/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Cc=Symbol("Comlink.proxy"),hf=Symbol("Comlink.endpoint"),pf=Symbol("Comlink.releaseProxy"),_a=Symbol("Comlink.finalizer"),yi=Symbol("Comlink.thrown"),xc=t=>typeof t=="object"&&t!==null||typeof t=="function",df={canHandle:t=>xc(t)&&t[Cc],serialize(t){const{port1:e,port2:n}=new MessageChannel;return b0(t,e),[n,[n]]},deserialize(t){return t.start(),Tf(t)}},mf={canHandle:t=>xc(t)&&yi in t,serialize({value:t}){let e;return t instanceof Error?e={isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:e={isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}},wc=new Map([["proxy",df],["throw",mf]]);function yf(t,e){for(const n of t)if(e===n||n==="*"||n instanceof RegExp&&n.test(e))return!0;return!1}function b0(t,e=globalThis,n=["*"]){e.addEventListener("message",function r(i){if(!i||!i.data)return;if(!yf(n,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:a,type:s,path:o}=Object.assign({path:[]},i.data),c=(i.data.argumentList||[]).map(gn);let l;try{const u=o.slice(0,-1).reduce((g,h)=>g[h],t),f=o.reduce((g,h)=>g[h],t);switch(s){case"GET":l=f;break;case"SET":u[o.slice(-1)[0]]=gn(i.data.value),l=!0;break;case"APPLY":l=f.apply(u,c);break;case"CONSTRUCT":{const g=new f(...c);l=Rf(g)}break;case"ENDPOINT":{const{port1:g,port2:h}=new MessageChannel;b0(t,h),l=Sf(g,[g])}break;case"RELEASE":l=void 0;break;default:return}}catch(u){l={value:u,[yi]:0}}Promise.resolve(l).catch(u=>({value:u,[yi]:0})).then(u=>{const[f,g]=Pi(u);e.postMessage(Object.assign(Object.assign({},f),{id:a}),g),s==="RELEASE"&&(e.removeEventListener("message",r),Sc(e),_a in t&&typeof t[_a]=="function"&&t[_a]())}).catch(u=>{const[f,g]=Pi({value:new TypeError("Unserializable return value"),[yi]:0});e.postMessage(Object.assign(Object.assign({},f),{id:a}),g)})}),e.start&&e.start()}function vf(t){return t.constructor.name==="MessagePort"}function Sc(t){vf(t)&&t.close()}function Tf(t,e){return t0(t,[],e)}function Qr(t){if(t)throw new Error("Proxy has been released and is not useable")}function Rc(t){return kn(t,{type:"RELEASE"}).then(()=>{Sc(t)})}const Ui=new WeakMap,ki="FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Ui.get(t)||0)-1;Ui.set(t,e),e===0&&Rc(t)});function Cf(t,e){const n=(Ui.get(e)||0)+1;Ui.set(e,n),ki&&ki.register(t,e,t)}function xf(t){ki&&ki.unregister(t)}function t0(t,e=[],n=function(){}){let r=!1;const i=new Proxy(n,{get(a,s){if(Qr(r),s===pf)return()=>{xf(i),Rc(t),r=!0};if(s==="then"){if(e.length===0)return{then:()=>i};const o=kn(t,{type:"GET",path:e.map(c=>c.toString())}).then(gn);return o.then.bind(o)}return t0(t,[...e,s])},set(a,s,o){Qr(r);const[c,l]=Pi(o);return kn(t,{type:"SET",path:[...e,s].map(u=>u.toString()),value:c},l).then(gn)},apply(a,s,o){Qr(r);const c=e[e.length-1];if(c===hf)return kn(t,{type:"ENDPOINT"}).then(gn);if(c==="bind")return t0(t,e.slice(0,-1));const[l,u]=js(o);return kn(t,{type:"APPLY",path:e.map(f=>f.toString()),argumentList:l},u).then(gn)},construct(a,s){Qr(r);const[o,c]=js(s);return kn(t,{type:"CONSTRUCT",path:e.map(l=>l.toString()),argumentList:o},c).then(gn)}});return Cf(i,t),i}function wf(t){return Array.prototype.concat.apply([],t)}function js(t){const e=t.map(Pi);return[e.map(n=>n[0]),wf(e.map(n=>n[1]))]}const Ec=new WeakMap;function Sf(t,e){return Ec.set(t,e),t}function Rf(t){return Object.assign(t,{[Cc]:!0})}function Pi(t){for(const[e,n]of wc)if(n.canHandle(t)){const[r,i]=n.serialize(t);return[{type:"HANDLER",name:e,value:r},i]}return[{type:"RAW",value:t},Ec.get(t)||[]]}function gn(t){switch(t.type){case"HANDLER":return wc.get(t.name).deserialize(t.value);case"RAW":return t.value}}function kn(t,e,n){return new Promise(r=>{const i=Ef();t.addEventListener("message",function a(s){!s.data||!s.data.id||s.data.id!==i||(t.removeEventListener("message",a),r(s.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:i},e),n)})}function Ef(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var A;(function(t){t.ERROR_EVENT="CORNERSTONE_ERROR",t.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",t.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",t.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",t.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",t.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",t.PRESET_MODIFIED="CORNERSTONE_VIEWPORT_RENDERING_PRESET_MODIFIED",t.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",t.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",t.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",t.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",t.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",t.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",t.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",t.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",t.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",t.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",t.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",t.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",t.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",t.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",t.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",t.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",t.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",t.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",t.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",t.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",t.VIEWPORT_NEW_IMAGE_SET="CORNERSTONE_VIEWPORT_NEW_IMAGE_SET",t.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",t.STACK_SCROLL_OUT_OF_BOUNDS="STACK_SCROLL_OUT_OF_BOUNDS",t.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",t.GEOMETRY_CACHE_GEOMETRY_REMOVED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_REMOVED",t.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS="VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS",t.VOLUME_VIEWPORT_SCROLL="VOLUME_VIEWPORT_SCROLL",t.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED",t.WEB_WORKER_PROGRESS="CORNERSTONE_WEB_WORKER_PROGRESS",t.COLORMAP_MODIFIED="CORNERSTONE_COLORMAP_MODIFIED",t.DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED="DYNAMIC_VOLUME_DIMENSION_GROUP_CHANGED",t.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED="DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED",t.DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED="DYNAMIC_VOLUME_DIMENSION_GROUP_LOADED",t.DYNAMIC_VOLUME_TIME_POINT_LOADED="DYNAMIC_VOLUME_TIME_POINT_LOADED",t.GEOMETRY_LOADED="GEOMETRY_LOADED",t.GEOMETRY_LOADED_FAILED="GEOMETRY_LOADED_FAILED"})(A||(A={}));var Q;(function(t){t.Interaction="interaction",t.Thumbnail="thumbnail",t.Prefetch="prefetch",t.Compute="compute"})(Q||(Q={}));var Ce;(function(t){t.STACK="stack",t.ORTHOGRAPHIC="orthographic",t.PERSPECTIVE="perspective",t.VOLUME_3D="volume3d",t.VIDEO="video",t.WHOLE_SLIDE="wholeSlide"})(Ce||(Ce={}));var Jt;(function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t[t.FAST_LINEAR=2]="FAST_LINEAR"})(Jt||(Jt={}));const vi={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4,RADON_TRANSFORM_BLEND:5,LABELMAP_EDGE_PROJECTION_BLEND:6},Mf={OFF:0,NORMALIZED:1,RAW:2};var Of={BlendMode:vi,FilterMode:Mf},br;(function(t){t.AXIAL="axial",t.CORONAL="coronal",t.SAGITTAL="sagittal",t.ACQUISITION="acquisition"})(br||(br={}));var qe;(function(t){t.LINEAR="LINEAR",t.SAMPLED_SIGMOID="SIGMOID",t.LINEAR_EXACT="LINEAR_EXACT"})(qe||(qe={}));var Ke;(function(t){t.NO_DATA="noData",t.LOADING="loading",t.PRE_RENDER="preRender",t.RESIZE="resize",t.RENDERED="rendered"})(Ke||(Ke={}));var st;(function(t){t[t.FAR_REPLICATE=1]="FAR_REPLICATE",t[t.ADJACENT_REPLICATE=3]="ADJACENT_REPLICATE",t[t.SUBRESOLUTION=6]="SUBRESOLUTION",t[t.LOSSY=7]="LOSSY",t[t.FULL_RESOLUTION=8]="FULL_RESOLUTION"})(st||(st={}));var Gi;(function(t){t.FRAME="f",t.SECOND="s"})(Gi||(Gi={}));var Je;(function(t){t.CALIBRATION="calibrationModule",t.CINE="cineModule",t.GENERAL_IMAGE="generalImageModule",t.GENERAL_SERIES="generalSeriesModule",t.GENERAL_STUDY="generalStudyModule",t.IMAGE_PIXEL="imagePixelModule",t.IMAGE_PLANE="imagePlaneModule",t.IMAGE_URL="imageUrlModule",t.MODALITY_LUT="modalityLutModule",t.MULTIFRAME="multiframeModule",t.NM_MULTIFRAME_GEOMETRY="nmMultiframeGeometryModule",t.OVERLAY_PLANE="overlayPlaneModule",t.PATIENT="patientModule",t.PATIENT_STUDY="patientStudyModule",t.PET_IMAGE="petImageModule",t.PET_ISOTOPE="petIsotopeModule",t.PET_SERIES="petSeriesModule",t.SOP_COMMON="sopCommonModule",t.ULTRASOUND_ENHANCED_REGION="ultrasoundEnhancedRegionModule",t.VOI_LUT="voiLutModule",t.WADO_WEB_CLIENT="wadoWebClient"})(Je||(Je={}));var n0;(function(t){t.RLE="RLE",t.Volume="Volume"})(n0||(n0={}));const Hs={hotIron:{name:"Hot Iron",numOfColors:256,colors:[[0,0,0,255],[2,0,0,255],[4,0,0,255],[6,0,0,255],[8,0,0,255],[10,0,0,255],[12,0,0,255],[14,0,0,255],[16,0,0,255],[18,0,0,255],[20,0,0,255],[22,0,0,255],[24,0,0,255],[26,0,0,255],[28,0,0,255],[30,0,0,255],[32,0,0,255],[34,0,0,255],[36,0,0,255],[38,0,0,255],[40,0,0,255],[42,0,0,255],[44,0,0,255],[46,0,0,255],[48,0,0,255],[50,0,0,255],[52,0,0,255],[54,0,0,255],[56,0,0,255],[58,0,0,255],[60,0,0,255],[62,0,0,255],[64,0,0,255],[66,0,0,255],[68,0,0,255],[70,0,0,255],[72,0,0,255],[74,0,0,255],[76,0,0,255],[78,0,0,255],[80,0,0,255],[82,0,0,255],[84,0,0,255],[86,0,0,255],[88,0,0,255],[90,0,0,255],[92,0,0,255],[94,0,0,255],[96,0,0,255],[98,0,0,255],[100,0,0,255],[102,0,0,255],[104,0,0,255],[106,0,0,255],[108,0,0,255],[110,0,0,255],[112,0,0,255],[114,0,0,255],[116,0,0,255],[118,0,0,255],[120,0,0,255],[122,0,0,255],[124,0,0,255],[126,0,0,255],[128,0,0,255],[130,0,0,255],[132,0,0,255],[134,0,0,255],[136,0,0,255],[138,0,0,255],[140,0,0,255],[142,0,0,255],[144,0,0,255],[146,0,0,255],[148,0,0,255],[150,0,0,255],[152,0,0,255],[154,0,0,255],[156,0,0,255],[158,0,0,255],[160,0,0,255],[162,0,0,255],[164,0,0,255],[166,0,0,255],[168,0,0,255],[170,0,0,255],[172,0,0,255],[174,0,0,255],[176,0,0,255],[178,0,0,255],[180,0,0,255],[182,0,0,255],[184,0,0,255],[186,0,0,255],[188,0,0,255],[190,0,0,255],[192,0,0,255],[194,0,0,255],[196,0,0,255],[198,0,0,255],[200,0,0,255],[202,0,0,255],[204,0,0,255],[206,0,0,255],[208,0,0,255],[210,0,0,255],[212,0,0,255],[214,0,0,255],[216,0,0,255],[218,0,0,255],[220,0,0,255],[222,0,0,255],[224,0,0,255],[226,0,0,255],[228,0,0,255],[230,0,0,255],[232,0,0,255],[234,0,0,255],[236,0,0,255],[238,0,0,255],[240,0,0,255],[242,0,0,255],[244,0,0,255],[246,0,0,255],[248,0,0,255],[250,0,0,255],[252,0,0,255],[254,0,0,255],[255,0,0,255],[255,2,0,255],[255,4,0,255],[255,6,0,255],[255,8,0,255],[255,10,0,255],[255,12,0,255],[255,14,0,255],[255,16,0,255],[255,18,0,255],[255,20,0,255],[255,22,0,255],[255,24,0,255],[255,26,0,255],[255,28,0,255],[255,30,0,255],[255,32,0,255],[255,34,0,255],[255,36,0,255],[255,38,0,255],[255,40,0,255],[255,42,0,255],[255,44,0,255],[255,46,0,255],[255,48,0,255],[255,50,0,255],[255,52,0,255],[255,54,0,255],[255,56,0,255],[255,58,0,255],[255,60,0,255],[255,62,0,255],[255,64,0,255],[255,66,0,255],[255,68,0,255],[255,70,0,255],[255,72,0,255],[255,74,0,255],[255,76,0,255],[255,78,0,255],[255,80,0,255],[255,82,0,255],[255,84,0,255],[255,86,0,255],[255,88,0,255],[255,90,0,255],[255,92,0,255],[255,94,0,255],[255,96,0,255],[255,98,0,255],[255,100,0,255],[255,102,0,255],[255,104,0,255],[255,106,0,255],[255,108,0,255],[255,110,0,255],[255,112,0,255],[255,114,0,255],[255,116,0,255],[255,118,0,255],[255,120,0,255],[255,122,0,255],[255,124,0,255],[255,126,0,255],[255,128,4,255],[255,130,8,255],[255,132,12,255],[255,134,16,255],[255,136,20,255],[255,138,24,255],[255,140,28,255],[255,142,32,255],[255,144,36,255],[255,146,40,255],[255,148,44,255],[255,150,48,255],[255,152,52,255],[255,154,56,255],[255,156,60,255],[255,158,64,255],[255,160,68,255],[255,162,72,255],[255,164,76,255],[255,166,80,255],[255,168,84,255],[255,170,88,255],[255,172,92,255],[255,174,96,255],[255,176,100,255],[255,178,104,255],[255,180,108,255],[255,182,112,255],[255,184,116,255],[255,186,120,255],[255,188,124,255],[255,190,128,255],[255,192,132,255],[255,194,136,255],[255,196,140,255],[255,198,144,255],[255,200,148,255],[255,202,152,255],[255,204,156,255],[255,206,160,255],[255,208,164,255],[255,210,168,255],[255,212,172,255],[255,214,176,255],[255,216,180,255],[255,218,184,255],[255,220,188,255],[255,222,192,255],[255,224,196,255],[255,226,200,255],[255,228,204,255],[255,230,208,255],[255,232,212,255],[255,234,216,255],[255,236,220,255],[255,238,224,255],[255,240,228,255],[255,242,232,255],[255,244,236,255],[255,246,240,255],[255,248,244,255],[255,250,248,255],[255,252,252,255],[255,255,255,255]]},pet:{name:"PET",numColors:256,colors:[[0,0,0,255],[0,2,1,255],[0,4,3,255],[0,6,5,255],[0,8,7,255],[0,10,9,255],[0,12,11,255],[0,14,13,255],[0,16,15,255],[0,18,17,255],[0,20,19,255],[0,22,21,255],[0,24,23,255],[0,26,25,255],[0,28,27,255],[0,30,29,255],[0,32,31,255],[0,34,33,255],[0,36,35,255],[0,38,37,255],[0,40,39,255],[0,42,41,255],[0,44,43,255],[0,46,45,255],[0,48,47,255],[0,50,49,255],[0,52,51,255],[0,54,53,255],[0,56,55,255],[0,58,57,255],[0,60,59,255],[0,62,61,255],[0,65,63,255],[0,67,65,255],[0,69,67,255],[0,71,69,255],[0,73,71,255],[0,75,73,255],[0,77,75,255],[0,79,77,255],[0,81,79,255],[0,83,81,255],[0,85,83,255],[0,87,85,255],[0,89,87,255],[0,91,89,255],[0,93,91,255],[0,95,93,255],[0,97,95,255],[0,99,97,255],[0,101,99,255],[0,103,101,255],[0,105,103,255],[0,107,105,255],[0,109,107,255],[0,111,109,255],[0,113,111,255],[0,115,113,255],[0,117,115,255],[0,119,117,255],[0,121,119,255],[0,123,121,255],[0,125,123,255],[0,128,125,255],[1,126,127,255],[3,124,129,255],[5,122,131,255],[7,120,133,255],[9,118,135,255],[11,116,137,255],[13,114,139,255],[15,112,141,255],[17,110,143,255],[19,108,145,255],[21,106,147,255],[23,104,149,255],[25,102,151,255],[27,100,153,255],[29,98,155,255],[31,96,157,255],[33,94,159,255],[35,92,161,255],[37,90,163,255],[39,88,165,255],[41,86,167,255],[43,84,169,255],[45,82,171,255],[47,80,173,255],[49,78,175,255],[51,76,177,255],[53,74,179,255],[55,72,181,255],[57,70,183,255],[59,68,185,255],[61,66,187,255],[63,64,189,255],[65,63,191,255],[67,61,193,255],[69,59,195,255],[71,57,197,255],[73,55,199,255],[75,53,201,255],[77,51,203,255],[79,49,205,255],[81,47,207,255],[83,45,209,255],[85,43,211,255],[86,41,213,255],[88,39,215,255],[90,37,217,255],[92,35,219,255],[94,33,221,255],[96,31,223,255],[98,29,225,255],[100,27,227,255],[102,25,229,255],[104,23,231,255],[106,21,233,255],[108,19,235,255],[110,17,237,255],[112,15,239,255],[114,13,241,255],[116,11,243,255],[118,9,245,255],[120,7,247,255],[122,5,249,255],[124,3,251,255],[126,1,253,255],[128,0,255,255],[130,2,252,255],[132,4,248,255],[134,6,244,255],[136,8,240,255],[138,10,236,255],[140,12,232,255],[142,14,228,255],[144,16,224,255],[146,18,220,255],[148,20,216,255],[150,22,212,255],[152,24,208,255],[154,26,204,255],[156,28,200,255],[158,30,196,255],[160,32,192,255],[162,34,188,255],[164,36,184,255],[166,38,180,255],[168,40,176,255],[170,42,172,255],[171,44,168,255],[173,46,164,255],[175,48,160,255],[177,50,156,255],[179,52,152,255],[181,54,148,255],[183,56,144,255],[185,58,140,255],[187,60,136,255],[189,62,132,255],[191,64,128,255],[193,66,124,255],[195,68,120,255],[197,70,116,255],[199,72,112,255],[201,74,108,255],[203,76,104,255],[205,78,100,255],[207,80,96,255],[209,82,92,255],[211,84,88,255],[213,86,84,255],[215,88,80,255],[217,90,76,255],[219,92,72,255],[221,94,68,255],[223,96,64,255],[225,98,60,255],[227,100,56,255],[229,102,52,255],[231,104,48,255],[233,106,44,255],[235,108,40,255],[237,110,36,255],[239,112,32,255],[241,114,28,255],[243,116,24,255],[245,118,20,255],[247,120,16,255],[249,122,12,255],[251,124,8,255],[253,126,4,255],[255,128,0,255],[255,130,4,255],[255,132,8,255],[255,134,12,255],[255,136,16,255],[255,138,20,255],[255,140,24,255],[255,142,28,255],[255,144,32,255],[255,146,36,255],[255,148,40,255],[255,150,44,255],[255,152,48,255],[255,154,52,255],[255,156,56,255],[255,158,60,255],[255,160,64,255],[255,162,68,255],[255,164,72,255],[255,166,76,255],[255,168,80,255],[255,170,85,255],[255,172,89,255],[255,174,93,255],[255,176,97,255],[255,178,101,255],[255,180,105,255],[255,182,109,255],[255,184,113,255],[255,186,117,255],[255,188,121,255],[255,190,125,255],[255,192,129,255],[255,194,133,255],[255,196,137,255],[255,198,141,255],[255,200,145,255],[255,202,149,255],[255,204,153,255],[255,206,157,255],[255,208,161,255],[255,210,165,255],[255,212,170,255],[255,214,174,255],[255,216,178,255],[255,218,182,255],[255,220,186,255],[255,222,190,255],[255,224,194,255],[255,226,198,255],[255,228,202,255],[255,230,206,255],[255,232,210,255],[255,234,214,255],[255,236,218,255],[255,238,222,255],[255,240,226,255],[255,242,230,255],[255,244,234,255],[255,246,238,255],[255,248,242,255],[255,250,246,255],[255,252,250,255],[255,255,255,255]]},hotMetalBlue:{name:"Hot Metal Blue",numColors:256,colors:[[0,0,0,255],[0,0,2,255],[0,0,4,255],[0,0,6,255],[0,0,8,255],[0,0,10,255],[0,0,12,255],[0,0,14,255],[0,0,16,255],[0,0,17,255],[0,0,19,255],[0,0,21,255],[0,0,23,255],[0,0,25,255],[0,0,27,255],[0,0,29,255],[0,0,31,255],[0,0,33,255],[0,0,35,255],[0,0,37,255],[0,0,39,255],[0,0,41,255],[0,0,43,255],[0,0,45,255],[0,0,47,255],[0,0,49,255],[0,0,51,255],[0,0,53,255],[0,0,55,255],[0,0,57,255],[0,0,59,255],[0,0,61,255],[0,0,63,255],[0,0,65,255],[0,0,67,255],[0,0,69,255],[0,0,71,255],[0,0,73,255],[0,0,75,255],[0,0,77,255],[0,0,79,255],[0,0,81,255],[0,0,83,255],[0,0,84,255],[0,0,86,255],[0,0,88,255],[0,0,90,255],[0,0,92,255],[0,0,94,255],[0,0,96,255],[0,0,98,255],[0,0,100,255],[0,0,102,255],[0,0,104,255],[0,0,106,255],[0,0,108,255],[0,0,110,255],[0,0,112,255],[0,0,114,255],[0,0,116,255],[0,0,117,255],[0,0,119,255],[0,0,121,255],[0,0,123,255],[0,0,125,255],[0,0,127,255],[0,0,129,255],[0,0,131,255],[0,0,133,255],[0,0,135,255],[0,0,137,255],[0,0,139,255],[0,0,141,255],[0,0,143,255],[0,0,145,255],[0,0,147,255],[0,0,149,255],[0,0,151,255],[0,0,153,255],[0,0,155,255],[0,0,157,255],[0,0,159,255],[0,0,161,255],[0,0,163,255],[0,0,165,255],[0,0,167,255],[3,0,169,255],[6,0,171,255],[9,0,173,255],[12,0,175,255],[15,0,177,255],[18,0,179,255],[21,0,181,255],[24,0,183,255],[26,0,184,255],[29,0,186,255],[32,0,188,255],[35,0,190,255],[38,0,192,255],[41,0,194,255],[44,0,196,255],[47,0,198,255],[50,0,200,255],[52,0,197,255],[55,0,194,255],[57,0,191,255],[59,0,188,255],[62,0,185,255],[64,0,182,255],[66,0,179,255],[69,0,176,255],[71,0,174,255],[74,0,171,255],[76,0,168,255],[78,0,165,255],[81,0,162,255],[83,0,159,255],[85,0,156,255],[88,0,153,255],[90,0,150,255],[93,2,144,255],[96,4,138,255],[99,6,132,255],[102,8,126,255],[105,9,121,255],[108,11,115,255],[111,13,109,255],[114,15,103,255],[116,17,97,255],[119,19,91,255],[122,21,85,255],[125,23,79,255],[128,24,74,255],[131,26,68,255],[134,28,62,255],[137,30,56,255],[140,32,50,255],[143,34,47,255],[146,36,44,255],[149,38,41,255],[152,40,38,255],[155,41,35,255],[158,43,32,255],[161,45,29,255],[164,47,26,255],[166,49,24,255],[169,51,21,255],[172,53,18,255],[175,55,15,255],[178,56,12,255],[181,58,9,255],[184,60,6,255],[187,62,3,255],[190,64,0,255],[194,66,0,255],[198,68,0,255],[201,70,0,255],[205,72,0,255],[209,73,0,255],[213,75,0,255],[217,77,0,255],[221,79,0,255],[224,81,0,255],[228,83,0,255],[232,85,0,255],[236,87,0,255],[240,88,0,255],[244,90,0,255],[247,92,0,255],[251,94,0,255],[255,96,0,255],[255,98,3,255],[255,100,6,255],[255,102,9,255],[255,104,12,255],[255,105,15,255],[255,107,18,255],[255,109,21,255],[255,111,24,255],[255,113,26,255],[255,115,29,255],[255,117,32,255],[255,119,35,255],[255,120,38,255],[255,122,41,255],[255,124,44,255],[255,126,47,255],[255,128,50,255],[255,130,53,255],[255,132,56,255],[255,134,59,255],[255,136,62,255],[255,137,65,255],[255,139,68,255],[255,141,71,255],[255,143,74,255],[255,145,76,255],[255,147,79,255],[255,149,82,255],[255,151,85,255],[255,152,88,255],[255,154,91,255],[255,156,94,255],[255,158,97,255],[255,160,100,255],[255,162,103,255],[255,164,106,255],[255,166,109,255],[255,168,112,255],[255,169,115,255],[255,171,118,255],[255,173,121,255],[255,175,124,255],[255,177,126,255],[255,179,129,255],[255,181,132,255],[255,183,135,255],[255,184,138,255],[255,186,141,255],[255,188,144,255],[255,190,147,255],[255,192,150,255],[255,194,153,255],[255,196,156,255],[255,198,159,255],[255,200,162,255],[255,201,165,255],[255,203,168,255],[255,205,171,255],[255,207,174,255],[255,209,176,255],[255,211,179,255],[255,213,182,255],[255,215,185,255],[255,216,188,255],[255,218,191,255],[255,220,194,255],[255,222,197,255],[255,224,200,255],[255,226,203,255],[255,228,206,255],[255,229,210,255],[255,231,213,255],[255,233,216,255],[255,235,219,255],[255,237,223,255],[255,239,226,255],[255,240,229,255],[255,242,232,255],[255,244,236,255],[255,246,239,255],[255,248,242,255],[255,250,245,255],[255,251,249,255],[255,253,252,255],[255,255,255,255]]},pet20Step:{name:"PET 20 Step",numColors:256,colors:[[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[0,0,0,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[96,0,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,80,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[48,48,112,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[80,80,128,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[96,96,176,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[112,112,192,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[128,128,224,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,96,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[48,144,48,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[80,192,80,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[64,224,64,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[224,224,80,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,208,96,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,176,64,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[208,144,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[192,96,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[176,48,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,0,0,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255],[255,255,255,255]]},gray:{name:"Gray",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,1,1]]}},jet:{name:"Jet",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]}},hsv:{name:"HSV",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[.15873,1,1],[.174603,.96875,.96875],[.333333,.03125,.03125],[.349206,0,0],[.666667,0,0],[.68254,.03125,.03125],[.84127,.96875,.96875],[.857143,1,1],[1,1,1]],green:[[0,0,0],[.15873,.9375,.9375],[.174603,1,1],[.507937,1,1],[.666667,.0625,.0625],[.68254,0,0],[1,0,0]],blue:[[0,0,0],[.333333,0,0],[.349206,.0625,.0625],[.507937,1,1],[.84127,1,1],[.857143,.9375,.9375],[1,.09375,.09375]]}},hot:{name:"Hot",numColors:256,gamma:1,segmentedData:{red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]}},cool:{name:"Cool",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,1,1],[1,0,0]],blue:[[0,1,1],[1,1,1]]}},spring:{name:"Spring",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,0,0]]}},summer:{name:"Summer",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,1,1]],green:[[0,.5,.5],[1,1,1]],blue:[[0,.4,.4],[1,.4,.4]]}},autumn:{name:"Autumn",numColors:256,gamma:1,segmentedData:{red:[[0,1,1],[1,1,1]],green:[[0,0,0],[1,1,1]],blue:[[0,0,0],[1,0,0]]}},winter:{name:"Winter",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[1,0,0]],green:[[0,0,0],[1,1,1]],blue:[[0,1,1],[1,.5,.5]]}},bone:{name:"Bone",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.746032,.652778,.652778],[1,1,1]],green:[[0,0,0],[.365079,.319444,.319444],[.746032,.777778,.777778],[1,1,1]],blue:[[0,0,0],[.365079,.444444,.444444],[1,1,1]]}},copper:{name:"Copper",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.809524,1,1],[1,1,1]],green:[[0,0,0],[1,.7812,.7812]],blue:[[0,0,0],[1,.4975,.4975]]}},spectral:{name:"Spectral",numColors:256,gamma:1,segmentedData:{red:[[0,0,0],[.05,.4667,.4667],[.1,.5333,.5333],[.15,0,0],[.2,0,0],[.25,0,0],[.3,0,0],[.35,0,0],[.4,0,0],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,.7333,.7333],[.7,.9333,.9333],[.75,1,1],[.8,1,1],[.85,1,1],[.9,.8667,.8667],[.95,.8,.8],[1,.8,.8]],green:[[0,0,0],[.05,0,0],[.1,0,0],[.15,0,0],[.2,0,0],[.25,.4667,.4667],[.3,.6,.6],[.35,.6667,.6667],[.4,.6667,.6667],[.45,.6,.6],[.5,.7333,.7333],[.55,.8667,.8667],[.6,1,1],[.65,1,1],[.7,.9333,.9333],[.75,.8,.8],[.8,.6,.6],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]],blue:[[0,0,0],[.05,.5333,.5333],[.1,.6,.6],[.15,.6667,.6667],[.2,.8667,.8667],[.25,.8667,.8667],[.3,.8667,.8667],[.35,.6667,.6667],[.4,.5333,.5333],[.45,0,0],[.5,0,0],[.55,0,0],[.6,0,0],[.65,0,0],[.7,0,0],[.75,0,0],[.8,0,0],[.85,0,0],[.9,0,0],[.95,0,0],[1,.8,.8]]}},coolwarm:{name:"CoolWarm",numColors:256,gamma:1,segmentedData:{red:[[0,.2298057,.2298057],[.03125,.26623388,.26623388],[.0625,.30386891,.30386891],[.09375,.342804478,.342804478],[.125,.38301334,.38301334],[.15625,.424369608,.424369608],[.1875,.46666708,.46666708],[.21875,.509635204,.509635204],[.25,.552953156,.552953156],[.28125,.596262162,.596262162],[.3125,.639176211,.639176211],[.34375,.681291281,.681291281],[.375,.722193294,.722193294],[.40625,.761464949,.761464949],[.4375,.798691636,.798691636],[.46875,.833466556,.833466556],[.5,.865395197,.865395197],[.53125,.897787179,.897787179],[.5625,.924127593,.924127593],[.59375,.944468518,.944468518],[.625,.958852946,.958852946],[.65625,.96732803,.96732803],[.6875,.969954137,.969954137],[.71875,.966811177,.966811177],[.75,.958003065,.958003065],[.78125,.943660866,.943660866],[.8125,.923944917,.923944917],[.84375,.89904617,.89904617],[.875,.869186849,.869186849],[.90625,.834620542,.834620542],[.9375,.795631745,.795631745],[.96875,.752534934,.752534934],[1,.705673158,.705673158]],green:[[0,.298717966,.298717966],[.03125,.353094838,.353094838],[.0625,.406535296,.406535296],[.09375,.458757618,.458757618],[.125,.50941904,.50941904],[.15625,.558148092,.558148092],[.1875,.604562568,.604562568],[.21875,.648280772,.648280772],[.25,.688929332,.688929332],[.28125,.726149107,.726149107],[.3125,.759599947,.759599947],[.34375,.788964712,.788964712],[.375,.813952739,.813952739],[.40625,.834302879,.834302879],[.4375,.849786142,.849786142],[.46875,.860207984,.860207984],[.5,.86541021,.86541021],[.53125,.848937047,.848937047],[.5625,.827384882,.827384882],[.59375,.800927443,.800927443],[.625,.769767752,.769767752],[.65625,.734132809,.734132809],[.6875,.694266682,.694266682],[.71875,.650421156,.650421156],[.75,.602842431,.602842431],[.78125,.551750968,.551750968],[.8125,.49730856,.49730856],[.84375,.439559467,.439559467],[.875,.378313092,.378313092],[.90625,.312874446,.312874446],[.9375,.24128379,.24128379],[.96875,.157246067,.157246067],[1,.01555616,.01555616]],blue:[[0,.753683153,.753683153],[.03125,.801466763,.801466763],[.0625,.84495867,.84495867],[.09375,.883725899,.883725899],[.125,.917387822,.917387822],[.15625,.945619588,.945619588],[.1875,.968154911,.968154911],[.21875,.98478814,.98478814],[.25,.995375608,.995375608],[.28125,.999836203,.999836203],[.3125,.998151185,.998151185],[.34375,.990363227,.990363227],[.375,.976574709,.976574709],[.40625,.956945269,.956945269],[.4375,.931688648,.931688648],[.46875,.901068838,.901068838],[.5,.865395561,.865395561],[.53125,.820880546,.820880546],[.5625,.774508472,.774508472],[.59375,.726736146,.726736146],[.625,.678007945,.678007945],[.65625,.628751763,.628751763],[.6875,.579375448,.579375448],[.71875,.530263762,.530263762],[.75,.481775914,.481775914],[.78125,.434243684,.434243684],[.8125,.387970225,.387970225],[.84375,.343229596,.343229596],[.875,.300267182,.300267182],[.90625,.259301199,.259301199],[.9375,.220525627,.220525627],[.96875,.184115123,.184115123],[1,.150232812,.150232812]]}},blues:{name:"Blues",numColors:256,gamma:1,segmentedData:{red:[[0,.9686274528503418,.9686274528503418],[.125,.8705882430076599,.8705882430076599],[.25,.7764706015586853,.7764706015586853],[.375,.6196078658103943,.6196078658103943],[.5,.41960784792900085,.41960784792900085],[.625,.25882354378700256,.25882354378700256],[.75,.12941177189350128,.12941177189350128],[.875,.0313725508749485,.0313725508749485],[1,.0313725508749485,.0313725508749485]],green:[[0,.9843137264251709,.9843137264251709],[.125,.9215686321258545,.9215686321258545],[.25,.8588235378265381,.8588235378265381],[.375,.7921568751335144,.7921568751335144],[.5,.6823529601097107,.6823529601097107],[.625,.572549045085907,.572549045085907],[.75,.4431372582912445,.4431372582912445],[.875,.3176470696926117,.3176470696926117],[1,.1882352977991104,.1882352977991104]],blue:[[0,1,1],[.125,.9686274528503418,.9686274528503418],[.25,.9372549057006836,.9372549057006836],[.375,.8823529481887817,.8823529481887817],[.5,.8392156958580017,.8392156958580017],[.625,.7764706015586853,.7764706015586853],[.75,.7098039388656616,.7098039388656616],[.875,.6117647290229797,.6117647290229797],[1,.41960784792900085,.41960784792900085]]}}},Te={MINIMUM_SLAB_THICKNESS:.05,MAXIMUM_RAY_DISTANCE:1e6};Object.freeze(Te);const Pt=.001;function Mc(t){const e=Object.getOwnPropertyNames(t);for(const n of e){const r=t[n];r&&typeof r=="object"&&Mc(r)}return Object.freeze(t)}const Df={axial:{viewPlaneNormal:[0,0,-1],viewUp:[0,-1,0],viewRight:[1,0,0]},sagittal:{viewPlaneNormal:[1,0,0],viewUp:[0,0,1],viewRight:[0,1,0]},coronal:{viewPlaneNormal:[0,-1,0],viewUp:[0,0,1],viewRight:[1,0,0]}},dn=Mc(Df),Vf=[{name:"CT-AAA",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 143.556 0 166.222 0.686275 214.389 0.696078 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 143.556 0.615686 0.356863 0.184314 166.222 0.882353 0.603922 0.290196 214.389 1 1 1 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-AAA2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"16 -3024 0 129.542 0 145.244 0.166667 157.02 0.5 169.918 0.627451 395.575 0.8125 1578.73 0.8125 3071 0.8125",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"32 -3024 0 0 0 129.542 0.54902 0.25098 0.14902 145.244 0.6 0.627451 0.843137 157.02 0.890196 0.47451 0.6 169.918 0.992157 0.870588 0.392157 395.575 1 0.886275 0.658824 1578.73 1 0.829256 0.957922 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -16.4458 0 641.385 0.715686 3071 0.705882",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -16.4458 0.729412 0.254902 0.301961 641.385 0.905882 0.815686 0.552941 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Bones",gradientOpacity:"4 0 1 985.12 1",specularPower:"1",scalarOpacity:"8 -1000 0 152.19 0 278.93 0.190476 952 0.2",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -1000 0.3 0.3 1 -488 0.3 1 0.3 463.28 1 0 0 659.15 1 0.912535 0.0374849 953 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-Cardiac",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 -77.6875 0 94.9518 0.285714 179.052 0.553571 260.439 0.848214 3071 0.875",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 -77.6875 0.54902 0.25098 0.14902 94.9518 0.882353 0.603922 0.290196 179.052 1 0.937033 0.954531 260.439 0.615686 0 0 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac2",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"12 -3024 0 42.8964 0 163.488 0.428571 277.642 0.776786 1587 0.754902 3071 0.754902",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"24 -3024 0 0 0 42.8964 0.54902 0.25098 0.14902 163.488 0.917647 0.639216 0.0588235 277.642 1 0.878431 0.623529 1587 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cardiac3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -3024 0 -86.9767 0 45.3791 0.169643 139.919 0.589286 347.907 0.607143 1224.16 0.607143 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -3024 0 0 0 -86.9767 0 0.25098 1 45.3791 1 0 0 139.919 1 0.894893 0.894893 347.907 1 1 0.25098 1224.16 1 1 1 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Contrast-Enhanced",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 67.0106 0 251.105 0.446429 439.291 0.625 3071 0.616071",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 67.0106 0.54902 0.25098 0.14902 251.105 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Chest-Vessels",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -3024 0 -1278.35 0 22.8277 0.428571 439.291 0.625 3071 0.616071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"20 -3024 0 0 0 -1278.35 0.54902 0.25098 0.14902 22.8277 0.882353 0.603922 0.290196 439.291 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 136.47 0 159.215 0.258929 318.43 0.571429 478.693 0.776786 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 136.47 0 0 0 159.215 0.159804 0.159804 0.159804 318.43 0.764706 0.764706 0.764706 478.693 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-2",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 142.677 0 145.016 0.116071 192.174 0.5625 217.24 0.776786 384.347 0.830357 3661 0.830357",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 142.677 0 0 0 145.016 0.615686 0 0.0156863 192.174 0.909804 0.454902 0 217.24 0.972549 0.807843 0.611765 384.347 0.909804 0.909804 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Coronary-Arteries-3",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"14 -2048 0 128.643 0 129.982 0.0982143 173.636 0.669643 255.884 0.857143 584.878 0.866071 3661 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"28 -2048 0 0 0 128.643 0 0 0 129.982 0.615686 0 0.0156863 173.636 0.909804 0.454902 0 255.884 0.886275 0.886275 0.886275 584.878 0.968627 0.968627 0.968627 3661 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Cropped-Volume-Bone",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -451 0 -450 1 1050 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -451 0 0 0 -450 0.0556356 0.0556356 0.0556356 1050 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Fat",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"14 -1000 0 -100 0 -99 0.15 -60 0.15 -59 0 101.2 0 952 0",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"36 -1000 0.3 0.3 1 -497.5 0.3 1 0.3 -99 0 0 1 -76.946 0 1 0 -65.481 0.835431 0.888889 0.0165387 83.89 1 0 0 463.28 1 0 0 659.15 1 0.912535 0.0374849 2952 1 0.300267 0.299886",diffuse:"1",interpolation:"1"},{name:"CT-Liver-Vasculature",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 149.113 0 157.884 0.482143 339.96 0.660714 388.526 0.830357 1197.95 0.839286 3661 0.848214",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 149.113 0 0 0 157.884 0.501961 0.25098 0 339.96 0.695386 0.59603 0.36886 388.526 0.854902 0.85098 0.827451 1197.95 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Lung",gradientOpacity:"6 0 1 985.12 1 988 1",specularPower:"1",scalarOpacity:"12 -1000 0 -600 0 -599 0.15 -400 0.15 -399 0 2952 0",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -1000 0.3 0.3 1 -600 0 0 1 -530 0.134704 0.781726 0.0724558 -460 0.929244 1 0.109473 -400 0.888889 0.254949 0.0240258 2952 1 0.3 0.3",diffuse:"1",interpolation:"1"},{name:"CT-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0 -637.62 0 700 1 3071 1",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 0 0 0 -637.62 1 1 1 700 1 1 1 3071 1 1 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Muscle",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"10 -3024 0 -155.407 0 217.641 0.676471 419.736 0.833333 3071 0.803922",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"20 -3024 0 0 0 -155.407 0.54902 0.25098 0.14902 217.641 0.882353 0.603922 0.290196 419.736 1 0.937033 0.954531 3071 0.827451 0.658824 1",diffuse:"0.9",interpolation:"1"},{name:"CT-Pulmonary-Arteries",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"14 -2048 0 -568.625 0 -364.081 0.0714286 -244.813 0.401786 18.2775 0.607143 447.798 0.830357 3592.73 0.839286",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"28 -2048 0 0 0 -568.625 0 0 0 -364.081 0.396078 0.301961 0.180392 -244.813 0.611765 0.352941 0.0705882 18.2775 0.843137 0.0156863 0.156863 447.798 0.752941 0.752941 0.752941 3592.73 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Soft-Tissue",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"10 -2048 0 -167.01 0 -160 1 240 1 3661 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"20 -2048 0 0 0 -167.01 0 0 0 -160 0.0556356 0.0556356 0.0556356 240 1 1 1 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"CT-Air",gradientOpacity:"4 0 1 255 1",specularPower:"10",scalarOpacity:"8 -3024 0.705882 -900.0 0.715686 -500.0 0 3071 0",specular:"0.2",shade:"1",ambient:"0.1",colorTransfer:"16 -3024 1 1 1 -900.0 0.2 1.0 1.0 -500.0 0.3 0.3 1.0 3071 0 0 0 ",diffuse:"0.9",interpolation:"1"},{name:"MR-Angio",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 -2048 0 151.354 0 158.279 0.4375 190.112 0.580357 200.873 0.732143 3661 0.741071",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 -2048 0 0 0 151.354 0 0 0 158.279 0.74902 0.376471 0 190.112 1 0.866667 0.733333 200.873 0.937255 0.937255 0.937255 3661 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-Default",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"12 0 0 20 0 40 0.15 120 0.3 220 0.375 1024 0.5",specular:"0",shade:"1",ambient:"0.2",colorTransfer:"24 0 0 0 0 20 0.168627 0 0 40 0.403922 0.145098 0.0784314 120 0.780392 0.607843 0.380392 220 0.847059 0.835294 0.788235 1024 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-MIP",gradientOpacity:"4 0 1 255 1",specularPower:"1",scalarOpacity:"8 0 0 98.3725 0 416.637 1 2800 1",specular:"0",shade:"0",ambient:"0.2",colorTransfer:"16 0 1 1 1 98.3725 1 1 1 416.637 1 1 1 2800 1 1 1",diffuse:"1",interpolation:"1"},{name:"MR-T2-Brain",gradientOpacity:"4 0 1 160.25 1",specularPower:"40",scalarOpacity:"10 0 0 36.05 0 218.302 0.171429 412.406 1 641 1",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"16 0 0 0 0 98.7223 0.956863 0.839216 0.192157 412.406 0 0.592157 0.807843 641 1 1 1",diffuse:"0.6",interpolation:"1"},{name:"DTI-FA-Brain",gradientOpacity:"4 0 1 0.9950 1",specularPower:"40",scalarOpacity:"16 0 0 0 0 0.3501 0.0158 0.49379 0.7619 0.6419 1 0.9920 1 0.9950 0 0.9950 0",specular:"0.5",shade:"1",ambient:"0.3",colorTransfer:"28 0 1 0 0 0 1 0 0 0.24974 0.4941 1 0 0.49949 0 0.9882 1 0.7492 0.51764 0 1 0.9950 1 0 0 0.9950 1 0 0",diffuse:"0.9",interpolation:"1"}],ur={},Fr={get:t=>ur[t],set:t=>{const e=t.id;ur[e]=t},delete:t=>delete ur[t],getAll:()=>{const e=Object.keys(ur).map(n=>ur[n]);return e.sort((n,r)=>n.id[0]==="_"&&r.id[0]!=="_"?1:n.id[0]!=="_"&&r.id[0]==="_"?-1:0),e}};class If{constructor(){this.listeners={},this.debouncedListeners={}}reset(){this.listeners={},this.debouncedListeners={}}addEventListenerOnce(e,n){const r=i=>{this.removeEventListener(e,r),n.call(this,i)};this.addEventListener(e,r)}addEventListener(e,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].indexOf(n)===-1&&this.listeners[e].push(n)}addEventListenerDebounced(e,n,r){this.debouncedListeners[e]=this.debouncedListeners[e]||{};const i=this.debouncedListeners[e];if(!i[n]){const a=s=>{i[n]&&clearTimeout(i[n].timeoutId),i[n].timeoutId=setTimeout(()=>{n.call(this,s)},r)};i[n]={original:n,handle:a,timeoutId:null},this.addEventListener(e,a)}}removeEventListenerDebounced(e,n){var r;if((r=this.debouncedListeners[e])!=null&&r[n]){const i=this.debouncedListeners[e][n];this.removeEventListener(e,i.handle),clearTimeout(i.timeoutId),delete this.debouncedListeners[e][n]}}removeEventListener(e,n){if(!this.listeners[e])return;const r=this.listeners[e],i=r.length;for(let a=0;a<i;a++)if(r[a]===n){r.splice(a,1);return}}dispatchEvent(e){if(!this.listeners[e.type])return!e.defaultPrevented;const n=this.listeners[e.type].slice(),r=n.length;for(let i=0;i<r;i++)try{n[i].call(this,e)}catch(a){console.error(`error in event listener of type:  ${e.type}`,a)}return!e.defaultPrevented}}const ae=new If;function Rt(){return typeof crypto.randomUUID=="function"?crypto.randomUUID():("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}function H(t=ae,e,n=null){if(!e)throw new Error("Event type was not defined");const r=new CustomEvent(e,{detail:n,cancelable:!0});return t==null?void 0:t.dispatchEvent(r)}var at=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function F0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Lf(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Nf=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!t(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(a=Object.keys(e),r=a.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;i--!==0;){var s=a[i];if(!t(e[s],n[s]))return!1}return!0}return e!==e&&n!==n},Oc=F0(Nf),Ks=Object.prototype.toString,Dc=function(e){var n=Ks.call(e),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Ks.call(e.callee)==="[object Function]"),r},Ua,qs;function bf(){if(qs)return Ua;qs=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=Dc,i=Object.prototype.propertyIsEnumerable,a=!i.call({toString:null},"toString"),s=i.call(function(){},"prototype"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(g){var h=g.constructor;return h&&h.prototype===g},l={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},u=function(){if(typeof window>"u")return!1;for(var g in window)try{if(!l["$"+g]&&e.call(window,g)&&window[g]!==null&&typeof window[g]=="object")try{c(window[g])}catch{return!0}}catch{return!0}return!1}(),f=function(g){if(typeof window>"u"||!u)return c(g);try{return c(g)}catch{return!1}};t=function(h){var p=h!==null&&typeof h=="object",d=n.call(h)==="[object Function]",m=r(h),y=p&&n.call(h)==="[object String]",T=[];if(!p&&!d&&!m)throw new TypeError("Object.keys called on a non-object");var v=s&&d;if(y&&h.length>0&&!e.call(h,0))for(var C=0;C<h.length;++C)T.push(String(C));if(m&&h.length>0)for(var x=0;x<h.length;++x)T.push(String(x));else for(var w in h)!(v&&w==="prototype")&&e.call(h,w)&&T.push(String(w));if(a)for(var E=f(h),O=0;O<o.length;++O)!(E&&o[O]==="constructor")&&e.call(h,o[O])&&T.push(o[O]);return T}}return Ua=t,Ua}var Ff=Array.prototype.slice,_f=Dc,Xs=Object.keys,Ti=Xs?function(e){return Xs(e)}:bf(),Ys=Object.keys;Ti.shim=function(){if(Object.keys){var e=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);e||(Object.keys=function(r){return _f(r)?Ys(Ff.call(r)):Ys(r)})}else Object.keys=Ti;return Object.keys||Ti};var Uf=Ti,kf=Error,Pf=EvalError,Gf=RangeError,Af=ReferenceError,Vc=SyntaxError,Ic=TypeError,Bf=URIError,Wf=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[n]=i;for(n in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==n||!Object.prototype.propertyIsEnumerable.call(e,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(e,n);if(s.value!==i||s.enumerable!==!0)return!1}return!0},Zs=typeof Symbol<"u"&&Symbol,zf=Wf,$f=function(){return typeof Zs!="function"||typeof Symbol!="function"||typeof Zs("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:zf()},ka={__proto__:null,foo:{}},jf=Object,Hf=function(){return{__proto__:ka}.foo===ka.foo&&!(ka instanceof jf)},Kf="Function.prototype.bind called on incompatible ",qf=Object.prototype.toString,Xf=Math.max,Yf="[object Function]",Js=function(e,n){for(var r=[],i=0;i<e.length;i+=1)r[i]=e[i];for(var a=0;a<n.length;a+=1)r[a+e.length]=n[a];return r},Zf=function(e,n){for(var r=[],i=n,a=0;i<e.length;i+=1,a+=1)r[a]=e[i];return r},Jf=function(t,e){for(var n="",r=0;r<t.length;r+=1)n+=t[r],r+1<t.length&&(n+=e);return n},Qf=function(e){var n=this;if(typeof n!="function"||qf.apply(n)!==Yf)throw new TypeError(Kf+n);for(var r=Zf(arguments,1),i,a=function(){if(this instanceof i){var u=n.apply(this,Js(r,arguments));return Object(u)===u?u:this}return n.apply(e,Js(r,arguments))},s=Xf(0,n.length-r.length),o=[],c=0;c<s;c++)o[c]="$"+c;if(i=Function("binder","return function ("+Jf(o,",")+"){ return binder.apply(this,arguments); }")(a),n.prototype){var l=function(){};l.prototype=n.prototype,i.prototype=new l,l.prototype=null}return i},e5=Qf,Lc=Function.prototype.bind||e5,t5=Function.prototype.call,n5=Object.prototype.hasOwnProperty,r5=Lc,i5=r5.call(t5,n5),te,a5=kf,s5=Pf,o5=Gf,c5=Af,Zn=Vc,Hn=Ic,l5=Bf,Nc=Function,Pa=function(t){try{return Nc('"use strict"; return ('+t+").constructor;")()}catch{}},Tn=Object.getOwnPropertyDescriptor;if(Tn)try{Tn({},"")}catch{Tn=null}var Ga=function(){throw new Hn},u5=Tn?function(){try{return arguments.callee,Ga}catch{try{return Tn(arguments,"callee").get}catch{return Ga}}}():Ga,Vn=$f(),f5=Hf(),be=Object.getPrototypeOf||(f5?function(t){return t.__proto__}:null),Pn={},g5=typeof Uint8Array>"u"||!be?te:be(Uint8Array),Cn={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?te:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?te:ArrayBuffer,"%ArrayIteratorPrototype%":Vn&&be?be([][Symbol.iterator]()):te,"%AsyncFromSyncIteratorPrototype%":te,"%AsyncFunction%":Pn,"%AsyncGenerator%":Pn,"%AsyncGeneratorFunction%":Pn,"%AsyncIteratorPrototype%":Pn,"%Atomics%":typeof Atomics>"u"?te:Atomics,"%BigInt%":typeof BigInt>"u"?te:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?te:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?te:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?te:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":a5,"%eval%":eval,"%EvalError%":s5,"%Float32Array%":typeof Float32Array>"u"?te:Float32Array,"%Float64Array%":typeof Float64Array>"u"?te:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?te:FinalizationRegistry,"%Function%":Nc,"%GeneratorFunction%":Pn,"%Int8Array%":typeof Int8Array>"u"?te:Int8Array,"%Int16Array%":typeof Int16Array>"u"?te:Int16Array,"%Int32Array%":typeof Int32Array>"u"?te:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Vn&&be?be(be([][Symbol.iterator]())):te,"%JSON%":typeof JSON=="object"?JSON:te,"%Map%":typeof Map>"u"?te:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Vn||!be?te:be(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?te:Promise,"%Proxy%":typeof Proxy>"u"?te:Proxy,"%RangeError%":o5,"%ReferenceError%":c5,"%Reflect%":typeof Reflect>"u"?te:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?te:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Vn||!be?te:be(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?te:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Vn&&be?be(""[Symbol.iterator]()):te,"%Symbol%":Vn?Symbol:te,"%SyntaxError%":Zn,"%ThrowTypeError%":u5,"%TypedArray%":g5,"%TypeError%":Hn,"%Uint8Array%":typeof Uint8Array>"u"?te:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?te:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?te:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?te:Uint32Array,"%URIError%":l5,"%WeakMap%":typeof WeakMap>"u"?te:WeakMap,"%WeakRef%":typeof WeakRef>"u"?te:WeakRef,"%WeakSet%":typeof WeakSet>"u"?te:WeakSet};if(be)try{null.error}catch(t){var h5=be(be(t));Cn["%Error.prototype%"]=h5}var p5=function t(e){var n;if(e==="%AsyncFunction%")n=Pa("async function () {}");else if(e==="%GeneratorFunction%")n=Pa("function* () {}");else if(e==="%AsyncGeneratorFunction%")n=Pa("async function* () {}");else if(e==="%AsyncGenerator%"){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if(e==="%AsyncIteratorPrototype%"){var i=t("%AsyncGenerator%");i&&be&&(n=be(i.prototype))}return Cn[e]=n,n},Qs={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},$r=Lc,Ai=i5,d5=$r.call(Function.call,Array.prototype.concat),m5=$r.call(Function.apply,Array.prototype.splice),eo=$r.call(Function.call,String.prototype.replace),Bi=$r.call(Function.call,String.prototype.slice),y5=$r.call(Function.call,RegExp.prototype.exec),v5=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,T5=/\\(\\)?/g,C5=function(e){var n=Bi(e,0,1),r=Bi(e,-1);if(n==="%"&&r!=="%")throw new Zn("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&n!=="%")throw new Zn("invalid intrinsic syntax, expected opening `%`");var i=[];return eo(e,v5,function(a,s,o,c){i[i.length]=o?eo(c,T5,"$1"):s||a}),i},x5=function(e,n){var r=e,i;if(Ai(Qs,r)&&(i=Qs[r],r="%"+i[0]+"%"),Ai(Cn,r)){var a=Cn[r];if(a===Pn&&(a=p5(r)),typeof a>"u"&&!n)throw new Hn("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:a}}throw new Zn("intrinsic "+e+" does not exist!")},bc=function(e,n){if(typeof e!="string"||e.length===0)throw new Hn("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new Hn('"allowMissing" argument must be a boolean');if(y5(/^%?[^%]*%?$/,e)===null)throw new Zn("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=C5(e),i=r.length>0?r[0]:"",a=x5("%"+i+"%",n),s=a.name,o=a.value,c=!1,l=a.alias;l&&(i=l[0],m5(r,d5([0,1],l)));for(var u=1,f=!0;u<r.length;u+=1){var g=r[u],h=Bi(g,0,1),p=Bi(g,-1);if((h==='"'||h==="'"||h==="`"||p==='"'||p==="'"||p==="`")&&h!==p)throw new Zn("property names with quotes must have matching quotes");if((g==="constructor"||!f)&&(c=!0),i+="."+g,s="%"+i+"%",Ai(Cn,s))o=Cn[s];else if(o!=null){if(!(g in o)){if(!n)throw new Hn("base intrinsic for "+e+" exists, but the property is not available.");return}if(Tn&&u+1>=r.length){var d=Tn(o,g);f=!!d,f&&"get"in d&&!("originalValue"in d.get)?o=d.get:o=o[g]}else f=Ai(o,g),o=o[g];f&&!c&&(Cn[s]=o)}}return o},w5=bc,Ci=w5("%Object.defineProperty%",!0)||!1;if(Ci)try{Ci({},"a",{value:1})}catch{Ci=!1}var Fc=Ci,S5=bc,xi=S5("%Object.getOwnPropertyDescriptor%",!0);if(xi)try{xi([],"length")}catch{xi=null}var R5=xi,to=Fc,E5=Vc,In=Ic,no=R5,M5=function(e,n,r){if(!e||typeof e!="object"&&typeof e!="function")throw new In("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new In("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new In("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new In("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new In("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new In("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,a=arguments.length>4?arguments[4]:null,s=arguments.length>5?arguments[5]:null,o=arguments.length>6?arguments[6]:!1,c=!!no&&no(e,n);if(to)to(e,n,{configurable:s===null&&c?c.configurable:!s,enumerable:i===null&&c?c.enumerable:!i,value:r,writable:a===null&&c?c.writable:!a});else if(o||!i&&!a&&!s)e[n]=r;else throw new E5("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},r0=Fc,_c=function(){return!!r0};_c.hasArrayLengthDefineBug=function(){if(!r0)return null;try{return r0([],"length",{value:1}).length!==1}catch{return!0}};var O5=_c,D5=Uf,V5=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",I5=Object.prototype.toString,L5=Array.prototype.concat,ro=M5,N5=function(t){return typeof t=="function"&&I5.call(t)==="[object Function]"},Uc=O5(),b5=function(t,e,n,r){if(e in t){if(r===!0){if(t[e]===n)return}else if(!N5(r)||!r())return}Uc?ro(t,e,n,!0):ro(t,e,n)},kc=function(t,e){var n=arguments.length>2?arguments[2]:{},r=D5(e);V5&&(r=L5.call(r,Object.getOwnPropertySymbols(e)));for(var i=0;i<r.length;i+=1)b5(t,r[i],e[r[i]],n[r[i]])};kc.supportsDescriptors=!!Uc;var Pc=kc,wi={exports:{}};typeof self<"u"?wi.exports=self:typeof window<"u"?wi.exports=window:wi.exports=Function("return this")();var Gc=wi.exports,F5=Gc,Ac=function(){return typeof at!="object"||!at||at.Math!==Math||at.Array!==Array?F5:at},_5=Pc,U5=Ac,k5=function(){var e=U5();if(_5.supportsDescriptors){var n=Object.getOwnPropertyDescriptor(e,"globalThis");(!n||n.configurable&&(n.enumerable||!n.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e},P5=Pc,G5=Gc,Bc=Ac,A5=k5,B5=Bc(),Wc=function(){return B5};P5(Wc,{getPolyfill:Bc,implementation:G5,shim:A5});var W5=Wc,z5=F0(W5);const ft=z5(),zc={vtkObject:()=>null};function ht(t){if(t==null||t.isA)return t;if(!t.vtkClass)return ft.console&&ft.console.error&&ft.console.error("Invalid VTK object"),null;const e=zc[t.vtkClass];if(!e)return ft.console&&ft.console.error&&ft.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const n={...t};Object.keys(n).forEach(i=>{n[i]&&typeof n[i]=="object"&&n[i].vtkClass&&(n[i]=ht(n[i]))});const r=e(n);return r&&r.modified&&r.modified(),r}function $5(t,e){zc[t]=e}ht.register=$5;class Aa extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let i0=0;const $c=Symbol("void");function j5(){return i0}const jc={};function hn(){}const H5=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];H5.forEach(t=>{jc[t]=hn});ft.console=console.hasOwnProperty("log")?console:jc;const nn={debug:hn,error:ft.console.error||hn,info:ft.console.info||hn,log:ft.console.log||hn,warn:ft.console.warn||hn};function Hc(t,e){nn[t]&&(nn[t]=e||hn)}function Kc(){nn.log(...arguments)}function qc(){nn.info(...arguments)}function Wi(){nn.debug(...arguments)}function J(){nn.error(...arguments)}function fa(){nn.warn(...arguments)}const io={};function Xc(t){io[t]||(nn.error(t),io[t]=!0)}const Ae=Object.create(null);Ae.Float32Array=Float32Array;Ae.Float64Array=Float64Array;Ae.Uint8Array=Uint8Array;Ae.Int8Array=Int8Array;Ae.Uint16Array=Uint16Array;Ae.Int16Array=Int16Array;Ae.Uint32Array=Uint32Array;Ae.Int32Array=Int32Array;Ae.Uint8ClampedArray=Uint8ClampedArray;try{Ae.BigInt64Array=BigInt64Array,Ae.BigUint64Array=BigUint64Array}catch{}function sr(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return new(Ae[t]||Float64Array)(...n)}function ga(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return(Ae[t]||Float64Array).from(...n)}function ha(t){return t.charAt(0).toUpperCase()+t.slice(1)}function we(t){return ha(t[0]==="_"?t.slice(1):t)}function Yc(t){return t.charAt(0).toLowerCase()+t.slice(1)}function Zc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let i=Number(t),a="B";for(;i>n;)i/=n,a=r.pop();return`${i.toFixed(e)} ${a}`}function Jc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const n=[];let r=t;for(;r>1e3;)n.push(`000${r%1e3}`.slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(e)}function Qc(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function K5(t){return Object.values(Ae).some(e=>t instanceof e)}function q5(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1}function X5(t,e){return Object.keys(t).find(n=>t[n]===e)}function e1(t){return t&&t.isA?t.getState():t}function _0(t){setTimeout(t,0)}function t1(t,e){const n=performance.now();t.finally(()=>{const r=performance.now()-n;e(r)})}function Re(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Qc(e);const n=[];if(Number.isInteger(e.mtime)||(e.mtime=++i0),!("classHierarchy"in e))e.classHierarchy=new Aa("vtkObject");else if(!(e.classHierarchy instanceof Aa)){const a=new Aa;for(let s=0;s<e.classHierarchy.length;s++)a.push(e.classHierarchy[s]);e.classHierarchy=a}function r(a){n[a]=null}function i(a){function s(){r(a)}return Object.freeze({unsubscribe:s})}return t.isDeleted=()=>!!e.deleted,t.modified=a=>{if(e.deleted){J("instance deleted - cannot call any method");return}a&&a<t.getMTime()||(e.mtime=++i0,n.forEach(s=>s&&s(t)))},t.onModified=a=>{if(e.deleted)return J("instance deleted - cannot call any method"),null;const s=n.length;return n.push(a),i(s)},t.getMTime=()=>e.mtime,t.isA=a=>{let s=e.classHierarchy.length;for(;s--;)if(e.classHierarchy[s]===a)return!0;return!1},t.getClassName=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-a]},t.set=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(a).forEach(l=>{const u=o?null:t[`set${ha(l)}`];u&&Array.isArray(a[l])&&u.length>1?c=u(...a[l])||c:u?c=u(a[l])||c:(["mtime"].indexOf(l)===-1&&!s&&fa(`Warning: Set value to model directly ${l}, ${a[l]}`),c=e[l]!==a[l]||c,e[l]=a[l])}),c},t.get=function(){for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];if(!s.length)return e;const c={};return s.forEach(l=>{c[l]=e[l]}),c},t.getReferenceByName=a=>e[a],t.delete=()=>{Object.keys(e).forEach(a=>delete e[a]),n.forEach((a,s)=>r(s)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const a={...e,vtkClass:t.getClassName()};Object.keys(a).forEach(o=>{a[o]===null||a[o]===void 0||o[0]==="_"?delete a[o]:a[o].isA?a[o]=a[o].getState():Array.isArray(a[o])?a[o]=a[o].map(e1):K5(a[o])&&(a[o]=Array.from(a[o]))});const s={};return Object.keys(a).sort().forEach(o=>{s[o]=a[o]}),s.mtime&&delete s.mtime,s},t.shallowCopy=function(a){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(a.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${a.getClassName()} into ${t.getClassName()}`);const o=a.get(),c=Object.keys(e).sort();Object.keys(o).sort().forEach(u=>{const f=c.indexOf(u);f===-1?s&&Wi(`add ${u} in shallowCopy`):c.splice(f,1),e[u]=o[u]}),c.length&&s&&Wi(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const Y5={object(t,e,n){return function(){return{...e[n.name]}}}};function dt(t,e,n){n.forEach(r=>{if(typeof r=="object"){const i=Y5[r.type];i?t[`get${we(r.name)}`]=i(t,e,r):t[`get${we(r.name)}`]=()=>e[r.name]}else t[`get${we(r)}`]=()=>e[r]})}const n1={enum(t,e,n){const r=`_on${we(n.name)}Changed`;return i=>{var a;if(typeof i=="string"){if(n.enum[i]!==void 0)return e[n.name]!==n.enum[i]?(e[n.name]=n.enum[i],t.modified(),!0):!1;throw J(`Set Enum with invalid argument ${n}, ${i}`),new RangeError("Set Enum with invalid string argument")}if(typeof i=="number"){if(e[n.name]!==i){if(Object.keys(n.enum).map(s=>n.enum[s]).indexOf(i)!==-1){const s=e[n.name];return e[n.name]=i,(a=e[r])==null||a.call(e,t,e,i,s),t.modified(),!0}throw J(`Set Enum outside numeric range ${n}, ${i}`),new RangeError("Set Enum outside numeric range")}return!1}throw J(`Set Enum with invalid argument (String/Number) ${n}, ${i}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,n){var i;((i=n.params)==null?void 0:i.length)===1&&fa('Setter of type "object" with a single "param" field is not supported');const r=`_on${we(n.name)}Changed`;return function(){var l,u;for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];let c;if(s.length>1&&((l=n.params)!=null&&l.length)?c=n.params.reduce((f,g,h)=>Object.assign(f,{[g]:s[h]}),{}):c=s[0],!Oc(e[n.name],c)){const f=e[n.name];return e[n.name]=c,(u=e[r])==null||u.call(e,t,e,c,f),t.modified(),!0}return!1}}};function ao(t){if(typeof t=="object"){const e=n1[t.type];if(e)return(n,r)=>e(n,r,t);throw J(`No setter for field ${t}`),new TypeError("No setter for field")}return function(n,r){const i=`_on${we(t)}Changed`;return function(s){var o;if(r.deleted)return J("instance deleted - cannot call any method"),!1;if(r[t]!==s){const c=r[t.name];return r[t]=s,(o=r[i])==null||o.call(r,n,r,s,c),n.modified(),!0}return!1}}}function jr(t,e,n){n.forEach(r=>{typeof r=="object"?t[`set${we(r.name)}`]=ao(r)(t,e):t[`set${we(r)}`]=ao(r)(t,e)})}function je(t,e,n){dt(t,e,n),jr(t,e,n)}function Hr(t,e,n){n.forEach(r=>{t[`get${we(r)}`]=()=>e[r]?Array.from(e[r]):e[r],t[`get${we(r)}ByReference`]=()=>e[r]})}function U0(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;n.forEach(a=>{if(e[a]&&r&&e[a].length!==r)throw new RangeError(`Invalid initial number of values for array (${a})`);const s=`_on${we(a)}Changed`;t[`set${we(a)}`]=function(){var h;if(e.deleted)return J("instance deleted - cannot call any method"),!1;for(var o=arguments.length,c=new Array(o),l=0;l<o;l++)c[l]=arguments[l];let u=c,f,g=!1;if(u.length===1&&(u[0]==null||u[0].length>=0)&&(u=u[0],g=!0),u==null)f=e[a]!==u;else{if(r&&u.length!==r)if(u.length<r&&i!==void 0)for(u=Array.from(u),g=!1;u.length<r;)u.push(i);else throw new RangeError(`Invalid number of values for array setter (${a})`);f=e[a]==null||e[a].length!==u.length;for(let p=0;!f&&p<u.length;++p)f=e[a][p]!==u[p];f&&g&&(u=Array.from(u))}if(f){const p=e[a.name];e[a]=u,(h=e[s])==null||h.call(e,t,e,u,p),t.modified()}return f},t[`set${we(a)}From`]=o=>{const c=e[a];o.forEach((l,u)=>{c[u]=l})}})}function r1(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;Hr(t,e,n),U0(t,e,n,r,i)}function pa(t,e,n){for(let r=0;r<n.length;r++){const i=n[r];e[i]!==void 0&&(e[`_${i}`]=e[i],delete e[i])}}function k0(t,e,n,r){e.inputData?e.inputData=e.inputData.map(ht):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(ht):e.inputConnection=[],e.output?e.output=e.output.map(ht):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(ht):e.inputArrayToProcess=[],e.numberOfInputs=n;function i(h){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){J("instance deleted - cannot call any method");return}if(p>=e.numberOfInputs){J(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[p]!==h||e.inputConnection[p])&&(e.inputData[p]=h,e.inputConnection[p]=null,t.modified&&t.modified())}function a(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[h]&&(e.inputData[h]=e.inputConnection[h]()),e.inputData[h]}function s(h){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){J("instance deleted - cannot call any method");return}if(p>=e.numberOfInputs){let d=`algorithm ${t.getClassName()} only has `;d+=`${e.numberOfInputs}`,d+=" input ports. To add more input ports, use addInputConnection()",J(d);return}e.inputData[p]=null,e.inputConnection[p]=h}function o(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[h]}function c(){let h=e.numberOfInputs;for(;h&&!e.inputData[h-1]&&!e.inputConnection[h-1];)h--;return h===e.numberOfInputs&&e.numberOfInputs++,h}function l(h){if(e.deleted){J("instance deleted - cannot call any method");return}s(h,c())}function u(h){if(e.deleted){J("instance deleted - cannot call any method");return}i(h,c())}function f(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(J("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[h])}t.shouldUpdate=()=>{var m,y;const h=t.getMTime();let p=1/0,d=r;for(;d--;){if(!e.output[d]||e.output[d].isDeleted())return!0;const T=e.output[d].getMTime();if(T<h)return!0;T<p&&(p=T)}for(d=e.numberOfInputs;d--;)if((m=e.inputConnection[d])!=null&&m.filter.shouldUpdate()||((y=t.getInputData(d))==null?void 0:y.getMTime())>p)return!0;return!1};function g(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const p=()=>f(h);return p.filter=t,p}if(e.numberOfInputs){let h=e.numberOfInputs;for(;h--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=i,t.setInputConnection=s,t.addInputData=u,t.addInputConnection=l,t.getInputData=a,t.getInputConnection=o}r&&(t.getOutputData=f,t.getOutputPort=g),t.update=()=>{const h=[];if(e.numberOfInputs){let p=0;for(;p<e.numberOfInputs;)h[p]=t.getInputData(p),p++}t.shouldUpdate()&&t.requestData&&t.requestData(h,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>r||e.output.length,t.getInputArrayToProcess=h=>{const p=e.inputArrayToProcess[h],d=e.inputData[h];return p&&d?d[`get${p.fieldAssociation}`]().getArray(p.arrayName):null},t.setInputArrayToProcess=function(h,p,d){let m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<h;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[h]={arrayName:p,fieldAssociation:d,attributeType:m}}}const P0=Symbol("Event abort");function i1(t,e,n){const r=[],i=t.delete;let a=1;function s(l){for(let u=0;u<r.length;++u){const[f]=r[u];if(f===l){r.splice(u,1);return}}}function o(l){function u(){s(l)}return Object.freeze({unsubscribe:u})}function c(){if(e.deleted){J("instance deleted - cannot call any method");return}const l=r.slice();for(let u=0;u<l.length;++u){const[,f,g]=l[u];if(f){if(g<0)setTimeout(()=>f.apply(t,arguments),1-g);else if(f.apply(t,arguments)===P0)break}}}t[`invoke${we(n)}`]=c,t[`on${we(n)}`]=function(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!l.apply)return console.error(`Invalid callback for event ${n}`),null;if(e.deleted)return J("instance deleted - cannot call any method"),null;const f=a++;return r.push([f,l,u]),r.sort((g,h)=>h[2]-g[2]),o(f)},t.delete=()=>{i(),r.forEach(l=>{let[u]=l;return s(u)})}}function Ie(t,e){const n=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i={},a={};return t(a,i,r),Object.freeze(a)};return e&&ht.register(e,n),n}function Kr(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e.filter(s=>!!s).map(s=>s(...i))}}function G0(t){return t&&t.isA&&t.isA("vtkObject")}function zi(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(G0(t)){if(r.indexOf(t)>=0)return n;r.push(t);const i=e(t);i!==void 0&&n.push(i);const a=t.get();Object.keys(a).forEach(s=>{const o=a[s];Array.isArray(o)?o.forEach(c=>{zi(c,e,n,r)}):zi(o,e,n,r)})}return n}function a1(t,e,n){var r=this;let i;const a=function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];const l=r,u=()=>{i=null,n||t.apply(l,o)},f=n&&!i;clearTimeout(i),i=setTimeout(u,e),f&&t.apply(l,o)};return a.cancel=()=>clearTimeout(i),a}function s1(t,e){let n=!1,r=null;function i(){n=!1,r!==null&&(a(...r),r=null)}function a(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];if(n){r=o;return}n=!0,t(...o),setTimeout(i,e)}return a}function A0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},n),t.setKey=(r,i)=>{e.keystore[r]=i},t.getKey=r=>e.keystore[r],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=r=>delete e.keystore[r],t.clearKeystore=()=>t.getAllKeys().forEach(r=>delete e.keystore[r])}let Z5=1;const ei="__root__";function o1(t,e){A0(t,e);const n=t.delete;e.proxyId=`${Z5++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),dt(t,e,["proxyId","proxyGroup","proxyName"]),je(t,e,["proxyManager"]);const r={},i={};function a(l,u){i[u]||(i[u]=[]);const f=i[u];for(let g=0;g<l.length;g++)f.push(l[g].name),r[l[g].name]=l[g],l[g].children&&l[g].children.length&&a(l[g].children,l[g].name)}a(e.ui,ei),t.updateUI=l=>{e.ui=JSON.parse(JSON.stringify(l||[])),Object.keys(r).forEach(u=>delete r[u]),Object.keys(i).forEach(u=>delete i[u]),a(e.ui,ei),t.modified()};function s(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ei;return i[l]}t.updateProxyProperty=(l,u)=>{const f=r[l];f?Object.assign(f,u):r[l]={...u}},t.activate=()=>{if(e.proxyManager){const l=`setActive${we(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[l]&&e.proxyManager[l](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(l,u)=>{u in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[u]=[]),e.propertyLinkSubscribers[u].push(l)},t.gcPropertyLinks=l=>{const u=e.propertyLinkSubscribers[l]||[];for(;u.length;)u.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[l])return e.propertyLinkMap[l];let f=null;const g=[];let h=0,p=!1;function d(C){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(p)return null;const w=[];let E=null;for(h=g.length;h--;){const D=g[h];D.instance===C?E=D:w.push(D)}if(!E)return null;const O=E.instance[`get${we(E.propertyName)}`]();if(!q5(O,f)||x){for(f=O,p=!0;w.length;){const D=w.pop();D.instance.set({[D.propertyName]:f})}p=!1}return e.propertyLinkMap[l].persistent&&(e.propertyLinkMap[l].value=O),O}function m(C,x){const w=[];for(h=g.length;h--;){const E=g[h];E.instance===C&&(E.propertyName===x||x===void 0)&&(E.subscription.unsubscribe(),w.push(h))}for(;w.length;)g.splice(w.pop(),1)}function y(C,x){let w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const E=C.onModified(d),O=g[0];return g.push({instance:C,propertyName:x,subscription:E}),w&&(e.propertyLinkMap[l].persistent&&e.propertyLinkMap[l].value!==void 0?C.set({[x]:e.propertyLinkMap[l].value}):O&&d(O.instance,!0)),{unsubscribe:()=>m(C,x)}}function T(){for(;g.length;)g.pop().subscription.unsubscribe()}const v={bind:y,unbind:m,unsubscribe:T,persistent:u};return e.propertyLinkMap[l]=v,v};function o(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ei;const u=[],f=e.proxyId,g=s(l)||[];for(let h=0;h<g.length;h++){const p=g[h],d=t[`get${we(p)}`],m=d?d():void 0,y={id:f,name:p,value:m},T=o(p);T.length&&(y.children=T),u.push(y)}return u}t.listPropertyNames=()=>o().map(l=>l.name),t.getPropertyByName=l=>o().find(u=>u.name===l),t.getPropertyDomainByName=l=>(r[l]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:o()}),t.delete=()=>{const l=Object.keys(e.propertyLinkMap);let u=l.length;for(;u--;)e.propertyLinkMap[l[u]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),n()},t.getState=()=>null;function c(){if(e.links)for(let l=0;l<e.links.length;l++){const{link:u,property:f,persistent:g,updateOnBind:h,type:p}=e.links[l];if(p==="application"){const d=e.proxyManager.getPropertyLink(u,g);t.registerPropertyLinkForGC(d,"application"),d.bind(t,f,h)}}}_0(c)}function c1(t,e,n){const r=t.delete,i=[],a=Object.keys(n);let s=a.length;for(;s--;){const o=a[s],{modelKey:c,property:l,modified:u=!0}=n[o],f=we(l),g=we(o);t[`get${g}`]=e[c][`get${f}`],t[`set${g}`]=e[c][`set${f}`],u&&i.push(e[c].onModified(t.modified))}t.delete=()=>{for(;i.length;)i.pop().unsubscribe();r()}}function l1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function i(o){const c=Object.keys(o);let l=c.length;for(;l--;){const u=c[l];e[u].set(o[u])}}const a=Object.keys(r);let s=a.length;for(;s--;){const o=a[s];e[o]=r[o];const c=n[o];t[`set${we(o)}`]=l=>{if(l!==e[o]){e[o]=l;const u=c[l];i(u),t.modified()}}}a.length&&dt(t,e,a)}const so=10,oo=40,co=800;function u1(t){let e=0,n=0,r=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*so,i=n*so,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(t.deltaMode===1?(r*=oo,i*=oo):(r*=co,i*=co)),r&&!e&&(e=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:n||e,pixelX:r,pixelY:i||r}}var R={algo:k0,capitalize:ha,chain:Kr,debounce:a1,enumToString:X5,event:i1,EVENT_ABORT:P0,formatBytesToProperUnit:Zc,formatNumbersWithThousandSeparator:Jc,get:dt,getArray:Hr,getCurrentGlobalMTime:j5,getStateArrayMapFunc:e1,isVtkObject:G0,keystore:A0,measurePromiseExecution:t1,moveToProtected:pa,newInstance:Ie,newTypedArray:sr,newTypedArrayFrom:ga,normalizeWheel:u1,obj:Re,proxy:o1,proxyPropertyMapping:c1,proxyPropertyState:l1,safeArrays:Qc,set:jr,setArray:U0,setGet:je,setGetArray:r1,setImmediate:_0,setLoggerFunction:Hc,throttle:s1,traverseInstanceTree:zi,TYPED_ARRAYS:Ae,uncapitalize:Yc,VOID:$c,vtkDebugMacro:Wi,vtkErrorMacro:J,vtkInfoMacro:qc,vtkLogMacro:Kc,vtkOnceErrorMacro:Xc,vtkWarningMacro:fa,objectSetterMap:n1},Ot=Object.freeze({__proto__:null,VOID:$c,setLoggerFunction:Hc,vtkLogMacro:Kc,vtkInfoMacro:qc,vtkDebugMacro:Wi,vtkErrorMacro:J,vtkWarningMacro:fa,vtkOnceErrorMacro:Xc,TYPED_ARRAYS:Ae,newTypedArray:sr,newTypedArrayFrom:ga,capitalize:ha,_capitalize:we,uncapitalize:Yc,formatBytesToProperUnit:Zc,formatNumbersWithThousandSeparator:Jc,setImmediateVTK:_0,measurePromiseExecution:t1,obj:Re,get:dt,set:jr,setGet:je,getArray:Hr,setArray:U0,setGetArray:r1,moveToProtected:pa,algo:k0,EVENT_ABORT:P0,event:i1,newInstance:Ie,chain:Kr,isVtkObject:G0,traverseInstanceTree:zi,debounce:a1,throttle:s1,keystore:A0,proxy:o1,proxyPropertyMapping:c1,proxyPropertyState:l1,normalizeWheel:u1,default:R});const J5={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},me={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},Q5=me.FLOAT;var f1={DefaultDataType:Q5,DataTypeByteSize:J5,VtkDataTypes:me};const _r={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},K={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var g1={Wrap:_r,Filter:K};const h1=new Float32Array(1),eg=new Int32Array(h1.buffer);function tg(t){h1[0]=t;const e=eg[0];let n=e>>16&32768,r=e>>12&2047;const i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(i===255?0:1)&&e&8388607,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=r&1,n)}function ng(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?(e?-1:1)*2**-14*(r/2**10):n===31?r?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(n-15)*(1+r/2**10)}var Gn={fromHalf:ng,toHalf:tg},B0={exports:{}};B0.exports;(function(t){(function(e,n,r){function i(c){var l=this,u=o();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=u(" "),l.s1=u(" "),l.s2=u(" "),l.s0-=u(c),l.s0<0&&(l.s0+=1),l.s1-=u(c),l.s1<0&&(l.s1+=1),l.s2-=u(c),l.s2<0&&(l.s2+=1),u=null}function a(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function s(c,l){var u=new i(c),f=l&&l.state,g=u.next;return g.int32=function(){return u.next()*4294967296|0},g.double=function(){return g()+(g()*2097152|0)*11102230246251565e-32},g.quick=g,f&&(typeof f=="object"&&a(f,u),g.state=function(){return a(u,{})}),g}function o(){var c=4022871197,l=function(u){u=String(u);for(var f=0;f<u.length;f++){c+=u.charCodeAt(f);var g=.02519603282416938*c;c=g>>>0,g-=c,g*=c,c=g>>>0,g-=c,c+=g*4294967296}return(c>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=s:this.alea=s})(at,t)})(B0);var rg=B0.exports,W0={exports:{}};W0.exports;(function(t){(function(e,n,r){function i(o){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var f=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^f^f>>>8},o===(o|0)?c.x=o:l+=o;for(var u=0;u<l.length+64;u++)c.x^=l.charCodeAt(u)|0,c.next()}function a(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c}function s(o,c){var l=new i(o),u=c&&c.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var g=l.next()>>>11,h=(l.next()>>>0)/4294967296,p=(g+h)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,u&&(typeof u=="object"&&a(u,l),f.state=function(){return a(l,{})}),f}n&&n.exports?n.exports=s:this.xor128=s})(at,t)})(W0);var ig=W0.exports,z0={exports:{}};z0.exports;(function(t){(function(e,n,r){function i(o){var c=this,l="";c.next=function(){var f=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(f^f<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,o===(o|0)?c.x=o:l+=o;for(var u=0;u<l.length+64;u++)c.x^=l.charCodeAt(u)|0,u==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function a(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c.v=o.v,c.d=o.d,c}function s(o,c){var l=new i(o),u=c&&c.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var g=l.next()>>>11,h=(l.next()>>>0)/4294967296,p=(g+h)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,u&&(typeof u=="object"&&a(u,l),f.state=function(){return a(l,{})}),f}n&&n.exports?n.exports=s:this.xorwow=s})(at,t)})(z0);var ag=z0.exports,$0={exports:{}};$0.exports;(function(t){(function(e,n,r){function i(o){var c=this;c.next=function(){var u=c.x,f=c.i,g,h;return g=u[f],g^=g>>>7,h=g^g<<24,g=u[f+1&7],h^=g^g>>>10,g=u[f+3&7],h^=g^g>>>3,g=u[f+4&7],h^=g^g<<7,g=u[f+7&7],g=g^g<<13,h^=g^g<<9,u[f]=h,c.i=f+1&7,h};function l(u,f){var g,h=[];if(f===(f|0))h[0]=f;else for(f=""+f,g=0;g<f.length;++g)h[g&7]=h[g&7]<<15^f.charCodeAt(g)+h[g+1&7]<<13;for(;h.length<8;)h.push(0);for(g=0;g<8&&h[g]===0;++g);for(g==8?h[7]=-1:h[g],u.x=h,u.i=0,g=256;g>0;--g)u.next()}l(c,o)}function a(o,c){return c.x=o.x.slice(),c.i=o.i,c}function s(o,c){o==null&&(o=+new Date);var l=new i(o),u=c&&c.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var g=l.next()>>>11,h=(l.next()>>>0)/4294967296,p=(g+h)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,u&&(u.x&&a(u,l),f.state=function(){return a(l,{})}),f}n&&n.exports?n.exports=s:this.xorshift7=s})(at,t)})($0);var sg=$0.exports,j0={exports:{}};j0.exports;(function(t){(function(e,n,r){function i(o){var c=this;c.next=function(){var u=c.w,f=c.X,g=c.i,h,p;return c.w=u=u+1640531527|0,p=f[g+34&127],h=f[g=g+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=f[g]=p^h,c.i=g,p+(u^u>>>16)|0};function l(u,f){var g,h,p,d,m,y=[],T=128;for(f===(f|0)?(h=f,f=null):(f=f+"\0",h=0,T=Math.max(T,f.length)),p=0,d=-32;d<T;++d)f&&(h^=f.charCodeAt((d+32)%f.length)),d===0&&(m=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,d>=0&&(m=m+1640531527|0,g=y[d&127]^=h+m,p=g==0?p+1:0);for(p>=128&&(y[(f&&f.length||0)&127]=-1),p=127,d=4*128;d>0;--d)h=y[p+34&127],g=y[p=p+1&127],h^=h<<13,g^=g<<17,h^=h>>>15,g^=g>>>12,y[p]=h^g;u.w=m,u.X=y,u.i=p}l(c,o)}function a(o,c){return c.i=o.i,c.w=o.w,c.X=o.X.slice(),c}function s(o,c){o==null&&(o=+new Date);var l=new i(o),u=c&&c.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var g=l.next()>>>11,h=(l.next()>>>0)/4294967296,p=(g+h)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,u&&(u.X&&a(u,l),f.state=function(){return a(l,{})}),f}n&&n.exports?n.exports=s:this.xor4096=s})(at,t)})(j0);var og=j0.exports,H0={exports:{}};H0.exports;(function(t){(function(e,n,r){function i(o){var c=this,l="";c.next=function(){var f=c.b,g=c.c,h=c.d,p=c.a;return f=f<<25^f>>>7^g,g=g-h|0,h=h<<24^h>>>8^p,p=p-f|0,c.b=f=f<<20^f>>>12^g,c.c=g=g-h|0,c.d=h<<16^g>>>16^p,c.a=p-f|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,o===Math.floor(o)?(c.a=o/4294967296|0,c.b=o|0):l+=o;for(var u=0;u<l.length+20;u++)c.b^=l.charCodeAt(u)|0,c.next()}function a(o,c){return c.a=o.a,c.b=o.b,c.c=o.c,c.d=o.d,c}function s(o,c){var l=new i(o),u=c&&c.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var g=l.next()>>>11,h=(l.next()>>>0)/4294967296,p=(g+h)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,u&&(typeof u=="object"&&a(u,l),f.state=function(){return a(l,{})}),f}n&&n.exports?n.exports=s:this.tychei=s})(at,t)})(H0);var cg=H0.exports,p1={exports:{}},lg={},ug=Object.freeze({__proto__:null,default:lg}),fg=Lf(ug);(function(t){(function(e,n,r){var i=256,a=6,s=52,o="random",c=r.pow(i,a),l=r.pow(2,s),u=l*2,f=i-1,g;function h(C,x,w){var E=[];x=x==!0?{entropy:!0}:x||{};var O=y(m(x.entropy?[C,v(n)]:C??T(),3),E),D=new p(E),S=function(){for(var M=D.g(a),V=c,L=0;M<l;)M=(M+L)*i,V*=i,L=D.g(1);for(;M>=u;)M/=2,V/=2,L>>>=1;return(M+L)/V};return S.int32=function(){return D.g(4)|0},S.quick=function(){return D.g(4)/4294967296},S.double=S,y(v(D.S),n),(x.pass||w||function(M,V,L,F){return F&&(F.S&&d(F,D),M.state=function(){return d(D,{})}),L?(r[o]=M,V):M})(S,O,"global"in x?x.global:this==r,x.state)}function p(C){var x,w=C.length,E=this,O=0,D=E.i=E.j=0,S=E.S=[];for(w||(C=[w++]);O<i;)S[O]=O++;for(O=0;O<i;O++)S[O]=S[D=f&D+C[O%w]+(x=S[O])],S[D]=x;(E.g=function(M){for(var V,L=0,F=E.i,k=E.j,b=E.S;M--;)V=b[F=f&F+1],L=L*i+b[f&(b[F]=b[k=f&k+V])+(b[k]=V)];return E.i=F,E.j=k,L})(i)}function d(C,x){return x.i=C.i,x.j=C.j,x.S=C.S.slice(),x}function m(C,x){var w=[],E=typeof C,O;if(x&&E=="object")for(O in C)try{w.push(m(C[O],x-1))}catch{}return w.length?w:E=="string"?C:C+"\0"}function y(C,x){for(var w=C+"",E,O=0;O<w.length;)x[f&O]=f&(E^=x[f&O]*19)+w.charCodeAt(O++);return v(x)}function T(){try{var C;return g&&(C=g.randomBytes)?C=C(i):(C=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues(C)),v(C)}catch{var x=e.navigator,w=x&&x.plugins;return[+new Date,e,w,e.screen,v(n)]}}function v(C){return String.fromCharCode.apply(0,C)}if(y(r.random(),n),t.exports){t.exports=h;try{g=fg}catch{}}else r["seed"+o]=h})(typeof self<"u"?self:at,[],Math)})(p1);var gg=p1.exports,hg=rg,pg=ig,dg=ag,mg=sg,yg=og,vg=cg,On=gg;On.alea=hg;On.xor128=pg;On.xorwow=dg;On.xorshift7=mg;On.xor4096=yg;On.tychei=vg;var Tg=On,Cg=F0(Tg);const K0=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],xg=[1,0,0,0,1,0,0,0,1],q0=1e-6,X0=1e-12,{vtkErrorMacro:d1,vtkWarningMacro:Rn}=R;let m1=0;const lo=20;function qr(t){return()=>d1(`vtkMath::${t} - NOT IMPLEMENTED`)}function xr(t,e,n,r){let i;for(let a=0;a<e;a++)i=t[n*e+a],t[n*e+a]=t[r*e+a],t[r*e+a]=i}function hr(t,e,n,r){let i;for(let a=0;a<e;a++)i=t[a*e+n],t[a*e+n]=t[a*e+r],t[a*e+r]=i}function de(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let n=0;n<t;++n)e[n]=0;return e}const wg=()=>Math.PI;function Sg(t,e){return e>1023?t*2**1023*2**(e-1023):e<-1074?t*2**-1074*2**(e+1074):t*2**e}function Fe(t){return t/180*Math.PI}function y1(t){return t*180/Math.PI}const{round:Rg,floor:Y0,ceil:Eg,min:Mg,max:Og}=Math;function Dg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0;for(let i=e,a=t.length;i<a;i+=n)t[i]<r&&(r=t[i]);return r}function Vg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=-1/0;for(let i=e,a=t.length;i<a;i+=n)r<t[i]&&(r=t[i]);return r}function Ig(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0,i=-1/0;for(let a=e,s=t.length;a<s;a+=n)t[a]<r&&(r=t[a]),i<t[a]&&(i=t[a]);return[r,i]}const Lg=qr("ceilLog2"),Ng=qr("factorial");function qt(t){let e=1;for(;e<t;)e*=2;return e}function pr(t){return t===qt(t)}function bg(t,e){let n=1;for(let r=1;r<=e;++r)n*=(t-r+1)/r;return Math.floor(n)}function Fg(t,e){if(t<e)return 0;const n=de(e);for(let r=0;r<e;++r)n[r]=r;return n}function _g(t,e,n){let r=0;for(let i=e-1;i>=0;--i)if(n[i]<t-e+i){let a=n[i]+1;for(;i<e;)n[i++]=a++;r=1;break}return r}function Ug(t){Cg(`${t}`,{global:!0}),m1=t}function kg(){return m1}function Pg(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+n*Math.random()}const Gg=qr("gaussian");function $i(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function Ut(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function v1(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function T1(t,e){return t[0]*=e,t[1]*=e,t}function a0(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function Ag(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r}function Y(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Bg(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[0]*e[2],n[3]=t[1]*e[0],n[4]=t[1]*e[1],n[5]=t[1]*e[2],n[6]=t[2]*e[0],n[7]=t[2]*e[1],n[8]=t[2]*e[2]}function Et(t,e,n){const r=t[1]*e[2]-t[2]*e[1],i=t[2]*e[0]-t[0]*e[2],a=t[0]*e[1]-t[1]*e[0];return n[0]=r,n[1]=i,n[2]=a,n}function Qt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let n=0;for(let r=0;r<e;r++)n+=t[r]*t[r];return Math.sqrt(n)}}}function da(t){const e=Qt(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function Wg(t,e,n,r){const i=t[0]*t[0],a=t[1]*t[1],s=t[2]*t[2],o=Math.sqrt(i+a+s);let c,l,u;i>a&&i>s?(c=0,l=1,u=2):a>s?(c=1,l=2,u=0):(c=2,l=0,u=1);const f=t[c]/o,g=t[l]/o,h=t[u]/o,p=Math.sqrt(f*f+h*h);if(r!==0){const d=Math.sin(r),m=Math.cos(r);e&&(e[c]=(h*m-f*g*d)/p,e[l]=d*p,e[u]=(-(f*m)-g*h*d)/p),n&&(n[c]=(-(h*d)-f*g*m)/p,n[l]=m*p,n[u]=(f*d-g*h*m)/p)}else e&&(e[c]=h/p,e[l]=0,e[u]=-f/p),n&&(n[c]=-f*g/p,n[l]=p,n[u]=-g*h/p)}function zg(t,e,n){const r=Y(e,e);if(r===0)return n[0]=0,n[1]=0,n[2]=0,!1;const i=Y(t,e)/r;for(let a=0;a<3;a++)n[a]=e[a];return v1(n,i),!0}function s0(t,e){return t[0]*e[0]+t[1]*e[1]}function $g(t,e,n){const r=s0(e,e);if(r===0)return n[0]=0,n[1]=0,!1;const i=s0(t,e)/r;for(let a=0;a<2;a++)n[a]=e[a];return T1(n,i),!0}function Ct(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function jg(t,e){const n=[0,0,0];return Et(t,e,n),Math.atan2(Qt(n),Y(t,e))}function Hg(t,e,n){const r=Math.abs(t-n);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(r**2)/(2*e))}function Kg(t,e,n){const r=Math.abs(t-n);return Math.exp(-(r**2)/(2*e))}function qg(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[1]*e[0],n[3]=t[1]*e[1]}function C1(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Xg(t){const e=C1(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function ye(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function Yg(t,e){let n,r,i;const a=[0,0,0];for(let s=0;s<3;s++)i=Math.abs(t[s*3]),(r=Math.abs(t[s*3+1]))>i&&(i=r),(r=Math.abs(t[s*3+2]))>i&&(i=r),a[s]=1/i;i=a[0]*Math.abs(t[0]),n=0,(r=a[1]*Math.abs(t[3]))>=i&&(i=r,n=1),(r=a[2]*Math.abs(t[6]))>=i&&(n=2),n!==0&&(xr(t,3,n,0),a[n]=a[0]),e[0]=n,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],i=a[1]*Math.abs(t[4]),n=1,(r=a[2]*Math.abs(t[7]))>=i&&(n=2,xr(t,3,1,2),a[2]=a[1]),e[1]=n,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function Zg(t,e,n){let r=n[e[0]];n[e[0]]=n[0],n[0]=r,r=n[e[1]],n[e[1]]=n[1],n[1]=r-t[3]*n[0],r=n[e[2]],n[e[2]]=n[2],n[2]=r-t[6]*n[0]-t[7]*n[1],n[2]/=t[8],n[1]=(n[1]-t[5]*n[2])/t[4],n[0]=(n[0]-t[1]*n[1]-t[2]*n[2])/t[0]}function Jg(t,e,n){const r=t[0],i=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=t[6],u=t[7],f=t[8],g=+ye(o,u,c,f),h=-ye(s,l,c,f),p=+ye(s,l,o,u),d=-ye(i,u,a,f),m=+ye(r,l,a,f),y=-ye(r,l,i,u),T=+ye(i,o,a,c),v=-ye(r,s,a,c),C=+ye(r,s,i,o),x=r*g+i*h+a*p,w=g*e[0]+d*e[1]+T*e[2],E=h*e[0]+m*e[1]+v*e[2],O=p*e[0]+y*e[1]+C*e[2];n[0]=w/x,n[1]=E/x,n[2]=O/x}function Si(t,e,n){const r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],i=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],a=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];n[0]=r,n[1]=i,n[2]=a}function o0(t,e,n){const r=[...t],i=[...e];for(let a=0;a<3;a++)n[a]=r[0]*i[a]+r[1]*i[a+3]+r[2]*i[a+6],n[a+3]=r[3]*i[a]+r[4]*i[a+3]+r[5]*i[a+6],n[a+6]=r[6]*i[a]+r[7]*i[a+3]+r[8]*i[a+6]}function Qg(t,e,n,r,i,a,s){r!==i&&d1("Number of columns of A must match number of rows of B.");const o=[...t],c=[...e];for(let l=0;l<n;l++)for(let u=0;u<a;u++){s[l*a+u]=0;for(let f=0;f<r;f++)s[l*a+u]+=o[l*r+f]*c[u+a*f]}}function Kn(t,e){let n;n=t[3],e[3]=t[1],e[1]=n,n=t[6],e[6]=t[2],e[2]=n,n=t[7],e[7]=t[5],e[5]=n,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function e3(t,e){const n=t[0],r=t[1],i=t[2],a=t[3],s=t[4],o=t[5],c=t[6],l=t[7],u=t[8],f=+ye(s,l,o,u),g=-ye(a,c,o,u),h=+ye(a,c,s,l),p=-ye(r,l,i,u),d=+ye(n,c,i,u),m=-ye(n,c,r,l),y=+ye(r,s,i,o),T=-ye(n,a,i,o),v=+ye(n,a,r,s),C=n*f+r*g+i*h;C===0&&Rn("Matrix has 0 determinant"),e[0]=f/C,e[3]=g/C,e[6]=h/C,e[1]=p/C,e[4]=d/C,e[7]=m/C,e[2]=y/C,e[5]=T/C,e[8]=v/C}function ma(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function x1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:q0;if(t.length!==e.length)return!1;function r(i,a){return Math.abs(i-e[a])<=n}return t.every(r)}const Xr=x1;function w1(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function S1(t,e){for(let n=0;n<t;n++){for(let r=0;r<t;r++)e[n*t+r]=0;e[n*t+n]=1}return e}function t3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:q0;return Xr(t,K0,e)}function n3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:q0;return Xr(t,xg,e)}function R1(t,e){const n=t[0]*t[0],r=t[0]*t[1],i=t[0]*t[2],a=t[0]*t[3],s=t[1]*t[1],o=t[2]*t[2],c=t[3]*t[3],l=t[1]*t[2],u=t[1]*t[3],f=t[2]*t[3],g=s+o+c;let h=1/(n+g);const p=(n-g)*h;h*=2,e[0]=s*h+p,e[3]=(l+a)*h,e[6]=(u-i)*h,e[1]=(l-a)*h,e[4]=o*h+p,e[7]=(f+r)*h,e[2]=(u+i)*h,e[5]=(f-r)*h,e[8]=c*h+p}function Ri(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const n=`${t}`.split("e");let r="";return+n[1]+e>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+e}`)}e-${e}`}function c0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=Ri(t[0],n),e[1]=Ri(t[1],n),e[2]=Ri(t[2],n),e}function Yr(t,e,n,r){let i,a,s,o,c,l,u,f,g,h,p,d,m,y,T,v;const C=de(e),x=de(e),w=(O,D,S)=>{y=O[D],m=O[S],O[D]=y-d*(m+y*h),O[S]=m+d*(y-m*h)};for(S1(e,r),c=0;c<e;c++)C[c]=n[c]=t[c+c*e],x[c]=0;for(i=0;i<lo;i++){for(p=0,c=0;c<e-1;c++)for(o=c+1;o<e;o++)p+=Math.abs(t[c*e+o]);if(p===0)break;for(i<3?u=.2*p/(e*e):u=0,c=0;c<e-1;c++)for(o=c+1;o<e;o++)if(y=100*Math.abs(t[c*e+o]),i>3&&Math.abs(n[c])+y===Math.abs(n[c])&&Math.abs(n[o])+y===Math.abs(n[o]))t[c*e+o]=0;else if(Math.abs(t[c*e+o])>u){for(m=n[o]-n[c],Math.abs(m)+y===Math.abs(m)?g=t[c*e+o]/m:(f=.5*m/t[c*e+o],g=1/(Math.abs(f)+Math.sqrt(1+f*f)),f<0&&(g=-g)),T=1/Math.sqrt(1+g*g),d=g*T,h=d/(1+T),m=g*t[c*e+o],x[c]-=m,x[o]+=m,n[c]-=m,n[o]+=m,t[c*e+o]=0,a=0;a<=c-1;a++)w(t,a*e+c,a*e+o);for(a=c+1;a<=o-1;a++)w(t,c*e+a,a*e+o);for(a=o+1;a<e;a++)w(t,c*e+a,o*e+a);for(a=0;a<e;a++)w(r,a*e+c,a*e+o)}for(c=0;c<e;c++)C[c]+=x[c],n[c]=C[c],x[c]=0}if(i>=lo)return Rn("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(a=0;a<e-1;a++){for(s=a,v=n[s],i=a+1;i<e;i++)(n[i]>=v||Math.abs(n[i]-v)<X0)&&(s=i,v=n[s]);s!==a&&(n[s]=n[a],n[a]=v,hr(r,e,a,s))}const E=(e>>1)+(e&1);for(l=0,i=0;i<e*e;i++)r[i]>=0&&l++;if(l<E)for(i=0;i<e;i++)r[i*e+a]*=-1;return 1}function E1(t,e){const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];n[0]=t[0]+t[4]+t[8],n[5]=t[0]-t[4]-t[8],n[10]=-t[0]+t[4]-t[8],n[15]=-t[0]-t[4]+t[8],n[1]=n[4]=t[7]-t[5],n[2]=n[8]=t[2]-t[6],n[3]=n[12]=t[3]-t[1],n[6]=n[9]=t[3]+t[1],n[7]=n[13]=t[2]+t[6],n[11]=n[14]=t[7]+t[5];const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0],a=[...n];Yr(a,4,i,r),e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12]}function r3(t,e,n){const r=t[0]*e[0],i=t[0]*e[1],a=t[0]*e[2],s=t[0]*e[3],o=t[1]*e[0],c=t[1]*e[1],l=t[1]*e[2],u=t[1]*e[3],f=t[2]*e[0],g=t[2]*e[1],h=t[2]*e[2],p=t[2]*e[3],d=t[3]*e[0],m=t[3]*e[1],y=t[3]*e[2],T=t[3]*e[3];n[0]=r-c-h-T,n[1]=i+o+p-y,n[2]=a-u+f+m,n[3]=s+l-g+d}function M1(t,e){for(let g=0;g<9;g++)e[g]=t[g];const n=de(3),r=de(3);let i;for(let g=0;g<3;g++){const h=Math.abs(e[g*3]),p=Math.abs(e[g*3+1]),d=Math.abs(e[g*3+2]);i=p>h?p:h,i=d>i?d:i,n[g]=1,i!==0&&(n[g]/=i)}const a=Math.abs(e[0])*n[0],s=Math.abs(e[3])*n[1],o=Math.abs(e[6])*n[2];r[0]=0,i=a,s>=i&&(i=s,r[0]=1),o>=i&&(r[0]=2),r[0]!==0&&(hr(e,3,r[0],0),n[r[0]]=n[0]);const c=Math.abs(e[4])*n[1],l=Math.abs(e[7])*n[2];r[1]=1,i=c,l>=i&&(r[1]=2,hr(e,3,1,2)),r[2]=2;let u=0;if(ma(e)<0){u=1;for(let g=0;g<9;g++)e[g]=-e[g]}const f=de(4);if(E1(e,f),R1(f,e),u)for(let g=0;g<9;g++)e[g]=-e[g];r[1]!==1&&hr(e,3,r[1],1),r[0]!==0&&hr(e,3,r[0],0)}function O1(t,e,n){let r,i,a,s,o,c;const l=[...t];if(Yr(l,3,e,n),e[0]===e[1]&&e[0]===e[2]){w1(n);return}for(Kn(n,n),r=0;r<3;r++)if(e[(r+1)%3]===e[(r+2)%3]){for(c=Math.abs(n[r*3]),s=0,i=1;i<3;i++)c<(o=Math.abs(n[r*3+i]))&&(c=o,s=i);s!==r&&(o=e[s],e[s]=e[r],e[r]=o,xr(n,3,r,s)),n[s*3+s]<0&&(n[s*3]=-n[s*3],n[s*3+1]=-n[s*3+1],n[s*3+2]=-n[s*3+2]),i=(s+1)%3,a=(s+2)%3,n[i*3]=0,n[i*3+1]=0,n[i*3+2]=0,n[i*3+i]=1;const u=Et([n[s*3],n[s*3+1],n[s*3+2]],[n[i*3],n[i*3+1],n[i*3+2]],[]);da(u);const f=Et(u,[n[s*3],n[s*3+1],n[s*3+2]],[]);for(let g=0;g<3;g++)n[a*3+g]=u[g],n[i*3+g]=f[g];Kn(n,n);return}for(c=Math.abs(n[0]),s=0,r=1;r<3;r++)c<(o=Math.abs(n[r*3]))&&(c=o,s=r);if(s!==0){const u=e[s];e[s]=e[0],e[0]=u,xr(n,3,s,0)}if(Math.abs(n[4])<Math.abs(n[7])){const u=e[2];e[2]=e[1],e[1]=u,xr(n,3,1,2)}for(r=0;r<2;r++)n[r*3+r]<0&&(n[r*3]=-n[r*3],n[r*3+1]=-n[r*3+1],n[r*3+2]=-n[r*3+2]);ma(n)<0&&(n[6]=-n[6],n[7]=-n[7],n[8]=-n[8]),Kn(n,n)}function i3(t,e,n,r){let i;const a=[...t],s=ma(a);if(s<0)for(i=0;i<9;i++)a[i]=-a[i];M1(a,e),Kn(a,a),o0(a,e,r),O1(r,n,r),o0(e,r,e),Kn(r,r),s<0&&(n[0]=-n[0],n[1]=-n[1],n[2]=-n[2])}function Z0(t,e,n){let r,i,a,s,o=0,c,l,u;const f=de(n);for(r=0;r<n;r++){for(s=0,i=0;i<n;i++)(u=Math.abs(t[r*n+i]))>s&&(s=u);if(s===0)return Rn("Unable to factor linear system"),0;f[r]=1/s}for(i=0;i<n;i++){for(r=0;r<i;r++){for(c=t[r*n+i],a=0;a<r;a++)c-=t[r*n+a]*t[a*n+i];t[r*n+i]=c}for(s=0,r=i;r<n;r++){for(c=t[r*n+i],a=0;a<i;a++)c-=t[r*n+a]*t[a*n+i];t[r*n+i]=c,(l=f[r]*Math.abs(c))>=s&&(s=l,o=r)}if(i!==o){for(a=0;a<n;a++)l=t[o*n+a],t[o*n+a]=t[i*n+a],t[i*n+a]=l;f[o]=f[i]}if(e[i]=o,Math.abs(t[i*n+i])<=X0)return Rn("Unable to factor linear system"),0;if(i!==n-1)for(l=1/t[i*n+i],r=i+1;r<n;r++)t[r*n+i]*=l}return 1}function J0(t,e,n,r){let i,a,s,o,c;for(s=-1,i=0;i<r;i++){if(o=e[i],c=n[o],n[o]=n[i],s>=0)for(a=s;a<=i-1;a++)c-=t[i*r+a]*n[a];else c!==0&&(s=i);n[i]=c}for(i=r-1;i>=0;i--){for(c=n[i],a=i+1;a<r;a++)c-=t[i*r+a]*n[a];n[i]=c/t[i*r+i]}}function D1(t,e,n){if(n===2){const i=de(2),a=ye(t[0],t[1],t[2],t[3]);return a===0?0:(i[0]=(t[3]*e[0]-t[1]*e[1])/a,i[1]=(-(t[2]*e[0])+t[0]*e[1])/a,e[0]=i[0],e[1]=i[1],1)}if(n===1)return t[0]===0?0:(e[0]/=t[0],1);const r=de(n);return Z0(t,r,n)===0?0:(J0(t,r,e,n),1)}function V1(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;const a=r||de(n),s=i||de(n);if(Z0(t,a,n)===0)return null;for(let o=0;o<n;o++){for(let c=0;c<n;c++)s[c]=0;s[o]=1,J0(t,a,s,n);for(let c=0;c<n;c++)e[c*n+o]=s[c]}return e}function a3(t,e){let n=+Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let i=0;i<e;i++)for(let a=i;a<e;a++)Math.abs(t[i*e+a])>r&&(r=Math.abs(t[i*e+a]));for(let i=0;i<e;i++)Math.abs(t[i*e+i])<n&&(n=Math.abs(t[i*e+i]));return n===0?Number.MAX_VALUE:r/n}function s3(t,e,n){return Yr(t,3,e,n)}function l0(t,e,n,r){if(t<n)return Rn("Insufficient number of samples. Underdetermined."),0;let i,a,s;const o=de(n*n),c=de(n),l=de(n*n);for(s=0;s<t;s++)for(i=0;i<n;i++)for(a=i;a<n;a++)o[i*n+a]+=e[s*n+i]*e[s*n+a];for(i=0;i<n;i++)for(a=0;a<i;a++)o[i*n+a]=o[a*n+i];for(Yr(o,n,c,l),i=0;i<n;i++)r[i]=l[i*n+n-1];return 1}function o3(t,e,n,r,i,a){let s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<n||t<i)return Rn("Insufficient number of samples. Underdetermined."),0;const o=de(i);let c=1,l,u=0,f,g,h,p=0;if(s){for(g=0;g<i;g++)o[g]=1;for(f=0;f<t;f++)for(g=0;g<i;g++)Math.abs(r[f*i+g])>X0&&(c=0,o[g]=0);if(c&&i===1)return Rn("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),l0(t,e,n,a);if(c)p=1;else for(g=0;g<i;g++)o[g]&&(p=1)}p&&(l=de(n),u=l0(t,e,n,l));const d=de(n*n),m=de(n*n),y=de(n*i);for(h=0;h<t;h++)for(f=0;f<n;f++){for(g=f;g<n;g++)d[f*n+g]+=e[h*n+f]*e[h*n+g];for(g=0;g<i;g++)y[f*i+g]+=e[h*n+f]*r[h*i+g]}for(f=0;f<n;f++)for(g=0;g<f;g++)d[f*n+g]=d[g*n+f];const T=V1(d,m,n);if(T)for(f=0;f<n;f++)for(g=0;g<i;g++)for(a[f*i+g]=0,h=0;h<n;h++)a[f*i+g]+=m[f*n+h]*y[h*i+g];if(p){for(g=0;g<i;g++)if(o[g])for(f=0;f<n;f++)a[f*i+g]=l[f*i]}return p?u&&T:T}function c3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function dr(t,e){let n,r;const[i,a,s]=t,o=1/3,c=1/6,l=2/3;let u=i,f=i;a>u?u=a:a<f&&(f=a),s>u?u=s:s<f&&(f=s);const g=u;g>0?r=(u-f)/u:r=0,r>0?(i===u?n=c*(a-s)/(u-f):a===u?n=o+c*(s-i)/(u-f):n=l+c*(i-a)/(u-f),n<0&&(n+=1)):n=0,e[0]=n,e[1]=r,e[2]=g}function An(t,e){const[n,r,i]=t,a=1/3,s=1/6,o=2/3,c=5/6;let l,u,f;n>s&&n<=a?(u=1,l=(a-n)/s,f=0):n>a&&n<=.5?(u=1,f=(n-a)/s,l=0):n>.5&&n<=o?(f=1,u=(o-n)/s,l=0):n>o&&n<=c?(f=1,l=(n-o)/s,u=0):n>c&&n<=1?(l=1,f=(1-n)/s,u=0):(l=1,u=n/s,f=0),l=r*l+(1-r),u=r*u+(1-r),f=r*f+(1-r),l*=i,u*=i,f*=i,e[0]=l,e[1]=u,e[2]=f}function I1(t,e){const[n,r,i]=t;let a=(n+16)/116,s=r/500+a,o=a-i/200;a**3>.008856?a**=3:a=(a-16/116)/7.787,s**3>.008856?s**=3:s=(s-16/116)/7.787,o**3>.008856?o**=3:o=(o-16/116)/7.787;const c=.9505,l=1,u=1.089;e[0]=c*s,e[1]=l*a,e[2]=u*o}function L1(t,e){const[n,r,i]=t,a=.9505,s=1,o=1.089;let c=n/a,l=r/s,u=i/o;c>.008856?c**=1/3:c=7.787*c+16/116,l>.008856?l**=1/3:l=7.787*l+16/116,u>.008856?u**=1/3:u=7.787*u+16/116,e[0]=116*l-16,e[1]=500*(c-l),e[2]=200*(l-u)}function N1(t,e){const[n,r,i]=t;let a=n*3.2406+r*-1.5372+i*-.4986,s=n*-.9689+r*1.8758+i*.0415,o=n*.0557+r*-.204+i*1.057;a>.0031308?a=1.055*a**(1/2.4)-.055:a*=12.92,s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92,o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92;let c=a;c<s&&(c=s),c<o&&(c=o),c>1&&(a/=c,s/=c,o/=c),a<0&&(a=0),s<0&&(s=0),o<0&&(o=0),e[0]=a,e[1]=s,e[2]=o}function b1(t,e){let[n,r,i]=t;n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,i>.04045?i=((i+.055)/1.055)**2.4:i/=12.92,e[0]=n*.4124+r*.3576+i*.1805,e[1]=n*.2126+r*.7152+i*.0722,e[2]=n*.0193+r*.1192+i*.9505}function mn(t,e){const n=[0,0,0];b1(t,n),L1(n,e)}function ji(t,e){const n=[0,0,0];I1(t,n),N1(n,e)}function ya(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function l3(t){return!(t[1]-t[0]<0)}function u3(t,e,n){return n[0]=Math.min(t[0],e[0]),n[1]=Math.max(t[0],e[0]),n[2]=Math.min(t[1],e[1]),n[3]=Math.max(t[1],e[1]),n[4]=Math.min(t[2],e[2]),n[5]=Math.max(t[2],e[2]),n}function pt(t,e,n){return t<e?e:t>n?n:t}function u0(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return r[0]=pt(t[0],e[0],n[0]),r[1]=pt(t[1],e[1],n[1]),r[2]=pt(t[2],e[2],n[2]),r}function f3(t,e){let n=0;return e[0]!==e[1]&&(t<e[0]?n=e[0]:t>e[1]?n=e[1]:n=t,n=(n-e[0])/(e[1]-e[0])),n}const g3=qr("GetScalarTypeFittingRange"),h3=qr("GetAdjustedScalarRange");function p3(t,e){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]<e[n]||t[n]>e[n+1]||t[n+1]<e[n]||t[n+1]>e[n+1])return 0;return 1}function d3(t,e,n){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]+n[r/2]<e[r]||t[r]-n[r/2]>e[r+1]||t[r+1]+n[r/2]<e[r]||t[r+1]-n[r/2]>e[r+1])return 0;return 1}function m3(t,e,n){if(!t||!e||!n)return 0;for(let r=0;r<3;r++)if(t[r]+n[r]<e[2*r]||t[r]-n[r]>e[2*r+1])return 0;return 1}function y3(t,e,n,r){const i=de(3),a=de(3),s=de(3),o=de(3),c=de(3),l=de(3);for(let C=0;C<3;++C)i[C]=t[C]-e[C],a[C]=e[C]-n[C],s[C]=n[C]-t[C],o[C]=-i[C],c[C]=-a[C],l[C]=-s[C];const u=Qt(o),f=Qt(c),g=Qt(s),h=de(3);Et(i,a,h);const p=Qt(h),d=u*f*g/(2*p),m=2*p*p,y=f*f*Y(i,l)/m,T=g*g*Y(o,a)/m,v=u*u*Y(s,c)/m;for(let C=0;C<3;++C)r[C]=y*t[C]+T*e[C]+v*n[C];return d}const v3=1/0,T3=-1/0,F1=t=>!Number.isFinite(t),{isFinite:C3,isNaN:f0}=Number,uo=f0;function Jn(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function x3(t){let e=-1,n=-1;for(let r=0;r<t.length;r++){const i=Math.abs(t[r]);i>e&&(n=r,e=i)}return n}function _1(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;const n=new Array(e),r=new Array(e);for(let a=0;a<e;++a)n[a]=a,r[a]=a;for(let a=e-1;a>0;a--){let s=-1/0,o=0,c=0;for(let l=0;l<=a;++l){const u=n[l];for(let f=0;f<=a;++f){const g=r[f],h=Math.abs(t[u+e*g]);h>s&&(s=h,o=l,c=f)}}[n[a],n[o]]=[n[o],n[a]],[r[a],r[c]]=[r[c],r[a]]}const i=new Array(e*e).fill(0);for(let a=0;a<e;++a){const s=n[a]+e*r[a];i[s]=t[s]<0?-1:1}return i}function U1(t){const e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function w3(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(U1).join("")}`}function ti(t){return Math.round(t*255)}function S3(t){return t.length===3?`rgb(${t.map(ti).join(", ")})`:`rgba(${ti(t[0]||0)}, ${ti(t[1]||0)}, ${ti(t[2]||0)}, ${t[3]||0})`}var gt={Pi:wg,ldexp:Sg,radiansFromDegrees:Fe,degreesFromRadians:y1,round:Rg,floor:Y0,ceil:Eg,ceilLog2:Lg,min:Mg,max:Og,arrayMin:Dg,arrayMax:Vg,arrayRange:Ig,isPowerOfTwo:pr,nearestPowerOfTwo:qt,factorial:Ng,binomial:bg,beginCombination:Fg,nextCombination:_g,randomSeed:Ug,getSeed:kg,random:Pg,gaussian:Gg,add:$i,subtract:Ut,multiplyScalar:v1,multiplyScalar2D:T1,multiplyAccumulate:a0,multiplyAccumulate2D:Ag,dot:Y,outer:Bg,cross:Et,norm:Qt,normalize:da,perpendiculars:Wg,projectVector:zg,projectVector2D:$g,distance2BetweenPoints:Ct,angleBetweenVectors:jg,gaussianAmplitude:Hg,gaussianWeight:Kg,dot2D:s0,outer2D:qg,norm2D:C1,normalize2D:Xg,determinant2x2:ye,LUFactor3x3:Yg,LUSolve3x3:Zg,linearSolve3x3:Jg,multiply3x3_vect3:Si,multiply3x3_mat3:o0,multiplyMatrix:Qg,transpose3x3:Kn,invert3x3:e3,identity3x3:w1,identity:S1,isIdentity:t3,isIdentity3x3:n3,determinant3x3:ma,quaternionToMatrix3x3:R1,areEquals:x1,areMatricesEqual:Xr,roundNumber:Ri,roundVector:c0,matrix3x3ToQuaternion:E1,multiplyQuaternion:r3,orthogonalize3x3:M1,diagonalize3x3:O1,singularValueDecomposition3x3:i3,solveLinearSystem:D1,invertMatrix:V1,luFactorLinearSystem:Z0,luSolveLinearSystem:J0,estimateMatrixCondition:a3,jacobi:s3,jacobiN:Yr,solveHomogeneousLeastSquares:l0,solveLeastSquares:o3,hex2float:c3,rgb2hsv:dr,hsv2rgb:An,lab2xyz:I1,xyz2lab:L1,xyz2rgb:N1,rgb2xyz:b1,rgb2lab:mn,lab2rgb:ji,uninitializeBounds:ya,areBoundsInitialized:l3,computeBoundsFromPoints:u3,clampValue:pt,clampVector:u0,clampAndNormalizeValue:f3,getScalarTypeFittingRange:g3,getAdjustedScalarRange:h3,extentIsWithinOtherExtent:p3,boundsIsWithinOtherBounds:d3,pointIsWithinBounds:m3,solve3PointCircle:y3,inf:v3,negInf:T3,isInf:F1,isNan:f0,isNaN:f0,isFinite:C3,createUninitializedBounds:Jn,getMajorAxisIndex:x3,getSparseOrthogonalMatrix:_1,floatToHex2:U1,floatRGB2HexCode:w3,float2CssRGBA:S3};const{vtkErrorMacro:R3}=Ot,{DefaultDataType:E3}=f1,M3=1e-6;function g0(t,e,n){const r=t.length;let i=Number.MAX_VALUE,a=-Number.MAX_VALUE,s,o;for(o=e;o<r;o+=n)if(!Number.isNaN(t[o])){i=t[o],a=i;break}for(;o<r;o+=n)s=t[o],s<i?i=s:s>a&&(a=s);return{min:i,max:a}}function O3(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,n=0,r=0;return{add(i){t>i&&(t=i),e<i&&(e=i),n++,r+=i},get(){return{min:t,max:e,count:n,sum:r,mean:r/n}},getRange(){return{min:t,max:e}}}}function k1(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&n>1){const i=t.length/n,a=new Float64Array(i);for(let s=0,o=0;s<i;++s){for(let c=o+n;o<c;++o)a[s]+=t[o]*t[o];a[s]**=.5}return g0(a,0,1)}return g0(t,e<0?0:e,n)}function fo(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=t||[];for(;n.length<=e;)n.push(null);return n}function Q0(t){return Object.prototype.toString.call(t).slice(8,-1)}function D3(t){const e=t.getNumberOfComponents();let n=0;const r=new Array(e);for(let i=0;i<t.getNumberOfTuples();++i){t.getTuple(i,r);const a=Qt(r,e);a>n&&(n=a)}return n}const V3={computeRange:k1,createRangeHelper:O3,fastComputeRange:g0,getDataType:Q0,getMaxNorm:D3};function I3(t,e){e.classHierarchy.push("vtkDataArray");function n(r){if(r<0)return!1;const i=t.getNumberOfComponents(),a=e.values.length/(i>0?i:1);if(r===a)return!0;if(r>a){const s=e.values;return e.values=sr(e.dataType,(r+a)*i),e.values.set(s),!0}return e.size>r*i&&(e.size=r*i,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.resize=r=>{n(r);const i=r*t.getNumberOfComponents();return e.size!==i?(e.size=i,t.dataChange(),!0):!1},t.initialize=()=>{t.resize(0)},t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+i]},t.setComponent=(r,i,a)=>{a!==e.values[r*e.numberOfComponents+i]&&(e.values[r*e.numberOfComponents+i]=a,t.dataChange())},t.getValue=r=>{const i=r/e.numberOfComponents,a=r%e.numberOfComponents;return t.getComponent(i,a)},t.setValue=(r,i)=>{const a=r/e.numberOfComponents,s=r%e.numberOfComponents;t.setComponent(a,s,i)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,i=r;i<0&&(i=e.numberOfComponents===1?0:e.numberOfComponents);let a=null;return e.ranges||(e.ranges=fo(e.ranges,e.numberOfComponents)),a=e.ranges[i],a?(e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple):(a=k1(t.getData(),r,e.numberOfComponents),e.ranges[i]=a,e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple)},t.setRange=(r,i)=>{e.ranges||(e.ranges=fo(e.ranges,e.numberOfComponents));const a={min:r.min,max:r.max};return e.ranges[i]=a,e.rangeTuple[0]=a.min,e.rangeTuple[1]=a.max,e.rangeTuple},t.setTuple=(r,i)=>{const a=r*e.numberOfComponents;for(let s=0;s<e.numberOfComponents;s++)e.values[a+s]=i[s]},t.setTuples=(r,i)=>{let a=r*e.numberOfComponents;const s=Math.min(i.length,e.size-a);for(let o=0;o<s;)e.values[a++]=i[o++]},t.insertTuple=(r,i)=>(e.size<=r*e.numberOfComponents&&(e.size=(r+1)*e.numberOfComponents,n(r+1)),t.setTuple(r,i),r),t.insertTuples=(r,i)=>{const a=r+i.length/e.numberOfComponents;return e.size<a*e.numberOfComponents&&(e.size=a*e.numberOfComponents,n(a)),t.setTuples(r,i),a},t.insertNextTuple=r=>{const i=e.size/e.numberOfComponents;return t.insertTuple(i,r)},t.insertNextTuples=r=>{const i=e.size/e.numberOfComponents;return t.insertTuples(i,r)},t.findTuple=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:M3;for(let a=0;a<e.size;a+=e.numberOfComponents)if(Math.abs(r[0]-e.values[a])<=i){let s=!0;for(let o=1;o<e.numberOfComponents;++o)if(Math.abs(r[o]-e.values[a+o])>i){s=!1;break}if(s)return a/e.numberOfComponents}return-1},t.getTuple=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const a=e.numberOfComponents||1,s=r*a;switch(a){case 4:i[3]=e.values[s+3];case 3:i[2]=e.values[s+2];case 2:i[1]=e.values[s+1];case 1:i[0]=e.values[s];break;default:for(let o=a-1;o>=0;--o)i[o]=e.values[s+o]}return i},t.getTuples=(r,i)=>{const a=(r??0)*e.numberOfComponents,s=(i??t.getNumberOfTuples())*e.numberOfComponents,o=t.getData().subarray(a,s);return o.length>0?o:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>G1({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(r,i)=>{e.values=r,e.size=r.length,e.dataType=Q0(r),i&&(e.numberOfComponents=i),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const r={...e,vtkClass:t.getClassName()};r.values=Array.from(r.values),delete r.buffer,Object.keys(r).forEach(a=>{r[a]||delete r[a]});const i={};return Object.keys(r).sort().forEach(a=>{i[a]=r[a]}),i.mtime&&delete i.mtime,i},t.deepCopy=r=>{const i=t.getDataType(),a=e.values;t.shallowCopy(r),(a==null?void 0:a.length)>=r.getNumberOfValues()&&i===r.getDataType()?(a.set(r.getData()),e.values=a,t.dataChange()):t.setData(r.getData().slice())},t.interpolateTuple=(r,i,a,s,o,c)=>{const l=e.numberOfComponents||1;(l!==i.getNumberOfComponents()||l!==s.getNumberOfComponents())&&R3("numberOfComponents must match");const u=i.getTuple(a),f=s.getTuple(o),g=[];switch(g.length=l,l){case 4:g[3]=u[3]+(f[3]-u[3])*c;case 3:g[2]=u[2]+(f[2]-u[2])*c;case 2:g[1]=u[1]+(f[1]-u[1])*c;case 1:g[0]=u[0]+(f[0]-u[0])*c;break;default:for(let h=0;h<l;h++)g[h]=u[h]+(f[h]-u[h])*c}return t.insertTuple(r,g)}}const L3={name:"",numberOfComponents:1,dataType:E3,rangeTuple:[0,0]};function P1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,L3,n),Array.isArray(n.values)&&n.dataType===void 0&&console.warn("vtkDataArray.newInstance: no dataType provided, converting to Float32Array"),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=ga(e.dataType,e.values)):e.values=sr(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=Q0(e.values)),Re(t,e),jr(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");I3(t,e)}const G1=Ie(P1,"vtkDataArray");var oe={newInstance:G1,extend:P1,...V3,...f1};const{vtkErrorMacro:N3}=R,b3=["Build","Render"];function F3(t,e){e.classHierarchy.push("vtkViewNode"),t.build=r=>{},t.render=r=>{},t.traverse=r=>{const i=r.getTraverseOperation(),a=t[i];if(a){a(r);return}t.apply(r,!0);for(let s=0;s<e.children.length;s++)e.children[s].traverse(r);t.apply(r,!1)},t.apply=(r,i)=>{const a=t[r.getOperation()];a&&a(i,r)},t.getViewNodeFor=r=>{if(e.renderable===r)return t;for(let i=0;i<e.children.length;++i){const s=e.children[i].getViewNodeFor(r);if(s)return s}},t.getFirstAncestorOfType=r=>e._parent?e._parent.isA(r)?e._parent:e._parent.getFirstAncestorOfType(r):null,t.getLastAncestorOfType=r=>{if(!e._parent)return null;const i=e._parent.getLastAncestorOfType(r);return i||(e._parent.isA(r)?e._parent:null)},t.addMissingNode=r=>{if(!r)return;const i=e._renderableChildMap.get(r);if(i!==void 0)return i.setVisited(!0),i;const a=t.createViewNode(r);if(a)return a.setParent(t),a.setVisited(!0),e._renderableChildMap.set(r,a),e.children.push(a),a},t.addMissingNodes=r=>{if(!(!r||!r.length))for(let i=0;i<r.length;++i){const a=r[i];t.addMissingNode(a)}},t.addMissingChildren=r=>{if(!(!r||!r.length))for(let i=0;i<r.length;++i){const a=r[i];if(e.children.indexOf(a)===-1){a.setParent(t),e.children.push(a);const o=a.getRenderable();o&&e._renderableChildMap.set(o,a)}a.setVisited(!0)}},t.removeNode=r=>{const i=e.children.findIndex(s=>s===r);if(i<0)return!1;const a=r.getRenderable();return a&&e._renderableChildMap.delete(a),r.delete(),e.children.splice(i,1),!0},t.prepareNodes=()=>{for(let r=0;r<e.children.length;++r)e.children[r].setVisited(!1)},t.setVisited=r=>{e.visited=r},t.removeUnusedNodes=()=>{let r=0;for(let i=0;i<e.children.length;++i){const a=e.children[i];if(a.getVisited())e.children[r++]=a,a.setVisited(!1);else{const o=a.getRenderable();o&&e._renderableChildMap.delete(o),a.delete()}}e.children.length=r},t.createViewNode=r=>{if(!e.myFactory)return N3("Cannot create view nodes without my own factory"),null;const i=e.myFactory.createNode(r);return i&&i.setRenderable(r),i};const n=t.delete;t.delete=()=>{for(let r=0;r<e.children.length;r++)e.children[r].delete();n()}}const _3={renderable:null,myFactory:null,children:[],visited:!1};function A1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_3,n),R.obj(t,e),R.event(t,e,"event"),e._renderableChildMap=new Map,R.get(t,e,["visited"]),R.setGet(t,e,["_parent","renderable","myFactory"]),R.getArray(t,e,["children"]),R.moveToProtected(t,e,["parent"]),F3(t,e)}const U3=R.newInstance(A1,"vtkViewNode");var Be={newInstance:U3,extend:A1,PASS_TYPES:b3};function k3(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,i=n.getClassName(r++),a=!1;const s=Object.keys(e.overrides);for(;i&&!a;)s.indexOf(i)!==-1?a=!0:i=n.getClassName(r++);if(!a)return null;const o=e.overrides[i]();return o.setMyFactory(t),o}}const P3={};function B1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,P3,n),R.obj(t,e),k3(t,e)}const G3=R.newInstance(B1,"vtkViewNodeFactory");var W1={newInstance:G3,extend:B1};const z1=Object.create(null);function Dt(t,e){z1[t]=e}function A3(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const B3={};function W3(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,B3,n),e.overrides=z1,W1.extend(t,e,n),A3(t,e)}R.newInstance(W3,"vtkOpenGLViewNodeFactory");function z3(){try{const r=new Int16Array([0,32767]),i=[1,1],a=document.createElement("canvas");a.width=4,a.height=4;const s=a.getContext("webgl2");if(!s)return!1;const o=s.getExtension("EXT_texture_norm16");if(!o)return!1;const c=`#version 300 es
    void main() {
      gl_PointSize = ${4 .toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,l=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `,u=s.createShader(s.VERTEX_SHADER);if(s.shaderSource(u,c),s.compileShader(u),!s.getShaderParameter(u,s.COMPILE_STATUS))return!1;const f=s.createShader(s.FRAGMENT_SHADER);if(s.shaderSource(f,l),s.compileShader(f),!s.getShaderParameter(f,s.COMPILE_STATUS))return!1;const g=s.createProgram();if(s.attachShader(g,u),s.attachShader(g,f),s.linkProgram(g),!s.getProgramParameter(g,s.LINK_STATUS))return!1;const h=s.createTexture();s.bindTexture(s.TEXTURE_2D,h),s.texImage2D(s.TEXTURE_2D,0,o.R16_SNORM_EXT,2,1,0,s.RED,s.SHORT,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.useProgram(g),s.drawArrays(s.POINTS,0,1);const p=new Uint8Array(4);s.readPixels(i[0],i[1],1,1,s.RGBA,s.UNSIGNED_BYTE,p);const[d,m,y]=p,T=s.getExtension("WEBGL_lose_context");return T&&T.loseContext(),d===m&&m===y&&d!==0}catch{return!1}}let Ba;function $3(){return Ba===void 0&&(Ba=z3()),Ba}const{Wrap:Ft,Filter:Le}=g1,{VtkDataTypes:re}=oe,{vtkDebugMacro:Wa,vtkErrorMacro:Ln,vtkWarningMacro:go}=Ot,{toHalf:j3}=Gn;function H3(t,e){e.classHierarchy.push("vtkOpenGLTexture"),t.render=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(l?e._openGLRenderWindow=l:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(Le.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(Le.LINEAR),t.setMagnificationFilter(Le.LINEAR)):(t.setMinificationFilter(Le.NEAREST),t.setMagnificationFilter(Le.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(Ft.REPEAT),t.setWrapS(Ft.REPEAT),t.setWrapT(Ft.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Le.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Le.LINEAR_MIPMAP_LINEAR));const f=e.renderable.getCanvas();t.create2DFromRaw(f.width,f.height,4,re.UNSIGNED_CHAR,f,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const f=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(Le.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw(f.width,f.height,4,re.UNSIGNED_CHAR,f.data,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const u=e.renderable.getInputData(0);if(u&&u.getPointData().getScalars()){const f=u.getExtent(),g=u.getPointData().getScalars(),h=[];for(let p=0;p<e.renderable.getNumberOfInputPorts();++p){const d=e.renderable.getInputData(p),m=d?d.getPointData().getScalars().getData():null;m&&h.push(m)}e.renderable.getInterpolate()&&g.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(Le.LINEAR_MIPMAP_LINEAR)),h.length%6===0?t.createCubeFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,g.getNumberOfComponents(),g.getDataType(),h):t.create2DFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,g.getNumberOfComponents(),g.getDataType(),g.getData()),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()};const n=()=>{if(!((e.minificationFilter===Le.LINEAR||e.magnificationFilter===Le.LINEAR)&&!$3()))return e.oglNorm16Ext};t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=l=>{l&&e.handle&&(l.activateTexture(t),l.deactivateTexture(t),e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(l),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let l=!1;if(e.context&&e.handle){let u=0;switch(e.target){case e.context.TEXTURE_2D:u=e.context.TEXTURE_BINDING_2D;break;default:go("impossible case");break}l=e.context.getIntegerv(u)===e.handle}return l},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(l,u)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(l,u)),e.internalFormat||Wa(`Unable to find suitable internal format for T=${l} NC= ${u}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&go("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(l,u)=>{let f=0;return f=e._openGLRenderWindow.getDefaultTextureInternalFormat(l,u,n(),t.useHalfFloat()),f||(f||(Wa("Unsupported internal texture type!"),Wa(`Unable to find suitable internal format for T=${l} NC= ${u}`)),f)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=l=>{e._forceInternalFormat=!0,l!==e.internalFormat&&(e.internalFormat=l,t.modified())},t.getFormat=(l,u)=>(e.format=t.getDefaultFormat(l,u),e.format),t.getDefaultFormat=(l,u)=>{if(e._openGLRenderWindow.getWebgl2())switch(u){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(u){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=l=>{const u=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(l){case re.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(n()&&!u&&re.SHORT):return e.context.SHORT;case(n()&&!u&&re.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(u&&re.SHORT):return e.context.HALF_FLOAT;case(u&&re.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case re.FLOAT:case re.VOID:default:return e.context.FLOAT}switch(l){case re.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case re.FLOAT:case re.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const f=e.context.getExtension("OES_texture_half_float");if(f&&e.context.getExtension("OES_texture_half_float_linear"))return f.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||u)&&(e.openGLDataType=t.getDefaultDataType(l)),e.openGLDataType},t.getShiftAndScale=()=>{let l=0,u=1;switch(e.openGLDataType){case e.context.BYTE:u=127.5,l=u-128;break;case e.context.UNSIGNED_BYTE:u=255,l=0;break;case e.context.SHORT:u=32767.5,l=u-32768;break;case e.context.UNSIGNED_SHORT:u=65536,l=0;break;case e.context.INT:u=21474836475e-1,l=u-2147483648;break;case e.context.UNSIGNED_INT:u=4294967295,l=0;break;case e.context.FLOAT:}return{shift:l,scale:u}},t.getOpenGLFilterMode=l=>{switch(l){case Le.NEAREST:return e.context.NEAREST;case Le.LINEAR:return e.context.LINEAR;case Le.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case Le.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case Le.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case Le.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=l=>{switch(l){case Ft.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case Ft.REPEAT:return e.context.REPEAT;case Ft.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}},t.updateArrayDataTypeForGL=function(l,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const g=[];let h=e.width*e.height*e.components;if(f&&(h*=e.depth),l!==re.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let d=0;d<u.length;d++)if(u[d]){const m=u[d].length>h?u[d].subarray(0,h):u[d];g.push(new Float32Array(m))}else g.push(null);if(l!==re.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let d=0;d<u.length;d++)if(u[d]){const m=u[d].length>h?u[d].subarray(0,h):u[d];g.push(new Uint8Array(m))}else g.push(null);let p=!1;if(e._openGLRenderWindow.getWebgl2())p=e.openGLDataType===e.context.HALF_FLOAT;else{const d=e.context.getExtension("OES_texture_half_float");p=d&&e.openGLDataType===d.HALF_FLOAT_OES}if(p)for(let d=0;d<u.length;d++)if(u[d]){const m=new Uint16Array(h),y=u[d];for(let T=0;T<h;T++)m[T]=j3(y[T]);g.push(m)}else g.push(null);if(g.length===0)for(let d=0;d<u.length;d++)g.push(u[d]);return g};function r(l){if(e._openGLRenderWindow.getWebgl2())return l;const u=[],f=e.width,g=e.height,h=e.components;if(l&&(!pr(f)||!pr(g))){const p=e.context.getExtension("OES_texture_half_float"),d=qt(f),m=qt(g),y=d*m*e.components;for(let T=0;T<l.length;T++)if(l[T]!==null){let v=null;const C=g/m,x=f/d;let w=!1;e.openGLDataType===e.context.FLOAT?v=new Float32Array(y):p&&e.openGLDataType===p.HALF_FLOAT_OES?(v=new Uint16Array(y),w=!0):v=new Uint8Array(y);for(let E=0;E<m;E++){const O=E*d*h,D=E*C;let S=Math.floor(D),M=Math.ceil(D);M>=g&&(M=g-1);const V=D-S,L=1-V;S=S*f*h,M=M*f*h;for(let F=0;F<d;F++){const k=F*h,b=F*x;let W=Math.floor(b),_=Math.ceil(b);_>=f&&(_=f-1);const N=b-W;W*=h,_*=h;for(let I=0;I<h;I++)w?v[O+k+I]=Gn.toHalf(Gn.fromHalf(l[T][S+W+I])*L*(1-N)+Gn.fromHalf(l[T][S+_+I])*L*N+Gn.fromHalf(l[T][M+W+I])*V*(1-N)+Gn.fromHalf(l[T][M+_+I])*V*N):v[O+k+I]=l[T][S+W+I]*L*(1-N)+l[T][S+_+I]*L*N+l[T][M+W+I]*V*(1-N)+l[T][M+_+I]*V*N}}u.push(v),e.width=d,e.height=m}else u.push(null)}if(u.length===0)for(let p=0;p<l.length;p++)u.push(l[p]);return u}function i(l){var u;return e._openGLRenderWindow?e.resizable||(u=e.renderable)!=null&&u.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&n()&&(l===re.UNSIGNED_SHORT||l===re.SHORT)):!1:!1}t.create2DFromRaw=function(l,u,f,g,h){let p=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(t.getOpenGLDataType(g,!0),t.getInternalFormat(g,f),t.getFormat(g,f),!e.internalFormat||!e.format||!e.openGLDataType)return Ln("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=f,e.width=l,e.height=u,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const d=[h],m=t.updateArrayDataTypeForGL(g,d),y=r(m);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,p),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(g)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),y[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,y[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,y[0]),e.generateMipmap&&e.context.generateMipmap(e.target),p&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(g,n(),t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=(l,u,f,g,h)=>{if(t.getOpenGLDataType(g),t.getInternalFormat(g,f),t.getFormat(g,f),!e.internalFormat||!e.format||!e.openGLDataType)return Ln("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=f,e.width=l,e.height=u,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=h.length/6-1,t.createTexture(),t.bind();const p=t.updateArrayDataTypeForGL(g,h),d=r(p),m=[];let y=e.width,T=e.height;for(let v=0;v<d.length;v++){v%6===0&&v!==0&&(y/=2,T/=2),m[v]=sr(g,T*y*e.components);for(let C=0;C<T;++C){const x=C*y*e.components,w=(T-C-1)*y*e.components;m[v].set(d[v].slice(w,w+y*e.components),x)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(g)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let v=0;v<6;v++){let C=0,x=e.width,w=e.height;for(;x>=1&&w>=1;){let E=null;C<=e.maxLevel&&(E=m[6*C+v]),i(g)?E!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+v,C,0,0,x,w,e.format,e.openGLDataType,E):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+v,C,e.internalFormat,x,w,0,e.format,e.openGLDataType,E),C++,x/=2,w/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(g,n(),t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=(l,u,f,g)=>(t.getOpenGLDataType(f),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?f===re.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Ln("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=l,e.height=u,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(f)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),g!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,g)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,g),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(f,n(),t.useHalfFloat()),t.deactivate(),!0)),t.create2DFromImage=l=>{if(t.getOpenGLDataType(re.UNSIGNED_CHAR),t.getInternalFormat(re.UNSIGNED_CHAR,4),t.getFormat(re.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Ln("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);const u=!e._openGLRenderWindow.getWebgl2()&&(!pr(l.width)||!pr(l.height)),f=document.createElement("canvas");f.width=u?qt(l.width):l.width,f.height=u?qt(l.height):l.height,e.width=f.width,e.height=f.height;const g=f.getContext("2d");g.translate(0,f.height),g.scale(1,-1),g.drawImage(l,0,0,l.width,l.height,0,0,f.width,f.height);const h=f;return i(re.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),h!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,h)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,h),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(re.UNSIGNED_CHAR,n(),t.useHalfFloat()),t.deactivate(),!0};function a(l,u,f){const g=new Array(f),h=new Array(f);for(let p=0;p<f;++p)g[p]=l[p],h[p]=u[p]-l[p]||1;return{scale:h,offset:g}}function s(l,u){for(let f=0;f<l.length;f++){const g=l[f],h=u[f]+g;if(g<-2048||g>2048||h<-2048||h>2048)return!1}return!0}function o(l,u,f,g){t.getOpenGLDataType(l);const h=s(u,f)||g;let p=!1;if(e._openGLRenderWindow.getWebgl2())p=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&h||e.openGLDataType===e.context.HALF_FLOAT;else{const d=e.context.getExtension("OES_texture_half_float");p=d&&e.openGLDataType===d.HALF_FLOAT_OES}e.canUseHalfFloat=p&&h}function c(l,u){const f=l.getNumberOfComponents(),g=l.getDataType(),h=l.getData(),p=new Array(f),d=new Array(f);for(let y=0;y<f;++y){const[T,v]=l.getRange(y);p[y]=T,d[y]=v}const m=a(p,d,f);return o(g,m.offset,m.scale,u),t.useHalfFloat()||t.getOpenGLDataType(g,!0),{numComps:f,dataType:g,data:h,scaleOffsets:m}}t.create2DFilterableFromRaw=function(l,u,f,g,h){let p=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;return t.create2DFilterableFromDataArray(l,u,oe.newInstance({numberOfComponents:f,dataType:g,values:h}),p)},t.create2DFilterableFromDataArray=function(l,u,f){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const{numComps:h,dataType:p,data:d}=c(f,g);t.create2DFromRaw(l,u,h,p,d)},t.updateVolumeInfoForGL=(l,u)=>{var h,p;let f=!1;const g=t.useHalfFloat();(!((h=e.volumeInfo)!=null&&h.scale)||!((p=e.volumeInfo)!=null&&p.offset))&&(e.volumeInfo={scale:new Array(u),offset:new Array(u)});for(let d=0;d<u;++d)e.volumeInfo.scale[d]=1,e.volumeInfo.offset[d]=0;if(n()&&!g&&l===re.SHORT){for(let d=0;d<u;++d)e.volumeInfo.scale[d]=32767;f=!0}if(n()&&!g&&l===re.UNSIGNED_SHORT){for(let d=0;d<u;++d)e.volumeInfo.scale[d]=65535;f=!0}if(l===re.UNSIGNED_CHAR){for(let d=0;d<u;++d)e.volumeInfo.scale[d]=255;f=!0}return(l===re.FLOAT||g&&(l===re.SHORT||l===re.UNSIGNED_SHORT))&&(f=!0),f},t.create3DFromRaw=(l,u,f,g,h,p)=>{let d=h,m=p;if(!t.updateVolumeInfoForGL(d,g)&&m){const x=l*u*f,w=structuredClone(e.volumeInfo),E=new Float32Array(x*g);e.volumeInfo.offset=w.offset,e.volumeInfo.scale=w.scale;let O=0;const D=w.scale.map(S=>1/S);for(let S=0;S<x;S++)for(let M=0;M<g;M++)E[O]=(m[O]-w.offset[M])*D[M],O++;d=re.FLOAT,m=E}if(t.getOpenGLDataType(d),t.getInternalFormat(d,g),t.getFormat(d,g),!e.internalFormat||!e.format||!e.openGLDataType)return Ln("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=g,e.width=l,e.height=u,e.depth=f,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const y=[m],v=t.updateArrayDataTypeForGL(d,y,!0),C=r(v);return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(d)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),C[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,C[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,C[0]),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(d,n(),t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(l,u,f,g,h,p){let d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1;return t.create3DFilterableFromDataArray(l,u,f,oe.newInstance({numberOfComponents:g,dataType:h,values:p}),d)},t.create3DFilterableFromDataArray=function(l,u,f,g){let h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{numComps:p,dataType:d,data:m,scaleOffsets:y}=c(g,h),T=[],v=[];for(let I=0;I<p;++I)T[I]=0,v[I]=1;if(e.volumeInfo={scale:v,offset:T,dataComputedScale:y.scale,dataComputedOffset:y.offset,width:l,height:u,depth:f},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw(l,u,f,p,d,m);const C=l*u*f,x=structuredClone(y);let w=(I,U,G,P,ee)=>{I[U]=G},E=re.UNSIGNED_CHAR;if(d===re.UNSIGNED_CHAR)for(let I=0;I<p;++I)x.offset[I]=0,x.scale[I]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(E=re.FLOAT,w=(I,U,G,P,ee)=>{I[U]=(G-P)/ee}):(E=re.UNSIGNED_CHAR,w=(I,U,G,P,ee)=>{I[U]=255*(G-P)/ee});if(t.getOpenGLDataType(E),t.getInternalFormat(E,p),t.getFormat(E,p),!e.internalFormat||!e.format||!e.openGLDataType)return Ln("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=p,e.depth=1,e.numberOfDimensions=2;let O=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);O>4096&&(E===re.FLOAT||p>=3)&&(O=4096);let D=1,S=1;C>O*O&&(D=Math.ceil(Math.sqrt(C/(O*O))),S=D);let M=Math.sqrt(C)/D;M=qt(M);const V=Math.floor(M*D/l),L=Math.ceil(f/V),F=qt(u*L/S);e.width=M,e.height=F,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=V,e.volumeInfo.yreps=L,e.volumeInfo.xstride=D,e.volumeInfo.ystride=S,e.volumeInfo.offset=x.offset,e.volumeInfo.scale=x.scale;let k;const b=M*F*p;E===re.FLOAT?k=new Float32Array(b):k=new Uint8Array(b);let W=0;const _=Math.floor(l/D),N=Math.floor(u/S);for(let I=0;I<L;I++){const U=Math.min(V,f-I*V),G=p*(e.width-U*Math.floor(l/D));for(let P=0;P<N;P++){for(let ee=0;ee<U;ee++){const Bt=p*((I*V+ee)*l*u+S*P*l);for(let We=0;We<_;We++)for(let mt=0;mt<p;mt++)w(k,W,m[Bt+D*We*p+mt],x.offset[mt],x.scale[mt]),W++}W+=G}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),i(E)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),k!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,k)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,k),t.deactivate(),!0},t.setOpenGLRenderWindow=l=>{e._openGLRenderWindow!==l&&(t.releaseGraphicsResources(),e._openGLRenderWindow=l,e.context=null,l&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=l=>l&&l.isCurrent()?l.getIntegerv(l.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=l=>{e.enableUseHalfFloat=l}}const K3={_openGLRenderWindow:null,_forceInternalFormat:!1,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:Ft.CLAMP_TO_EDGE,wrapT:Ft.CLAMP_TO_EDGE,wrapR:Ft.CLAMP_TO_EDGE,minificationFilter:Le.NEAREST,magnificationFilter:Le.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function $1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,K3,n),Be.extend(t,e,n),e.sendParametersTime={},Re(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},Re(e.textureBuildTime,{mtime:0}),jr(t,e,["format","openGLDataType"]),je(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),dt(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),pa(t,e,["openGLRenderWindow"]),H3(t,e)}const j1=Ie($1,"vtkOpenGLTexture");var Ue={newInstance:j1,extend:$1,...g1};Dt("vtkTexture",j1);function q3(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.saveCurrentBindings(r),t.saveCurrentBuffers(r)},t.saveCurrentBindings=n=>{if(!e.context){J("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const r=e.context;e.previousDrawBinding=r.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=n=>{},t.restorePreviousBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.restorePreviousBindings(r),t.restorePreviousBuffers(r)},t.restorePreviousBindings=n=>{if(!e.context){J("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const r=e.context;r.bindFramebuffer(r.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=n=>{},t.bind=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;r===null&&(r=e.context.FRAMEBUFFER),e.context.bindFramebuffer(r,e.glFramebuffer);for(let i=0;i<e.colorBuffers.length;i++)e.colorBuffers[i].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(n,r)=>{if(!e.context){J("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=n,e.glFramebuffer.height=r},t.setColorBuffer=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=e.context;if(!i){J("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let a=i.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())a+=r;else{J("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[r]=n,i.framebufferTexture2D(i.FRAMEBUFFER,a,i.TEXTURE_2D,n.getHandle(),0)},t.removeColorBuffer=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=e.context;if(!r){J("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let i=r.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())i+=n;else{J("Using multiple framebuffer attachments requires WebGL 2");return}r.framebufferTexture2D(r.FRAMEBUFFER,i,r.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(n,1)},t.setDepthBuffer=n=>{if(!e.context){J("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n.getHandle(),0)}else J("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){J("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,null,0)}else J("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){J("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const n=e.context,r=Ue.newInstance();r.setOpenGLRenderWindow(e._openGLRenderWindow),r.setMinificationFilter(K.LINEAR),r.setMagnificationFilter(K.LINEAR),r.create2DFromRaw(e.glFramebuffer.width,e.glFramebuffer.height,4,me.UNSIGNED_CHAR,null),t.setColorBuffer(r),e.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,e.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const X3={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function H1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,X3,n),Re(t,e),e.colorBuffers&&J("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],Hr(t,e,["colorBuffers"]),q3(t,e)}const Y3=Ie(H1,"vtkFramebuffer");var Z3={newInstance:Y3,extend:H1},ge=1e-6,Ve=typeof Float32Array<"u"?Float32Array:Array,J3=Math.PI/180;function Q3(t){return t*J3}function ho(t,e){return Math.abs(t-e)<=ge*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function K1(){var t=new Ve(9);return Ve!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function q1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function ni(t,e,n,r,i,a,s,o,c){var l=new Ve(9);return l[0]=t,l[1]=e,l[2]=n,l[3]=r,l[4]=i,l[5]=a,l[6]=s,l[7]=o,l[8]=c,l}function e4(t,e,n,r,i,a,s,o,c,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=s,t[6]=o,t[7]=c,t[8]=l,t}function va(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function t4(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function es(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],o=e[5],c=e[6],l=e[7],u=e[8],f=u*s-o*l,g=-u*a+o*c,h=l*a-s*c,p=n*f+r*g+i*h;return p?(p=1/p,t[0]=f*p,t[1]=(-u*r+i*l)*p,t[2]=(o*r-i*s)*p,t[3]=g*p,t[4]=(u*n-i*c)*p,t[5]=(-o*n+i*a)*p,t[6]=h*p,t[7]=(-l*n+r*c)*p,t[8]=(s*n-r*a)*p,t):null}function Nn(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],s=t[5],o=t[6],c=t[7],l=t[8];return e*(l*a-s*c)+n*(-l*i+s*o)+r*(c*i-a*o)}function po(t,e,n){var r=e[0],i=e[1],a=e[2],s=e[3],o=e[4],c=e[5],l=e[6],u=e[7],f=e[8],g=n[0],h=n[1],p=n[2],d=n[3],m=n[4],y=n[5],T=n[6],v=n[7],C=n[8];return t[0]=g*r+h*s+p*l,t[1]=g*i+h*o+p*u,t[2]=g*a+h*c+p*f,t[3]=d*r+m*s+y*l,t[4]=d*i+m*o+y*u,t[5]=d*a+m*c+y*f,t[6]=T*r+v*s+C*l,t[7]=T*i+v*o+C*u,t[8]=T*a+v*c+C*f,t}function Dn(){var t=new Ve(16);return Ve!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function n4(t){var e=new Ve(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Oe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function X1(t,e,n,r,i,a,s,o,c,l,u,f,g,h,p,d){var m=new Ve(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=a,m[6]=s,m[7]=o,m[8]=c,m[9]=l,m[10]=u,m[11]=f,m[12]=g,m[13]=h,m[14]=p,m[15]=d,m}function r4(t,e,n,r,i,a,s,o,c,l,u,f,g,h,p,d,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=s,t[6]=o,t[7]=c,t[8]=l,t[9]=u,t[10]=f,t[11]=g,t[12]=h,t[13]=p,t[14]=d,t[15]=m,t}function X(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ue(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],a=e[6],s=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=i,t[13]=s,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ke(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],o=e[5],c=e[6],l=e[7],u=e[8],f=e[9],g=e[10],h=e[11],p=e[12],d=e[13],m=e[14],y=e[15],T=n*o-r*s,v=n*c-i*s,C=n*l-a*s,x=r*c-i*o,w=r*l-a*o,E=i*l-a*c,O=u*d-f*p,D=u*m-g*p,S=u*y-h*p,M=f*m-g*d,V=f*y-h*d,L=g*y-h*m,F=T*L-v*V+C*M+x*S-w*D+E*O;return F?(F=1/F,t[0]=(o*L-c*V+l*M)*F,t[1]=(i*V-r*L-a*M)*F,t[2]=(d*E-m*w+y*x)*F,t[3]=(g*w-f*E-h*x)*F,t[4]=(c*S-s*L-l*D)*F,t[5]=(n*L-i*S+a*D)*F,t[6]=(m*C-p*E-y*v)*F,t[7]=(u*E-g*C+h*v)*F,t[8]=(s*V-o*S+l*O)*F,t[9]=(r*S-n*V-a*O)*F,t[10]=(p*w-d*C+y*T)*F,t[11]=(f*C-u*w-h*T)*F,t[12]=(o*D-s*M-c*O)*F,t[13]=(n*M-r*D+i*O)*F,t[14]=(d*v-p*x-m*T)*F,t[15]=(u*x-f*v+g*T)*F,t):null}function i4(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],o=e[5],c=e[6],l=e[7],u=e[8],f=e[9],g=e[10],h=e[11],p=e[12],d=e[13],m=e[14],y=e[15];return t[0]=o*(g*y-h*m)-f*(c*y-l*m)+d*(c*h-l*g),t[1]=-(r*(g*y-h*m)-f*(i*y-a*m)+d*(i*h-a*g)),t[2]=r*(c*y-l*m)-o*(i*y-a*m)+d*(i*l-a*c),t[3]=-(r*(c*h-l*g)-o*(i*h-a*g)+f*(i*l-a*c)),t[4]=-(s*(g*y-h*m)-u*(c*y-l*m)+p*(c*h-l*g)),t[5]=n*(g*y-h*m)-u*(i*y-a*m)+p*(i*h-a*g),t[6]=-(n*(c*y-l*m)-s*(i*y-a*m)+p*(i*l-a*c)),t[7]=n*(c*h-l*g)-s*(i*h-a*g)+u*(i*l-a*c),t[8]=s*(f*y-h*d)-u*(o*y-l*d)+p*(o*h-l*f),t[9]=-(n*(f*y-h*d)-u*(r*y-a*d)+p*(r*h-a*f)),t[10]=n*(o*y-l*d)-s*(r*y-a*d)+p*(r*l-a*o),t[11]=-(n*(o*h-l*f)-s*(r*h-a*f)+u*(r*l-a*o)),t[12]=-(s*(f*m-g*d)-u*(o*m-c*d)+p*(o*g-c*f)),t[13]=n*(f*m-g*d)-u*(r*m-i*d)+p*(r*g-i*f),t[14]=-(n*(o*m-c*d)-s*(r*m-i*d)+p*(r*c-i*o)),t[15]=n*(o*g-c*f)-s*(r*g-i*f)+u*(r*c-i*o),t}function a4(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],s=t[5],o=t[6],c=t[7],l=t[8],u=t[9],f=t[10],g=t[11],h=t[12],p=t[13],d=t[14],m=t[15],y=e*s-n*a,T=e*o-r*a,v=e*c-i*a,C=n*o-r*s,x=n*c-i*s,w=r*c-i*o,E=l*p-u*h,O=l*d-f*h,D=l*m-g*h,S=u*d-f*p,M=u*m-g*p,V=f*m-g*d;return y*V-T*M+v*S+C*D-x*O+w*E}function se(t,e,n){var r=e[0],i=e[1],a=e[2],s=e[3],o=e[4],c=e[5],l=e[6],u=e[7],f=e[8],g=e[9],h=e[10],p=e[11],d=e[12],m=e[13],y=e[14],T=e[15],v=n[0],C=n[1],x=n[2],w=n[3];return t[0]=v*r+C*o+x*f+w*d,t[1]=v*i+C*c+x*g+w*m,t[2]=v*a+C*l+x*h+w*y,t[3]=v*s+C*u+x*p+w*T,v=n[4],C=n[5],x=n[6],w=n[7],t[4]=v*r+C*o+x*f+w*d,t[5]=v*i+C*c+x*g+w*m,t[6]=v*a+C*l+x*h+w*y,t[7]=v*s+C*u+x*p+w*T,v=n[8],C=n[9],x=n[10],w=n[11],t[8]=v*r+C*o+x*f+w*d,t[9]=v*i+C*c+x*g+w*m,t[10]=v*a+C*l+x*h+w*y,t[11]=v*s+C*u+x*p+w*T,v=n[12],C=n[13],x=n[14],w=n[15],t[12]=v*r+C*o+x*f+w*d,t[13]=v*i+C*c+x*g+w*m,t[14]=v*a+C*l+x*h+w*y,t[15]=v*s+C*u+x*p+w*T,t}function Se(t,e,n){var r=n[0],i=n[1],a=n[2],s,o,c,l,u,f,g,h,p,d,m,y;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*a+e[12],t[13]=e[1]*r+e[5]*i+e[9]*a+e[13],t[14]=e[2]*r+e[6]*i+e[10]*a+e[14],t[15]=e[3]*r+e[7]*i+e[11]*a+e[15]):(s=e[0],o=e[1],c=e[2],l=e[3],u=e[4],f=e[5],g=e[6],h=e[7],p=e[8],d=e[9],m=e[10],y=e[11],t[0]=s,t[1]=o,t[2]=c,t[3]=l,t[4]=u,t[5]=f,t[6]=g,t[7]=h,t[8]=p,t[9]=d,t[10]=m,t[11]=y,t[12]=s*r+u*i+p*a+e[12],t[13]=o*r+f*i+d*a+e[13],t[14]=c*r+g*i+m*a+e[14],t[15]=l*r+h*i+y*a+e[15]),t}function Gt(t,e,n){var r=n[0],i=n[1],a=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ct(t,e,n,r){var i=r[0],a=r[1],s=r[2],o=Math.hypot(i,a,s),c,l,u,f,g,h,p,d,m,y,T,v,C,x,w,E,O,D,S,M,V,L,F,k;return o<ge?null:(o=1/o,i*=o,a*=o,s*=o,c=Math.sin(n),l=Math.cos(n),u=1-l,f=e[0],g=e[1],h=e[2],p=e[3],d=e[4],m=e[5],y=e[6],T=e[7],v=e[8],C=e[9],x=e[10],w=e[11],E=i*i*u+l,O=a*i*u+s*c,D=s*i*u-a*c,S=i*a*u-s*c,M=a*a*u+l,V=s*a*u+i*c,L=i*s*u+a*c,F=a*s*u-i*c,k=s*s*u+l,t[0]=f*E+d*O+v*D,t[1]=g*E+m*O+C*D,t[2]=h*E+y*O+x*D,t[3]=p*E+T*O+w*D,t[4]=f*S+d*M+v*V,t[5]=g*S+m*M+C*V,t[6]=h*S+y*M+x*V,t[7]=p*S+T*M+w*V,t[8]=f*L+d*F+v*k,t[9]=g*L+m*F+C*k,t[10]=h*L+y*F+x*k,t[11]=p*L+T*F+w*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ts(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[4],s=e[5],o=e[6],c=e[7],l=e[8],u=e[9],f=e[10],g=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*r,t[5]=s*i+u*r,t[6]=o*i+f*r,t[7]=c*i+g*r,t[8]=l*i-a*r,t[9]=u*i-s*r,t[10]=f*i-o*r,t[11]=g*i-c*r,t}function ns(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],s=e[1],o=e[2],c=e[3],l=e[8],u=e[9],f=e[10],g=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-l*r,t[1]=s*i-u*r,t[2]=o*i-f*r,t[3]=c*i-g*r,t[8]=a*r+l*i,t[9]=s*r+u*i,t[10]=o*r+f*i,t[11]=c*r+g*i,t}function rs(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],s=e[1],o=e[2],c=e[3],l=e[4],u=e[5],f=e[6],g=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*r,t[1]=s*i+u*r,t[2]=o*i+f*r,t[3]=c*i+g*r,t[4]=l*i-a*r,t[5]=u*i-s*r,t[6]=f*i-o*r,t[7]=g*i-c*r,t}function Ta(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function is(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function as(t,e,n){var r=n[0],i=n[1],a=n[2],s=Math.hypot(r,i,a),o,c,l;return s<ge?null:(s=1/s,r*=s,i*=s,a*=s,o=Math.sin(e),c=Math.cos(e),l=1-c,t[0]=r*r*l+c,t[1]=i*r*l+a*o,t[2]=a*r*l-i*o,t[3]=0,t[4]=r*i*l-a*o,t[5]=i*i*l+c,t[6]=a*i*l+r*o,t[7]=0,t[8]=r*a*l+i*o,t[9]=i*a*l-r*o,t[10]=a*a*l+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function s4(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o4(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function c4(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Y1(t,e,n){var r=e[0],i=e[1],a=e[2],s=e[3],o=r+r,c=i+i,l=a+a,u=r*o,f=r*c,g=r*l,h=i*c,p=i*l,d=a*l,m=s*o,y=s*c,T=s*l;return t[0]=1-(h+d),t[1]=f+T,t[2]=g-y,t[3]=0,t[4]=f-T,t[5]=1-(u+d),t[6]=p+m,t[7]=0,t[8]=g+y,t[9]=p-m,t[10]=1-(u+h),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function l4(t,e){var n=new Ve(3),r=-e[0],i=-e[1],a=-e[2],s=e[3],o=e[4],c=e[5],l=e[6],u=e[7],f=r*r+i*i+a*a+s*s;return f>0?(n[0]=(o*s+u*r+c*a-l*i)*2/f,n[1]=(c*s+u*i+l*r-o*a)*2/f,n[2]=(l*s+u*a+o*i-c*r)*2/f):(n[0]=(o*s+u*r+c*a-l*i)*2,n[1]=(c*s+u*i+l*r-o*a)*2,n[2]=(l*s+u*a+o*i-c*r)*2),Y1(t,e,n),t}function u4(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Z1(t,e){var n=e[0],r=e[1],i=e[2],a=e[4],s=e[5],o=e[6],c=e[8],l=e[9],u=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(a,s,o),t[2]=Math.hypot(c,l,u),t}function h0(t,e){var n=new Ve(3);Z1(n,e);var r=1/n[0],i=1/n[1],a=1/n[2],s=e[0]*r,o=e[1]*i,c=e[2]*a,l=e[4]*r,u=e[5]*i,f=e[6]*a,g=e[8]*r,h=e[9]*i,p=e[10]*a,d=s+u+p,m=0;return d>0?(m=Math.sqrt(d+1)*2,t[3]=.25*m,t[0]=(f-h)/m,t[1]=(g-c)/m,t[2]=(o-l)/m):s>u&&s>p?(m=Math.sqrt(1+s-u-p)*2,t[3]=(f-h)/m,t[0]=.25*m,t[1]=(o+l)/m,t[2]=(g+c)/m):u>p?(m=Math.sqrt(1+u-s-p)*2,t[3]=(g-c)/m,t[0]=(o+l)/m,t[1]=.25*m,t[2]=(f+h)/m):(m=Math.sqrt(1+p-s-u)*2,t[3]=(o-l)/m,t[0]=(g+c)/m,t[1]=(f+h)/m,t[2]=.25*m),t}function J1(t,e,n,r){var i=e[0],a=e[1],s=e[2],o=e[3],c=i+i,l=a+a,u=s+s,f=i*c,g=i*l,h=i*u,p=a*l,d=a*u,m=s*u,y=o*c,T=o*l,v=o*u,C=r[0],x=r[1],w=r[2];return t[0]=(1-(p+m))*C,t[1]=(g+v)*C,t[2]=(h-T)*C,t[3]=0,t[4]=(g-v)*x,t[5]=(1-(f+m))*x,t[6]=(d+y)*x,t[7]=0,t[8]=(h+T)*w,t[9]=(d-y)*w,t[10]=(1-(f+p))*w,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function f4(t,e,n,r,i){var a=e[0],s=e[1],o=e[2],c=e[3],l=a+a,u=s+s,f=o+o,g=a*l,h=a*u,p=a*f,d=s*u,m=s*f,y=o*f,T=c*l,v=c*u,C=c*f,x=r[0],w=r[1],E=r[2],O=i[0],D=i[1],S=i[2],M=(1-(d+y))*x,V=(h+C)*x,L=(p-v)*x,F=(h-C)*w,k=(1-(g+y))*w,b=(m+T)*w,W=(p+v)*E,_=(m-T)*E,N=(1-(g+d))*E;return t[0]=M,t[1]=V,t[2]=L,t[3]=0,t[4]=F,t[5]=k,t[6]=b,t[7]=0,t[8]=W,t[9]=_,t[10]=N,t[11]=0,t[12]=n[0]+O-(M*O+F*D+W*S),t[13]=n[1]+D-(V*O+k*D+_*S),t[14]=n[2]+S-(L*O+b*D+N*S),t[15]=1,t}function Hi(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],s=n+n,o=r+r,c=i+i,l=n*s,u=r*s,f=r*o,g=i*s,h=i*o,p=i*c,d=a*s,m=a*o,y=a*c;return t[0]=1-f-p,t[1]=u+y,t[2]=g-m,t[3]=0,t[4]=u-y,t[5]=1-l-p,t[6]=h+d,t[7]=0,t[8]=g+m,t[9]=h-d,t[10]=1-l-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function g4(t,e,n,r,i,a,s){var o=1/(n-e),c=1/(i-r),l=1/(a-s);return t[0]=a*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*o,t[9]=(i+r)*c,t[10]=(s+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*a*2*l,t[15]=0,t}function Q1(t,e,n,r,i){var a=1/Math.tan(e/2),s;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(s=1/(r-i),t[10]=(i+r)*s,t[14]=2*i*r*s):(t[10]=-1,t[14]=-2*r),t}var h4=Q1;function p4(t,e,n,r,i){var a=1/Math.tan(e/2),s;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(s=1/(r-i),t[10]=i*s,t[14]=i*r*s):(t[10]=-1,t[14]=-r),t}function d4(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(s+o),l=2/(i+a);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-((s-o)*c*.5),t[9]=(i-a)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function e2(t,e,n,r,i,a,s){var o=1/(e-n),c=1/(r-i),l=1/(a-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*o,t[13]=(i+r)*c,t[14]=(s+a)*l,t[15]=1,t}var ss=e2;function m4(t,e,n,r,i,a,s){var o=1/(e-n),c=1/(r-i),l=1/(a-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*o,t[13]=(i+r)*c,t[14]=a*l,t[15]=1,t}function t2(t,e,n,r){var i,a,s,o,c,l,u,f,g,h,p=e[0],d=e[1],m=e[2],y=r[0],T=r[1],v=r[2],C=n[0],x=n[1],w=n[2];return Math.abs(p-C)<ge&&Math.abs(d-x)<ge&&Math.abs(m-w)<ge?X(t):(u=p-C,f=d-x,g=m-w,h=1/Math.hypot(u,f,g),u*=h,f*=h,g*=h,i=T*g-v*f,a=v*u-y*g,s=y*f-T*u,h=Math.hypot(i,a,s),h?(h=1/h,i*=h,a*=h,s*=h):(i=0,a=0,s=0),o=f*s-g*a,c=g*i-u*s,l=u*a-f*i,h=Math.hypot(o,c,l),h?(h=1/h,o*=h,c*=h,l*=h):(o=0,c=0,l=0),t[0]=i,t[1]=o,t[2]=u,t[3]=0,t[4]=a,t[5]=c,t[6]=f,t[7]=0,t[8]=s,t[9]=l,t[10]=g,t[11]=0,t[12]=-(i*p+a*d+s*m),t[13]=-(o*p+c*d+l*m),t[14]=-(u*p+f*d+g*m),t[15]=1,t)}function y4(t,e,n,r){var i=e[0],a=e[1],s=e[2],o=r[0],c=r[1],l=r[2],u=i-n[0],f=a-n[1],g=s-n[2],h=u*u+f*f+g*g;h>0&&(h=1/Math.sqrt(h),u*=h,f*=h,g*=h);var p=c*g-l*f,d=l*u-o*g,m=o*f-c*u;return h=p*p+d*d+m*m,h>0&&(h=1/Math.sqrt(h),p*=h,d*=h,m*=h),t[0]=p,t[1]=d,t[2]=m,t[3]=0,t[4]=f*m-g*d,t[5]=g*p-u*m,t[6]=u*d-f*p,t[7]=0,t[8]=u,t[9]=f,t[10]=g,t[11]=0,t[12]=i,t[13]=a,t[14]=s,t[15]=1,t}function v4(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function T4(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function C4(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function n2(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function x4(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function w4(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function S4(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function R4(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],s=t[4],o=t[5],c=t[6],l=t[7],u=t[8],f=t[9],g=t[10],h=t[11],p=t[12],d=t[13],m=t[14],y=t[15],T=e[0],v=e[1],C=e[2],x=e[3],w=e[4],E=e[5],O=e[6],D=e[7],S=e[8],M=e[9],V=e[10],L=e[11],F=e[12],k=e[13],b=e[14],W=e[15];return Math.abs(n-T)<=ge*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(r-v)<=ge*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(i-C)<=ge*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(a-x)<=ge*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(s-w)<=ge*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(o-E)<=ge*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(c-O)<=ge*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(l-D)<=ge*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(u-S)<=ge*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(f-M)<=ge*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(g-V)<=ge*Math.max(1,Math.abs(g),Math.abs(V))&&Math.abs(h-L)<=ge*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(p-F)<=ge*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(d-k)<=ge*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(m-b)<=ge*Math.max(1,Math.abs(m),Math.abs(b))&&Math.abs(y-W)<=ge*Math.max(1,Math.abs(y),Math.abs(W))}var Ki=se,E4=n2,mo=Object.freeze({__proto__:null,add:C4,adjoint:i4,clone:n4,copy:Oe,create:Dn,determinant:a4,equals:R4,exactEquals:S4,frob:T4,fromQuat:Hi,fromQuat2:l4,fromRotation:as,fromRotationTranslation:Y1,fromRotationTranslationScale:J1,fromRotationTranslationScaleOrigin:f4,fromScaling:is,fromTranslation:Ta,fromValues:X1,fromXRotation:s4,fromYRotation:o4,fromZRotation:c4,frustum:g4,getRotation:h0,getScaling:Z1,getTranslation:u4,identity:X,invert:ke,lookAt:t2,mul:Ki,multiply:se,multiplyScalar:x4,multiplyScalarAndAdd:w4,ortho:ss,orthoNO:e2,orthoZO:m4,perspective:h4,perspectiveFromFieldOfView:d4,perspectiveNO:Q1,perspectiveZO:p4,rotate:ct,rotateX:ts,rotateY:ns,rotateZ:rs,scale:Gt,set:r4,str:v4,sub:E4,subtract:n2,targetTo:y4,translate:Se,transpose:ue});function $(){var t=new Ve(3);return Ve!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function en(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function xe(t,e,n){var r=new Ve(3);return r[0]=t,r[1]=e,r[2]=n,r}function M4(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ce(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function rn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Pe(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function O4(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function D4(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function tn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function ze(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function r2(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function kt(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function i2(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function _e(t,e){var n=e[0],r=e[1],i=e[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function fe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ve(t,e,n){var r=e[0],i=e[1],a=e[2],s=n[0],o=n[1],c=n[2];return t[0]=i*c-a*o,t[1]=a*s-r*c,t[2]=r*o-i*s,t}function pe(t,e,n){var r=e[0],i=e[1],a=e[2],s=n[3]*r+n[7]*i+n[11]*a+n[15];return s=s||1,t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/s,t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/s,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/s,t}function Ei(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=r*n[0]+i*n[3]+a*n[6],t[1]=r*n[1]+i*n[4]+a*n[7],t[2]=r*n[2]+i*n[5]+a*n[8],t}function a2(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],s=e[1],o=e[2],c=Math.sqrt(n*n+r*r+i*i),l=Math.sqrt(a*a+s*s+o*o),u=c*l,f=u&&fe(t,e)/u;return Math.acos(Math.min(Math.max(f,-1),1))}function V4(t){return t[0]=0,t[1]=0,t[2]=0,t}function yo(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function vo(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],s=e[1],o=e[2];return Math.abs(n-a)<=ge*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=ge*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=ge*Math.max(1,Math.abs(i),Math.abs(o))}var $e=Pe,I4=O4,s2=en;(function(){var t=$();return function(e,n,r,i,a,s){var o,c;for(n||(n=3),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,o=r;o<c;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],a(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();function L4(){var t=new Ve(4);return Ve!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function N4(t,e,n,r){var i=new Ve(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function To(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function b4(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],s=n*n+r*r+i*i+a*a;return s>0&&(s=1/Math.sqrt(s)),t[0]=n*s,t[1]=r*s,t[2]=i*s,t[3]=a*s,t}function yn(t,e,n){var r=e[0],i=e[1],a=e[2],s=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*s,t[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*s,t[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*s,t[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*s,t}(function(){var t=L4();return function(e,n,r,i,a,s){var o,c;for(n||(n=4),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,o=r;o<c;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],a(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();function En(){var t=new Ve(4);return Ve!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function os(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function F4(t,e){var n=Math.acos(e[3])*2,r=Math.sin(n/2);return r>ge?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Co(t,e,n){var r=e[0],i=e[1],a=e[2],s=e[3],o=n[0],c=n[1],l=n[2],u=n[3];return t[0]=r*u+s*o+i*l-a*c,t[1]=i*u+s*c+a*o-r*l,t[2]=a*u+s*l+r*c-i*o,t[3]=s*u-r*o-i*c-a*l,t}function Mi(t,e,n,r){var i=e[0],a=e[1],s=e[2],o=e[3],c=n[0],l=n[1],u=n[2],f=n[3],g,h,p,d,m;return h=i*c+a*l+s*u+o*f,h<0&&(h=-h,c=-c,l=-l,u=-u,f=-f),1-h>ge?(g=Math.acos(h),p=Math.sin(g),d=Math.sin((1-r)*g)/p,m=Math.sin(r*g)/p):(d=1-r,m=r),t[0]=d*i+m*c,t[1]=d*a+m*l,t[2]=d*s+m*u,t[3]=d*o+m*f,t}function _4(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function U4(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);var a=(i+1)%3,s=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[a*3+a]-e[s*3+s]+1),t[i]=.5*r,r=.5/r,t[3]=(e[a*3+s]-e[s*3+a])*r,t[a]=(e[a*3+i]+e[i*3+a])*r,t[s]=(e[s*3+i]+e[i*3+s])*r}return t}var xo=N4,o2=b4;(function(){var t=$(),e=xe(1,0,0),n=xe(0,1,0);return function(r,i,a){var s=fe(i,a);return s<-.999999?(ve(t,e,i),s2(t)<1e-6&&ve(t,n,i),_e(t,t),os(r,t,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(ve(t,i,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+s,o2(r,r))}})();(function(){var t=En(),e=En();return function(n,r,i,a,s,o){return Mi(t,r,s,o),Mi(e,i,a,o),Mi(n,t,e,2*o*(1-o)),n}})();(function(){var t=K1();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],o2(e,U4(e,t))}})();function c2(){var t=new Ve(2);return Ve!=Float32Array&&(t[0]=0,t[1]=0),t}function wo(t,e){var n=new Ve(2);return n[0]=t,n[1]=e,n}function cs(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function qi(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function So(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}var Xi=qi;(function(){var t=c2();return function(e,n,r,i,a,s){var o,c;for(n||(n=2),r||(r=0),i?c=Math.min(i*n+r,e.length):c=e.length,o=r;o<c;o+=n)t[0]=e[o],t[1]=e[o+1],a(t,t,s),e[o]=t[0],e[o+1]=t[1];return e}})();const wr={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var l2={ObjectType:wr};const{ObjectType:Oi}=l2,k4={};function P4(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function n(o){switch(o){case Oi.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case Oi.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case Oi.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let r=null,i=null,a=!0,s="";t.getType=()=>r,t.setType=o=>{r=o},t.getHandle=()=>i,t.isReady=()=>a===!1,t.generateBuffer=o=>{const c=n(o);return i===null&&(i=e.context.createBuffer(),r=o),n(r)===c},t.upload=(o,c)=>t.generateBuffer(c)?(e.context.bindBuffer(n(r),i),e.context.bufferData(n(r),o,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=o.length*o.BYTES_PER_ELEMENT,a=!1,!0):(s="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>i?(e.context.bindBuffer(n(r),i),!0):!1,t.release=()=>i?(e.context.bindBuffer(n(r),null),!0):!1,t.releaseGraphicsResources=()=>{i!==null&&(e.context.bindBuffer(n(r),null),e.context.deleteBuffer(i),i=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=o=>{e._openGLRenderWindow!==o&&(t.releaseGraphicsResources(),e._openGLRenderWindow=o,e.context=null,o&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>s}const G4={objectType:Oi.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function u2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,G4,n),R.obj(t,e),R.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),R.moveToProtected(t,e,["openGLRenderWindow"]),P4(t,e)}const A4=R.newInstance(u2);var f2={newInstance:A4,extend:u2,...k4,...l2};const g2={FLAT:0,GOURAUD:1,PHONG:2},St={POINTS:0,WIREFRAME:1,SURFACE:2},B4=g2;var h2={Shading:g2,Representation:St,Interpolation:B4};const{vtkErrorMacro:Ro}=R;function W4(t,e){const n=new Float64Array(3);i2(n,e);const r=new Float64Array(16);return J1(r,En(),t,n),r}function z4(t,e){return t===null||e===null?!1:!(yo(t,[0,0,0])&&yo(e,[1,1,1]))}function $4(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(wr.ARRAY_BUFFER),t.createVBO=function(n,r,i,a){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!n.getData()||!n.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const o=a.points.getData();let c=null,l=null,u=null;const f=a.colors?a.colors.getNumberOfComponents():0,g=a.tcoords?a.tcoords.getNumberOfComponents():0;a.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=a.normals.getData()),a.customAttributes&&a.customAttributes.forEach(N=>{N&&(e.customData.push({data:N.getData(),offset:4*e.blockSize,components:N.getNumberOfComponents(),name:N.getName()}),e.blockSize+=N.getNumberOfComponents())}),a.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=g,e.blockSize+=g,l=a.tcoords.getData()),a.colors?(e.colorComponents=a.colors.getNumberOfComponents(),e.colorOffset=0,u=a.colors.getData(),e.colorBO||(e.colorBO=f2.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let h=0,p=0,d=0,m=0,y=0,T=0,v;const C={anythingToPoints(N,I,U,G){for(let P=0;P<N;++P)v(I[U+P],G)},linesToWireframe(N,I,U,G){for(let P=0;P<N-1;++P)v(I[U+P],G),v(I[U+P+1],G)},polysToWireframe(N,I,U,G){if(N>2)for(let P=0;P<N;++P)v(I[U+P],G),v(I[U+(P+1)%N],G)},stripsToWireframe(N,I,U,G){if(N>2){for(let P=0;P<N-1;++P)v(I[U+P],G),v(I[U+P+1],G);for(let P=0;P<N-2;P++)v(I[U+P],G),v(I[U+P+2],G)}},polysToSurface(N,I,U,G){for(let P=0;P<N-2;P++)v(I[U+0],G),v(I[U+P+1],G),v(I[U+P+2],G)},stripsToSurface(N,I,U,G){for(let P=0;P<N-2;P++)v(I[U+P],G),v(I[U+P+1+P%2],G),v(I[U+P+1+(P+1)%2],G)}},x={anythingToPoints(N,I){return N},linesToWireframe(N,I){return N>1?(N-1)*2:0},polysToWireframe(N,I){return N>2?N*2:0},stripsToWireframe(N,I){return N>2?N*4-6:0},polysToSurface(N,I){return N>2?(N-2)*3:0},stripsToSurface(N,I,U){return N>2?(N-2)*3:0}};let w=null,E=null;i===St.POINTS||r==="verts"?(w=C.anythingToPoints,E=x.anythingToPoints):i===St.WIREFRAME||r==="lines"?(w=C[`${r}ToWireframe`],E=x[`${r}ToWireframe`]):(w=C[`${r}ToSurface`],E=x[`${r}ToSurface`]);const O=n.getData(),D=O.length;let S=0;for(let N=0;N<D;)S+=E(O[N],O),N+=O[N]+1;let M=null;const V=new Float32Array(S*e.blockSize);u&&(M=new Uint8Array(S*4));let L=0,F=0,k=0,b=0;for(let N=0;N<3;++N){const I=a.points.getRange(N),U=I[1]-I[0];k+=U*U;const G=.5*(I[1]+I[0]);b+=G*G}if(k>0&&(Math.abs(b)/k>1e6||Math.abs(Math.log10(k))>3||k===0&&b>1e6)){const N=new Float64Array(3),I=new Float64Array(3);for(let U=0;U<3;++U){const G=a.points.getRange(U),P=G[1]-G[0];N[U]=.5*(G[1]+G[0]),I[U]=P>0?1/P:1}t.setCoordShiftAndScale(N,I)}else e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null);if(s)if(!s.points&&!s.cells)s.points=new Int32Array(S),s.cells=new Int32Array(S);else{const N=new Int32Array(S+s.points.length);N.set(s.points),s.points=N;const I=new Int32Array(S+s.cells.length);I.set(s.cells),s.cells=I}let _=a.vertexOffset;v=function(I,U){if(s&&(s.points[_]=I,s.cells[_]=T+a.cellOffset),++_,h=I*3,e.coordShiftAndScaleEnabled?(V[L++]=(o[h++]-e.coordShift[0])*e.coordScale[0],V[L++]=(o[h++]-e.coordShift[1])*e.coordScale[1],V[L++]=(o[h++]-e.coordShift[2])*e.coordScale[2]):(V[L++]=o[h++],V[L++]=o[h++],V[L++]=o[h++]),c!==null&&(a.haveCellNormals?p=(T+a.cellOffset)*3:p=I*3,V[L++]=c[p++],V[L++]=c[p++],V[L++]=c[p++]),e.customData.forEach(G=>{y=I*G.components;for(let P=0;P<G.components;++P)V[L++]=G.data[y++]}),l!==null){a.useTCoordsPerCell?d=U*g:d=I*g;for(let G=0;G<g;++G)V[L++]=l[d++]}u!==null&&(a.haveCellScalars?m=(T+a.cellOffset)*f:m=I*f,M[F++]=u[m++],M[F++]=u[m++],M[F++]=u[m++],M[F++]=f===4?u[m++]:255)};for(let N=0;N<D;N+=O[N]+1,T++)w(O[N],O,N+1,T+a.cellOffset);return e.elementCount=S,t.upload(V,wr.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(M,wr.ARRAY_BUFFER)),T},t.setCoordShiftAndScale=(n,r)=>{if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){Ro("Wrong type for coordShift, expected vec3 or null");return}if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){Ro("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||n===null||!vo(n,e.coordShift))&&(e.coordShift=n),(e.coordScale===null||r===null||!vo(r,e.coordScale))&&(e.coordScale=r),e.coordShiftAndScaleEnabled=z4(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=W4(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const j4={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function p2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,j4,n),f2.extend(t,e,n),R.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),R.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),$4(t,e)}const H4=R.newInstance(p2);var K4={newInstance:H4,extend:p2};const{vtkErrorMacro:q4}=R;function X4(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let n=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":n=e.context.FRAGMENT_SHADER;break;case"Vertex":default:n=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(n),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const i=e.context.getShaderInfoLog(e.handle);return q4(`Error compiling shader '${e.source}': ${i}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const Y4={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function d2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Y4,n),R.obj(t,e),R.setGet(t,e,["shaderType","source","error","handle","context"]),X4(t,e)}const Z4=R.newInstance(d2,"vtkShader");var za={newInstance:Z4,extend:d2};const{vtkErrorMacro:yt}=R;function J4(t,e,n,r){const i=typeof n=="string"?n:n.join(`
`),a=r===!1?e:new RegExp(e,"g"),s=t.replace(a,i);return{replace:s!==i,result:s}}function Q4(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(yt(e.error),0):t.link()?(t.setCompiled(!0),1):(yt(`Links failed: ${e.error}`),0):(yt(e.fragmentShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),yt(e.fragmentShader.getError()),0):(yt(e.vertexShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),yt(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=n=>{e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const r=e.context.getProgramInfoLog(e.handle);return yt(`Error linking shader ${r}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const a=new Float32Array(r);return e.context.uniformMatrix4fv(i,!1,a),!0},t.setUniformMatrix3x3=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const a=new Float32Array(r);return e.context.uniformMatrix3fv(i,!1,a),!0},t.setUniformf=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1f(i,r),!0)},t.setUniformfv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1fv(i,r),!0)},t.setUniformi=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1i(i,r),!0)},t.setUniformiv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1iv(i,r),!0)},t.setUniform2f=(n,r,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(a,r,i),!0},t.setUniform2fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2fv(i,r),!0)},t.setUniform2i=(n,r,i)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(i===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(a,r,i),!0},t.setUniform2iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2iv(i,r),!0)},t.setUniform3f=(n,r,i,a)=>{const s=t.findUniform(n);if(s===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(s,r,i,a),!0},t.setUniform3fArray=(n,r)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(!Array.isArray(r)||r.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,r[0],r[1],r[2]),!0},t.setUniform3fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3fv(i,r),!0)},t.setUniform3i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];let o=a;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(r,o[0],o[1],o[2]),!0},t.setUniform3iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3iv(i,r),!0)},t.setUniform4f=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];let o=a;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(r,o[0],o[1],o[2],o[3]),!0},t.setUniform4fv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4fv(i,r),!0)},t.setUniform4i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];let o=a;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(r,o[0],o[1],o[2],o[3]),!0},t.setUniform4iv=(n,r)=>{const i=t.findUniform(n);return i===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4iv(i,r),!0)},t.findUniform=n=>{if(!n||!e.linked)return-1;let r=e.uniformLocs[n];return r!==void 0?r:(r=e.context.getUniformLocation(e.handle,n),r===null?(e.error=`Uniform ${n} not found in current shader program.`,e.uniformLocs[n]=-1,-1):(e.uniformLocs[n]=r,r))},t.isUniformUsed=n=>{if(!n)return!1;let r=e.uniformLocs[n];return r!==void 0?r!==null:e.linked?(r=e.context.getUniformLocation(e.handle,n),e.uniformLocs[n]=r,r!==null):(yt("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=n=>{if(!n)return!1;if(n in e.attributeLocs)return!0;if(!e.linked)return yt("attempt to find uniform when the shader program is not linked"),!1;const r=e.context.getAttribLocation(e.handle,n);return r===-1?!1:(e.attributeLocs[n]=r,!0)},t.attachShader=n=>{if(n.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const r=e.context.createProgram();if(r===0)return e.error="Could not create shader program.",!1;e.handle=r,e.linked=!1}return n.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=n.getHandle()),n.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=n.getHandle()),e.context.attachShader(e.handle,n.getHandle()),t.setLinked(!1),!0},t.detachShader=n=>{if(n.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),n.getShaderType()){case"Vertex":return e.vertexShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=n=>{e.context=n,e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.setLastCameraMTime=n=>{e.lastCameraMTime=n}}const eh={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function m2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eh,n),e.attributesLocs={},e.uniformLocs={},e.vertexShader=za.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=za.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=za.newInstance(),e.geometryShader.setShaderType("Geometry"),R.obj(t,e),R.get(t,e,["lastCameraMTime"]),R.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),Q4(t,e)}const th=R.newInstance(m2,"vtkShaderProgram");var B={newInstance:th,extend:m2,substitute:J4};function nh(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,i.buffer);for(let a=0;a<i.attributes.length;++a){const s=i.attributes[a],o=s.isMatrix?s.size:1;for(let c=0;c<o;++c)n.enableVertexAttribArray(s.index+c),n.vertexAttribPointer(s.index+c,s.size,s.type,s.normalize,s.stride,s.offset+s.stride*c/s.size),s.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(s.index+c,1):n.vertexAttribDivisor(s.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,i.buffer);for(let a=0;a<i.attributes.length;++a){const s=i.attributes[a],o=s.isMatrix?s.size:1;for(let c=0;c<o;++c)n.enableVertexAttribArray(s.index+c),n.vertexAttribPointer(s.index+c,s.size,s.type,s.normalize,s.stride,s.offset+s.stride*c/s.size),s.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(s.index+c,0):n.vertexAttribDivisor(s.index+c,0)),n.disableVertexAttribArray(s.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(n,r,i,a,s,o,c,l)=>t.addAttributeArrayWithDivisor(n,r,i,a,s,o,c,l,0,!1),t.addAttributeArrayWithDivisor=(n,r,i,a,s,o,c,l,u,f)=>{if(!n||!n.isBound()||r.getHandle()===0||r.getType()!==wr.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=n.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==n.getHandle()))return!1;const g=e.context,h={};if(h.name=i,h.index=g.getAttribLocation(e.handleProgram,i),h.offset=a,h.stride=s,h.type=o,h.size=c,h.normalize=l,h.isMatrix=f,h.divisor=u,h.Index===-1)return!1;if(r.bind(),g.enableVertexAttribArray(h.index),g.vertexAttribPointer(h.index,h.size,h.type,h.normalize,h.stride,h.offset),u>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(h.index,1):g.vertexAttribDivisor(h.index,1)),h.buffer=r.getHandle(),!e.supported){let p=!1;for(let d=0;d<e.buffers.length;++d){const m=e.buffers[d];if(m.buffer===h.buffer){p=!0;let y=!1;for(let T=0;T<m.attributes.length;++T)m.attributes[T].name===i&&(y=!0,m.attributes[T]=h);y||m.attributes.push(h)}}p||e.buffers.push({buffer:h.buffer,attributes:[h]})}return!0},t.addAttributeMatrixWithDivisor=(n,r,i,a,s,o,c,l,u)=>{const f=t.addAttributeArrayWithDivisor(n,r,i,a,s,o,c,l,u,!0);if(!f)return f;const g=e.context,h=g.getAttribLocation(e.handleProgram,i);for(let p=1;p<c;p++)g.enableVertexAttribArray(h+p),g.vertexAttribPointer(h+p,c,o,l,s,a+s*p/c),u>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(h+p,1):g.vertexAttribDivisor(h+p,1));return!0},t.removeAttributeArray=n=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let r=0;r<e.buffers.length;++r){const i=e.buffers[r];for(let a=0;a<i.attributes.length;++a)if(i.attributes[a].name===n)return i.attributes.splice(a,1),i.attributes.length||e.buffers.splice(r,1),!0}return!0},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const rh={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function y2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rh,n),e.buffers=[],R.obj(t,e),R.get(t,e,["supported"]),R.setGet(t,e,["forceEmulation"]),nh(t,e)}const ih=R.newInstance(y2,"vtkOpenGLVertexArrayObject");var v2={newInstance:ih,extend:y2};const Ht={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function ah(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=n=>{e.context=n.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(n),e.CABO.setOpenGLRenderWindow(n)},t.releaseGraphicsResources=n=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(n,r,i,a)=>{if(e.CABO.getElementCount()){const s=t.getOpenGLMode(i),o=t.haveWideLines(n,r),c=e.context,l=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),s===c.LINES&&o?(t.updateShaders(n,r,a),c.drawArraysInstanced(s,0,e.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(c.lineWidth(r.getProperty().getLineWidth()),t.updateShaders(n,r,a),c.drawArrays(s,0,e.CABO.getElementCount()),c.lineWidth(1));const f=(s===c.POINTS?1:0)||(s===c.LINES?2:3);return e.pointPicking&&c.depthMask(l),e.CABO.getElementCount()/f}return 0},t.getOpenGLMode=n=>{if(e.pointPicking)return e.context.POINTS;const r=e.primitiveType;return n===St.POINTS||r===Ht.Points?e.context.POINTS:n===St.WIREFRAME||r===Ht.Lines||r===Ht.TrisEdges||r===Ht.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(n,r)=>r.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=r.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(n,r,i)=>!!(i.getNeedToRebuildShaders(t,n,r)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<i.getMTime()||t.getShaderSourceTime().getMTime()<r.getMTime()),t.updateShaders=(n,r,i)=>{if(t.getNeedToRebuildShaders(n,r,i)){const a={Vertex:null,Fragment:null,Geometry:null};i.buildShaders(a,n,r);const s=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(a.Vertex,a.Fragment,a.Geometry);s!==t.getProgram()&&(t.setProgram(s),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),i.setMapperShaderParameters(t,n,r),i.setPropertyShaderParameters(t,n,r),i.setCameraShaderParameters(t,n,r),i.setLightingShaderParameters(t,n,r),i.invokeShaderCallbacks(t,n,r)},t.setMapperShaderParameters=(n,r,i)=>{if(t.haveWideLines(n,r)){t.getProgram().setUniform2f("viewportSize",i.usize,i.vsize);const a=parseFloat(r.getProperty().getLineWidth()),s=a/2;t.getProgram().setUniformf("lineWidthStepSize",a/Math.ceil(a)),t.getProgram().setUniformf("halfLineWidth",s)}e.primitiveType===Ht.Points||r.getProperty().getRepresentation()===St.POINTS?t.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(n,r,i)=>{let a=n.Vertex;a=B.substitute(a,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,a=B.substitute(a,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(i.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(r,i)&&(a=B.substitute(a,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,a=B.substitute(a,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=a},t.getPointPickingPrimitiveSize=()=>e.primitiveType===Ht.Points?2:e.primitiveType===Ht.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const sh={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function T2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sh,n),R.obj(t,e),e.shaderSourceTime={},R.obj(e.shaderSourceTime),e.attributeUpdateTime={},R.obj(e.attributeUpdateTime),R.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=B.newInstance(),e.VAO=v2.newInstance(),e.CABO=K4.newInstance(),ah(t,e)}const oh=R.newInstance(T2);var Ca={newInstance:oh,extend:T2,primTypes:Ht};const{Representation:mr,Interpolation:yr}=h2;function Eo(t){return()=>R.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function ch(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(n,r,i)=>{Array.isArray(n)?(e.color[0]!==n[0]||e.color[1]!==n[1]||e.color[2]!==n[2])&&(e.color[0]=n[0],e.color[1]=n[1],e.color[2]=n[2],t.modified()):(e.color[0]!==n||e.color[1]!==r||e.color[2]!==i)&&(e.color[0]=n,e.color[1]=r,e.color[2]=i,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=Eo("ComputeCompositeColor"),t.getColor=()=>{let n=0;e.ambient+e.diffuse+e.specular>0&&(n=1/(e.ambient+e.diffuse+e.specular));for(let r=0;r<3;r++)e.color[r]=n*(e.ambient*e.ambientColor[r]+e.diffuse*e.diffuseColor[r]+e.specular*e.specularColor[r]);return[].concat(e.color)},t.setSpecularPower=n=>{const r=1/Math.max(1,n);(e.roughness!==r||e.specularPower!==n)&&(e.specularPower=n,e.roughness=r,t.modified())},t.addShaderVariable=Eo("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(yr.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(yr.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(yr.PHONG),t.getInterpolationAsString=()=>R.enumToString(yr,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(mr.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(mr.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(mr.POINTS),t.getRepresentationAsString=()=>R.enumToString(mr,e.representation)}const lh={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:yr.GOURAUD,representation:mr.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function C2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lh,n),R.obj(t,e),R.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture"]),R.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),ch(t,e)}const uh=R.newInstance(C2,"vtkProperty");var fh={newInstance:uh,extend:C2,...h2};const{vtkErrorMacro:Mo,vtkWarningMacro:gh}=R;function hh(t,e){e.classHierarchy.push("vtkFieldData");const n=t.getState;e.arrays&&(e.arrays=e.arrays.map(r=>({data:ht(r.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=r=>{t.initializeFields(),e.copyFieldFlags=r.getCopyFieldFlags().map(i=>i),e.arrays=r.arrays().map(i=>({array:i}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=r=>{const i=r.getName(),{array:a,index:s}=t.getArrayWithIndex(i);return a!=null?(e.arrays[s]={data:r},s):(e.arrays=[].concat(e.arrays,{data:r}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=r=>{const i=e.arrays.findIndex(a=>a.data.getName()===r);return t.removeArrayByIndex(i)},t.removeArrayByIndex=r=>r!==-1&&r<e.arrays.length?(e.arrays.splice(r,1),!0):!1,t.getArrays=()=>e.arrays.map(r=>r.data),t.getArray=r=>typeof r=="number"?t.getArrayByIndex(r):t.getArrayByName(r),t.getArrayByName=r=>e.arrays.reduce((i,a,s)=>a.data.getName()===r?a.data:i,null),t.getArrayWithIndex=r=>{const i=e.arrays.findIndex(a=>a.data.getName()===r);return{array:i!==-1?e.arrays[i].data:null,index:i}},t.getArrayByIndex=r=>r>=0&&r<e.arrays.length?e.arrays[r].data:null,t.hasArray=r=>t.getArrayWithIndex(r).index>=0,t.getArrayName=r=>{const i=e.arrays[r];return i?i.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=r=>e.copyFieldFlags[r],t.passData=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;r.getArrays().forEach(s=>{const o=t.getFlag(s.getName());if(o!==!1&&!(e.doCopyAllOff&&o!==!0)&&s){let c=t.getArrayByName(s.getName());if(c)if(s.getNumberOfComponents()===c.getNumberOfComponents())if(i>-1&&i<s.getNumberOfTuples()){const l=a>-1?a:i;c.insertTuple(l,s.getTuple(i))}else c.insertTuples(0,s.getTuples());else Mo("Unhandled case in passData");else if(i<0||i>s.getNumberOfTuples())t.addArray(s),r.getAttributes(s).forEach(l=>{t.setAttribute(s,l)});else{const l=s.getNumberOfComponents();let u=s.getNumberOfValues();const f=a>-1?a:i;u<=f*l&&(u=(f+1)*l),c=oe.newInstance({name:s.getName(),dataType:s.getDataType(),numberOfComponents:l,values:R.newTypedArray(s.getDataType(),u),size:0}),c.insertTuple(f,s.getTuple(i)),t.addArray(c),r.getAttributes(s).forEach(g=>{t.setAttribute(c,g)})}}})},t.interpolateData=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;r.getArrays().forEach(c=>{const l=t.getFlag(c.getName());if(l!==!1&&!(e.doCopyAllOff&&l!==!0)&&c){let u=t.getArrayByName(c.getName());if(u)if(c.getNumberOfComponents()===u.getNumberOfComponents())if(i>-1&&i<c.getNumberOfTuples()){const f=s>-1?s:i;u.interpolateTuple(f,c,i,c,a,o),gh("Unexpected case in interpolateData")}else u.insertTuples(c.getTuples());else Mo("Unhandled case in interpolateData");else if(i<0||a<0||i>c.getNumberOfTuples())t.addArray(c),r.getAttributes(c).forEach(f=>{t.setAttribute(c,f)});else{const f=c.getNumberOfComponents();let g=c.getNumberOfValues();const h=s>-1?s:i;g<=h*f&&(g=(h+1)*f),u=oe.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:f,values:R.newTypedArray(c.getDataType(),g),size:0}),u.interpolateTuple(h,c,i,c,a,o),t.addArray(u),r.getAttributes(c).forEach(p=>{t.setAttribute(u,p)})}}})},t.copyFieldOn=r=>{e.copyFieldFlags[r]=!0},t.copyFieldOff=r=>{e.copyFieldFlags[r]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=r=>{e.arrays=r.getArrays().map(i=>{const a=i.newClone();return a.deepCopy(i),{data:a}})},t.copyFlags=r=>r.getCopyFieldFlags().map(i=>i),t.reset=()=>e.arrays.forEach(r=>r.data.reset()),t.getMTime=()=>e.arrays.reduce((r,i)=>i.data.getMTime()>r?i.data.getMTime():r,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((r,i)=>r+i.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const r=n();return r&&(r.arrays=e.arrays.map(i=>({data:i.data.getState()}))),r}}const ph={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function x2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ph,n),R.obj(t,e),hh(t,e)}const dh=R.newInstance(x2,"vtkFieldData");var mh={newInstance:dh,extend:x2};const yh={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},vh={MAX:0,EXACT:1,NOLIMIT:2},Th={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},Ch={DUPLICATEPOINT:1,HIDDENPOINT:2},xh={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},wh="vtkGhostType",Sh={DEFAULT:0,SINGLE:1,DOUBLE:2};var w2={AttributeCopyOperations:xh,AttributeLimitTypes:vh,AttributeTypes:yh,CellGhostTypes:Th,DesiredOutputPrecision:Sh,PointGhostTypes:Ch,ghostArrayName:wh};const{AttributeTypes:Wt,AttributeCopyOperations:sn}=w2,{vtkWarningMacro:ri}=R;function Rh(t,e){const n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(s){let o=n.find(c=>Wt[c.toUpperCase()]===s||typeof s!="number"&&c.toLowerCase()===s.toLowerCase());return typeof o>"u"&&(o=null),o}e.classHierarchy.push("vtkDataSetAttributes");const i={...t};t.checkNumberOfComponents=s=>!0,t.setAttribute=(s,o)=>{const c=r(o);if(s&&c.toUpperCase()==="PEDIGREEIDS"&&!s.isA("vtkDataArray"))return ri(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(s&&!t.checkNumberOfComponents(s,c))return ri(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let l=e[`active${c}`];if(l>=0&&l<e.arrays.length){if(e.arrays[l]===s)return l;t.removeArrayByIndex(l)}return s?(l=t.addArray(s),e[`active${c}`]=l):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=s=>n.filter(o=>t[`get${o}`]()===s),t.setActiveAttributeByName=(s,o)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(s).index,o),t.setActiveAttributeByIndex=(s,o)=>{const c=r(o);if(s>=0&&s<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const l=t.getArrayByIndex(s);if(!l.isA("vtkDataArray"))return ri(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(l,c))return ri(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=s,t.modified(),s}return s===-1&&(e[`active${c}`]=s,t.modified()),-1},t.getActiveAttribute=s=>{const o=r(s);return t[`get${o}`]()},t.removeAllArrays=()=>{n.forEach(s=>{e[`active${s}`]=-1}),i.removeAllArrays()},t.removeArrayByIndex=s=>(s!==-1&&n.forEach(o=>{s===e[`active${o}`]?e[`active${o}`]=-1:s<e[`active${o}`]&&(e[`active${o}`]-=1)}),i.removeArrayByIndex(s)),n.forEach(s=>{const o=`active${s}`;t[`get${s}`]=()=>t.getArrayByIndex(e[o]),t[`set${s}`]=c=>t.setAttribute(c,s),t[`setActive${s}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,s),t[`copy${s}Off`]=()=>{const c=s.toUpperCase();e.copyAttributeFlags[sn.PASSDATA][Wt[c]]=!1},t[`copy${s}On`]=()=>{const c=s.toUpperCase();e.copyAttributeFlags[sn.PASSDATA][Wt[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(sn).filter(s=>s!=="ALLCOPY").forEach(s=>{e.copyAttributeFlags[sn[s]]=Object.keys(Wt).filter(o=>o!=="NUM_ATTRIBUTES").reduce((o,c)=>(o[Wt[c]]=!0,o),[])}),e.copyAttributeFlags[sn.COPYTUPLE][Wt.GLOBALIDS]=!1,e.copyAttributeFlags[sn.INTERPOLATE][Wt.GLOBALIDS]=!1,e.copyAttributeFlags[sn.COPYTUPLE][Wt.PEDIGREEIDS]=!1},t.initialize=R.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(s=>{!e.dataArrays[s].ref&&e.dataArrays[s].type==="vtkDataArray"&&t.addArray(oe.newInstance(e.dataArrays[s]))});const a=t.shallowCopy;t.shallowCopy=(s,o)=>{a(s,o),e.arrays=s.getArrays().map(c=>{const l=c.newClone();return l.shallowCopy(c,o),{data:l}})},t.initializeAttributeCopyFlags()}const Eh={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function S2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Eh,n),mh.extend(t,e,n),R.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),Rh(t,e)}const Mh=R.newInstance(S2,"vtkDataSetAttributes");var Oo={newInstance:Mh,extend:S2,...w2};const Oh={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},Dh={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var Vh={FieldDataTypes:Oh,FieldAssociations:Dh};const p0=["pointData","cellData","fieldData"];function Ih(t,e){e.classHierarchy.push("vtkDataSet"),p0.forEach(r=>{e[r]?e[r]=ht(e[r]):e[r]=Oo.newInstance()});const n=t.shallowCopy;t.shallowCopy=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,i),p0.forEach(a=>{e[a]=Oo.newInstance(),e[a].shallowCopy(r.getReferenceByName(a))})}}const Lh={};function R2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Lh,n),R.obj(t,e),R.setGet(t,e,p0),Ih(t,e)}const Nh=R.newInstance(R2,"vtkDataSet");var E2={newInstance:Nh,extend:R2,...Vh};function bh(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=n=>{if(n){const r=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize),e.context.scissor(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=n=>{if(n!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||n.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){Oe(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),q1(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),es(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),ue(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const r=e._openGLRenderer.getAspectRatio();Oe(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(r,-1,1)),ue(e.keyMatrices.vcpc,e.keyMatrices.vcpc),se(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=n}return e.keyMatrices}}const Fh={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function _h(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Fh,n),Be.extend(t,e,n),e.keyMatrixTime={},Re(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},je(t,e,["context","keyMatrixTime"]),bh(t,e)}const Uh=Ie(_h);Dt("vtkCamera",Uh);function kh(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=n=>n.isA("vtkPlane")?e.clippingPlanes.includes(n)?!1:(e.clippingPlanes.push(n),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=n=>{const r=e.clippingPlanes.indexOf(n);return r===-1?!1:(e.clippingPlanes.splice(r,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=n=>{if(n)if(!Array.isArray(n))t.addClippingPlane(n);else{const r=n.length;for(let i=0;i<r&&i<6;i++)t.addClippingPlane(n[i])}},t.getClippingPlaneInDataCoords=(n,r,i)=>{const a=e.clippingPlanes,s=n;if(a){const o=a.length;if(r>=0&&r<o){const c=a[r],l=c.getNormal(),u=c.getOrigin(),f=l[0],g=l[1],h=l[2],p=-(f*u[0]+g*u[1]+h*u[2]);i[0]=f*s[0]+g*s[4]+h*s[8]+p*s[12],i[1]=f*s[1]+g*s[5]+h*s[9]+p*s[13],i[2]=f*s[2]+g*s[6]+h*s[10]+p*s[14],i[3]=f*s[3]+g*s[7]+h*s[11]+p*s[15];return}}R.vtkErrorMacro(`Clipping plane index ${r} is out of range.`)}}const Ph={clippingPlanes:[]};function Gh(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ph,n),R.obj(t,e),R.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),kh(t,e)}var Ah={extend:Gh};function Bh(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=n=>{if(!e.transform)return t.evaluateFunction(n);const r=[];return e.transform.transformPoint(n,r),t.evaluateFunction(r)},t.evaluateFunction=n=>{R.vtkErrorMacro("not implemented")}}const Wh={};function M2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wh,n),R.obj(t,e),R.setGet(t,e,["transform"]),Bh(t,e)}const zh=R.newInstance(M2,"vtkImplicitFunction");var $h={newInstance:zh,extend:M2};const d0=1e-6,O2="coincide",D2="disjoint";function jh(t,e,n){return t[0]*(n[0]-e[0])+t[1]*(n[1]-e[1])+t[2]*(n[2]-e[2])}function V2(t,e,n){const r=n[0]*(t[0]-e[0])+n[1]*(t[1]-e[1])+n[2]*(t[2]-e[2]);return Math.abs(r)}function I2(t,e,n,r){const i=[];Ut(t,e,i);const a=Y(n,i);r[0]=t[0]-a*n[0],r[1]=t[1]-a*n[1],r[2]=t[2]-a*n[2]}function L2(t,e,n){const r=Y(t,e);let i=Y(e,e);return i===0&&(i=1),n[0]=t[0]-r*e[0]/i,n[1]=t[1]-r*e[1]/i,n[2]=t[2]-r*e[2]/i,n}function N2(t,e,n,r){const i=[];Ut(t,e,i);const a=Y(n,i),s=Y(n,n);s!==0?(r[0]=t[0]-a*n[0]/s,r[1]=t[1]-a*n[1]/s,r[2]=t[2]-a*n[2]/s):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}function b2(t,e,n,r){const i={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},a=[],s=[];Ut(e,t,a),Ut(n,t,s);const o=Y(r,s),c=Y(r,a);let l,u;return c<0?l=-c:l=c,o<0?u=-o*d0:u=o*d0,l<=u||(i.t=o/c,i.x[0]=t[0]+i.t*a[0],i.x[1]=t[1]+i.t*a[1],i.x[2]=t[2]+i.t*a[2],i.intersection=!0,i.betweenPoints=i.t>=0&&i.t<=1),i}function F2(t,e,n,r){const i={intersection:!1,l0:[],l1:[],error:null},a=[];Et(e,r,a);const s=a.map(f=>Math.abs(f));if(s[0]+s[1]+s[2]<d0){const f=[];return Ut(t,n,f),Y(e,f)===0?i.error=O2:i.error=D2,i}let o;s[0]>s[1]&&s[0]>s[2]?o="x":s[1]>s[2]?o="y":o="z";const c=[],l=-Y(e,t),u=-Y(r,n);switch(o){case"x":c[0]=0,c[1]=(u*e[2]-l*r[2])/a[0],c[2]=(l*r[1]-u*e[1])/a[0];break;case"y":c[0]=(l*r[2]-u*e[2])/a[1],c[1]=0,c[2]=(u*e[0]-l*r[0])/a[1];break;case"z":c[0]=(u*e[1]-l*r[1])/a[2],c[1]=(l*r[0]-u*e[0])/a[2],c[2]=0;break}return i.l0=c,$i(c,a,i.l1),i.intersection=!0,i}const Hh={evaluate:jh,distanceToPlane:V2,projectPoint:I2,projectVector:L2,generalizedProjectPoint:N2,intersectWithLine:b2,intersectWithPlane:F2,DISJOINT:D2,COINCIDE:O2};function Kh(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=n=>V2(n,e.origin,e.normal),t.projectPoint=(n,r)=>{I2(n,e.origin,e.normal,r)},t.projectVector=(n,r)=>L2(n,e.normal,r),t.push=n=>{if(n!==0)for(let r=0;r<3;r++)e.origin[r]+=n*e.normal[r]},t.generalizedProjectPoint=(n,r)=>{N2(n,e.origin,e.normal,r)},t.evaluateFunction=(n,r,i)=>Array.isArray(n)?e.normal[0]*(n[0]-e.origin[0])+e.normal[1]*(n[1]-e.origin[1])+e.normal[2]*(n[2]-e.origin[2]):e.normal[0]*(n-e.origin[0])+e.normal[1]*(r-e.origin[1])+e.normal[2]*(i-e.origin[2]),t.evaluateGradient=n=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(n,r)=>b2(n,r,e.origin,e.normal),t.intersectWithPlane=(n,r)=>F2(n,r,e.origin,e.normal)}const qh={normal:[0,0,1],origin:[0,0,0]};function _2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qh,n),$h.extend(t,e,n),R.setGetArray(t,e,["normal","origin"],3),Kh(t,e)}const Xh=R.newInstance(_2,"vtkPlane");var Ge={newInstance:Xh,extend:_2,...Hh};const xa=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function U2(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function At(t){return(t==null?void 0:t.length)>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function ls(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function us(t){return ls(t,xa)}function Yi(t,e,n,r){const[i,a,s,o,c,l]=t;return t[0]=i<e?i:e,t[1]=a>e?a:e,t[2]=s<n?s:n,t[3]=o>n?o:n,t[4]=c<r?c:r,t[5]=l>r?l:r,t}function fs(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let n=0;n<e.length;++n)Yi(t,...e[n]);else for(let n=0;n<e.length;n+=3)Yi(t,...e.slice(n,n+3));return t}function k2(t,e,n,r,i,a,s){const[o,c,l,u,f,g]=t;return s===void 0?(t[0]=Math.min(e[0],o),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],l),t[3]=Math.max(e[3],u),t[4]=Math.min(e[4],f),t[5]=Math.max(e[5],g)):(t[0]=Math.min(e,o),t[1]=Math.max(n,c),t[2]=Math.min(r,l),t[3]=Math.max(i,u),t[4]=Math.min(a,f),t[5]=Math.max(s,g)),t}function P2(t,e,n,r){const[i,a,s,o,c,l]=t;return t[0]=e,t[1]=e>a?e:a,t[2]=n,t[3]=n>o?n:o,t[4]=r,t[5]=r>l?r:l,i!==e||s!==n||c!==r}function G2(t,e,n,r){const[i,a,s,o,c,l]=t;return t[0]=e<i?e:i,t[1]=e,t[2]=n<s?n:s,t[3]=n,t[4]=r<c?r:c,t[5]=r,a!==e||o!==n||l!==r}function A2(t,e){return t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t}function gs(t,e,n,r){return At(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),n>=0?(t[2]*=n,t[3]*=n):(t[2]=n*t[3],t[3]=n*t[2]),r>=0?(t[4]*=r,t[5]*=r):(t[4]=r*t[5],t[5]=r*t[4]),!0):!1}function hs(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function Yh(t,e,n,r){if(!At(t))return!1;const i=hs(t);return t[0]-=i[0],t[1]-=i[0],t[2]-=i[1],t[3]-=i[1],t[4]-=i[2],t[5]-=i[2],gs(t,e,n,r),t[0]+=i[0],t[1]+=i[0],t[2]+=i[1],t[3]+=i[1],t[4]+=i[2],t[5]+=i[2],!0}function Sr(t,e){return t[e*2+1]-t[e*2]}function wa(t){return[Sr(t,0),Sr(t,1),Sr(t,2)]}function B2(t){return t.slice(0,2)}function W2(t){return t.slice(2,4)}function z2(t){return t.slice(4,6)}function $2(t){const e=wa(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function j2(t){if(At(t)){const e=wa(t);return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}return null}function ps(t){return[t[0],t[2],t[4]]}function ds(t){return[t[1],t[3],t[5]]}function ii(t,e){return t<=0&&e>=0||t>=0&&e<=0}function ms(t,e){let n=0;for(let r=0;r<2;r++)for(let i=2;i<4;i++)for(let a=4;a<6;a++)e[n++]=[t[r],t[i],t[a]];return e}function H2(t,e,n){return e[0]=t[0],e[1]=t[2],e[2]=t[4],n[0]=t[1],n[1]=t[3],n[2]=t[5],e}function K2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const r=ms(t,[]);for(let i=0;i<r.length;++i)pe(r[i],r[i],e);return us(n),fs(n,r)}function q2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function X2(t,e,n,r){const i=[].concat(xa),a=t.getData();for(let s=0;s<a.length;s+=3){const o=[a[s],a[s+1],a[s+2]],c=Y(o,e);i[0]=Math.min(c,i[0]),i[1]=Math.max(c,i[1]);const l=Y(o,n);i[2]=Math.min(l,i[2]),i[3]=Math.max(l,i[3]);const u=Y(o,r);i[4]=Math.min(u,i[4]),i[5]=Math.max(u,i[5])}return i}function Y2(t,e,n,r,i){let a=!0;const s=[];let o=0;const c=[],l=[0,0,0],u=0,f=1,g=2;for(let h=0;h<3;h++)e[h]<t[2*h]?(s[h]=f,l[h]=t[2*h],a=!1):e[h]>t[2*h+1]?(s[h]=u,l[h]=t[2*h+1],a=!1):s[h]=g;if(a)return r[0]=e[0],r[1]=e[1],r[2]=e[2],i[0]=0,1;for(let h=0;h<3;h++)s[h]!==g&&n[h]!==0?c[h]=(l[h]-e[h])/n[h]:c[h]=-1;for(let h=0;h<3;h++)c[o]<c[h]&&(o=h);if(c[o]>1||c[o]<0)return 0;i[0]=c[o];for(let h=0;h<3;h++)if(o!==h){if(r[h]=e[h]+c[o]*n[h],r[h]<t[2*h]||r[h]>t[2*h+1])return 0}else r[h]=l[h];return 1}function Z2(t,e,n){const r=[];let i=0,a=1,s=1;for(let o=4;o<=5;++o){r[2]=t[o];for(let c=2;c<=3;++c){r[1]=t[c];for(let l=0;l<=1;++l)if(r[0]=t[l],i=Ge.evaluate(n,e,r),s&&(a=i>=0?1:-1,s=0),i===0||a>0&&i<0||a<0&&i>0)return 1}}return 0}function J2(t,e){if(!(At(t)&&At(e)))return!1;const n=[0,0,0,0,0,0];let r;for(let i=0;i<3;i++)if(r=!1,e[i*2]>=t[i*2]&&e[i*2]<=t[i*2+1]?(r=!0,n[i*2]=e[i*2]):t[i*2]>=e[i*2]&&t[i*2]<=e[i*2+1]&&(r=!0,n[i*2]=t[i*2]),e[i*2+1]>=t[i*2]&&e[i*2+1]<=t[i*2+1]?(r=!0,n[i*2+1]=e[2*i+1]):t[i*2+1]>=e[i*2]&&t[i*2+1]<=e[i*2+1]&&(r=!0,n[i*2+1]=t[i*2+1]),!r)return!1;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],!0}function Zi(t,e){if(!(At(t)&&At(e)))return!1;for(let n=0;n<3;n++)if(!(e[n*2]>=t[n*2]&&e[n*2]<=t[n*2+1])&&!(t[n*2]>=e[n*2]&&t[n*2]<=e[n*2+1])&&!(e[n*2+1]>=t[n*2]&&e[n*2+1]<=t[n*2+1])&&!(t[n*2+1]>=e[n*2]&&t[n*2+1]<=e[n*2+1]))return!1;return!0}function Ji(t,e,n,r){return!(e<t[0]||e>t[1]||n<t[2]||n>t[3]||r<t[4]||r>t[5])}function Zh(t,e){return!(!Zi(t,e)||!Ji(t,...ps(e))||!Ji(t,...ds(e)))}function Q2(t,e,n){const r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],i=[0,0,0,0,0,0,0,0];let a=0;for(let f=0;f<2;f++)for(let g=2;g<4;g++)for(let h=4;h<6;h++){const p=[t[f],t[g],t[h]];i[a++]=Ge.evaluate(n,e,p)}let s=2;for(;s--&&!(ii(i[r[s][0]],i[r[s][4]])&&ii(i[r[s][1]],i[r[s][5]])&&ii(i[r[s][2]],i[r[s][6]])&&ii(i[r[s][3]],i[r[s][7]])););if(s<0)return!1;const o=Math.sign(n[s]),c=Math.abs((t[s*2+1]-t[s*2])*n[s]);let l=o>0?1:0;for(let f=0;f<4;f++){if(c===0)continue;const g=Math.abs(i[r[s][f]])/c;o>0&&g<l&&(l=g),o<0&&g>l&&(l=g)}const u=(1-l)*t[s*2]+l*t[s*2+1];return o>0?t[s*2]=u:t[s*2+1]=u,!0}class Jh{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(xa))}getBounds(){return this.bounds}equals(e){return U2(this.bounds,e)}isValid(){return At(this.bounds)}setBounds(e){return ls(this.bounds,e)}reset(){return us(this.bounds)}addPoint(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Yi(this.bounds,...n)}addPoints(e){return fs(this.bounds,e)}addBounds(e,n,r,i,a,s){return k2(this.bounds,e,n,r,i,a,s)}setMinPoint(e,n,r){return P2(this.bounds,e,n,r)}setMaxPoint(e,n,r){return G2(this.bounds,e,n,r)}inflate(e){return A2(this.bounds,e)}scale(e,n,r){return gs(this.bounds,e,n,r)}getCenter(){return hs(this.bounds)}getLength(e){return Sr(this.bounds,e)}getLengths(){return wa(this.bounds)}getMaxLength(){return $2(this.bounds)}getDiagonalLength(){return j2(this.bounds)}getMinPoint(){return ps(this.bounds)}getMaxPoint(){return ds(this.bounds)}getXRange(){return B2(this.bounds)}getYRange(){return W2(this.bounds)}getZRange(){return z2(this.bounds)}getCorners(e){return ms(this.bounds,e)}computeCornerPoints(e,n){return H2(this.bounds,e,n)}computeLocalBounds(e,n,r){return X2(this.bounds,e,n,r)}transformBounds(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return K2(this.bounds,e,n)}computeScale3(e){return q2(this.bounds,e)}cutWithPlane(e,n){return Q2(this.bounds,e,n)}intersectBox(e,n,r,i){return Y2(this.bounds,e,n,r,i)}intersectPlane(e,n){return Z2(this.bounds,e,n)}intersect(e){return J2(this.bounds,e)}intersects(e){return Zi(this.bounds,e)}containsPoint(e,n,r){return Ji(this.bounds,e,n,r)}contains(e){return Zi(this.bounds,e)}}function Qh(t){const e=t&&t.bounds;return new Jh(e)}const e9={equals:U2,isValid:At,setBounds:ls,reset:us,addPoint:Yi,addPoints:fs,addBounds:k2,setMinPoint:P2,setMaxPoint:G2,inflate:A2,scale:gs,scaleAboutCenter:Yh,getCenter:hs,getLength:Sr,getLengths:wa,getMaxLength:$2,getDiagonalLength:j2,getMinPoint:ps,getMaxPoint:ds,getXRange:B2,getYRange:W2,getZRange:z2,getCorners:ms,computeCornerPoints:H2,computeLocalBounds:X2,transformBounds:K2,computeScale3:q2,cutWithPlane:Q2,intersectBox:Y2,intersectPlane:Z2,intersect:J2,intersects:Zi,containsPoint:Ji,contains:Zh,INIT_BOUNDS:xa};var De={newInstance:Qh,...e9};function t9(t,e){t.getBounds=()=>(R.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),Jn()),t.getCenter=()=>{var r;const n=t.getBounds();return e.center=De.isValid(n)?De.getCenter(n):null,(r=e.center)==null?void 0:r.slice()},t.getLength=()=>{const n=t.getBounds();return De.getDiagonalLength(n)}}const n9=t=>({bounds:[...De.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function r9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,n9(n)),Ah.extend(t,e,n),R.setGet(t,e,["viewSpecificProperties"]),t9(t,e)}var el={extend:r9};const lt={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var tl={StructuredType:lt};const{StructuredType:It}=tl;function i9(t){let e=0;for(let n=0;n<3;++n)t[n*2]<t[n*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?It.EMPTY:e===3?It.XYZ_GRID:e===2?t[0]===t[1]?It.YZ_PLANE:t[2]===t[3]?It.XZ_PLANE:It.XY_PLANE:e===1?t[0]<t[1]?It.X_LINE:t[2]<t[3]?It.Y_LINE:It.Z_LINE:It.SINGLE_POINT}var a9={getDataDescriptionFromExtent:i9,...tl};const{vtkErrorMacro:on}=R;function s9(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return on("instance deleted - cannot call any method"),!1;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];const a=r.length===1?r[0]:r;if(a.length!==6)return!1;const s=e.extent.some((o,c)=>o!==a[c]);return s&&(e.extent=a.slice(),e.dataDescription=a9.getDataDescriptionFromExtent(e.extent),t.modified()),s},t.setDimensions=function(){let n,r,i;if(e.deleted){on("instance deleted - cannot call any method");return}if(arguments.length===1){const a=arguments.length<=0?void 0:arguments[0];n=a[0],r=a[1],i=a[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],i=arguments.length<=2?void 0:arguments[2];else{on("Bad dimension specification");return}t.setExtent(0,n-1,0,r-1,0,i-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const n=t.getDimensions();let r=1;for(let i=0;i<3;i++){if(n[i]===0)return 0;n[i]>1&&(r*=n[i]-1)}return r},t.getNumberOfPoints=()=>{const n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=n=>{const r=t.getDimensions();if(r[0]===0||r[1]===0||r[2]===0)return on("Requesting a point from an empty image."),null;const i=new Float64Array(3);switch(e.dataDescription){case lt.EMPTY:return null;case lt.SINGLE_POINT:break;case lt.X_LINE:i[0]=n;break;case lt.Y_LINE:i[1]=n;break;case lt.Z_LINE:i[2]=n;break;case lt.XY_PLANE:i[0]=n%r[0],i[1]=n/r[0];break;case lt.YZ_PLANE:i[1]=n%r[1],i[2]=n/r[1];break;case lt.XZ_PLANE:i[0]=n%r[0],i[2]=n/r[0];break;case lt.XYZ_GRID:i[0]=n%r[0],i[1]=n/r[0]%r[1],i[2]=n/(r[0]*r[1]);break;default:on("Invalid dataDescription");break}const a=[0,0,0];return t.indexToWorld(i,a),a},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=n=>De.transformBounds(n,e.indexToWorld),t.getSpatialExtent=()=>De.inflate([...e.extent],.5),t.computeTransforms=()=>{Ta(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],Gt(e.indexToWorld,e.indexToWorld,e.spacing),ke(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return pe(r,n,e.indexToWorld),r},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return pe(r,n,e.worldToIndex),r},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return De.transformBounds(n,e.indexToWorld,r)},t.worldToIndexBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return De.transformBounds(n,e.worldToIndex,r)},t.onModified(t.computeTransforms),t.computeTransforms(),t.getCenter=()=>De.getCenter(t.getBounds()),t.computeHistogram=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const i=[0,0,0,0,0,0];t.worldToIndexBounds(n,i);const a=[0,0,0],s=[0,0,0];De.computeCornerPoints(i,a,s),c0(a,a),c0(s,s);const o=t.getDimensions();u0(a,[0,0,0],[o[0]-1,o[1]-1,o[2]-1],a),u0(s,[0,0,0],[o[0]-1,o[1]-1,o[2]-1],s);const c=o[0],l=o[0]*o[1],u=t.getPointData().getScalars().getData();let f=-1/0,g=1/0,h=0,p=0,d=0;for(let v=a[2];v<=s[2];v++)for(let C=a[1];C<=s[1];C++){let x=a[0]+C*c+v*l;for(let w=a[0];w<=s[0];w++){if(!r||r([w,C,v],i)){const E=u[x];E>f&&(f=E),E<g&&(g=E),h+=E*E,p+=E,d+=1}++x}}const m=d>0?p/d:0,y=d?Math.abs(h/d-m*m):0,T=Math.sqrt(y);return{minimum:g,maximum:f,average:m,variance:y,sigma:T,count:d}},t.computeIncrements=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=[];let a=r;for(let s=0;s<3;++s)i[s]=a,a*=n[s*2+1]-n[s*2]+1;return i},t.computeOffsetIndex=n=>{let[r,i,a]=n;const s=t.getExtent(),o=t.getPointData().getScalars().getNumberOfComponents(),c=t.computeIncrements(s,o);return Math.floor((Math.round(r)-s[0])*c[0]+(Math.round(i)-s[2])*c[1]+(Math.round(a)-s[4])*c[2])},t.getOffsetIndexFromWorld=n=>{const r=t.getExtent(),i=t.worldToIndex(n);for(let a=0;a<3;++a)if(i[a]<r[a*2]||i[a]>r[a*2+1])return on(`GetScalarPointer: Pixel ${i} is not in memory. Current extent = ${r}`),NaN;return t.computeOffsetIndex(i)},t.getScalarValueFromWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const i=t.getPointData().getScalars().getNumberOfComponents();if(r<0||r>=i)return on(`GetScalarPointer: Scalar Component ${r} is not within bounds. Current Scalar numberOfComponents: ${i}`),NaN;const a=t.getOffsetIndexFromWorld(n);return Number.isNaN(a)?a:t.getPointData().getScalars().getComponent(a,r)}}const o9={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:lt.EMPTY};function nl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,o9,n),E2.extend(t,e,n),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=va(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),R.get(t,e,["indexToWorld","worldToIndex"]),R.setGetArray(t,e,["origin","spacing"],3),R.setGetArray(t,e,["direction"],9),R.getArray(t,e,["extent"],6),s9(t,e)}const c9=R.newInstance(nl,"vtkImageData");var rl={newInstance:c9,extend:nl};const l9={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},u9={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4};var il={VectorMode:l9,ScalarMappingTarget:u9};const f9={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},g9={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},h9={BY_ID:0,BY_NAME:1};var p9={ColorMode:f9,GetArray:h9,ScalarMode:g9};const{ScalarMappingTarget:Do,VectorMode:Tt}=il,{VtkDataTypes:zt}=oe,{ColorMode:ai}=p9,{vtkErrorMacro:Vo}=R;function d9(t){return t}function Io(t){return Math.floor(t*255+.5)}function m9(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(Tt.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(Tt.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(Tt.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(n,r)=>{if(!(n&&!r||!n&&r)){if(n&&r&&n.length!==r.length){Vo("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],r&&n){const i=r.length;for(let a=0;a<i;a++)e.annotationArray.push({value:n[a],annotation:String(r[a])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(n,r)=>{let i=t.checkForAnnotatedValue(n),a=!1;return i>=0?e.annotationArray[i].annotation!==r&&(e.annotationArray[i].annotation=r,a=!0):(e.annotationArray.push({value:n,annotation:r}),i=e.annotationArray.length-1,a=!0),a&&(t.updateAnnotatedValueMap(),t.modified()),i},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=n=>n<0||n>=e.annotationArray.length?null:e.annotationArray[n].value,t.getAnnotation=n=>e.annotationArray[n]===void 0?null:e.annotationArray[n].annotation,t.getAnnotatedValueIndex=n=>e.annotationArray.length?t.checkForAnnotatedValue(n):-1,t.removeAnnotation=n=>{const r=t.checkForAnnotatedValue(n),i=r>=0;return i&&(e.annotationArray.splice(r,1),t.updateAnnotatedValueMap(),t.modified()),i},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(n,r)=>{if(e.indexedLookup){const i=t.getAnnotatedValueIndex(n);t.getIndexedColor(i,r)}else t.getColor(parseFloat(n),r),r[3]=1},t.checkForAnnotatedValue=n=>t.getAnnotatedValueIndexInternal(n),t.getAnnotatedValueIndexInternal=n=>{if(e.annotatedValueMap[n]!==void 0){const r=e.annotationArray.length;return e.annotatedValueMap[n]%r}return-1},t.getIndexedColor=(n,r)=>{r[0]=0,r[1]=0,r[2]=0,r[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const n=e.annotationArray.length;for(let r=0;r<n;r++)e.annotatedValueMap[e.annotationArray[r].value]=r},t.mapScalars=(n,r,i)=>{const a=n.getNumberOfComponents();let s=null;if(r===ai.DEFAULT&&(n.getDataType()===zt.UNSIGNED_CHAR||n.getDataType()===zt.UNSIGNED_CHAR_CLAMPED)||r===ai.DIRECT_SCALARS&&n)s=t.convertToRGBA(n,a,n.getNumberOfTuples());else{const o={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:zt.UNSIGNED_CHAR},c=R.newTypedArray(o.dataType,4*n.getNumberOfTuples());o.values=c,o.size=c.length,s=oe.newInstance(o);let l=i;l<0&&a>1?t.mapVectorsThroughTable(n,s,Do.RGBA,-1,-1):(l<0&&(l=0),l>=a&&(l=a-1),t.mapScalarsThroughTable(n,s,Do.RGBA,l))}return s},t.mapVectorsToMagnitude=(n,r,i)=>{const a=n.getNumberOfTuples(),s=n.getNumberOfComponents(),o=r.getData(),c=n.getData();for(let l=0;l<a;l++){let u=0;for(let f=0;f<i;f++)u+=c[l*s+f]*c[l*s+f];o[l]=Math.sqrt(u)}},t.mapVectorsThroughTable=(n,r,i,a,s)=>{let o=t.getVectorMode(),c=s,l=a;const u=n.getNumberOfComponents();o===Tt.COMPONENT?(l===-1&&(l=t.getVectorComponent()),l<0&&(l=0),l>=u&&(l=u-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(l=0,c=u):(l<0&&(l=0),l>=u&&(l=u-1),l+c>u&&(c=u-l)),o===Tt.MAGNITUDE&&(u===1||c===1)&&(o=Tt.COMPONENT));let f=0;switch(l>0&&(f=l),o){case Tt.COMPONENT:{t.mapScalarsThroughTable(n,r,i,f);break}case Tt.RGBCOLORS:break;case Tt.MAGNITUDE:default:{const g=oe.newInstance({numberOfComponents:1,values:new Float32Array(n.getNumberOfTuples())});t.mapVectorsToMagnitude(n,g,c),t.mapScalarsThroughTable(g,r,i,0);break}}},t.luminanceToRGBA=(n,r,i,a)=>{const s=a(i),o=r.getData(),c=n.getData(),l=o.length,u=0,f=1;let g=0;for(let h=u;h<l;h+=f){const p=a(o[h]);c[g*4]=p,c[g*4+1]=p,c[g*4+2]=p,c[g*4+3]=s,g++}},t.luminanceAlphaToRGBA=(n,r,i,a)=>{const s=r.getData(),o=n.getData(),c=s.length,l=0,u=2;let f=0;for(let g=l;g<c;g+=u){const h=a(s[g]);o[f]=h,o[f+1]=h,o[f+2]=h,o[f+3]=a(s[g+1])*i,f+=4}},t.rGBToRGBA=(n,r,i,a)=>{const s=Io(i),o=r.getData(),c=n.getData(),l=o.length,u=0,f=3;let g=0;for(let h=u;h<l;h+=f)c[g*4]=a(o[h]),c[g*4+1]=a(o[h+1]),c[g*4+2]=a(o[h+2]),c[g*4+3]=s,g++},t.rGBAToRGBA=(n,r,i,a)=>{const s=r.getData(),o=n.getData(),c=s.length,l=0,u=4;let f=0;for(let g=l;g<c;g+=u)o[f*4]=a(s[g]),o[f*4+1]=a(s[g+1]),o[f*4+2]=a(s[g+2]),o[f*4+3]=a(s[g+3])*i,f++},t.convertToRGBA=(n,r,i)=>{let{alpha:a}=e;if(r===4&&a>=1&&n.getDataType()===zt.UNSIGNED_CHAR)return n;const s=oe.newInstance({numberOfComponents:4,empty:!0,size:4*i,dataType:zt.UNSIGNED_CHAR});if(i<=0)return s;a=a>0?a:0,a=a<1?a:1;let o=d9;switch((n.getDataType()===zt.FLOAT||n.getDataType()===zt.DOUBLE)&&(o=Io),r){case 1:t.luminanceToRGBA(s,n,a,o);break;case 2:t.luminanceAlphaToRGBA(s,n,o);break;case 3:t.rGBToRGBA(s,n,a,o);break;case 4:t.rGBAToRGBA(s,n,a,o);break;default:return Vo("Cannot convert colors"),null}return s},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(n,r)=>t.setMappingRange(n,r),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(n,r,i)=>{if(!n)return t.isOpaque();const a=n.getNumberOfComponents();return r===ai.DEFAULT&&n.getDataType()===zt.UNSIGNED_CHAR||r===ai.DIRECT_SCALARS?a===3||a===1?e.alpha>=1:n.getRange(a-1)[0]===255:!0}}const y9={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:Tt.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1};function al(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,y9,n),R.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],R.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),R.setArray(t,e,["mappingRange"],2),R.getArray(t,e,["mappingRange"]),m9(t,e)}const v9=R.newInstance(al,"vtkScalarsToColors");var sl={newInstance:v9,extend:al,...il};const Vt={Off:0,PolygonOffset:1};let m0=Vt.PolygonOffset,Qi=Vt.Off;const T9=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function C9(){return m0}function x9(t){const e=m0===t;return m0=t,e}function w9(){return Qi}function Sa(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=Qi===t;return Qi=t,e}function S9(){return Sa(Vt.Off)}function R9(){return Sa(Vt.Off)}function E9(){return Sa(Vt.PolygonOffset)}function M9(){return T9[Qi]}var y0={Resolve:Vt,getResolveCoincidentTopologyAsString:M9,getResolveCoincidentTopologyPolygonOffsetFaces:C9,getResolveCoincidentTopology:w9,setResolveCoincidentTopology:Sa,setResolveCoincidentTopologyPolygonOffsetFaces:x9,setResolveCoincidentTopologyToDefault:S9,setResolveCoincidentTopologyToOff:R9,setResolveCoincidentTopologyToPolygonOffset:E9};function ol(t,e,n){n.forEach(r=>{t[`get${r.method}`]=()=>e[r.key],t[`set${r.method}`]=R.objectSetterMap.object(t,e,{name:r.key,params:["factor","offset"]})})}const ys=["Polygon","Line","Point"],O9={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},D9=()=>{},pn={modified:D9};ol(pn,O9,ys.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function V9(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),R.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(y0).forEach(n=>{t[n]=y0[n]}),Object.keys(pn).filter(n=>n!=="modified").forEach(n=>{t[n]=pn[n]}),ol(t,e.topologyOffset,ys.map(n=>({key:n,method:`RelativeCoincidentTopology${n}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const n=pn.getResolveCoincidentTopologyPolygonOffsetParameters(),r=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const n=pn.getResolveCoincidentTopologyLineOffsetParameters(),r=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const n=pn.getResolveCoincidentTopologyPointOffsetParameters(),r=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}}}var cl={implementCoincidentTopologyMethods:V9,staticOffsetAPI:pn,otherStaticMethods:y0,CATEGORIES:ys,Resolve:Vt};const I9={DISPLAY:0,WORLD:1};var ll={CoordinateSystem:I9};const{CoordinateSystem:v0}=ll;function Lo(t){return()=>R.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function L9(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let n=e.mtime;for(let r=0;r<e.textures.length;++r){const i=e.textures[r].getMTime();i>n&&(n=i)}return n},t.processSelectorPixelBuffers=(n,r)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=Lo("pick"),t.hasKey=Lo("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=n=>{e.estimatedRenderTime=n,e.savedEstimatedRenderTime=n},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=n=>{e.estimatedRenderTime+=n},t.setAllocatedRenderTime=n=>{e.allocatedRenderTime=n,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=n=>e.textures.indexOf(n)!==-1,t.addTexture=n=>{n&&!t.hasTexture(n)&&(e.textures=e.textures.concat(n),t.modified())},t.removeTexture=n=>{const r=e.textures.filter(i=>i!==n);e.textures.length!==r.length&&(e.textures=r,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(v0.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(v0.DISPLAY)}const N9={allocatedRenderTime:10,coordinateSystem:v0.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function ul(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,N9,n),R.obj(t,e),R.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),R.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),R.moveToProtected(t,e,["parentProp"]),L9(t,e)}const b9=R.newInstance(ul,"vtkProp");var F9={newInstance:b9,extend:ul,...ll},fl=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,gl=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function _9(t,e){t.replaceShaderCoincidentOffset=(n,r,i)=>{const a=t.getCoincidentParameters(r,i);if(a&&(a.factor!==0||a.offset!==0)){let s=n.Fragment;s=B.substitute(s,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(a.factor!==0?(s=B.substitute(s,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,s=B.substitute(s,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):s=B.substitute(s,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(a.factor!==0?(s=B.substitute(s,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,s=B.substitute(s,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):s=B.substitute(s,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=s}}}function U9(t,e){t.applyShaderReplacements=(n,r,i)=>{let a=null;if(r&&(a=r.ShaderReplacements),a)for(let s=0;s<a.length;s++){const o=a[s];if(i&&o.replaceFirst||!i&&!o.replaceFirst){const c=o.shaderType,l=n[c],u=B.substitute(l,o.originalValue,o.replacementValue,o.replaceAll);n[c]=u.result}}},t.buildShaders=(n,r,i)=>{t.getReplacedShaderTemplate(n,r,i),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(n);const a=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(n,a,!0),t.replaceShaderValues(n,r,i),t.applyShaderReplacements(n,a)},t.getReplacedShaderTemplate=(n,r,i)=>{const a=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(n,r,i);let s=n.Vertex;if(a){const l=a.VertexShaderCode;l!==void 0&&l!==""&&(s=l)}n.Vertex=s;let o=n.Fragment;if(a){const l=a.FragmentShaderCode;l!==void 0&&l!==""&&(o=l)}n.Fragment=o;let c=n.Geometry;if(a){const l=a.GeometryShaderCode;l!==void 0&&(c=l)}n.Geometry=c}}var Qn={implementReplaceShaderCoincidentOffset:_9,implementBuildShadersWithReplacements:U9};const k9={NONE:-1,I:0,J:1,K:2,X:3,Y:4,Z:5};var Ra={SlicingMode:k9};const xn={NEAREST:0,LINEAR:1};var P9={InterpolationType:xn};function an(t,e,n){return t?`${t.getMTime()}-${e}-${n}`:"0"}function vs(t,e){return`${t.getMTime()}A${e.getMTime()}`}const{vtkErrorMacro:bn}=Ot,{SlicingMode:Ye}=Ra;function G9(t){const e=t.split(`
`),n=[];for(let r=0;r<e.length;++r){const i=e[r].trim();i.length>0&&n.push(i)}return n}function A9(t,e){e.classHierarchy.push("vtkOpenGLImageMapper");function n(r){e.openGLTexture.releaseGraphicsResources(r),[e._colorTransferFunc,e._pwFunc,e._labelOutlineThicknessArray].forEach(i=>r.unregisterGraphicsResourceUser(i,t))}t.buildPass=r=>{if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&n(i),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow);const a=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(a.getActiveCamera()),e.renderable.isA("vtkImageMapper")&&e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(a.getActiveCamera())}},t.translucentPass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.getCoincidentParameters=(r,i)=>e.renderable.getResolveCoincidentTopology()==Vt.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,r)},t.getShaderTemplate=(r,i,a)=>{r.Vertex=fl,r.Fragment=gl,r.Geometry=""},t.replaceShaderValues=(r,i,a)=>{let s=r.Vertex,o=r.Fragment;s=B.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,s=B.substitute(s,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result,s=B.substitute(s,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result,s=B.substitute(s,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result;const c=e.openGLTexture.getComponents(),l=a.getProperty().getIndependentComponents();let u=["varying vec2 tcoordVCVSOutput;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D texture1;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform sampler2D labelOutlineTexture1;","uniform float opacity;","uniform float outlineOpacity;"];if(l){for(let g=1;g<c;g++)u=u.concat([`uniform float cshift${g};`,`uniform float cscale${g};`,`uniform float pwfshift${g};`,`uniform float pwfscale${g};`]);switch(c){case 1:u=u.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:u=u.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:u=u.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:u=u.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:bn("Unsupported number of independent coordinates.")}}if(o=B.substitute(o,"//VTK::TCoord::Dec",u).result,a.getProperty().getUseLabelOutline()===!0&&(o=B.substitute(o,"//VTK::LabelOutline::Dec",["uniform int outlineThickness;","uniform float vpWidth;","uniform float vpHeight;","uniform float vpOffsetX;","uniform float vpOffsetY;","uniform mat4 PCWCMatrix;","uniform mat4 vWCtoIDX;","uniform ivec3 imageDimensions;","uniform int sliceAxis;"]).result,o=B.substitute(o,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result,o=B.substitute(o,"//VTK::LabelOutlineHelperFunction",["#ifdef vtkImageLabelOutlineOn","vec3 fragCoordToIndexSpace(vec4 fragCoord) {","  vec4 pcPos = vec4(","    (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,","    (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,","    (fragCoord.z - 0.5) * 2.0,","    1.0);","","  vec4 worldCoord = PCWCMatrix * pcPos;","  vec4 vertex = (worldCoord/worldCoord.w);","","  vec3 index = (vWCtoIDX * vertex).xyz;","","  // half voxel fix for labelmapOutline","  return (index + vec3(0.5)) / vec3(imageDimensions);","}","vec2 getSliceCoords(vec3 coord, int axis) {","  if (axis == 0) return coord.yz;","  if (axis == 1) return coord.xz;","  if (axis == 2) return coord.xy;","}","#endif"]).result),l){const g=["r","g","b","a"];let h=["vec4 tvalue = texture2D(texture1, tcoordVCVSOutput);"];for(let p=0;p<c;p++)h=h.concat([`vec3 tcolor${p} = mix${p} * texture2D(colorTexture1, vec2(tvalue.${g[p]} * cscale${p} + cshift${p}, height${p})).rgb;`,`float compWeight${p} = mix${p} * texture2D(pwfTexture1, vec2(tvalue.${g[p]} * pwfscale${p} + pwfshift${p}, height${p})).r;`]);switch(c){case 1:h=h.concat(["gl_FragData[0] = vec4(tcolor0.rgb, opacity);"]);break;case 2:h=h.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:h=h.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:h=h.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:bn("Unsupported number of independent coordinates.")}o=B.substitute(o,"//VTK::TCoord::Impl",h).result}else switch(c){case 1:o=B.substitute(o,"//VTK::TCoord::Impl",[...G9(`
                #ifdef vtkImageLabelOutlineOn
                  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord);
                  float centerValue = texture2D(texture1, getSliceCoords(centerPosIS, sliceAxis)).r;
                  bool pixelOnBorder = false;
                  vec3 tColor = texture2D(colorTexture1, vec2(centerValue * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(centerValue * pwfscale0 + pwfshift0, 0.5)).r;
                  float opacityToUse = scalarOpacity * opacity;
                  int segmentIndex = int(centerValue * 255.0);
                  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
                  float textureValue = texture2D(labelOutlineTexture1, vec2(textureCoordinate, 0.5)).r;
                  int actualThickness = int(textureValue * 255.0);

                  if (segmentIndex == 0){
                    gl_FragData[0] = vec4(0.0, 0.0, 0.0, 0.0);
                    return;
                  }

                  for (int i = -actualThickness; i <= actualThickness; i++) {
                    for (int j = -actualThickness; j <= actualThickness; j++) {
                      if (i == 0 || j == 0) {
                        continue;
                      }
                      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
                        gl_FragCoord.y + float(j),
                        gl_FragCoord.z, gl_FragCoord.w);
                      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
                      float value = texture2D(texture1, getSliceCoords(neighborPosIS, sliceAxis)).r;
                      if (value != centerValue) {
                        pixelOnBorder = true;
                        break;
                      }
                    }
                    if (pixelOnBorder == true) {
                      break;
                    }
                  }
                  if (pixelOnBorder == true) {
                    gl_FragData[0] = vec4(tColor, outlineOpacity);
                  }
                  else {
                    gl_FragData[0] = vec4(tColor, opacityToUse);
                  }
                #else
                  float intensity = texture2D(texture1, tcoordVCVSOutput).r;
                  vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;
                  float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;
                  gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);
                #endif
                `)]).result;break;case 2:o=B.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","float intensity = tcolor.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tcolor.g + pwfshift0);"]).result;break;case 3:o=B.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]).result;break;default:o=B.substitute(o,"//VTK::TCoord::Impl",["vec4 tcolor = cscale0*texture2D(texture1, tcoordVCVSOutput.st) + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"]).result}e.haveSeenDepthRequest&&(o=B.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=B.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=s,r.Fragment=o,t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a)},t.replaceShaderClip=(r,i,a)=>{let s=r.Vertex,o=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(J("OpenGL has a limit of 6 clipping planes"),c=6),s=B.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,s=B.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=B.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,o=B.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=s,r.Fragment=o},t.getNeedToRebuildShaders=(r,i,a)=>{var l;const s=e.openGLTexture.getComponents(),o=a.getProperty().getIndependentComponents();let c=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(c=!0),c||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||((l=r.getProgram())==null?void 0:l.getHandle())===0||e.lastTextureComponents!==s||e.lastIndependentComponents!==o?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=s,e.lastIndependentComponents=o,!0):!1},t.updateShaders=(r,i,a)=>{if(e.lastBoundBO=r,t.getNeedToRebuildShaders(r,i,a)){const s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,i,a);const o=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);o!==r.getProgram()&&(r.setProgram(o),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,i,a),t.setCameraShaderParameters(r,i,a),t.setPropertyShaderParameters(r,i,a)},t.setMapperShaderParameters=(r,i,a)=>{r.getCABO().getElementCount()&&(e.VBOBuildTime>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||bn("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),e.context.FALSE)||bn("Error setting tcoordMC in shader VAO.")),r.getAttributeUpdateTime().modified());const s=e.openGLTexture.getTextureUnit();r.getProgram().setUniformi("texture1",s);const o=e.openGLTexture.getComponents(),c=a.getProperty().getIndependentComponents();if(c)for(let p=0;p<o;p++)r.getProgram().setUniformf(`mix${p}`,a.getProperty().getComponentWeight(p));const l=e.openGLTexture.getShiftAndScale();for(let p=0;p<o;p++){let d=a.getProperty().getColorWindow(),m=a.getProperty().getColorLevel();const y=c?p:0,T=a.getProperty().getRGBTransferFunction(y);if(T&&a.getProperty().getUseLookupTableScalarRange()){const x=T.getRange();d=x[1]-x[0],m=.5*(x[1]+x[0])}const v=l.scale/d,C=(l.shift-m)/d+.5;r.getProgram().setUniformf(`cshift${p}`,C),r.getProgram().setUniformf(`cscale${p}`,v)}for(let p=0;p<o;p++){let d=1,m=0;const y=c?p:0,T=a.getProperty().getPiecewiseFunction(y);if(T){const v=T.getRange(),C=v[1]-v[0],x=.5*(v[0]+v[1]);d=l.scale/C,m=(l.shift-x)/C+.5}r.getProgram().setUniformf(`pwfshift${p}`,m),r.getProgram().setUniformf(`pwfscale${p}`,d)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const p=t.getCoincidentParameters(i,a);r.getProgram().setUniformf("coffset",p.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",p.factor)}const u=e.colorTexture.getTextureUnit();r.getProgram().setUniformi("colorTexture1",u);const f=e.pwfTexture.getTextureUnit();r.getProgram().setUniformi("pwfTexture1",f);const g=e.labelOutlineThicknessTexture.getTextureUnit();if(r.getProgram().setUniformi("labelOutlineTexture1",g),e.renderable.getNumberOfClippingPlanes()){let p=e.renderable.getNumberOfClippingPlanes();p>6&&(J("OpenGL has a limit of 6 clipping planes"),p=6);const m=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,y=m?Oe(e.imagematinv,a.getMatrix()):a.getMatrix();m&&(ue(y,y),se(y,y,m),ue(y,y)),ue(e.imagemat,e.currentInput.getIndexToWorld()),se(e.imagematinv,y,e.imagemat);const T=[];for(let v=0;v<p;v++){const C=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,v,C);for(let x=0;x<4;x++)T.push(C[x])}r.getProgram().setUniformi("numClipPlanes",p),r.getProgram().setUniform4fv("clipPlanes",T)}if(a.getProperty().getUseLabelOutline()===!0){const p=a.getProperty().getLabelOutlineOpacity();r.getProgram().setUniformf("outlineOpacity",p)}},t.setCameraShaderParameters=(r,i,a)=>{const s=r.getProgram(),o=e.openGLImageSlice.getKeyMatrices(),c=e.currentInput,l=c.getIndexToWorld();se(e.imagemat,o.mcwc,l);const u=e.openGLCamera.getKeyMatrices(i);if(se(e.imagemat,u.wcpc,e.imagemat),r.getCABO().getCoordShiftAndScaleEnabled()){const g=r.getCABO().getInverseShiftAndScaleMatrix();se(e.imagemat,e.imagemat,g)}if(s.setUniformMatrix("MCPCMatrix",e.imagemat),a.getProperty().getUseLabelOutline()===!0){const g=c.getWorldToIndex(),h=c.getDimensions();let p=e.renderable.getClosestIJKAxis().ijkMode;p===Ye.NONE&&(p=Ye.K),s.setUniform3i("imageDimensions",h[0],h[1],h[2]),s.setUniformi("sliceAxis",p),s.setUniformMatrix("vWCtoIDX",g);const d=e.openGLCamera.getKeyMatrices(i);ke(e.projectionToWorld,d.wcpc),e.openGLCamera.getKeyMatrices(i),s.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const m=t.getRenderTargetSize();s.setUniformf("vpWidth",m[0]),s.setUniformf("vpHeight",m[1]);const y=t.getRenderTargetOffset();s.setUniformf("vpOffsetX",y[0]/m[0]),s.setUniformf("vpOffsetY",y[1]/m[1])}},t.setPropertyShaderParameters=(r,i,a)=>{const s=r.getProgram(),c=a.getProperty().getOpacity();s.setUniformf("opacity",c)},t.renderPieceStart=(r,i)=>{t.updateBufferObjects(r,i),e.lastBoundBO=null},t.renderPieceDraw=(r,i)=>{const a=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,i),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,i)=>{},t.renderPiece=(r,i)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getCurrentImage(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){bn("No input!");return}t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i)},t.computeBounds=(r,i)=>{if(!t.getInput()){ya(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i)},t.getNeedToRebuildBufferObjects=(r,i)=>{var a,s,o,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<i.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<i.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!((a=e.openGLTexture)!=null&&a.getHandle())||!((s=e.colorTexture)!=null&&s.getHandle())||!((o=e.labelOutlineThicknessTexture)!=null&&o.getHandle())||!((c=e.pwfTexture)!=null&&c.getHandle())},t.buildBufferObjects=(r,i)=>{var V,L,F,k;const a=e.currentInput;if(!a)return;const s=a.getPointData()&&a.getPointData().getScalars();if(!s)return;const o=s.getDataType(),c=s.getNumberOfComponents(),l=i.getProperty(),u=l.getInterpolationType(),f=l.getIndependentComponents(),g=f?c:1,h=f?2*g:1,p=l.getRGBTransferFunction(),d=an(p,f,g),m=e._openGLRenderWindow.getGraphicsResourceForObject(p);if(!((V=m==null?void 0:m.oglObject)!=null&&V.getHandle())||(m==null?void 0:m.hash)!==d){e.colorTexture=Ue.newInstance({resizable:!0}),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const b=1024,W=b*h*3,_=new Uint8ClampedArray(W);if(u===xn.NEAREST?(e.colorTexture.setMinificationFilter(K.NEAREST),e.colorTexture.setMagnificationFilter(K.NEAREST)):(e.colorTexture.setMinificationFilter(K.LINEAR),e.colorTexture.setMagnificationFilter(K.LINEAR)),p){const N=new Float32Array(b*3);for(let I=0;I<g;I++){const U=l.getRGBTransferFunction(I),G=U.getRange();if(U.getTable(G[0],G[1],b,N,1),f)for(let P=0;P<b*3;P++)_[I*b*6+P]=255*N[P],_[I*b*6+P+b*3]=255*N[P];else for(let P=0;P<b*3;P++)_[I*b*6+P]=255*N[P]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(b,h,3,me.UNSIGNED_CHAR,_)}else{for(let N=0;N<b*3;++N)_[N]=255*N/((b-1)*3),_[N+1]=255*N/((b-1)*3),_[N+2]=255*N/((b-1)*3);e.colorTexture.create2DFromRaw(b,1,3,me.UNSIGNED_CHAR,_)}p&&(e._openGLRenderWindow.setGraphicsResourceForObject(p,e.colorTexture,d),p!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(p,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=p)}else e.colorTexture=m.oglObject;const T=l.getPiecewiseFunction(),v=an(T,f,g),C=e._openGLRenderWindow.getGraphicsResourceForObject(T);if(!((L=C==null?void 0:C.oglObject)!=null&&L.getHandle())||(C==null?void 0:C.hash)!==v){const W=1024*h,_=new Uint8ClampedArray(W);if(e.pwfTexture=Ue.newInstance({resizable:!0}),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),u===xn.NEAREST?(e.pwfTexture.setMinificationFilter(K.NEAREST),e.pwfTexture.setMagnificationFilter(K.NEAREST)):(e.pwfTexture.setMinificationFilter(K.LINEAR),e.pwfTexture.setMagnificationFilter(K.LINEAR)),T){const N=new Float32Array(W),I=new Float32Array(1024);for(let U=0;U<g;++U){const G=l.getPiecewiseFunction(U);if(G===null)N.fill(1);else{const P=G.getRange();if(G.getTable(P[0],P[1],1024,I,1),f)for(let ee=0;ee<1024;ee++)N[U*1024*2+ee]=I[ee],N[U*1024*2+ee+1024]=I[ee];else for(let ee=0;ee<1024;ee++)N[U*1024*2+ee]=I[ee]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,h,1,me.FLOAT,N)}else _.fill(255),e.pwfTexture.create2DFromRaw(1024,1,1,me.UNSIGNED_CHAR,_);T&&(e._openGLRenderWindow.setGraphicsResourceForObject(T,e.pwfTexture,v),T!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(T,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=T)}else e.pwfTexture=C.oglObject;t.updatelabelOutlineThicknessTexture(i);const{ijkMode:w}=e.renderable.getClosestIJKAxis();let E=e.renderable.getSlice();w!==e.renderable.getSlicingMode()&&(E=e.renderable.getSliceAtPosition(E));const O=e.renderable.isA("vtkImageArrayMapper")?e.renderable.getSubSlice():Math.round(E),D=a.getExtent();let S;w===Ye.I&&(S=O-D[0]),w===Ye.J&&(S=O-D[2]),(w===Ye.K||w===Ye.NONE)&&(S=O-D[4]);const M=`${E}A${a.getMTime()}A${s.getMTime()}B${t.getMTime()}C${e.renderable.getSlicingMode()}D${i.getProperty().getInterpolationType()}`;if(e.VBOBuildString!==M){const b=a.getDimensions();e.openGLTexture||(e.openGLTexture=Ue.newInstance({resizable:!0})),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),u===xn.NEAREST?(new Set([1,3,4]).has(c)&&o===me.UNSIGNED_CHAR&&!f&&e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(K.NEAREST),e.openGLTexture.setMagnificationFilter(K.NEAREST)):(c===4&&o===me.UNSIGNED_CHAR&&!f?(e.openGLTexture.setGenerateMipmap(!0),e.openGLTexture.setMinificationFilter(K.LINEAR_MIPMAP_LINEAR)):e.openGLTexture.setMinificationFilter(K.LINEAR),e.openGLTexture.setMagnificationFilter(K.LINEAR)),e.openGLTexture.setWrapS(_r.CLAMP_TO_EDGE),e.openGLTexture.setWrapT(_r.CLAMP_TO_EDGE);const W=b[0]*b[1]*c,_=new Float32Array(12),N=new Float32Array(8);for(let He=0;He<4;He++)N[He*2]=He%2?1:0,N[He*2+1]=He>1?1:0;const I=[Ye.X,Ye.Y,Ye.Z].includes(e.renderable.getSlicingMode())?E:O,U=a.getSpatialExtent(),G=s.getData();let P=null;if(w===Ye.I){P=new G.constructor(b[2]*b[1]*c);let He=0;for(let et=0;et<b[2];et++)for(let le=0;le<b[1];le++){let ie=(S+le*b[0]+et*b[0]*b[1])*c;He=(et*b[1]+le)*c;const tt=ie+c;for(;ie<tt;)P[He++]=G[ie++]}b[0]=b[1],b[1]=b[2],_[0]=I,_[1]=U[2],_[2]=U[4],_[3]=I,_[4]=U[3],_[5]=U[4],_[6]=I,_[7]=U[2],_[8]=U[5],_[9]=I,_[10]=U[3],_[11]=U[5]}else if(w===Ye.J){P=new G.constructor(b[2]*b[0]*c);let He=0;for(let et=0;et<b[2];et++)for(let le=0;le<b[0];le++){let ie=(le+S*b[0]+et*b[0]*b[1])*c;He=(et*b[0]+le)*c;const tt=ie+c;for(;ie<tt;)P[He++]=G[ie++]}b[1]=b[2],_[0]=U[0],_[1]=I,_[2]=U[4],_[3]=U[1],_[4]=I,_[5]=U[4],_[6]=U[0],_[7]=I,_[8]=U[5],_[9]=U[1],_[10]=I,_[11]=U[5]}else w===Ye.K||w===Ye.NONE?(P=G.subarray(S*W,(S+1)*W),_[0]=U[0],_[1]=U[2],_[2]=I,_[3]=U[1],_[4]=U[2],_[5]=I,_[6]=U[0],_[7]=U[3],_[8]=I,_[9]=U[1],_[10]=U[3],_[11]=I):bn("Reformat slicing not yet supported.");e.openGLTexture.resetFormatAndType(),e.openGLTexture.create2DFilterableFromRaw(b[0],b[1],c,s.getDataType(),P,(k=(F=e.renderable).getPreferSizeOverAccuracy)==null?void 0:k.call(F)),e.openGLTexture.activate(),e.openGLTexture.sendParameters(),e.openGLTexture.deactivate();const ee=oe.newInstance({numberOfComponents:3,values:_});ee.setName("points");const Bt=oe.newInstance({numberOfComponents:2,values:N});Bt.setName("tcoords");const We=new Uint16Array(8);We[0]=3,We[1]=0,We[2]=1,We[3]=3,We[4]=3,We[5]=0,We[6]=3,We[7]=2;const mt=oe.newInstance({numberOfComponents:1,values:We});e.tris.getCABO().createVBO(mt,"polys",St.SURFACE,{points:ee,tcoords:Bt,cellOffset:0}),e.VBOBuildTime.modified(),e.VBOBuildString=M}},t.updatelabelOutlineThicknessTexture=r=>{var c;const i=r.getProperty().getLabelOutlineThicknessByReference(),a=e._openGLRenderWindow.getGraphicsResourceForObject(i),s=`${i.join("-")}`;if(!((c=a==null?void 0:a.oglObject)!=null&&c.getHandle())||(a==null?void 0:a.hash)!==s){const g=new Uint8Array(1024);for(let h=0;h<1024;++h){const p=typeof i[h]<"u"?i[h]:i[0];g[h]=p}e.labelOutlineThicknessTexture=Ue.newInstance({resizable:!1}),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(K.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(K.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(1024,1,1,me.UNSIGNED_CHAR,g),i&&(e._openGLRenderWindow.setGraphicsResourceForObject(i,e.labelOutlineThicknessTexture,s),i!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(i,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=i)}else e.labelOutlineThicknessTexture=a.oglObject},t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:r,vsize:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,i]},t.getRenderTargetOffset=()=>{const{lowerLeftU:r,lowerLeftV:i}=e._openGLRenderer.getTiledSizeAndOrigin();return[r,i]},t.delete=Kr(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const B9={VBOBuildTime:0,VBOBuildString:null,openGLTexture:null,tris:null,imagemat:null,imagematinv:null,colorTexture:null,pwfTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0};function W9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,B9,n),Be.extend(t,e,n),Qn.implementReplaceShaderCoincidentOffset(t,e,n),Qn.implementBuildShadersWithReplacements(t,e,n),e.tris=Ca.newInstance(),e.imagemat=X(new Float64Array(16)),e.imagematinv=X(new Float64Array(16)),e.projectionToWorld=X(new Float64Array(16)),e.idxToView=X(new Float64Array(16)),e.idxNormalMatrix=va(new Float64Array(9)),e.modelToView=X(new Float64Array(16)),e.projectionToView=X(new Float64Array(16)),je(t,e,[]),e.VBOBuildTime={},Re(e.VBOBuildTime),A9(t,e)}const z9=Ie(W9,"vtkOpenGLImageMapper");Dt("vtkAbstractImageMapper",z9);const cn={MAX:0,MIN:1,AVERAGE:2},{vtkErrorMacro:si}=R;function $9(t,e){e.classHierarchy.push("vtkOpenGLImageCPRMapper");function n(r){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(i=>r.unregisterGraphicsResourceUser(i,t))}t.buildPass=r=>{if(r){e.currentRenderPass=null,e.openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const i=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),i&&!i.isDeleted()&&i!==e._openGLRenderWindow&&n(i),e.context=e._openGLRenderWindow.getContext(),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.opaquePass=(r,i)=>{r&&(e.currentRenderPass=i,t.render())},t.opaqueZBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.getCoincidentParameters=(r,i)=>e.renderable.getResolveCoincidentTopology()===Vt.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const r=e.openGLImageSlice.getRenderable(),i=e._openGLRenderer.getRenderable();t.renderPiece(i,r)},t.renderPiece=(r,i)=>{t.invokeEvent({type:"StartEvent"}),e.renderable.update(),t.invokeEvent({type:"EndEvent"}),e.renderable.preRenderCheck()&&(e.currentImageDataInput=e.renderable.getInputData(0),e.currentCenterlineInput=e.renderable.getOrientedCenterline(),t.renderPieceStart(r,i),t.renderPieceDraw(r,i),t.renderPieceFinish(r,i))},t.renderPieceStart=(r,i)=>{t.updateBufferObjects(r,i)},t.renderPieceDraw=(r,i)=>{const a=e.context;e.volumeTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),e.tris.getCABO().getElementCount()&&(t.updateShaders(e.tris,r,i),a.drawArrays(a.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release()),e.volumeTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(r,i)=>{},t.updateBufferObjects=(r,i)=>{t.getNeedToRebuildBufferObjects(r,i)&&t.buildBufferObjects(r,i),i.getProperty().getInterpolationType()===xn.NEAREST?(e.volumeTexture.setMinificationFilter(K.NEAREST),e.volumeTexture.setMagnificationFilter(K.NEAREST),e.colorTexture.setMinificationFilter(K.NEAREST),e.colorTexture.setMagnificationFilter(K.NEAREST),e.pwfTexture.setMinificationFilter(K.NEAREST),e.pwfTexture.setMagnificationFilter(K.NEAREST)):(e.volumeTexture.setMinificationFilter(K.LINEAR),e.volumeTexture.setMagnificationFilter(K.LINEAR),e.colorTexture.setMinificationFilter(K.LINEAR),e.colorTexture.setMagnificationFilter(K.LINEAR),e.pwfTexture.setMinificationFilter(K.LINEAR),e.pwfTexture.setMagnificationFilter(K.LINEAR))},t.getNeedToRebuildBufferObjects=(r,i)=>{var s;const a=e.VBOBuildTime.getMTime();return a<t.getMTime()||a<e.renderable.getMTime()||a<i.getMTime()||a<e.currentImageDataInput.getMTime()||a<e.currentCenterlineInput.getMTime()||!((s=e.volumeTexture)!=null&&s.getHandle())},t.buildBufferObjects=(r,i)=>{var O,D,S,M;const a=e.currentImageDataInput,s=e.currentCenterlineInput,o=(O=a==null?void 0:a.getPointData())==null?void 0:O.getScalars();if(!o)return;const c=e._openGLRenderWindow.getGraphicsResourceForObject(o),l=vs(a,o);if(!((D=c==null?void 0:c.oglObject)!=null&&D.getHandle())||(c==null?void 0:c.hash)!==l){e.volumeTexture=Ue.newInstance(),e.volumeTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const V=a.getDimensions();e.volumeTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.volumeTexture.resetFormatAndType(),e.volumeTexture.create3DFilterableFromDataArray(V[0],V[1],V[2],o,e.renderable.getPreferSizeOverAccuracy()),e._openGLRenderWindow.setGraphicsResourceForObject(o,e.volumeTexture,l),o!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(o,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=o}else e.volumeTexture=c.oglObject;const f=o.getNumberOfComponents(),g=i.getProperty(),h=g.getIndependentComponents(),p=h?f:1,d=h?2*p:1,m=g.getRGBTransferFunction(),y=an(m,h,p),T=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((S=T==null?void 0:T.oglObject)!=null&&S.getHandle())||(T==null?void 0:T.hash)!==y){const L=1024*d*3,F=new Uint8ClampedArray(L);if(e.colorTexture=Ue.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),m){const k=new Float32Array(3072);for(let b=0;b<p;b++){const W=g.getRGBTransferFunction(b),_=W.getRange();if(W.getTable(_[0],_[1],1024,k,1),h)for(let N=0;N<1024*3;N++)F[b*1024*6+N]=255*k[N],F[b*1024*6+N+1024*3]=255*k[N];else for(let N=0;N<1024*3;N++)F[b*1024*6+N]=255*k[N]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,d,3,me.UNSIGNED_CHAR,F)}else{for(let k=0;k<1024*3;++k)F[k]=255*k/(1023*3),F[k+1]=255*k/(1023*3),F[k+2]=255*k/(1023*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,me.UNSIGNED_CHAR,F)}m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,y),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=T.oglObject;const C=g.getPiecewiseFunction(),x=an(C,h,p),w=e._openGLRenderWindow.getGraphicsResourceForObject(C);if(!((M=w==null?void 0:w.oglObject)!=null&&M.getHandle())||(w==null?void 0:w.hash)!==x){const L=1024*d,F=new Uint8ClampedArray(L);if(e.pwfTexture=Ue.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),C){const k=new Float32Array(L),b=new Float32Array(1024);for(let W=0;W<p;++W){const _=g.getPiecewiseFunction(W);if(_===null)k.fill(1);else{const N=_.getRange();if(_.getTable(N[0],N[1],1024,b,1),h)for(let I=0;I<1024;I++)k[W*1024*2+I]=b[I],k[W*1024*2+I+1024]=b[I];else for(let I=0;I<1024;I++)k[W*1024*2+I]=b[I]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,d,1,me.FLOAT,k)}else F.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,me.UNSIGNED_CHAR,F);C&&(e._openGLRenderWindow.setGraphicsResourceForObject(C,e.pwfTexture,x),C!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(C,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=C)}else e.pwfTexture=w.oglObject;if(e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<s.getMTime()){const V=s.getNumberOfPoints(),L=V<=1?0:V-1,F=s.getDistancesToFirstPoint(),k=e.renderable.getHeight(),b=4*L,W=new Float32Array(3*b),_=e.renderable.getWidth();for(let le=0,ie=0;le<L;++le)W.set([0,k-F[le],0],ie),ie+=3,W.set([_,k-F[le],0],ie),ie+=3,W.set([_,k-F[le+1],0],ie),ie+=3,W.set([0,k-F[le+1],0],ie),ie+=3;const N=oe.newInstance({numberOfComponents:3,values:W});N.setName("points");const I=new Uint16Array(5*L);for(let le=0,ie=0,tt=0;le<L;++le)I.set([4,tt+3,tt+2,tt+1,tt],ie),ie+=5,tt+=4;const U=oe.newInstance({numberOfComponents:1,values:I}),G=s.getPoints(),P=new Float32Array(3*b),ee=new Array(3),Bt=new Array(3);for(let le=0,ie=0;le<L;++le)G.getPoint(le,ee),G.getPoint(le+1,Bt),P.set(ee,ie),ie+=3,P.set(ee,ie),ie+=3,P.set(Bt,ie),ie+=3,P.set(Bt,ie),ie+=3;const We=oe.newInstance({numberOfComponents:3,values:P,name:"centerlinePosition"}),mt=new Float32Array(b);for(let le=0,ie=0;le<L;++le)mt.set([0,1,3,2],ie),ie+=4;const He=oe.newInstance({numberOfComponents:1,values:mt,name:"quadIndex"}),et=[We,He];if(!e.renderable.getUseUniformOrientation()){const le=e.renderable.getOrientedCenterline().getOrientations()??[],ie=new Float32Array(4*b),tt=new Float32Array(4*b);for(let lr=0;lr<L;++lr){const ff=le[lr],gf=le[lr+1];for(let Fa=0;Fa<4;++Fa){const $s=4*(Fa+4*lr);ie.set(ff,$s),tt.set(gf,$s)}}const lf=oe.newInstance({numberOfComponents:4,values:ie,name:"centerlineTopOrientation"}),uf=oe.newInstance({numberOfComponents:4,values:tt,name:"centerlineBotOrientation"});et.push(lf,uf)}e.tris.getCABO().createVBO(U,"polys",St.SURFACE,{points:N,customAttributes:et}),e.VBOBuildTime.modified()}},t.getNeedToRebuildShaders=(r,i,a)=>{const s=e.volumeTexture.getComponents(),o=a.getProperty().getIndependentComponents(),c=!!e.renderable.getCenterPoint(),l=e.renderable.getUseUniformOrientation(),u=e.renderable.isProjectionEnabled()&&e.renderable.getProjectionMode();return r.getProgram()===0||e.lastUseCenterPoint!==c||e.lastUseUniformOrientation!==l||e.lastProjectionMode!==u||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||e.lastTextureComponents!==s||e.lastIndependentComponents!==o?(e.lastUseCenterPoint=c,e.lastUseUniformOrientation=l,e.lastProjectionMode=u,e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=s,e.lastIndependentComponents=o,!0):!1},t.buildShaders=(r,i,a)=>{t.getShaderTemplate(r,i,a),t.replaceShaderValues(r,i,a)},t.replaceShaderValues=(r,i,a)=>{let s=r.Vertex,o=r.Fragment;const c=["vec3 applyQuaternionToVec(vec4 q, vec3 v) {","  float uvx = q.y * v.z - q.z * v.y;","  float uvy = q.z * v.x - q.x * v.z;","  float uvz = q.x * v.y - q.y * v.x;","  float uuvx = q.y * uvz - q.z * uvy;","  float uuvy = q.z * uvx - q.x * uvz;","  float uuvz = q.x * uvy - q.y * uvx;","  float w2 = q.w * 2.0;","  uvx *= w2;","  uvy *= w2;","  uvz *= w2;","  uuvx *= 2.0;","  uuvy *= 2.0;","  uuvz *= 2.0;","  return vec3(v.x + uvx + uuvx, v.y + uvy + uuvy, v.z + uvz + uuvz);","}"];s=B.substitute(s,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,s=B.substitute(s,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result;const l=["attribute vec3 centerlinePosition;","attribute float quadIndex;","uniform float width;","out vec2 quadOffsetVSOutput;","out vec3 centerlinePosVSOutput;"],u=e.renderable.isProjectionEnabled(),f=e.renderable.getUseUniformOrientation();f?(l.push("out vec3 samplingDirVSOutput;","uniform vec4 centerlineOrientation;","uniform vec3 tangentDirection;",...c),u&&l.push("out vec3 projectionDirVSOutput;","uniform vec3 bitangentDirection;")):l.push("out vec4 centerlineTopOrientationVSOutput;","out vec4 centerlineBotOrientationVSOutput;","attribute vec4 centerlineTopOrientation;","attribute vec4 centerlineBotOrientation;"),s=B.substitute(s,"//VTK::Color::Dec",l).result;const g=["quadOffsetVSOutput = vec2(width * (mod(quadIndex, 2.0) == 0.0 ? -0.5 : 0.5), quadIndex > 1.0 ? 0.0 : 1.0);","centerlinePosVSOutput = centerlinePosition;"];f?(g.push("samplingDirVSOutput = applyQuaternionToVec(centerlineOrientation, tangentDirection);"),u&&g.push("projectionDirVSOutput = applyQuaternionToVec(centerlineOrientation, bitangentDirection);")):g.push("centerlineTopOrientationVSOutput = centerlineTopOrientation;","centerlineBotOrientationVSOutput = centerlineBotOrientation;"),s=B.substitute(s,"//VTK::Color::Impl",g).result;const h=e.volumeTexture.getComponents(),p=a.getProperty().getIndependentComponents();let d=["uniform mat4 MCTCMatrix; // Model coordinates to texture coordinates","in vec2 quadOffsetVSOutput;","in vec3 centerlinePosVSOutput;","uniform highp sampler3D volumeTexture;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;"];u&&d.push("uniform vec3 volumeSizeMC;","uniform int projectionSlabNumberOfSamples;","uniform float projectionConstantOffset;","uniform float projectionStepLength;"),f?(d.push("in vec3 samplingDirVSOutput;"),u&&d.push("in vec3 projectionDirVSOutput;")):(d.push("uniform vec3 tangentDirection;","in vec4 centerlineTopOrientationVSOutput;","in vec4 centerlineBotOrientationVSOutput;",...c),u&&d.push("uniform vec3 bitangentDirection;"));const m=e.renderable.getCenterPoint();if(m&&d.push("uniform vec3 globalCenterPoint;"),p){for(let T=1;T<h;T++)d=d.concat([`uniform float cshift${T};`,`uniform float cscale${T};`,`uniform float pwfshift${T};`,`uniform float pwfscale${T};`]);switch(h){case 1:d=d.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:d=d.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:d=d.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:d=d.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:si("Unsupported number of independent coordinates.")}}o=B.substitute(o,"//VTK::TCoord::Dec",d).result;let y=[];if(f?(y.push("vec3 samplingDirection = samplingDirVSOutput;"),u&&y.push("vec3 projectionDirection = projectionDirVSOutput;")):(y.push("vec4 q0 = centerlineBotOrientationVSOutput;","vec4 q1 = centerlineTopOrientationVSOutput;","float qCosAngle = dot(q0, q1);","vec4 interpolatedOrientation;","if (qCosAngle > 0.999 || qCosAngle < -0.999) {","  // Use LERP instead of SLERP when the two quaternions are close or opposite","  interpolatedOrientation = normalize(mix(q0, q1, quadOffsetVSOutput.y));","} else {","  float omega = acos(qCosAngle);","  interpolatedOrientation = normalize(sin((1.0 - quadOffsetVSOutput.y) * omega) * q0 + sin(quadOffsetVSOutput.y * omega) * q1);","}","vec3 samplingDirection = applyQuaternionToVec(interpolatedOrientation, tangentDirection);"),u&&y.push("vec3 projectionDirection = applyQuaternionToVec(interpolatedOrientation, bitangentDirection);")),m?y.push("float baseOffset = dot(samplingDirection, globalCenterPoint - centerlinePosVSOutput);","float horizontalOffset = quadOffsetVSOutput.x + baseOffset;"):y.push("float horizontalOffset = quadOffsetVSOutput.x;"),y.push("vec3 volumePosMC = centerlinePosVSOutput + horizontalOffset * samplingDirection;","vec3 volumePosTC = (MCTCMatrix * vec4(volumePosMC, 1.0)).xyz;","if (any(lessThan(volumePosTC, vec3(0.0))) || any(greaterThan(volumePosTC, vec3(1.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}"),u){const T=e.renderable.getProjectionMode();switch(T){case cn.MIN:y.push("const vec4 initialProjectionTextureValue = vec4(1.0);");break;case cn.MAX:case cn.AVERAGE:default:y.push("const vec4 initialProjectionTextureValue = vec4(0.0);");break}switch(y.push("vec3 projectionScaledDirection = projectionDirection / volumeSizeMC;","vec3 projectionStep = projectionStepLength * projectionScaledDirection;","vec3 projectionStartPosition = volumePosTC + projectionConstantOffset * projectionScaledDirection;","vec4 tvalue = initialProjectionTextureValue;","for (int projectionSampleIdx = 0; projectionSampleIdx < projectionSlabNumberOfSamples; ++projectionSampleIdx) {","  vec3 projectionSamplePosition = projectionStartPosition + float(projectionSampleIdx) * projectionStep;","  vec4 sampledTextureValue = texture(volumeTexture, projectionSamplePosition);"),T){case cn.MAX:y.push("  tvalue = max(tvalue, sampledTextureValue);");break;case cn.MIN:y.push("  tvalue = min(tvalue, sampledTextureValue);");break;case cn.AVERAGE:default:y.push("  tvalue = tvalue + sampledTextureValue;");break}y.push("}"),T===cn.AVERAGE&&y.push("tvalue = tvalue / float(projectionSlabNumberOfSamples);")}else y.push("vec4 tvalue = texture(volumeTexture, volumePosTC);");if(p){const T=["r","g","b","a"];for(let v=0;v<h;++v)y=y.concat([`vec3 tcolor${v} = mix${v} * texture2D(colorTexture1, vec2(tvalue.${T[v]} * cscale${v} + cshift${v}, height${v})).rgb;`,`float compWeight${v} = mix${v} * texture2D(pwfTexture1, vec2(tvalue.${T[v]} * pwfscale${v} + pwfshift${v}, height${v})).r;`]);switch(h){case 1:y=y.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:y=y.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:y=y.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:y=y.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:si("Unsupported number of independent coordinates.")}}else switch(h){case 1:y=y.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:y=y.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:y=y.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:y=y.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}o=B.substitute(o,"//VTK::TCoord::Impl",y).result,e.haveSeenDepthRequest&&(o=B.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=B.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result),r.Vertex=s,r.Fragment=o,t.replaceShaderClip(r,i,a),t.replaceShaderCoincidentOffset(r,i,a)},t.replaceShaderClip=(r,i,a)=>{let s=r.Vertex,o=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){let c=e.renderable.getNumberOfClippingPlanes();c>6&&(R.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),c=6),s=B.substitute(s,"//VTK::Clip::Dec",["uniform int numClipPlanes;","uniform vec4 clipPlanes[6];","varying float clipDistancesVSOutput[6];"]).result,s=B.substitute(s,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=B.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;","varying float clipDistancesVSOutput[6];"]).result,o=B.substitute(o,"//VTK::Clip::Impl",["for (int planeNum = 0; planeNum < 6; planeNum++)","    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=s,r.Fragment=o},t.getShaderTemplate=(r,i,a)=>{r.Vertex=fl,r.Fragment=gl,r.Geometry=""},t.setMapperShaderParameters=(r,i,a)=>{const s=r.getProgram(),o=r.getCABO();o.getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())&&(s.isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(s,o,"vertexMC",o.getVertexOffset(),o.getStride(),e.context.FLOAT,3,e.context.FALSE)||si("Error setting vertexMC in shader VAO.")),r.getCABO().getCustomData().forEach(h=>{h&&s.isAttributeUsed(h.name)&&!r.getVAO().addAttributeArray(s,o,h.name,h.offset,o.getStride(),e.context.FLOAT,h.components,e.context.FALSE)&&si(`Error setting ${h.name} in shader VAO.`)}),r.getAttributeUpdateTime().modified());const c=e.volumeTexture.getTextureUnit();if(s.setUniformi("volumeTexture",c),s.setUniformf("width",e.renderable.getWidth()),r.getProgram().setUniform4fv("backgroundColor",e.renderable.getBackgroundColor()),s.isUniformUsed("tangentDirection")){const h=e.renderable.getTangentDirection();r.getProgram().setUniform3fArray("tangentDirection",h)}if(s.isUniformUsed("bitangentDirection")){const h=e.renderable.getBitangentDirection();r.getProgram().setUniform3fArray("bitangentDirection",h)}if(s.isUniformUsed("centerlineOrientation")){const h=e.renderable.getUniformOrientation();r.getProgram().setUniform4fv("centerlineOrientation",h)}if(s.isUniformUsed("globalCenterPoint")){const h=e.renderable.getCenterPoint();s.setUniform3fArray("globalCenterPoint",h)}if(e.renderable.isProjectionEnabled()){const h=e.currentImageDataInput,p=h.getSpacing(),d=h.getDimensions(),m=e.renderable.getProjectionSlabThickness(),y=e.renderable.getProjectionSlabNumberOfSamples(),T=I4([],p,d);s.setUniform3fArray("volumeSizeMC",T),s.setUniformi("projectionSlabNumberOfSamples",y);const v=-.5*m;s.setUniformf("projectionConstantOffset",v);const C=m/(y-1);s.setUniformf("projectionStepLength",C)}const l=e.currentImageDataInput,u=l.getWorldToIndex(),f=is(new Float32Array(16),i2([],l.getDimensions())),g=Ki(f,f,u);if(s.setUniformMatrix("MCTCMatrix",g),e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),e.renderable.getNumberOfClippingPlanes()){let h=e.renderable.getNumberOfClippingPlanes();h>6&&(R.vtkErrorMacro("OpenGL has a limit of 6 clipping planes"),h=6);const d=o.getCoordShiftAndScaleEnabled()?o.getInverseShiftAndScaleMatrix():null,m=d?Oe(e.imagematinv,a.getMatrix()):a.getMatrix();d&&(ue(m,m),se(m,m,d),ue(m,m)),ue(e.imagemat,e.currentImageDataInput.getIndexToWorld()),se(e.imagematinv,m,e.imagemat);const y=[];for(let T=0;T<h;T++){const v=[];e.renderable.getClippingPlaneInDataCoords(e.imagematinv,T,v);for(let C=0;C<4;C++)y.push(v[C])}s.setUniformi("numClipPlanes",h),s.setUniform4fv("clipPlanes",y)}if(s.isUniformUsed("coffset")){const h=t.getCoincidentParameters(i,a);s.setUniformf("coffset",h.offset),s.isUniformUsed("cfactor")&&s.setUniformf("cfactor",h.factor)}},t.setCameraShaderParameters=(r,i,a)=>{const s=e.openGLImageSlice.getKeyMatrices().mcwc,o=e.openGLCamera.getKeyMatrices(i).wcpc;if(se(e.imagemat,o,s),r.getCABO().getCoordShiftAndScaleEnabled()){const c=r.getCABO().getInverseShiftAndScaleMatrix();se(e.imagemat,e.imagemat,c)}r.getProgram().setUniformMatrix("MCPCMatrix",e.imagemat)},t.setPropertyShaderParameters=(r,i,a)=>{const s=r.getProgram(),o=a.getProperty(),c=o.getOpacity();s.setUniformf("opacity",c);const l=e.volumeTexture.getComponents(),u=o.getIndependentComponents();if(u)for(let p=0;p<l;++p)s.setUniformf(`mix${p}`,o.getComponentWeight(p));const f=e.volumeTexture.getVolumeInfo();for(let p=0;p<l;p++){let d=o.getColorWindow(),m=o.getColorLevel();const y=u?p:0,T=o.getRGBTransferFunction(y);if(T&&o.getUseLookupTableScalarRange()){const x=T.getRange();d=x[1]-x[0],m=.5*(x[1]+x[0])}const v=f.scale[p]/d,C=(f.offset[p]-m)/d+.5;s.setUniformf(`cshift${p}`,C),s.setUniformf(`cscale${p}`,v)}const g=e.colorTexture.getTextureUnit();s.setUniformi("colorTexture1",g);for(let p=0;p<l;p++){let d=1,m=0;const y=u?p:0,T=o.getPiecewiseFunction(y);if(T){const v=T.getRange(),C=v[1]-v[0],x=.5*(v[0]+v[1]);d=f.scale[p]/C,m=(f.offset[p]-x)/C+.5}s.setUniformf(`pwfshift${p}`,m),s.setUniformf(`pwfscale${p}`,d)}const h=e.pwfTexture.getTextureUnit();s.setUniformi("pwfTexture1",h)},t.updateShaders=(r,i,a)=>{if(t.getNeedToRebuildShaders(r,i,a)){const s={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(s,i,a);const o=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);o!==r.getProgram()&&(r.setProgram(o),r.getVAO().releaseGraphicsResources()),r.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(r.getProgram());r.getVAO().bind(),t.setMapperShaderParameters(r,i,a),t.setCameraShaderParameters(r,i,a),t.setPropertyShaderParameters(r,i,a)},t.delete=R.chain(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const j9={currentRenderPass:null,volumeTexture:null,colorTexture:null,pwfTexture:null,tris:null,lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastTextureComponents:0,lastIndependentComponents:0,imagemat:null,imagematinv:null};function H9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,j9,n),Be.extend(t,e,n),Qn.implementReplaceShaderCoincidentOffset(t,e,n),R.algo(t,e,2,0),e.tris=Ca.newInstance(),e.volumeTexture=null,e.colorTexture=null,e.pwfTexture=null,e.imagemat=X(new Float64Array(16)),e.imagematinv=X(new Float64Array(16)),e.VBOBuildTime={},R.obj(e.VBOBuildTime,{mtime:0}),$9(t,e)}const K9=R.newInstance(H9,"vtkOpenGLImageCPRMapper");Dt("vtkImageCPRMapper",K9);function q9(t,e){e.classHierarchy.push("vtkOpenGLImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{n&&e.context.depthMask(!0)},t.translucentPass=(n,r)=>{e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(Oe(e.keyMatrices.mcwc,e.renderable.getMatrix()),ue(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.keyMatrixTime.modified()),e.keyMatrices)}const X9={context:null,keyMatrixTime:null,keyMatrices:null};function Y9(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,X9,n),Be.extend(t,e,n),e.keyMatrixTime={},Re(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:X(new Float64Array(16))},je(t,e,["context"]),q9(t,e)}const Z9=Ie(Y9,"vtkOpenGLImageSlice");Dt("vtkImageSlice",Z9);const{vtkDebugMacro:J9}=Ot;function Q9(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const i=e._openGLRenderer.getAspectRatio(),a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,s=e._openGLRenderer.getTiledSizeAndOrigin();let o=null;if(e.renderable.getUseZValues()){const c=r.getZBufferTexture(),l=Math.floor(c.getWidth()),u=Math.floor(c.getHeight()),f=e._openGLRenderWindow.getContext();c.bind();const g=r.getFramebuffer();g?g.saveCurrentBindingsAndBuffers():J9("No framebuffer to save/restore");const h=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,h),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,c.getHandle(),0),f.checkFramebufferStatus(f.FRAMEBUFFER)===f.FRAMEBUFFER_COMPLETE&&(o=new Uint8Array(l*u*4),f.viewport(0,0,l,u),f.readPixels(0,0,l,u,f.RGBA,f.UNSIGNED_BYTE,o)),g&&g.restorePreviousBindingsAndBuffers(),f.deleteFramebuffer(h)}e.renderable.invokeCallback(e.renderable.getInputData(),a,i,s,o)},t.queryPass=(n,r)=>{n&&e.renderable.getUseZValues()&&r.requestDepth()}}const e8={};function t8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,e8,n),Be.extend(t,e,n),Q9(t,e)}const n8=Ie(t8,"vtkOpenGLPixelSpaceCallbackMapper");Dt("vtkPixelSpaceCallbackMapper",n8);const{vtkDebugMacro:r8}=Ot;function i8(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes()}},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let i=0;i<r.length;++i)r[i].getSwitch()>0&&n++;return n||(r8("No lights are on, creating one."),e.renderable.createLight()),n},t.zBufferPass=n=>{if(n){let r=0;const i=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),r|=i.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(i.clearDepth(1),r|=i.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const a=t.getTiledSizeAndOrigin();i.enable(i.SCISSOR_TEST),i.scissor(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),i.viewport(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),i.colorMask(!0,!0,!0,!0),r&&i.clear(r),i.enable(i.DEPTH_TEST)}},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.cameraPass=n=>{n&&t.clear()},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],i=n[0]-r[0],a=n[1]-r[1],s=e._parent.normalizedDisplayToDisplay(i,a),o=Math.round(s[0]),c=Math.round(s[1]),l=n[2]-r[0],u=n[3]-r[1],f=e._parent.normalizedDisplayToDisplay(l,u);let g=Math.round(f[0])-o,h=Math.round(f[1])-c;return g<0&&(g=0),h<0&&(h=0),{usize:g,vsize:h,lowerLeftU:o,lowerLeftV:c}},t.clear=()=>{let n=0;const r=e.context;if(!e.renderable.getTransparent()){const a=e.renderable.getBackgroundByReference();r.clearColor(a[0],a[1],a[2],a[3]),n|=r.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,r.depthMask(!0)),r.colorMask(!0,!0,!0,!0);const i=t.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),r.viewport(i.lowerLeftU,i.lowerLeftV,i.usize,i.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(n=>{n.modified()})},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const a8={context:null,_openGLRenderWindow:null,selector:null};function s8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,a8,n),Be.extend(t,e,n),dt(t,e,["shaderCache"]),je(t,e,["selector"]),pa(t,e,["openGLRenderWindow"]),i8(t,e)}const o8=Ie(s8,"vtkOpenGLRenderer");Dt("vtkRenderer",o8);function c8(t,e){e.classHierarchy.push("vtkOpenGLVolume"),t.buildPass=n=>{!e.renderable||!e.renderable.getVisibility()||n&&(e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementVolumeCount()}},t.traverseVolumePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0].traverse(n),t.apply(n,!1))},t.volumePass=n=>{!e.renderable||!e.renderable.getVisibility()||e.context.depthMask(!n)},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),Oe(e.MCWCMatrix,e.renderable.getMatrix()),ue(e.MCWCMatrix,e.MCWCMatrix),e.renderable.getIsIdentity()?va(e.normalMatrix):(q1(e.normalMatrix,e.MCWCMatrix),es(e.normalMatrix,e.normalMatrix),t4(e.normalMatrix,e.normalMatrix)),e.keyMatrixTime.modified()),{mcwc:e.MCWCMatrix,normalMatrix:e.normalMatrix})}const l8={};function u8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,l8,n),Be.extend(t,e,n),e.keyMatrixTime={},Re(e.keyMatrixTime,{mtime:0}),e.normalMatrix=new Float64Array(9),e.MCWCMatrix=new Float64Array(16),je(t,e,["context"]),c8(t,e)}const f8=Ie(u8,"vtkOpenGLVolume");Dt("vtkVolume",f8);const T0={NEAREST:0,LINEAR:1,FAST_LINEAR:2},hl={FRACTIONAL:0,PROPORTIONAL:1},Di={CUSTOM:0,ADDITIVE:1,COLORIZE:2};var pl={InterpolationType:T0,OpacityMode:hl,ColorMixPreset:Di},g8=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexDC;

varying vec3 vertexVCVSOutput;
uniform mat4 PCVCMatrix;

uniform float dcxmin;
uniform float dcxmax;
uniform float dcymin;
uniform float dcymax;

void main()
{
  // dcsmall is the device coords reduced to the
  // x y area covered by the volume
  vec4 dcsmall = vec4(
    dcxmin + 0.5 * (vertexDC.x + 1.0) * (dcxmax - dcxmin),
    dcymin + 0.5 * (vertexDC.y + 1.0) * (dcymax - dcymin),
    vertexDC.z,
    vertexDC.w);
  vec4 vcpos = PCVCMatrix * dcsmall;
  vertexVCVSOutput = vcpos.xyz/vcpos.w;
  gl_Position = dcsmall;
}
`,h8=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkVolumeFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the volume mappers fragment shader

// the output of this shader
//VTK::Output::Dec

varying vec3 vertexVCVSOutput;

// first declare the settings from the mapper
// that impact the code paths in here

// always set vtkNumComponents 1,2,3,4
//VTK::NumComponents

// possibly define vtkTrilinearOn
//VTK::TrilinearOn

// possibly define UseIndependentComponents
//VTK::IndependentComponentsOn

// possibly define vtkCustomComponentsColorMix
//VTK::CustomComponentsColorMixOn

// possibly define any "proportional" components
//VTK::vtkProportionalComponents

// possibly define any components that are forced to nearest interpolation
//VTK::vtkForceNearestComponents

// Define the blend mode to use
#define vtkBlendMode //VTK::BlendMode

// Possibly define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Possibly define vtkLabelEdgeProjectionOn
//VTK::LabelEdgeProjectionOn


#ifdef vtkImageLabelOutlineOn
  uniform float outlineOpacity;
  uniform float vpWidth;
  uniform float vpHeight;
  uniform float vpOffsetX;
  uniform float vpOffsetY;
  uniform mat4 PCWCMatrix;
  uniform mat4 vWCtoIDX;

  const int MAX_SEGMENT_INDEX = 256; // Define as per expected maximum
  // bool seenSegmentsByOriginalPos[MAX_SEGMENT_INDEX];
  #define MAX_SEGMENTS 256
  #define UINT_SIZE 32
  #define BITMASK_SIZE ((MAX_SEGMENTS + UINT_SIZE - 1) / UINT_SIZE)

  uint bitmask[BITMASK_SIZE];

  // Set the corresponding bit in the bitmask
  void setBit(int segmentIndex) {
    int index = segmentIndex / UINT_SIZE;
    int bitIndex = segmentIndex % UINT_SIZE;
    bitmask[index] |= 1u << bitIndex;
  }

  // Check if a bit is set in the bitmask
  bool isBitSet(int segmentIndex) {
    int index = segmentIndex / UINT_SIZE;
    int bitIndex = segmentIndex % UINT_SIZE;
    return ((bitmask[index] & (1u << bitIndex)) != 0u);
  }
#endif

// define vtkLightComplexity
//VTK::LightComplexity
#if vtkLightComplexity > 0
uniform float vSpecularPower;
uniform float vAmbient;
uniform float vDiffuse;
uniform float vSpecular;
//VTK::Light::Dec
#endif

//VTK::VolumeShadowOn
//VTK::SurfaceShadowOn
//VTK::localAmbientOcclusionOn
//VTK::LAO::Dec
//VTK::VolumeShadow::Dec

// define vtkComputeNormalFromOpacity
//VTK::vtkComputeNormalFromOpacity

// possibly define vtkGradientOpacityOn
//VTK::GradientOpacityOn
#ifdef vtkGradientOpacityOn
uniform float goscale0;
uniform float goshift0;
uniform float gomin0;
uniform float gomax0;
#ifdef UseIndependentComponents
#if vtkNumComponents > 1
uniform float goscale1;
uniform float goshift1;
uniform float gomin1;
uniform float gomax1;
#if vtkNumComponents > 2
uniform float goscale2;
uniform float goshift2;
uniform float gomin2;
uniform float gomax2;
#if vtkNumComponents > 3
uniform float goscale3;
uniform float goshift3;
uniform float gomin3;
uniform float gomax3;
#endif
#endif
#endif
#endif
#endif

// if you want to see the raw tiled
// data in webgl1 uncomment the following line
// #define debugtile

// camera values
uniform float camThick;
uniform float camNear;
uniform float camFar;
uniform int cameraParallel;

// values describing the volume geometry
uniform vec3 vOriginVC;
uniform vec3 vSpacing;
uniform ivec3 volumeDimensions; // 3d texture dimensions
uniform vec3 vPlaneNormal0;
uniform float vPlaneDistance0;
uniform vec3 vPlaneNormal1;
uniform float vPlaneDistance1;
uniform vec3 vPlaneNormal2;
uniform float vPlaneDistance2;
uniform vec3 vPlaneNormal3;
uniform float vPlaneDistance3;
uniform vec3 vPlaneNormal4;
uniform float vPlaneDistance4;
uniform vec3 vPlaneNormal5;
uniform float vPlaneDistance5;

//VTK::ClipPlane::Dec

// opacity and color textures
uniform sampler2D otexture;
uniform float oshift0;
uniform float oscale0;
uniform sampler2D ctexture;
uniform float cshift0;
uniform float cscale0;

#if vtkNumComponents >= 2
uniform float oshift1;
uniform float oscale1;
uniform float cshift1;
uniform float cscale1;
#endif
#if vtkNumComponents >= 3
uniform float oshift2;
uniform float oscale2;
uniform float cshift2;
uniform float cscale2;
#endif
#if vtkNumComponents >= 4
uniform float oshift3;
uniform float oscale3;
uniform float cshift3;
uniform float cscale3;
#endif

// jitter texture
uniform sampler2D jtexture;
uniform sampler2D ttexture;


// some 3D texture values
uniform float sampleDistance;
uniform vec3 vVCToIJK;
uniform vec3 volumeSpacings; // spacing in the world coorindates


// the heights defined below are the locations
// for the up to four components of the tfuns
// the tfuns have a height of 2XnumComps pixels so the
// values are computed to hit the middle of the two rows
// for that component
#ifdef UseIndependentComponents
#if vtkNumComponents == 1
uniform float mix0;
#define height0 0.5
#endif
#if vtkNumComponents == 2
uniform float mix0;
uniform float mix1;
#define height0 0.25
#define height1 0.75
#endif
#if vtkNumComponents == 3
uniform float mix0;
uniform float mix1;
uniform float mix2;
#define height0 0.17
#define height1 0.5
#define height2 0.83
#endif
#if vtkNumComponents == 4
uniform float mix0;
uniform float mix1;
uniform float mix2;
uniform float mix3;
#define height0 0.125
#define height1 0.375
#define height2 0.625
#define height3 0.875
#endif
#endif

uniform vec4 ipScalarRangeMin;
uniform vec4 ipScalarRangeMax;

// declaration for intermixed geometry
//VTK::ZBuffer::Dec

//=======================================================================
// global and custom variables (a temporary section before photorealistics rendering module is complete)
vec3 rayDirVC;
float sampleDistanceISVS;
float sampleDistanceIS;

#define SQRT3    1.7321
#define INV4PI   0.0796
#define EPSILON  0.001
#define PI       3.1415
#define PI2      9.8696

//=======================================================================
// Webgl2 specific version of functions
#if __VERSION__ == 300

uniform highp sampler3D texture1;

vec4 getTextureValue(vec3 pos)
{
  vec4 tmp = texture(texture1, pos);

  #if defined(vtkComponent0ForceNearest) || \\
      defined(vtkComponent1ForceNearest) || \\
      defined(vtkComponent2ForceNearest) || \\
      defined(vtkComponent3ForceNearest)
    vec3 nearestPos = (floor(pos * vec3(volumeDimensions)) + 0.5) / vec3(volumeDimensions);
    vec4 nearestValue = texture(texture1, nearestPos);
    #ifdef vtkComponent0ForceNearest
      tmp[0] = nearestValue[0];
    #endif
    #ifdef vtkComponent1ForceNearest
      tmp[1] = nearestValue[1];
    #endif
    #ifdef vtkComponent2ForceNearest
      tmp[2] = nearestValue[2];
    #endif
    #ifdef vtkComponent3ForceNearest
      tmp[3] = nearestValue[3];
    #endif
  #endif

  #ifndef UseIndependentComponents
    #if vtkNumComponents == 1
      tmp.a = tmp.r;
    #endif
    #if vtkNumComponents == 2
      tmp.a = tmp.g;
    #endif
    #if vtkNumComponents == 3
      tmp.a = length(tmp.rgb);
    #endif
  #endif

  return tmp;
}

//=======================================================================
// WebGL1 specific version of functions
#else

uniform sampler2D texture1;

uniform float texWidth;
uniform float texHeight;
uniform int xreps;
uniform int xstride;
uniform int ystride;

// if computing trilinear values from multiple z slices
#ifdef vtkTrilinearOn
vec4 getTextureValue(vec3 ijk)
{
  float zoff = 1.0/float(volumeDimensions.z);
  vec4 val1 = getOneTextureValue(ijk);
  vec4 val2 = getOneTextureValue(vec3(ijk.xy, ijk.z + zoff));

  float indexZ = float(volumeDimensions)*ijk.z;
  float zmix =  indexZ - floor(indexZ);

  return mix(val1, val2, zmix);
}

vec4 getOneTextureValue(vec3 ijk)
#else // nearest or fast linear
vec4 getTextureValue(vec3 ijk)
#endif
{
  vec3 tdims = vec3(volumeDimensions);

#ifdef debugtile
  vec2 tpos = vec2(ijk.x, ijk.y);
  vec4 tmp = texture2D(texture1, tpos);
  tmp.a = 1.0;

#else
  int z = int(ijk.z * tdims.z);
  int yz = z / xreps;
  int xz = z - yz*xreps;

  int tileWidth = volumeDimensions.x/xstride;
  int tileHeight = volumeDimensions.y/ystride;

  xz *= tileWidth;
  yz *= tileHeight;

  float ni = float(xz) + (ijk.x*float(tileWidth));
  float nj = float(yz) + (ijk.y*float(tileHeight));

  vec2 tpos = vec2(ni/texWidth, nj/texHeight);

  vec4 tmp = texture2D(texture1, tpos);

#if vtkNumComponents == 1
  tmp.a = tmp.r;
#endif
#if vtkNumComponents == 2
  tmp.g = tmp.a;
#endif
#if vtkNumComponents == 3
  tmp.a = length(tmp.rgb);
#endif
#endif

  return tmp;
}

// End of Webgl1 specific code
//=======================================================================
#endif

//=======================================================================
// transformation between VC and IS space

// convert vector position from idx to vc
#if (vtkLightComplexity > 0) || (defined vtkClippingPlanesOn)
vec3 IStoVC(vec3 posIS){
  vec3 posVC = posIS / vVCToIJK;
  return posVC.x * vPlaneNormal0 +
         posVC.y * vPlaneNormal2 +
         posVC.z * vPlaneNormal4 +
         vOriginVC;
}

// convert vector position from vc to idx
vec3 VCtoIS(vec3 posVC){
  posVC = posVC - vOriginVC;
  posVC = vec3(
    dot(posVC, vPlaneNormal0),
    dot(posVC, vPlaneNormal2),
    dot(posVC, vPlaneNormal4));
  return posVC * vVCToIJK;
}
#endif

//Rotate vector to view coordinate
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
void rotateToViewCoord(inout vec3 dirIS){
  dirIS.xyz =
    dirIS.x * vPlaneNormal0 +
    dirIS.y * vPlaneNormal2 +
    dirIS.z * vPlaneNormal4;
}

//Rotate vector to idx coordinate
vec3 rotateToIDX(vec3 dirVC){
  vec3 dirIS;
  dirIS.xyz = vec3(
    dot(dirVC, vPlaneNormal0),
    dot(dirVC, vPlaneNormal2),
    dot(dirVC, vPlaneNormal4));
  return dirIS;
}
#endif

//=======================================================================
// Given a normal compute the gradient opacity factors
float computeGradientOpacityFactor(
  float normalMag, float goscale, float goshift, float gomin, float gomax)
{
  return clamp(normalMag * goscale + goshift, gomin, gomax);
}

//=======================================================================
// compute the normal and gradient magnitude for a position, uses forward difference
#if (vtkLightComplexity > 0) || (defined vtkGradientOpacityOn)
  #ifdef vtkClippingPlanesOn
    void adjustClippedVoxelValues(vec3 pos, vec3 texPos[3], inout vec3 g1)
    {
      vec3 g1VC[3];
      for (int i = 0; i < 3; ++i)
      {
        g1VC[i] = IStoVC(texPos[i]);
      }
      vec3 posVC = IStoVC(pos);
      for (int i = 0; i < clip_numPlanes; ++i)
      {
        for (int j = 0; j < 3; ++j)
        {
          if(dot(vec3(vClipPlaneOrigins[i] - g1VC[j].xyz), vClipPlaneNormals[i]) > 0.0)
          {
            g1[j] = 0.0;
          }
        }
      }
    }
  #endif

  #ifdef vtkComputeNormalFromOpacity
    vec4 computeDensityNormal(vec3 opacityUCoords[2], float opactityTextureHeight, float gradientOpacity) {
      vec3 opacityG1, opacityG2;
      opacityG1.x = texture2D(otexture, vec2(opacityUCoords[0].x, opactityTextureHeight)).r;
      opacityG1.y = texture2D(otexture, vec2(opacityUCoords[0].y, opactityTextureHeight)).r;
      opacityG1.z = texture2D(otexture, vec2(opacityUCoords[0].z, opactityTextureHeight)).r;
      opacityG2.x = texture2D(otexture, vec2(opacityUCoords[1].x, opactityTextureHeight)).r;
      opacityG2.y = texture2D(otexture, vec2(opacityUCoords[1].y, opactityTextureHeight)).r;
      opacityG2.z = texture2D(otexture, vec2(opacityUCoords[1].z, opactityTextureHeight)).r;
      opacityG1.xyz *= gradientOpacity;
      opacityG2.xyz *= gradientOpacity;

      vec4 opacityG = vec4(opacityG1 - opacityG2, 1.0f);
      // divide by spacing
      opacityG.xyz /= vSpacing;
      opacityG.w = length(opacityG.xyz);
      // rotate to View Coords
      rotateToViewCoord(opacityG.xyz);
      if (!all(equal(opacityG.xyz, vec3(0.0)))) {
        return vec4(normalize(opacityG.xyz),opacityG.w);
      } else {
        return vec4(0.0);
      }
    }

    vec4 computeNormalForDensity(vec3 pos, vec3 tstep, out vec3 scalarInterp[2], const int opacityComponent)
    {
      vec3 xvec = vec3(tstep.x, 0.0, 0.0);
      vec3 yvec = vec3(0.0, tstep.y, 0.0);
      vec3 zvec = vec3(0.0, 0.0, tstep.z);
      vec3 texPosPVec[3];
      texPosPVec[0] = pos + xvec;
      texPosPVec[1] = pos + yvec;
      texPosPVec[2] = pos + zvec;
      vec3 texPosNVec[3];
      texPosNVec[0] = pos - xvec;
      texPosNVec[1] = pos - yvec;
      texPosNVec[2] = pos - zvec;
      vec3 g1, g2;

      scalarInterp[0].x = getTextureValue(texPosPVec[0])[opacityComponent];
      scalarInterp[0].y = getTextureValue(texPosPVec[1])[opacityComponent];
      scalarInterp[0].z = getTextureValue(texPosPVec[2])[opacityComponent];
      scalarInterp[1].x = getTextureValue(texPosNVec[0])[opacityComponent];
      scalarInterp[1].y = getTextureValue(texPosNVec[1])[opacityComponent];
      scalarInterp[1].z = getTextureValue(texPosNVec[2])[opacityComponent];

      #ifdef vtkClippingPlanesOn
        adjustClippedVoxelValues(pos, texPosPVec, scalarInterp[0]);
        adjustClippedVoxelValues(pos, texPosNVec, scalarInterp[1]);
      #endif
      vec4 result;
      result.x = scalarInterp[0].x - scalarInterp[1].x;
      result.y = scalarInterp[0].y - scalarInterp[1].y;
      result.z = scalarInterp[0].z - scalarInterp[1].z;
      // divide by spacing
      result.xyz /= vSpacing;
      result.w = length(result.xyz);
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      if (length(result.xyz) > 0.0) {
        return vec4(normalize(result.xyz),result.w);
      } else {
        return vec4(0.0);
      }
    }
  #endif

  // only works with dependent components
  vec4 computeNormal(vec3 pos, vec3 tstep)
  {
    vec3 xvec = vec3(tstep.x, 0.0, 0.0);
    vec3 yvec = vec3(0.0, tstep.y, 0.0);
    vec3 zvec = vec3(0.0, 0.0, tstep.z);
    vec3 texPosPVec[3];
    texPosPVec[0] = pos + xvec;
    texPosPVec[1] = pos + yvec;
    texPosPVec[2] = pos + zvec;
    vec3 texPosNVec[3];
    texPosNVec[0] = pos - xvec;
    texPosNVec[1] = pos - yvec;
    texPosNVec[2] = pos - zvec;
    vec3 g1, g2;
    g1.x = getTextureValue(texPosPVec[0]).a;
    g1.y = getTextureValue(texPosPVec[1]).a;
    g1.z = getTextureValue(texPosPVec[2]).a;
    g2.x = getTextureValue(texPosNVec[0]).a;
    g2.y = getTextureValue(texPosNVec[1]).a;
    g2.z = getTextureValue(texPosNVec[2]).a;
    #ifdef vtkClippingPlanesOn
      adjustClippedVoxelValues(pos, texPosPVec, g1);
      adjustClippedVoxelValues(pos, texPosNVec, g2);
    #endif
    vec4 result;
    result = vec4(g1 - g2, -1.0);
    // divide by spacing
    result.xyz /= vSpacing;
    result.w = length(result.xyz);
    if (result.w > 0.0){
      // rotate to View Coords
      rotateToViewCoord(result.xyz);
      return vec4(normalize(result.xyz),result.w);
    } else {
      return vec4(0.0);
    }
  }
#endif


#ifdef vtkImageLabelOutlineOn
  vec4 fragCoordToPCPos(vec4 fragCoord) {
    return vec4(
      (fragCoord.x / vpWidth - vpOffsetX - 0.5) * 2.0,
      (fragCoord.y / vpHeight - vpOffsetY - 0.5) * 2.0,
      (fragCoord.z - 0.5) * 2.0,
      1.0);
  }

  vec4 pcPosToWorldCoord(vec4 pcPos) {
    return PCWCMatrix * pcPos;
  }

  vec3 fragCoordToIndexSpace(vec4 fragCoord) {
    vec4 pcPos = fragCoordToPCPos(fragCoord);
    vec4 worldCoord = pcPosToWorldCoord(pcPos);
    vec4 vertex = (worldCoord / worldCoord.w);

    vec3 index = (vWCtoIDX * vertex).xyz;

    // half voxel fix for labelmapOutline
    return (index + vec3(0.5)) / vec3(volumeDimensions);
  }

  vec3 fragCoordToWorld(vec4 fragCoord) {
    vec4 pcPos = fragCoordToPCPos(fragCoord);
    vec4 worldCoord = pcPosToWorldCoord(pcPos);
    return worldCoord.xyz;
  }
#endif

//=======================================================================
// compute the normals and gradient magnitudes for a position
// for independent components
mat4 computeMat4Normal(vec3 pos, vec4 tValue, vec3 tstep)
{
  mat4 result;
  vec4 distX = getTextureValue(pos + vec3(tstep.x, 0.0, 0.0)) - tValue;
  vec4 distY = getTextureValue(pos + vec3(0.0, tstep.y, 0.0)) - tValue;
  vec4 distZ = getTextureValue(pos + vec3(0.0, 0.0, tstep.z)) - tValue;

  // divide by spacing
  distX /= vSpacing.x;
  distY /= vSpacing.y;
  distZ /= vSpacing.z;

  mat3 rot;
  rot[0] = vPlaneNormal0;
  rot[1] = vPlaneNormal2;
  rot[2] = vPlaneNormal4;

#if !defined(vtkComponent0Proportional)
  result[0].xyz = vec3(distX.r, distY.r, distZ.r);
  result[0].a = length(result[0].xyz);
  result[0].xyz *= rot;
  if (result[0].w > 0.0)
  {
    result[0].xyz /= result[0].w;
  }
#endif

// optionally compute the 2nd component
#if vtkNumComponents >= 2 && !defined(vtkComponent1Proportional)
  result[1].xyz = vec3(distX.g, distY.g, distZ.g);
  result[1].a = length(result[1].xyz);
  result[1].xyz *= rot;
  if (result[1].w > 0.0)
  {
    result[1].xyz /= result[1].w;
  }
#endif

// optionally compute the 3rd component
#if vtkNumComponents >= 3 && !defined(vtkComponent2Proportional)
  result[2].xyz = vec3(distX.b, distY.b, distZ.b);
  result[2].a = length(result[2].xyz);
  result[2].xyz *= rot;
  if (result[2].w > 0.0)
  {
    result[2].xyz /= result[2].w;
  }
#endif

// optionally compute the 4th component
#if vtkNumComponents >= 4 && !defined(vtkComponent3Proportional)
  result[3].xyz = vec3(distX.a, distY.a, distZ.a);
  result[3].a = length(result[3].xyz);
  result[3].xyz *= rot;
  if (result[3].w > 0.0)
  {
    result[3].xyz /= result[3].w;
  }
#endif

  return result;
}

//=======================================================================
// global shadow - secondary ray
#if defined(VolumeShadowOn) || defined(localAmbientOcclusionOn)
float random()
{
  float rand = fract(sin(dot(gl_FragCoord.xy,vec2(12.9898,78.233)))*43758.5453123);
  float jitter=texture2D(jtexture,gl_FragCoord.xy/32.).r;
  uint pcg_state = floatBitsToUint(jitter);
  uint state = pcg_state;
  pcg_state = pcg_state * uint(747796405) + uint(2891336453);
  uint word = ((state >> ((state >> uint(28)) + uint(4))) ^ state) * uint(277803737);
  return (float((((word >> uint(22)) ^ word) >> 1 ))/float(2147483647) + rand)/2.0;
}
#endif

#ifdef VolumeShadowOn
// henyey greenstein phase function
float phase_function(float cos_angle)
{
  // divide by 2.0 instead of 4pi to increase intensity
  return ((1.0-anisotropy2)/pow(1.0+anisotropy2-2.0*anisotropy*cos_angle, 1.5))/2.0;
}

// Computes the intersection between a ray and a box
struct Hit
{
  float tmin;
  float tmax;
};

struct Ray
{
  vec3 origin;
  vec3 dir;
  vec3 invDir;
};

bool BBoxIntersect(vec3 boundMin, vec3 boundMax, const Ray r, out Hit hit)
{
  vec3 tbot = r.invDir * (boundMin - r.origin);
  vec3 ttop = r.invDir * (boundMax - r.origin);
  vec3 tmin = min(ttop, tbot);
  vec3 tmax = max(ttop, tbot);
  vec2 t = max(tmin.xx, tmin.yz);
  float t0 = max(t.x, t.y);
  t = min(tmax.xx, tmax.yz);
  float t1 = min(t.x, t.y);
  hit.tmin = t0;
  hit.tmax = t1;
  return t1 > max(t0,0.0);
}

// As BBoxIntersect requires the inverse of the ray coords,
// this function is used to avoid numerical issues
void safe_0_vector(inout Ray ray)
{
  if(abs(ray.dir.x) < EPSILON) ray.dir.x = sign(ray.dir.x) * EPSILON;
  if(abs(ray.dir.y) < EPSILON) ray.dir.y = sign(ray.dir.y) * EPSILON;
  if(abs(ray.dir.z) < EPSILON) ray.dir.z = sign(ray.dir.z) * EPSILON;
}

float volume_shadow(vec3 posIS, vec3 lightDirNormIS)
{
  float shadow = 1.0;
  float opacity = 0.0;

  // modify sample distance with a random number between 1.5 and 3.0
  float sampleDistanceISVS_jitter = sampleDistanceISVS * mix(1.5, 3.0, random());
  float opacityPrev = texture2D(otexture, vec2(getTextureValue(posIS).r * oscale0 + oshift0, 0.5)).r;

  // in case the first sample near surface has a very tiled light ray, we need to offset start position
  posIS += sampleDistanceISVS_jitter * lightDirNormIS;

  // compute the start and end points for the ray
  Ray ray;
  Hit hit;
  ray.origin = posIS;
  ray.dir = lightDirNormIS;
  safe_0_vector(ray);
  ray.invDir = 1.0/ray.dir;

  if(!BBoxIntersect(vec3(0.0),vec3(1.0), ray, hit))
  {
    return 1.0;
  }
  float maxdist = hit.tmax;

  // interpolate shadow ray length between: 1 unit of sample distance in IS to SQRT3, based on globalIlluminationReach
  float maxgi = mix(sampleDistanceISVS_jitter,SQRT3,giReach);
  maxdist = min(maxdist,maxgi);
  if(maxdist < EPSILON) {
    return 1.0;
  }

  float current_dist = 0.0;
  float current_step = length(sampleDistanceISVS_jitter * lightDirNormIS);
  float clamped_step = 0.0;

  vec4 scalar = vec4(0.0);
  while(current_dist < maxdist)
  {
#ifdef vtkClippingPlanesOn
    vec3 posVC = IStoVC(posIS);
    for (int i = 0; i < clip_numPlanes; ++i)
    {
      if (dot(vec3(vClipPlaneOrigins[i] - posVC), vClipPlaneNormals[i]) > 0.0)
      {
        current_dist = maxdist;
      }
    }
#endif
    scalar = getTextureValue(posIS);
    opacity = texture2D(otexture, vec2(scalar.r * oscale0 + oshift0, 0.5)).r;
    #if defined(vtkGradientOpacityOn) && !defined(UseIndependentComponents)
      vec4 normal = computeNormal(posIS, vec3(1.0/vec3(volumeDimensions)));
      opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
    #endif
    shadow *= 1.0 - opacity;

    // optimization: early termination
    if (shadow < EPSILON){
      return 0.0;
    }

    clamped_step = min(maxdist - current_dist, current_step);
    posIS += clamped_step * lightDirNormIS;
    current_dist += current_step;
  }

  return shadow;
}

vec3 applyShadowRay(vec3 tColor, vec3 posIS, vec3 viewDirectionVC)
{
  vec3 vertLight = vec3(0.0);
  vec3 secondary_contrib = vec3(0.0);
  // here we assume only positional light, no effect of cones
  for (int i = 0; i < lightNum; i++)
  {
    #if(vtkLightComplexity==3)
      if (lightPositional[i] == 1){
        vertLight = lightPositionVC[i] - IStoVC(posIS);
      }else{
        vertLight = - lightDirectionVC[i];
      }
    #else
      vertLight = - lightDirectionVC[i];
    #endif
    // here we assume achromatic light, only intensity
    float dDotL = dot(viewDirectionVC, normalize(vertLight));
    // isotropic scatter returns 0.5 instead of 1/4pi to increase intensity
    float phase_attenuation = 0.5;
    if (abs(anisotropy) > EPSILON){
      phase_attenuation = phase_function(dDotL);
    }
    float vol_shadow = volume_shadow(posIS, normalize(rotateToIDX(vertLight)));
    secondary_contrib += tColor * vDiffuse * lightColor[i] * vol_shadow * phase_attenuation;
    secondary_contrib += tColor * vAmbient;
  }
  return secondary_contrib;
}
#endif

//=======================================================================
// local ambient occlusion
#ifdef localAmbientOcclusionOn
vec3 sample_direction_uniform(int i)
{
  float rand = random() * 0.5;
  float theta = PI2 * (kernelSample[i][0] + rand);
  float phi = acos(2.0 * (kernelSample[i][1] + rand) -1.0) / 2.5;
  return normalize(vec3(cos(theta)*sin(phi), sin(theta)*sin(phi), cos(phi)));
}

// return a matrix that transform startDir into z axis; startDir should be normalized
mat3 zBaseRotationalMatrix(vec3 startDir){
  vec3 axis = cross(startDir, vec3(0.0,0.0,1.0));
  float cosA = startDir.z;
  float k = 1.0 / (1.0 + cosA);
  mat3 matrix = mat3((axis.x * axis.x * k) + cosA, (axis.y * axis.x * k) - axis.z, (axis.z * axis.x * k) + axis.y,
              (axis.x * axis.y * k) + axis.z, (axis.y * axis.y * k) + cosA, (axis.z * axis.y * k) - axis.x,
              (axis.x * axis.z * k) - axis.y, (axis.y * axis.z * k) + axis.x, (axis.z * axis.z * k) + cosA);
  return matrix;
}

float computeLAO(vec3 posIS, float op, vec3 lightDir, vec4 normal){
  // apply LAO only at selected locations, otherwise return full brightness
  if (normal.w > 0.0 && op > 0.05){
    float total_transmittance = 0.0;
    mat3 inverseRotateBasis = inverse(zBaseRotationalMatrix(normalize(-normal.xyz)));
    vec3 currPos, randomDirStep;
    float weight, transmittance, opacity;
    for (int i = 0; i < kernelSize; i++)
    {
      randomDirStep = inverseRotateBasis * sample_direction_uniform(i) * sampleDistanceIS;
      weight = 1.0 - dot(normalize(lightDir), normalize(randomDirStep));
      currPos = posIS;
      transmittance = 1.0;
      for (int j = 0; j < kernelRadius ; j++){
        currPos += randomDirStep;
        // check if it's at clipping plane, if so return full brightness
        if (all(greaterThan(currPos, vec3(EPSILON))) && all(lessThan(currPos,vec3(1.0-EPSILON)))){
          opacity = texture2D(otexture, vec2(getTextureValue(currPos).r * oscale0 + oshift0, 0.5)).r;
          #ifdef vtkGradientOpacityOn
             opacity *= computeGradientOpacityFactor(normal.w, goscale0, goshift0, gomin0, gomax0);
          #endif
          transmittance *= 1.0 - opacity;
        }
        else{
          break;
        }
      }
      total_transmittance += transmittance / float(kernelRadius) * weight;

      // early termination if fully translucent
      if (total_transmittance > 1.0 - EPSILON){
        return 1.0;
      }
    }
    // average transmittance and reduce variance
    return clamp(total_transmittance / float(kernelSize), 0.3, 1.0);
  } else {
    return 1.0;
  }
}
#endif

//=======================================================================
// surface light contribution
#if vtkLightComplexity > 0
  void applyLighting(inout vec3 tColor, vec4 normal)
  {
    vec3 diffuse = vec3(0.0, 0.0, 0.0);
    vec3 specular = vec3(0.0, 0.0, 0.0);
    float df, sf = 0.0;
    for (int i = 0; i < lightNum; i++){
        df = abs(dot(normal.rgb, -lightDirectionVC[i]));
        diffuse += df * lightColor[i];
        sf = pow( abs(dot(lightHalfAngleVC[i],normal.rgb)), vSpecularPower);
        specular += sf * lightColor[i];
    }
    tColor.rgb = tColor.rgb*(diffuse*vDiffuse + vAmbient) + specular*vSpecular;
  }
  #ifdef SurfaceShadowOn
  #if vtkLightComplexity < 3
    vec3 applyLightingDirectional(vec3 posIS, vec4 tColor, vec4 normal)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float ndotL,vdotR;
        vertLightDirection = lightDirectionVC[i];
        ndotL = dot(normal.xyz, vertLightDirection);
        if (ndotL < 0.0 && twoSidedLighting)
        {
          ndotL = -ndotL;
        }
        if (ndotL > 0.0)
        {
          diffuse += ndotL * lightColor[i];
          //specular
          vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
          if (vdotR > 0.0)
          {
            specular += pow(vdotR, vSpecularPower) * lightColor[i];
          }
        }
        #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
        #endif
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #else
    vec3 applyLightingPositional(vec3 posIS, vec4 tColor, vec4 normal, vec3 posVC)
    {
      // everything in VC
      vec3 diffuse = vec3(0.0);
      vec3 specular = vec3(0.0);
      #ifdef localAmbientOcclusionOn
        vec3 ambient = vec3(0.0);
      #endif
      vec3 vertLightDirection;
      for (int i = 0; i < lightNum; i++){
        float distance,attenuation,ndotL,vdotR;
        vec3 lightDir;
        if (lightPositional[i] == 1){
          lightDir = lightDirectionVC[i];
          vertLightDirection = posVC - lightPositionVC[i];
          distance = length(vertLightDirection);
          vertLightDirection = normalize(vertLightDirection);
          attenuation = 1.0 / (lightAttenuation[i].x
                              + lightAttenuation[i].y * distance
                              + lightAttenuation[i].z * distance * distance);
          // per OpenGL standard cone angle is 90 or less for a spot light
          if (lightConeAngle[i] <= 90.0){
            float coneDot = dot(vertLightDirection, lightDir);
            if (coneDot >= cos(radians(lightConeAngle[i]))){  // if inside cone
              attenuation = attenuation * pow(coneDot, lightExponent[i]);
            }
            else {
              attenuation = 0.0;
            }
          }
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * attenuation * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * attenuation * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        } else {
          vertLightDirection = lightDirectionVC[i];
          ndotL = dot(normal.xyz, vertLightDirection);
          if (ndotL < 0.0 && twoSidedLighting)
          {
            ndotL = -ndotL;
          }
          if (ndotL > 0.0)
          {
            diffuse += ndotL * lightColor[i];
            //specular
            vdotR = dot(-rayDirVC, normalize(2.0 * ndotL * -normal.xyz + vertLightDirection));
            if (vdotR > 0.0)
            {
              specular += pow(vdotR, vSpecularPower) * lightColor[i];
            }
          }
          #ifdef localAmbientOcclusionOn
            ambient += computeLAO(posIS, tColor.a, vertLightDirection, normal);
          #endif
        }
      }
      #ifdef localAmbientOcclusionOn
        return tColor.rgb * (diffuse * vDiffuse + vAmbient * ambient) + specular*vSpecular;
      #else
        return tColor.rgb * (diffuse * vDiffuse + vAmbient) + specular*vSpecular;
      #endif
    }
  #endif
  #endif
#endif

// LAO of surface shadows and volume shadows only work with dependent components
vec3 applyAllLightning(vec3 tColor, float alpha, vec3 posIS, vec4 normalLight) {
  #if vtkLightComplexity > 0
    // surface shadows if needed
    #ifdef SurfaceShadowOn
      #if vtkLightComplexity < 3
        vec3 tColorS = applyLightingDirectional(posIS, vec4(tColor, alpha), normalLight);
      #else
        vec3 tColorS = applyLightingPositional(posIS, vec4(tColor, alpha), normalLight, IStoVC(posIS));
      #endif
    #endif

    // volume shadows if needed
    #ifdef VolumeShadowOn
      vec3 tColorVS = applyShadowRay(tColor, posIS, rayDirVC);
    #endif

    // merge
    #ifdef VolumeShadowOn
      #ifdef SurfaceShadowOn
        // surface shadows + volumetric shadows
        float vol_coef = volumetricScatteringBlending * (1.0 - alpha / 2.0) * (1.0 - atan(normalLight.w) * INV4PI);
        tColor = (1.0-vol_coef) * tColorS + vol_coef * tColorVS;
      #else
        // volumetric shadows only
        tColor = tColorVS;
      #endif
    #else
      #ifdef SurfaceShadowOn
        // surface shadows only
        tColor = tColorS;
      #else
        // no shadows
        applyLighting(tColor, normal3);
      #endif
    #endif
  #endif
  return tColor;
}

  
vec4 getColorForValue(vec4 tValue, vec3 posIS, vec3 tstep)
{

// If labeloutline and not the edge labelmap, since in the edge labelmap blend
// we need the underlying data to sample through
#if defined(vtkImageLabelOutlineOn) && !defined(vtkLabelEdgeProjectionOn)
  vec3 centerPosIS = fragCoordToIndexSpace(gl_FragCoord); // pos in texture space
  vec4 centerValue = getTextureValue(centerPosIS);
  bool pixelOnBorder = false;
  vec4 tColor = texture2D(ctexture, vec2(centerValue.r * cscale0 + cshift0, 0.5));

  // Get alpha of segment from opacity function.
  tColor.a = texture2D(otexture, vec2(centerValue.r * oscale0 + oshift0, 0.5)).r;

  int segmentIndex = int(centerValue.r * 255.0);
  
  // Use texture sampling for outlineThickness
  float textureCoordinate = float(segmentIndex - 1) / 1024.0;
  float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

  int actualThickness = int(textureValue * 255.0);


  // If it is the background (segment index 0), we should quickly bail out. 
  // Previously, this was determined by tColor.a, which was incorrect as it
  // prevented the outline from appearing when the fill is 0.
  if (segmentIndex == 0){
    return vec4(0, 0, 0, 0);
  }

  // Only perform outline check on fragments rendering voxels that aren't invisible.
  // Saves a bunch of needless checks on the background.
  // TODO define epsilon when building shader?
  for (int i = -actualThickness; i <= actualThickness; i++) {
    for (int j = -actualThickness; j <= actualThickness; j++) {
      if (i == 0 || j == 0) {
        continue;
      }

      vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i),
        gl_FragCoord.y + float(j),
        gl_FragCoord.z, gl_FragCoord.w);

      vec3 neighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);
      vec4 value = getTextureValue(neighborPosIS);

      // If any of my neighbours are not the same value as I
      // am, this means I am on the border of the segment.
      // We can break the loops
      if (any(notEqual(value, centerValue))) {
        pixelOnBorder = true;
        break;
      }
    }

    if (pixelOnBorder == true) {
      break;
    }
  }

  // If I am on the border, I am displayed at full opacity
  if (pixelOnBorder == true) {
    tColor.a = outlineOpacity;
  }

  return tColor;

#else
  // compute the normal and gradient magnitude if needed
  // We compute it as a vec4 if possible otherwise a mat4

  #ifdef UseIndependentComponents

    // sample textures
    vec3 tColor0 = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, height0)).r;

    #if vtkNumComponents > 1
      vec3 tColor1 = texture2D(ctexture, vec2(tValue.g * cscale1 + cshift1, height1)).rgb;
      float pwfValue1 = texture2D(otexture, vec2(tValue.g * oscale1 + oshift1, height1)).r;

      #if vtkNumComponents > 2
        vec3 tColor2 = texture2D(ctexture, vec2(tValue.b * cscale2 + cshift2, height2)).rgb;
        float pwfValue2 = texture2D(otexture, vec2(tValue.b * oscale2 + oshift2, height2)).r;

        #if vtkNumComponents > 3
          vec3 tColor3 = texture2D(ctexture, vec2(tValue.a * cscale3 + cshift3, height3)).rgb;
          float pwfValue3 = texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, height3)).r;
        #endif
      #endif
    #endif

    #if !defined(vtkCustomComponentsColorMix)
      // default path for component color mix

      // compute the normal vectors as needed
      #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
      #endif

      // compute gradient opacity factors as needed
      vec4 goFactor = vec4(1.0, 1.0 ,1.0 ,1.0);
      #if defined(vtkGradientOpacityOn)
        #if !defined(vtkComponent0Proportional)
          goFactor.x =
            computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
        #endif
        #if vtkNumComponents > 1
          #if !defined(vtkComponent1Proportional)
            goFactor.y =
              computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          #endif
          #if vtkNumComponents > 2
            #if !defined(vtkComponent2Proportional)
              goFactor.z =
                computeGradientOpacityFactor(normalMat[2].a, goscale2, goshift2, gomin2, gomax2);
            #endif
            #if vtkNumComponents > 3
              #if !defined(vtkComponent3Proportional)
                goFactor.w =
                  computeGradientOpacityFactor(normalMat[3].a, goscale3, goshift3, gomin3, gomax3);
              #endif
            #endif
          #endif
        #endif
      #endif

      // process color and opacity for each component
      #if !defined(vtkComponent0Proportional)
        float alpha = goFactor.x*mix0*pwfValue0;
        #if vtkLightComplexity > 0
          applyLighting(tColor0, normalMat[0]);
        #endif
      #else
        tColor0 *= pwfValue0;
        float alpha = mix(pwfValue0, 1.0, (1.0 - mix0));
      #endif

      #if vtkNumComponents > 1
        #if !defined(vtkComponent1Proportional)
          alpha += goFactor.y*mix1*pwfValue1;
          #if vtkLightComplexity > 0
            applyLighting(tColor1, normalMat[1]);
          #endif
        #else
          tColor1 *= pwfValue1;
          alpha *= mix(pwfValue1, 1.0, (1.0 - mix1));
        #endif

        #if vtkNumComponents > 2
          #if !defined(vtkComponent2Proportional)
            alpha += goFactor.z*mix2*pwfValue2;
            #if vtkLightComplexity > 0
              applyLighting(tColor2, normalMat[2]);
            #endif
          #else
            tColor2 *= pwfValue2;
            alpha *= mix(pwfValue2, 1.0, (1.0 - mix2));
          #endif
        #endif

        #if vtkNumComponents > 3
          #if !defined(vtkComponent3Proportional)
            alpha += goFactor.w*mix3*pwfValue3;
            #if vtkLightComplexity > 0
              applyLighting(tColor3, normalMat[3]);
            #endif
          #else
            tColor3 *= pwfValue3;
            alpha *= mix(pwfValue3, 1.0, (1.0 - mix3));
          #endif
        #endif
      #endif

      // perform final independent blend
      vec3 tColor = mix0 * tColor0;
      #if vtkNumComponents > 1
        tColor += mix1 * tColor1;
        #if vtkNumComponents > 2
          tColor += mix2 * tColor2;
          #if vtkNumComponents > 3
            tColor += mix3 * tColor3;
          #endif
        #endif
      #endif

      return vec4(tColor, alpha);
    #else
      /*
       * Mix the color information from all the independent components to get a single rgba output
       * Gradient opactity factors and normals are not computed
       *
       * You can compute these using:
       * - computeMat4Normal: always available, compute normal only for non proportional components, used by default independent component mix
       * - computeDensityNormal & computeNormalForDensity: available if ((LightComplexity > 0) || GradientOpacityOn) && ComputeNormalFromOpacity),
       *                                                   used by dependent component color mix, see code for Additive preset in OpenGl/VolumeMapper
       * - computeGradientOpacityFactor: always available, used in a lot of places
       *
       * Using applyAllLightning() is advised for shading but some features don't work well with it (volume shadows, LAO)
       * mix0, mix1, ... are defined for each component that is used and correspond to the componentWeight
       */
      //VTK::CustomComponentsColorMix::Impl
    #endif
  #else
    // dependent components

    // compute normal if needed
    #if (vtkLightComplexity > 0) || defined(vtkGradientOpacityOn)
      // use component 3 of the opacity texture as getTextureValue() sets alpha to the opacity value
      #ifdef vtkComputeNormalFromOpacity
        vec3 scalarInterp[2];
        vec4 normal0 = computeNormalForDensity(posIS, tstep, scalarInterp, 3);
      #else
        vec4 normal0 = computeNormal(posIS, tstep);
      #endif
    #endif

    // compute gradient opacity factor enabled
    #if defined(vtkGradientOpacityOn)
      float gradientOpacity = computeGradientOpacityFactor(normal0.a, goscale0, goshift0, gomin0, gomax0);
    #else
      const float gradientOpacity = 1.0;
    #endif

    // get color and opacity
    #if vtkNumComponents == 1
      vec3 tColor = texture2D(ctexture, vec2(tValue.r * cscale0 + cshift0, 0.5)).rgb;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      if (alpha < EPSILON){
        return vec4(0.0);
      }
    #endif
    #if vtkNumComponents == 2
      vec3 tColor = vec3(tValue.r * cscale0 + cshift0);
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale1 + oshift1, 0.5)).r;
    #endif
    #if vtkNumComponents == 3
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale0 + oshift0, 0.5)).r;
    #endif
    #if vtkNumComponents == 4
      vec3 tColor;
      tColor.r = tValue.r * cscale0 + cshift0;
      tColor.g = tValue.g * cscale1 + cshift1;
      tColor.b = tValue.b * cscale2 + cshift2;
      float alpha = gradientOpacity*texture2D(otexture, vec2(tValue.a * oscale3 + oshift3, 0.5)).r;
    #endif

    // lighting
    #if (vtkLightComplexity > 0)
      #ifdef vtkComputeNormalFromOpacity
        vec4 normalLight;
        if (!all(equal(normal0, vec4(0.0)))) {
          scalarInterp[0] = scalarInterp[0] * oscale0 + oshift0;
          scalarInterp[1] = scalarInterp[1] * oscale0 + oshift0;
          normalLight = computeDensityNormal(scalarInterp, 0.5, gradientOpacity);
          if (all(equal(normalLight, vec4(0.0)))) {
            normalLight = normal0;
          }
        }
      #else
        vec4 normalLight = normal0;
      #endif
      tColor = applyAllLightning(tColor, alpha, posIS, normalLight);
    #endif

    return vec4(tColor, alpha);
  #endif // dependent
#endif
}

bool valueWithinScalarRange(vec4 val, vec4 min, vec4 max) {
  bool withinRange = false;
  #if vtkNumComponents == 1
    if (val.r >= min.r && val.r <= max.r) {
      withinRange = true;
    }
  #else
    #ifdef UseIndependentComponents
      #if vtkNumComponents == 2
        if (val.r >= min.r && val.r <= max.r &&
            val.g >= min.g && val.g <= max.g) {
          withinRange = true;
        }
      #else
        if (all(greaterThanEqual(val, ipScalarRangeMin)) &&
            all(lessThanEqual(val, ipScalarRangeMax))) {
          withinRange = true;
        }
      #endif
    #endif
  #endif
  return withinRange;
}

#if vtkBlendMode == 6 
bool checkOnEdgeForNeighbor(int i, int j, int s, vec3 stepIS) {
    vec4 neighborPixelCoord = vec4(gl_FragCoord.x + float(i), gl_FragCoord.y + float(j), gl_FragCoord.z, gl_FragCoord.w);
    vec3 originalNeighborPosIS = fragCoordToIndexSpace(neighborPixelCoord);

    bool justSawIt = false;

    vec3 neighborPosIS = originalNeighborPosIS;

    float stepsTraveled = 0.0;


    // float neighborValue;
    for (int k = 0; k < //VTK::MaximumSamplesValue /2 ; ++k) {
        ivec3 texCoord = ivec3(neighborPosIS * vec3(volumeDimensions));
        vec4 texValue = texelFetch(texture1, texCoord, 0);

        if (int(texValue.g) == s) {
            justSawIt = true;
            break;
        }
        neighborPosIS += stepIS;
    }

    if (justSawIt){
      return false;
    }

   
    neighborPosIS = originalNeighborPosIS;
    for (int k = 0; k < //VTK::MaximumSamplesValue /2 ; ++k) {
        ivec3 texCoord = ivec3(neighborPosIS * vec3(volumeDimensions));
        vec4 texValue = texelFetch(texture1, texCoord, 0);

        if (int(texValue.g) == s) {
            justSawIt = true;
            break;
        }
        neighborPosIS -= stepIS;
    }


    if (!justSawIt) {
        // onedge
        vec3 tColorSegment = texture2D(ctexture, vec2(float(s) * cscale1 + cshift1, height1)).rgb;
        float pwfValueSegment = texture2D(otexture, vec2(float(s) * oscale1 + oshift1, height1)).r;
        gl_FragData[0] = vec4(tColorSegment, pwfValueSegment);
        return true;
    }

    // not on edge
    return false;
}

#endif


//=======================================================================
// Apply the specified blend mode operation along the ray's path.
//
void applyBlend(vec3 posIS, vec3 endIS, vec3 tdims)
{
  vec3 tstep = 1.0/tdims;

  // start slightly inside and apply some jitter
  vec3 delta = endIS - posIS;
  vec3 stepIS = normalize(delta)*sampleDistanceIS;
  float raySteps = length(delta)/sampleDistanceIS;

  // Initialize arrays to false
  // avoid 0.0 jitter
  float jitter = 0.01 + 0.99*texture2D(jtexture, gl_FragCoord.xy/32.0).r;
  float stepsTraveled = jitter;

  // local vars for the loop
  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);
  vec4 tValue;
  vec4 tColor;

  // if we have less than one step then pick the middle point
  // as our value
  // if (raySteps <= 1.0)
  // {
  //   posIS = (posIS + endIS)*0.5;
  // }

  // Perform initial step at the volume boundary
  // compute the scalar
  tValue = getTextureValue(posIS);
  
  #if vtkBlendMode == 6 
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);
    vec3 maxPosIS = posIS; // Store the position of the max value
    int segmentIndex = int(value.g);
    bool originalPosHasSeenNonZero = false;

    uint bitmask = 0u;

    if (segmentIndex != 0) {
      // Tried using the segment index in an boolean array but reading 
      // from the array by dynamic indexing was horrondously slow
      // so use bit masking instead and assign 1 to the bit corresponding to the segment index
      // and later check if the bit is set via bit operations
      setBit(segmentIndex);
    }
    
    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);
      segmentIndex = int(tValue.g);

      if (segmentIndex != 0) {
        originalPosHasSeenNonZero = true;
        setBit(segmentIndex);
      }

      if (tValue.r > value.r) {
        value =  tValue; // Update the max value
        maxPosIS = posIS; // Update the position where max occurred
      }

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);

    if (tValue.r > value.r) {
      value = tValue; // Update the max value
      maxPosIS = posIS; // Update the position where max occurred
    }  

    // If we have not seen any non-zero segments, we can return early
    // and grab color from the actual center value first component (image)
    if (!originalPosHasSeenNonZero) {
      gl_FragData[0] = getColorForValue(value, maxPosIS, tstep);
      return;
    }

    // probably we can make this configurable but for now we will use the same
    // sample distance as the original sample distance
    float neighborSampleDistanceIS = sampleDistanceIS;

    vec3 neighborRayStepsIS = stepIS;
    float neighborRaySteps = raySteps;
    bool shouldLookInAllNeighbors = false;

    float minVoxelSpacing = min(volumeSpacings[0], min(volumeSpacings[1], volumeSpacings[2]));
    vec4 base = vec4(gl_FragCoord.x, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);

    vec4 baseXPlus = vec4(gl_FragCoord.x + 1.0, gl_FragCoord.y, gl_FragCoord.z, gl_FragCoord.w);
    vec4 baseYPlus = vec4(gl_FragCoord.x, gl_FragCoord.y + 1.0, gl_FragCoord.z, gl_FragCoord.w);

    vec3 baseWorld = fragCoordToWorld(base);
    vec3 baseXPlusWorld = fragCoordToWorld(baseXPlus);
    vec3 baseYPlusWorld = fragCoordToWorld(baseYPlus);

    float XPlusDiff = length(baseXPlusWorld - baseWorld);
    float YPlusDiff = length(baseYPlusWorld - baseWorld);

    float minFragSpacingWorld = min(XPlusDiff, YPlusDiff);

    for (int s = 1; s < MAX_SEGMENT_INDEX; s++) {
      // bail out quickly if the segment index has not 
      // been seen by the center segment
      if (!isBitSet(s)) {
       continue;
      }

      // Use texture sampling for outlineThickness so that we can have 
      // per segment thickness
      float textureCoordinate = float(s - 1) / 1024.0;
      float textureValue = texture2D(ttexture, vec2(textureCoordinate, 0.5)).r;

      int actualThickness = int(textureValue * 255.0);

      // check the extreme points in the neighborhood since there is a better
      // chance of finding the edge there, so that we can bail out 
      // faster if we find the edge
      bool onEdge =
          checkOnEdgeForNeighbor(-actualThickness, -actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(actualThickness, actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(actualThickness, -actualThickness, s, stepIS) ||
          checkOnEdgeForNeighbor(-actualThickness, +actualThickness, s, stepIS);

      if (onEdge) {
        return;
      }

      // since the next step is computationally expensive, we need to perform
      // some optimizations to avoid it if possible. One of the optimizations
      // is to check the whether the minimum of the voxel spacing is greater than 
      // the 2 * the thickness of the outline segment. If that is the case
      // then we can safely skip the next step since we can be sure that the
      // the previous 4 checks on the extreme points would caught the entirety 
      // of the all the fragments inside. i.e., this happens when we zoom out, 
      if (minVoxelSpacing > (2.0 * float(actualThickness) - 1.0) * minFragSpacingWorld) {
        continue;
      }
      
      // Loop through the rest, skipping the processed extremes and the center
      for (int i = -actualThickness; i <= actualThickness; i++) {
            for (int j = -actualThickness; j <= actualThickness; j++) {
                if (i == 0 && j == 0) continue; // Skip the center
                if (abs(i) == actualThickness && abs(j) == actualThickness) continue; // Skip corners
                if (checkOnEdgeForNeighbor(i, j, s, stepIS )) {
                    return;
                }
          }
      }
    }

    vec3 tColor0 = texture2D(ctexture, vec2(value.r * cscale0 + cshift0, height0)).rgb;
    float pwfValue0 = texture2D(otexture, vec2(value.r * oscale0 + oshift0, height0)).r;
    gl_FragData[0] = vec4(tColor0, pwfValue0);
  #endif
  #if vtkBlendMode == 0 // COMPOSITE_BLEND
    // now map through opacity and color
    tColor = getColorForValue(tValue, posIS, tstep);

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps);
      gl_FragData[0] = tColor;
      return;
    }

    tColor.a = 1.0 - pow(1.0 - tColor.a, jitter);
    color = vec4(tColor.rgb*tColor.a, tColor.a);
    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);

      float mix = (1.0 - color.a);

      // this line should not be needed but nvidia seems to not handle
      // the break correctly on windows/chrome 58 angle
      //mix = mix * sign(max(raySteps - stepsTraveled - 1.0, 0.0));

      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
      stepsTraveled++;
      posIS += stepIS;
      if (color.a > 0.99) { color.a = 1.0; break; }
    }

    if (color.a < 0.99 && (raySteps - stepsTraveled) > 0.0)
    {
      posIS = endIS;

      // compute the scalar
      tValue = getTextureValue(posIS);

      // now map through opacity and color
      tColor = getColorForValue(tValue, posIS, tstep);
      tColor.a = 1.0 - pow(1.0 - tColor.a, raySteps - stepsTraveled);

      float mix = (1.0 - color.a);
      color = color + vec4(tColor.rgb*tColor.a, tColor.a)*mix;
    }

    gl_FragData[0] = vec4(color.rgb/color.a, color.a);
  #endif
  #if vtkBlendMode == 1 || vtkBlendMode == 2
    // MAXIMUM_INTENSITY_BLEND || MINIMUM_INTENSITY_BLEND
    // Find maximum/minimum intensity along the ray.

    // Define the operation we will use (min or max)
    #if vtkBlendMode == 1
    #define OP max
    #else
    #define OP min
    #endif

    // If the clipping range is shorter than the sample distance
    // we can skip the sampling loop along the ray.
    if (raySteps <= 1.0)
    {
      gl_FragData[0] = getColorForValue(tValue, posIS, tstep);
      return;
    }

    vec4 value = tValue;
    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // Update the maximum value if necessary
      value = OP(tValue, value);

      // Otherwise, continue along the ray
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;
    tValue = getTextureValue(posIS);
    value = OP(tValue, value);

    // Now map through opacity and color
    gl_FragData[0] = getColorForValue(value, posIS, tstep);
  #endif
  #if vtkBlendMode == 3 || vtkBlendMode == 4 //AVERAGE_INTENSITY_BLEND || ADDITIVE_BLEND
    vec4 sum = vec4(0.);

    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;
    }

    if (raySteps <= 1.0) {
      gl_FragData[0] = getColorForValue(sum, posIS, tstep);
      return;
    }

    posIS += (jitter*stepIS);

    // Sample along the ray until MaximumSamplesValue,
    // ending slightly inside the total distance
    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      // If we have reached the last step, break
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar
      tValue = getTextureValue(posIS);

      // One can control the scalar range by setting the AverageIPScalarRange to disregard scalar values, not in the range of interest, from the average computation.
      // Notes:
      // - We are comparing all values in the texture to see if any of them
      //   are outside of the scalar range. In the future we might want to allow
      //   scalar ranges for each component.
      if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
        // Sum the values across each step in the path
        sum += tValue;
      }
      stepsTraveled++;
      posIS += stepIS;
    }

    // Perform the last step along the ray using the
    // residual distance
    posIS = endIS;

    // compute the scalar
    tValue = getTextureValue(posIS);

    // One can control the scalar range by setting the IPScalarRange to disregard scalar values, not in the range of interest, from the average computation
    if (valueWithinScalarRange(tValue, ipScalarRangeMin, ipScalarRangeMax)) {
      sum += tValue;

      stepsTraveled++;
    }

    #if vtkBlendMode == 3 // Average
      sum /= vec4(stepsTraveled, stepsTraveled, stepsTraveled, 1.0);
    #endif

    gl_FragData[0] = getColorForValue(sum, posIS, tstep);
  #endif
  #if vtkBlendMode == 5 // RADON
    float normalizedRayIntensity = 1.0;

    // handle very thin volumes
    if (raySteps <= 1.0)
    {
      tValue = getTextureValue(posIS);
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;
      gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity, 0.5));
      return;
    }

    posIS += (jitter*stepIS);

    for (int i = 0; i < //VTK::MaximumSamplesValue ; ++i)
    {
      if (stepsTraveled + 1.0 >= raySteps) { break; }

      // compute the scalar value
      tValue = getTextureValue(posIS);

      // Convert scalar value to normalizedRayIntensity coefficient and accumulate normalizedRayIntensity
      normalizedRayIntensity = normalizedRayIntensity - sampleDistance*texture2D(otexture, vec2(tValue.r * oscale0 + oshift0, 0.5)).r;

      posIS += stepIS;
      stepsTraveled++;
    }

    // map normalizedRayIntensity to color
    gl_FragData[0] = texture2D(ctexture, vec2(normalizedRayIntensity , 0.5));

  #endif
}

//=======================================================================
// Compute a new start and end point for a given ray based
// on the provided bounded clipping plane (aka a rectangle)
void getRayPointIntersectionBounds(
  vec3 rayPos, vec3 rayDir,
  vec3 planeDir, float planeDist,
  inout vec2 tbounds, vec3 vPlaneX, vec3 vPlaneY,
  float vSize1, float vSize2)
{
  float result = dot(rayDir, planeDir);
  if (abs(result) < 1e-6)
  {
    return;
  }
  result = -1.0 * (dot(rayPos, planeDir) + planeDist) / result;
  vec3 xposVC = rayPos + rayDir*result;
  vec3 vxpos = xposVC - vOriginVC;
  vec2 vpos = vec2(
    dot(vxpos, vPlaneX),
    dot(vxpos, vPlaneY));

  // on some apple nvidia systems this does not work
  // if (vpos.x < 0.0 || vpos.x > vSize1 ||
  //     vpos.y < 0.0 || vpos.y > vSize2)
  // even just
  // if (vpos.x < 0.0 || vpos.y < 0.0)
  // fails
  // so instead we compute a value that represents in and out
  //and then compute the return using this value
  float xcheck = max(0.0, vpos.x * (vpos.x - vSize1)); //  0 means in bounds
  float check = sign(max(xcheck, vpos.y * (vpos.y - vSize2))); //  0 means in bounds, 1 = out

  tbounds = mix(
   vec2(min(tbounds.x, result), max(tbounds.y, result)), // in value
   tbounds, // out value
   check);  // 0 in 1 out
}

//=======================================================================
// given a
// - ray direction (rayDir)
// - starting point (vertexVCVSOutput)
// - bounding planes of the volume
// - optionally depth buffer values
// - far clipping plane
// compute the start/end distances of the ray we need to cast
vec2 computeRayDistances(vec3 rayDir, vec3 tdims)
{
  vec2 dists = vec2(100.0*camFar, -1.0);

  vec3 vSize = vSpacing*tdims;

  // all this is in View Coordinates
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal0, vPlaneDistance0, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal1, vPlaneDistance1, dists, vPlaneNormal2, vPlaneNormal4,
    vSize.y, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal2, vPlaneDistance2, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal3, vPlaneDistance3, dists, vPlaneNormal0, vPlaneNormal4,
    vSize.x, vSize.z);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal4, vPlaneDistance4, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);
  getRayPointIntersectionBounds(vertexVCVSOutput, rayDir,
    vPlaneNormal5, vPlaneDistance5, dists, vPlaneNormal0, vPlaneNormal2,
    vSize.x, vSize.y);

  //VTK::ClipPlane::Impl

  // do not go behind front clipping plane
  dists.x = max(0.0,dists.x);

  // do not go PAST far clipping plane
  float farDist = -camThick/rayDir.z;
  dists.y = min(farDist,dists.y);

  // Do not go past the zbuffer value if set
  // This is used for intermixing opaque geometry
  //VTK::ZBuffer::Impl

  return dists;
}

//=======================================================================
// Compute the index space starting position (pos) and end
// position
//
void computeIndexSpaceValues(out vec3 pos, out vec3 endPos, vec3 rayDir, vec2 dists)
{
  // compute starting and ending values in volume space
  pos = vertexVCVSOutput + dists.x*rayDir;
  pos = pos - vOriginVC;
  // convert to volume basis and origin
  pos = vec3(
    dot(pos, vPlaneNormal0),
    dot(pos, vPlaneNormal2),
    dot(pos, vPlaneNormal4));

  endPos = vertexVCVSOutput + dists.y*rayDir;
  endPos = endPos - vOriginVC;
  endPos = vec3(
    dot(endPos, vPlaneNormal0),
    dot(endPos, vPlaneNormal2),
    dot(endPos, vPlaneNormal4));

  float delta = length(endPos - pos);

  pos *= vVCToIJK;
  endPos *= vVCToIJK;

  float delta2 = length(endPos - pos);
  sampleDistanceIS = sampleDistance*delta2/delta;
  #ifdef VolumeShadowOn
    sampleDistanceISVS = sampleDistanceIS * volumeShadowSamplingDistFactor;
  #endif
}

void main()
{

  if (cameraParallel == 1)
  {
    // Camera is parallel, so the rayDir is just the direction of the camera.
    rayDirVC = vec3(0.0, 0.0, -1.0);
  } else {
    // camera is at 0,0,0 so rayDir for perspective is just the vc coord
    rayDirVC = normalize(vertexVCVSOutput);
  }

  vec3 tdims = vec3(volumeDimensions);

  // compute the start and end points for the ray
  vec2 rayStartEndDistancesVC = computeRayDistances(rayDirVC, tdims);

  // do we need to composite? aka does the ray have any length
  // If not, bail out early
  if (rayStartEndDistancesVC.y <= rayStartEndDistancesVC.x)
  {
    discard;
  }

  // IS = Index Space
  vec3 posIS;
  vec3 endIS;
  computeIndexSpaceValues(posIS, endIS, rayDirVC, rayStartEndDistancesVC);

  // Perform the blending operation along the ray
  applyBlend(posIS, endIS, tdims);
}
`;const{vtkWarningMacro:p8,vtkErrorMacro:$a}=Ot;function d8(t){switch(t){case Di.CUSTOM:return"//VTK::CustomColorMix";case Di.ADDITIVE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);

          vec3 scalarInterp1[2];
          vec4 normalLight1 = computeNormalForDensity(posIS, tstep, scalarInterp1, 1);
          scalarInterp1[0] = scalarInterp1[0] * oscale1 + oshift1;
          scalarInterp1[1] = scalarInterp1[1] * oscale1 + oshift1;
          normalLight1 = computeDensityNormal(scalarInterp1, height1, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
          vec4 normalLight1 = normalMat[1];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        float opacity1 = pwfValue1;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
          float gof1 = computeGradientOpacityFactor(normalMat[1].a, goscale1, goshift1, gomin1, gomax1);
          opacity1 *= gof1;
        #endif
        float opacitySum = opacity0 + opacity1;
        if (opacitySum <= 0.0) {
          return vec4(0.0);
        }

        // mix the colors and opacities
        tColor0 = applyAllLightning(tColor0, opacity0, posIS, normalLight0);
        tColor1 = applyAllLightning(tColor1, opacity1, posIS, normalLight1);
        vec3 mixedColor = (opacity0 * tColor0 + opacity1 * tColor1) / opacitySum;
        return vec4(mixedColor, min(1.0, opacitySum));
`;case Di.COLORIZE:return`
        // compute normals
        mat4 normalMat = computeMat4Normal(posIS, tValue, tstep);
        #if (vtkLightComplexity > 0) && defined(vtkComputeNormalFromOpacity)
          vec3 scalarInterp0[2];
          vec4 normalLight0 = computeNormalForDensity(posIS, tstep, scalarInterp0, 0);
          scalarInterp0[0] = scalarInterp0[0] * oscale0 + oshift0;
          scalarInterp0[1] = scalarInterp0[1] * oscale0 + oshift0;
          normalLight0 = computeDensityNormal(scalarInterp0, height0, 1.0);
        #else
          vec4 normalLight0 = normalMat[0];
        #endif

        // compute opacities
        float opacity0 = pwfValue0;
        #ifdef vtkGradientOpacityOn
          float gof0 = computeGradientOpacityFactor(normalMat[0].a, goscale0, goshift0, gomin0, gomax0);
          opacity0 *= gof0;
        #endif

        // mix the colors and opacities
        vec3 color = tColor0 * mix(vec3(1.0), tColor1, pwfValue1);
        color = applyAllLightning(color, opacity0, posIS, normalLight0);
        return vec4(color, opacity0);
`;default:return null}}function m8(t,e){e.classHierarchy.push("vtkOpenGLVolumeMapper");function n(i){[e._scalars,e._scalarOpacityFunc,e._colorTransferFunc,e._labelOutlineThicknessArray].forEach(a=>i.unregisterGraphicsResourceUser(a,t))}t.buildPass=()=>{e.zBufferTexture=null},t.zBufferPass=(i,a)=>{if(i){const s=a.getZBufferTexture();s!==e.zBufferTexture&&(e.zBufferTexture=s)}},t.opaqueZBufferPass=(i,a)=>t.zBufferPass(i,a),t.volumePass=(i,a)=>{if(i){const s=e._openGLRenderWindow;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),s&&!s.isDeleted()&&s!==e._openGLRenderWindow&&n(s),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.jitterTexture.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLVolume=t.getFirstAncestorOfType("vtkOpenGLVolume");const o=e.openGLVolume.getRenderable();e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const c=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(c.getActiveCamera()),t.renderPiece(c,o)}},t.getShaderTemplate=(i,a,s)=>{i.Vertex=g8,i.Fragment=h8,i.Geometry=""},t.useIndependentComponents=i=>{var l,u;const a=i.getIndependentComponents(),s=e.currentInput,o=(u=(l=s==null?void 0:s.getPointData())==null?void 0:l.getScalars())==null?void 0:u.getNumberOfComponents(),c=i.getColorMixPreset();return a&&o>=2||!!c},t.replaceShaderValues=(i,a,s)=>{const o=s.getProperty();let c=i.Fragment;o.getInterpolationType()===T0.LINEAR&&(c=B.substitute(c,"//VTK::TrilinearOn","#define vtkTrilinearOn").result),t.isLabelmapOutlineRequired(s)===!0&&(c=B.substitute(c,"//VTK::ImageLabelOutlineOn","#define vtkImageLabelOutlineOn").result),e.renderable.getBlendMode()===vi.LABELMAP_EDGE_PROJECTION_BLEND&&(c=B.substitute(c,"//VTK::LabelEdgeProjectionOn","#define vtkLabelEdgeProjectionOn").result);const g=e.scalarTexture.getComponents();c=B.substitute(c,"//VTK::NumComponents",`#define vtkNumComponents ${g}`).result;const h=t.useIndependentComponents(o);h&&(c=B.substitute(c,"//VTK::IndependentComponentsOn","#define UseIndependentComponents").result);const p=[],d=[];for(let E=0;E<g;E++)o.getOpacityMode(E)===hl.PROPORTIONAL&&p.push(`#define vtkComponent${E}Proportional`),o.getForceNearestInterpolation(E)&&d.push(`#define vtkComponent${E}ForceNearest`);c=B.substitute(c,"//VTK::vtkProportionalComponents",p.join(`
`)).result,c=B.substitute(c,"//VTK::vtkForceNearestComponents",d.join(`
`)).result;const m=o.getColorMixPreset(),y=d8(m);y&&(c=B.substitute(c,"//VTK::CustomComponentsColorMixOn","#define vtkCustomComponentsColorMix").result,c=B.substitute(c,"//VTK::CustomComponentsColorMix::Impl",y).result);const T=e.currentInput.getSpatialExtent(),v=e.currentInput.getSpacing(),C=new Float64Array(3);ce(C,(T[1]-T[0])*v[0],(T[3]-T[2])*v[1],(T[5]-T[4])*v[2]);const x=en(C)/t.getCurrentSampleDistance(a);c=B.substitute(c,"//VTK::MaximumSamplesValue",`${Math.ceil(x)}`).result,c=B.substitute(c,"//VTK::LightComplexity",`#define vtkLightComplexity ${e.lightComplexity}`).result,e.lightComplexity>0&&(e.renderable.getVolumetricScatteringBlending()>0&&(c=B.substitute(c,"//VTK::VolumeShadowOn","#define VolumeShadowOn").result),e.renderable.getVolumetricScatteringBlending()<1&&(c=B.substitute(c,"//VTK::SurfaceShadowOn","#define SurfaceShadowOn").result),e.renderable.getLocalAmbientOcclusion()&&o.getAmbient()>0&&(c=B.substitute(c,"//VTK::localAmbientOcclusionOn","#define localAmbientOcclusionOn").result));const w=h?g:1;e.gopacity=!1;for(let E=0;!e.gopacity&&E<w;++E)e.gopacity||(e.gopacity=o.getUseGradientOpacity(E));e.gopacity&&(c=B.substitute(c,"//VTK::GradientOpacityOn","#define vtkGradientOpacityOn").result),e.renderable.getComputeNormalFromOpacity()&&(c=B.substitute(c,"//VTK::vtkComputeNormalFromOpacity","#define vtkComputeNormalFromOpacity").result),e.zBufferTexture!==null&&(c=B.substitute(c,"//VTK::ZBuffer::Dec",["uniform sampler2D zBufferTexture;","uniform float vpZWidth;","uniform float vpZHeight;"]).result,c=B.substitute(c,"//VTK::ZBuffer::Impl",["vec4 depthVec = texture2D(zBufferTexture, vec2(gl_FragCoord.x / vpZWidth, gl_FragCoord.y/vpZHeight));","float zdepth = (depthVec.r*256.0 + depthVec.g)/257.0;","zdepth = zdepth * 2.0 - 1.0;","if (cameraParallel == 0) {","zdepth = -2.0 * camFar * camNear / (zdepth*(camFar-camNear)-(camFar+camNear)) - camNear;}","else {",`zdepth = (zdepth + 1.0) * 0.5 * (camFar - camNear);}
`,"zdepth = -zdepth/rayDir.z;","dists.y = min(zdepth,dists.y);"]).result),c=B.substitute(c,"//VTK::BlendMode",`${e.renderable.getBlendMode()}`).result,i.Fragment=c,t.replaceShaderLight(i,a,s),t.replaceShaderClippingPlane(i,a,s)},t.replaceShaderLight=(i,a,s)=>{if(e.lightComplexity===0)return;let o=i.Fragment,c=0;a.getLights().forEach(l=>{l.getSwitch()&&(c+=1)}),o=B.substitute(o,"//VTK::Light::Dec",["uniform int lightNum;","uniform bool twoSidedLighting;",`uniform vec3 lightColor[${c}];`,`uniform vec3 lightDirectionVC[${c}]; // normalized`,`uniform vec3 lightHalfAngleVC[${c}];`,"//VTK::Light::Dec"],!1).result,e.lightComplexity===3&&(o=B.substitute(o,"//VTK::Light::Dec",[`uniform vec3 lightPositionVC[${c}];`,`uniform vec3 lightAttenuation[${c}];`,`uniform float lightConeAngle[${c}];`,`uniform float lightExponent[${c}];`,`uniform int lightPositional[${c}];`],!1).result),e.renderable.getVolumetricScatteringBlending()>0&&(o=B.substitute(o,"//VTK::VolumeShadow::Dec",["uniform float volumetricScatteringBlending;","uniform float giReach;","uniform float volumeShadowSamplingDistFactor;","uniform float anisotropy;","uniform float anisotropy2;"],!1).result),e.renderable.getLocalAmbientOcclusion()&&s.getProperty().getAmbient()>0&&(o=B.substitute(o,"//VTK::LAO::Dec",["uniform int kernelRadius;",`uniform vec2 kernelSample[${e.renderable.getLAOKernelRadius()}];`,"uniform int kernelSize;"],!1).result),i.Fragment=o},t.replaceShaderClippingPlane=(i,a,s)=>{let o=i.Fragment;if(e.renderable.getClippingPlanes().length>0){const c=e.renderable.getClippingPlanes().length;o=B.substitute(o,"//VTK::ClipPlane::Dec",["uniform vec3 vClipPlaneNormals[6];","uniform float vClipPlaneDistances[6];","uniform vec3 vClipPlaneOrigins[6];","uniform int clip_numPlanes;","//VTK::ClipPlane::Dec","#define vtkClippingPlanesOn"],!1).result,o=B.substitute(o,"//VTK::ClipPlane::Impl",[`for(int i = 0; i < ${c}; i++) {`,"  float rayDirRatio = dot(rayDir, vClipPlaneNormals[i]);","  float equationResult = dot(vertexVCVSOutput, vClipPlaneNormals[i]) + vClipPlaneDistances[i];","  if (rayDirRatio == 0.0)","  {","    if (equationResult < 0.0) dists.x = dists.y;","    continue;","  }","  float result = -1.0 * equationResult / rayDirRatio;","  if (rayDirRatio < 0.0) dists.y = min(dists.y, result);","  else dists.x = max(dists.x, result);","}","//VTK::ClipPlane::Impl"],!1).result}i.Fragment=o};const r=(i,a)=>{let s=0;i.getProperty().getShade()&&e.renderable.getBlendMode()===vi.COMPOSITE_BLEND&&(s=0,e.numberOfLights=0,a.forEach(o=>{o.getSwitch()>0&&(e.numberOfLights++,s===0&&(s=1)),s===1&&(e.numberOfLights>1||o.getIntensity()!==1||!o.lightTypeIsHeadLight())&&(s=2),s<3&&o.getPositional()&&(s=3)})),s!==e.lightComplexity&&(e.lightComplexity=s,t.modified())};t.getNeedToRebuildShaders=(i,a,s)=>{var y;const o=s.getProperty();r(s,a.getLights());const c=e.scalarTexture.getComponents(),l=[],u=[];for(let T=0;T<c;T++)l.push(o.getOpacityMode(T)),u.push(o.getForceNearestInterpolation(T));const f=e.currentInput.getSpatialExtent(),g=e.currentInput.getSpacing(),h=new Float64Array(3);ce(h,(f[1]-f[0])*g[0],(f[3]-f[2])*g[1],(f[5]-f[4])*g[2]);const p=en(h)/t.getCurrentSampleDistance(a),d=!!e.zBufferTexture,m={iComps:o.getIndependentComponents(),colorMixPreset:o.getColorMixPreset(),interpolationType:o.getInterpolationType(),useLabelOutline:t.isLabelmapOutlineRequired(s),numComp:c,maxSamples:p,useGradientOpacity:o.getUseGradientOpacity(0),blendMode:e.renderable.getBlendMode(),hasZBufferTexture:d,opacityModes:l,forceNearestInterps:u};return((y=i.getProgram())==null?void 0:y.getHandle())===0||i.getShaderSourceTime().getMTime()<t.getMTime()||i.getShaderSourceTime().getMTime()<e.renderable.getMTime()||!e.previousState||!Oc(e.previousState,m)?(e.previousState=m,!0):!1},t.updateShaders=(i,a,s)=>{if(t.getNeedToRebuildShaders(i,a,s)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,a,s);const c=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);c!==i.getProgram()&&(i.setProgram(c),i.getVAO().releaseGraphicsResources()),i.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(i.getProgram());i.getVAO().bind(),t.setMapperShaderParameters(i,a,s),t.setCameraShaderParameters(i,a,s),t.setPropertyShaderParameters(i,a,s),t.getClippingPlaneShaderParameters(i,a,s)},t.setMapperShaderParameters=(i,a,s)=>{var u;const o=i.getProgram();i.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>i.getAttributeUpdateTime().getMTime()||i.getShaderSourceTime().getMTime()>i.getAttributeUpdateTime().getMTime())&&(o.isAttributeUsed("vertexDC")&&(i.getVAO().addAttributeArray(o,i.getCABO(),"vertexDC",i.getCABO().getVertexOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||$a("Error setting vertexDC in shader VAO.")),i.getAttributeUpdateTime().modified()),o.setUniformi("texture1",e.scalarTexture.getTextureUnit()),o.setUniformf("sampleDistance",t.getCurrentSampleDistance(a));const c=e.scalarTexture.getVolumeInfo(),l=e.renderable.getIpScalarRange();if((u=c==null?void 0:c.dataComputedScale)!=null&&u.length){const f=[],g=[];for(let h=0;h<4;h++)f[h]=l[0]*c.dataComputedScale[h]+c.dataComputedOffset[h],g[h]=l[1]*c.dataComputedScale[h]+c.dataComputedOffset[h],f[h]=(f[h]-c.offset[h])/c.scale[h],g[h]=(g[h]-c.offset[h])/c.scale[h];o.setUniform4f("ipScalarRangeMin",f[0],f[1],f[2],f[3]),o.setUniform4f("ipScalarRangeMax",g[0],g[1],g[2],g[3])}if(e.zBufferTexture!==null){o.setUniformi("zBufferTexture",e.zBufferTexture.getTextureUnit());const f=e._useSmallViewport?[e._smallViewportWidth,e._smallViewportHeight]:e._openGLRenderWindow.getFramebufferSize();o.setUniformf("vpZWidth",f[0]),o.setUniformf("vpZHeight",f[1])}},t.setCameraShaderParameters=(i,a,s)=>{const o=e.openGLCamera.getKeyMatrices(a),c=e.openGLVolume.getKeyMatrices();se(e.modelToView,o.wcvc,c.mcwc);const l=i.getProgram(),u=e.openGLCamera.getRenderable(),f=u.getClippingRange();l.setUniformf("camThick",f[1]-f[0]),l.setUniformf("camNear",f[0]),l.setUniformf("camFar",f[1]);const g=e.currentInput.getBounds(),h=e.currentInput.getDimensions(),p=new Float64Array(3),d=new Float64Array(3);let m=1,y=-1,T=1,v=-1;for(let b=0;b<8;++b){if(ce(p,g[b%2],g[2+Math.floor(b/2)%2],g[4+Math.floor(b/4)]),pe(p,p,e.modelToView),!u.getParallelProjection()){_e(d,p);const W=-f[0]/p[2];tn(p,d,W)}pe(p,p,o.vcpc),m=Math.min(p[0],m),y=Math.max(p[0],y),T=Math.min(p[1],T),v=Math.max(p[1],v)}l.setUniformf("dcxmin",m),l.setUniformf("dcxmax",y),l.setUniformf("dcymin",T),l.setUniformf("dcymax",v),l.isUniformUsed("cameraParallel")&&l.setUniformi("cameraParallel",u.getParallelProjection());const C=e.currentInput.getSpatialExtent(),x=e.currentInput.getSpacing(),w=new Float64Array(3);ce(w,(C[1]-C[0])*x[0],(C[3]-C[2])*x[1],(C[5]-C[4])*x[2]),l.setUniform3f("vSpacing",x[0],x[1],x[2]),ce(p,C[0],C[2],C[4]),e.currentInput.indexToWorldVec3(p,p),pe(p,p,e.modelToView),l.setUniform3f("vOriginVC",p[0],p[1],p[2]);const E=e.currentInput.getIndexToWorld();se(e.idxToView,e.modelToView,E),po(e.idxNormalMatrix,o.normalMatrix,c.normalMatrix),po(e.idxNormalMatrix,e.idxNormalMatrix,e.currentInput.getDirectionByReference());const O=en(w)/t.getCurrentSampleDistance(a);O>e.renderable.getMaximumSamplesPerRay()&&p8(`The number of steps required ${Math.ceil(O)} is larger than the
        specified maximum number of steps ${e.renderable.getMaximumSamplesPerRay()}.
        Please either change the
        volumeMapper sampleDistance or its maximum number of samples.`);const D=new Float64Array(3);if(ce(D,1,1,1),D4(D,D,w),l.setUniform3f("vVCToIJK",D[0],D[1],D[2]),l.setUniform3i("volumeDimensions",h[0],h[1],h[2]),l.setUniform3f("volumeSpacings",x[0],x[1],x[2]),!e._openGLRenderWindow.getWebgl2()){const b=e.scalarTexture.getVolumeInfo();l.setUniformf("texWidth",e.scalarTexture.getWidth()),l.setUniformf("texHeight",e.scalarTexture.getHeight()),l.setUniformi("xreps",b.xreps),l.setUniformi("xstride",b.xstride),l.setUniformi("ystride",b.ystride)}const S=new Float64Array(3),M=new Float64Array(3);for(let b=0;b<6;++b){switch(b){case 1:ce(S,-1,0,0),ce(M,C[0],C[2],C[4]);break;case 2:ce(S,0,1,0),ce(M,C[1],C[3],C[5]);break;case 3:ce(S,0,-1,0),ce(M,C[0],C[2],C[4]);break;case 4:ce(S,0,0,1),ce(M,C[1],C[3],C[5]);break;case 5:ce(S,0,0,-1),ce(M,C[0],C[2],C[4]);break;case 0:default:ce(S,1,0,0),ce(M,C[1],C[3],C[5]);break}Ei(S,S,e.idxNormalMatrix),pe(M,M,e.idxToView);const W=-1*fe(M,S);l.setUniform3f(`vPlaneNormal${b}`,S[0],S[1],S[2]),l.setUniformf(`vPlaneDistance${b}`,W)}if(t.isLabelmapOutlineRequired(s)){const W=e.currentInput.getWorldToIndex();l.setUniformMatrix("vWCtoIDX",W);const _=a.getActiveCamera(),[N,I]=_.getClippingRange(),U=_.getDistance();_.setClippingRange(U,U+.1);const G=e.openGLCamera.getKeyMatrices(a);ke(e.projectionToWorld,G.wcpc),_.setClippingRange(N,I),e.openGLCamera.getKeyMatrices(a),l.setUniformMatrix("PCWCMatrix",e.projectionToWorld);const P=t.getRenderTargetSize();l.setUniformf("vpWidth",P[0]),l.setUniformf("vpHeight",P[1]);const ee=t.getRenderTargetOffset();l.setUniformf("vpOffsetX",ee[0]/P[0]),l.setUniformf("vpOffsetY",ee[1]/P[1])}if(ke(e.projectionToView,o.vcpc),l.setUniformMatrix("PCVCMatrix",e.projectionToView),e.lightComplexity===0)return;let V=0;const L=[],F=[],k=[];if(a.getLights().forEach(b=>{if(b.getSwitch()>0){const _=b.getColor(),N=b.getIntensity();L[0+V*3]=_[0]*N,L[1+V*3]=_[1]*N,L[2+V*3]=_[2]*N;const I=b.getDirection();ce(S,I[0],I[1],I[2]),Ei(S,S,o.normalMatrix),_e(S,S),F[0+V*3]=S[0],F[1+V*3]=S[1],F[2+V*3]=S[2],k[0+V*3]=-.5*S[0],k[1+V*3]=-.5*S[1],k[2+V*3]=-.5*(S[2]-1),V++}}),l.setUniformi("twoSidedLighting",a.getTwoSidedLighting()),l.setUniformi("lightNum",V),l.setUniform3fv("lightColor",L),l.setUniform3fv("lightDirectionVC",F),l.setUniform3fv("lightHalfAngleVC",k),e.lightComplexity===3){V=0;const b=[],W=[],_=[],N=[],I=[];a.getLights().forEach(U=>{if(U.getSwitch()>0){const P=U.getAttenuationValues();W[0+V*3]=P[0],W[1+V*3]=P[1],W[2+V*3]=P[2],N[V]=U.getExponent(),_[V]=U.getConeAngle(),I[V]=U.getPositional();const ee=U.getTransformedPosition();pe(ee,ee,e.modelToView),b[0+V*3]=ee[0],b[1+V*3]=ee[1],b[2+V*3]=ee[2],V+=1}}),l.setUniform3fv("lightPositionVC",b),l.setUniform3fv("lightAttenuation",W),l.setUniformfv("lightConeAngle",_),l.setUniformfv("lightExponent",N),l.setUniformiv("lightPositional",I)}if(e.renderable.getVolumetricScatteringBlending()>0&&(l.setUniformf("giReach",e.renderable.getGlobalIlluminationReach()),l.setUniformf("volumetricScatteringBlending",e.renderable.getVolumetricScatteringBlending()),l.setUniformf("volumeShadowSamplingDistFactor",e.renderable.getVolumeShadowSamplingDistFactor()),l.setUniformf("anisotropy",e.renderable.getAnisotropy()),l.setUniformf("anisotropy2",e.renderable.getAnisotropy()**2)),e.renderable.getLocalAmbientOcclusion()&&s.getProperty().getAmbient()>0){const b=e.renderable.getLAOKernelSize();l.setUniformi("kernelSize",b);const W=[];for(let _=0;_<b;_++)W[_*2]=Math.random()*.5,W[_*2+1]=Math.random()*.5;l.setUniform2fv("kernelSample",W),l.setUniformi("kernelRadius",e.renderable.getLAOKernelRadius())}},t.setPropertyShaderParameters=(i,a,s)=>{const o=i.getProgram();o.setUniformi("ctexture",e.colorTexture.getTextureUnit()),o.setUniformi("otexture",e.opacityTexture.getTextureUnit()),o.setUniformi("jtexture",e.jitterTexture.getTextureUnit()),o.setUniformi("ttexture",e.labelOutlineThicknessTexture.getTextureUnit());const c=e.scalarTexture.getVolumeInfo(),l=s.getProperty(),u=e.scalarTexture.getComponents(),f=t.useIndependentComponents(l);if(f)for(let h=0;h<u;h++)o.setUniformf(`mix${h}`,s.getProperty().getComponentWeight(h));for(let h=0;h<u;h++){const p=f?h:0,d=c.scale[h],y=l.getScalarOpacity(p).getRange(),T=d/(y[1]-y[0]),v=(c.offset[h]-y[0])/(y[1]-y[0]);o.setUniformf(`oshift${h}`,v),o.setUniformf(`oscale${h}`,T);const x=l.getRGBTransferFunction(p).getRange(),w=(c.offset[h]-x[0])/(x[1]-x[0]),E=d/(x[1]-x[0]);o.setUniformf(`cshift${h}`,w),o.setUniformf(`cscale${h}`,E)}if(e.gopacity)if(f)for(let h=0;h<u;++h){const p=c.scale[h];if(l.getUseGradientOpacity(h)){const m=l.getGradientOpacityMinimumOpacity(h),y=l.getGradientOpacityMaximumOpacity(h);o.setUniformf(`gomin${h}`,m),o.setUniformf(`gomax${h}`,y);const T=[l.getGradientOpacityMinimumValue(h),l.getGradientOpacityMaximumValue(h)];o.setUniformf(`goscale${h}`,p*(y-m)/(T[1]-T[0])),o.setUniformf(`goshift${h}`,-T[0]*(y-m)/(T[1]-T[0])+m)}else o.setUniformf(`gomin${h}`,1),o.setUniformf(`gomax${h}`,1),o.setUniformf(`goscale${h}`,0),o.setUniformf(`goshift${h}`,1)}else{const h=c.scale[u-1],p=l.getGradientOpacityMinimumOpacity(0),d=l.getGradientOpacityMaximumOpacity(0);o.setUniformf("gomin0",p),o.setUniformf("gomax0",d);const m=[l.getGradientOpacityMinimumValue(0),l.getGradientOpacityMaximumValue(0)];o.setUniformf("goscale0",h*(d-p)/(m[1]-m[0])),o.setUniformf("goshift0",-m[0]*(d-p)/(m[1]-m[0])+p)}if(t.isLabelmapOutlineRequired(s)===!0){const h=s.getProperty().getLabelOutlineOpacity();o.setUniformf("outlineOpacity",h)}e.lightComplexity>0&&(o.setUniformf("vAmbient",l.getAmbient()),o.setUniformf("vDiffuse",l.getDiffuse()),o.setUniformf("vSpecular",l.getSpecular()),o.setUniformf("vSpecularPower",l.getSpecularPower()))},t.getClippingPlaneShaderParameters=(i,a,s)=>{if(e.renderable.getClippingPlanes().length>0){const o=e.openGLCamera.getKeyMatrices(a),c=[],l=[],u=[],f=e.renderable.getClippingPlanes(),g=f.length;for(let p=0;p<g;++p){const d=f[p].getNormal(),m=f[p].getOrigin();Ei(d,d,o.normalMatrix),pe(m,m,o.wcvc);const y=-1*fe(m,d);c.push(d[0]),c.push(d[1]),c.push(d[2]),l.push(y),u.push(m[0]),u.push(m[1]),u.push(m[2])}const h=i.getProgram();h.setUniform3fv("vClipPlaneNormals",c),h.setUniformfv("vClipPlaneDistances",l),h.setUniform3fv("vClipPlaneOrigins",u),h.setUniformi("clip_numPlanes",g)}},t.delete=Kr(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete),t.getRenderTargetSize=()=>{if(e._useSmallViewport)return[e._smallViewportWidth,e._smallViewportHeight];const{usize:i,vsize:a}=e._openGLRenderer.getTiledSizeAndOrigin();return[i,a]},t.getRenderTargetOffset=()=>{const{lowerLeftU:i,lowerLeftV:a}=e._openGLRenderer.getTiledSizeAndOrigin();return[i,a]},t.getCurrentSampleDistance=i=>{const a=i.getVTKWindow().getInteractor(),s=e.renderable.getSampleDistance();if(a.isAnimating()){const o=e.renderable.getInteractionSampleDistanceFactor();return s*o}return s},t.renderPieceStart=(i,a)=>{const s=i.getVTKWindow().getInteractor();if(e._lastScale||(e._lastScale=e.renderable.getInitialInteractionScale()),e._useSmallViewport=!1,s.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._animationRateSubscription||(e._animationRateSubscription=s.onAnimationFrameRateUpdate(()=>{if(e.renderable.getAutoAdjustSampleDistances()){const c=s.getRecentAnimationFrameRate(),l=s.getDesiredUpdateRate()/c;(l>1.15||l<.85)&&(e._lastScale*=l),e._lastScale>400&&(e._lastScale=400),e._lastScale<1.5&&(e._lastScale=1.5)}else e._lastScale=e.renderable.getImageSampleDistance()*e.renderable.getImageSampleDistance()})),e._useSmallViewport){const c=e._openGLRenderWindow.getFramebufferSize(),l=1/Math.sqrt(e._lastScale);if(e._smallViewportWidth=Math.ceil(l*c[0]),e._smallViewportHeight=Math.ceil(l*c[1]),e._smallViewportHeight>c[1]&&(e._smallViewportHeight=c[1]),e._smallViewportWidth>c[0]&&(e._smallViewportWidth=c[0]),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.getGLFramebuffer()===null)e.framebuffer.create(c[0],c[1]),e.framebuffer.populateFramebuffer();else{const f=e.framebuffer.getSize();(!f||f[0]!==c[0]||f[1]!==c[1])&&(e.framebuffer.create(c[0],c[1]),e.framebuffer.populateFramebuffer())}e.framebuffer.bind();const u=e.context;u.clearColor(0,0,0,0),u.colorMask(!0,!0,!0,!0),u.clear(u.COLOR_BUFFER_BIT),u.viewport(0,0,e._smallViewportWidth,e._smallViewportHeight),e.fvp=[e._smallViewportWidth/c[0],e._smallViewportHeight/c[1]]}e.context.disable(e.context.DEPTH_TEST),t.updateBufferObjects(i,a),a.getProperty().getInterpolationType()===T0.NEAREST?(e.scalarTexture.setMinificationFilter(K.NEAREST),e.scalarTexture.setMagnificationFilter(K.NEAREST)):(e.scalarTexture.setMinificationFilter(K.LINEAR),e.scalarTexture.setMagnificationFilter(K.LINEAR)),e.zBufferTexture!==null&&e.zBufferTexture.activate()},t.renderPieceDraw=(i,a)=>{const s=e.context;e.scalarTexture.activate(),e.opacityTexture.activate(),e.labelOutlineThicknessTexture.activate(),e.colorTexture.activate(),e.jitterTexture.activate(),t.updateShaders(e.tris,i,a),s.drawArrays(s.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.scalarTexture.deactivate(),e.colorTexture.deactivate(),e.opacityTexture.deactivate(),e.labelOutlineThicknessTexture.deactivate(),e.jitterTexture.deactivate()},t.renderPieceFinish=(i,a)=>{if(e.zBufferTexture!==null&&e.zBufferTexture.deactivate(),e._useSmallViewport){if(e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null){e.copyShader=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","uniform vec2 tfactor;","varying vec2 tcoord;","void main() { tcoord = vec2(vertexDC.x*0.5 + 0.5, vertexDC.y*0.5 + 0.5) * tfactor; gl_Position = vertexDC; }"].join(`
`),["//VTK::System::Dec","//VTK::Output::Dec","uniform sampler2D texture1;","varying vec2 tcoord;","void main() { gl_FragData[0] = texture2D(texture1,tcoord); }"].join(`
`),"");const l=e.copyShader;e.copyVAO=v2.newInstance(),e.copyVAO.setOpenGLRenderWindow(e._openGLRenderWindow),e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(l,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||$a("Error setting vertexDC in copy shader VAO.")}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.copyShader);const s=e._openGLRenderWindow.getFramebufferSize();e.context.viewport(0,0,s[0],s[1]);const o=e.framebuffer.getColorTexture();o.activate(),e.copyShader.setUniformi("texture",o.getTextureUnit()),e.copyShader.setUniform2f("tfactor",e.fvp[0],e.fvp[1]);const c=e.context;c.blendFuncSeparate(c.ONE,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),o.deactivate(),c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)}},t.renderPiece=(i,a)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent({type:"EndEvent"}),!e.currentInput){$a("No input!");return}t.renderPieceStart(i,a),t.renderPieceDraw(i,a),t.renderPieceFinish(i,a)},t.computeBounds=(i,a)=>{if(!t.getInput()){ya(e.Bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(i,a)=>{t.getNeedToRebuildBufferObjects(i,a)&&t.buildBufferObjects(i,a)},t.getNeedToRebuildBufferObjects=(i,a)=>{var s,o,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||!((s=e.scalarTexture)!=null&&s.getHandle())||!((o=e.colorTexture)!=null&&o.getHandle())||!((c=e.labelOutlineThicknessTexture)!=null&&c.getHandle())},t.buildBufferObjects=(i,a)=>{var x,w;const s=e.currentInput;if(!s)return;const o=s.getPointData()&&s.getPointData().getScalars();if(!o)return;const c=a.getProperty();if(!e.jitterTexture.getHandle()){const E=new Uint8Array(1024);for(let O=0;O<32*32;++O)E[O]=255*Math.random();e.jitterTexture.setMinificationFilter(K.LINEAR),e.jitterTexture.setMagnificationFilter(K.LINEAR),e.jitterTexture.create2DFromRaw(32,32,1,me.UNSIGNED_CHAR,E)}const l=o.getNumberOfComponents(),u=t.useIndependentComponents(c),f=u?l:1,g=c.getScalarOpacity(),h=e._openGLRenderWindow.getGraphicsResourceForObject(g);let p=an(g,u,f);if(!(h!=null&&h.oglObject)||h.hash!==p){e.opacityTexture=Ue.newInstance(),e.opacityTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const E=1024,O=E*2*f,D=new Float32Array(O),S=new Float32Array(E);for(let M=0;M<f;++M){const V=c.getScalarOpacity(M),L=t.getCurrentSampleDistance(i)/c.getScalarOpacityUnitDistance(M),F=V.getRange();V.getTable(F[0],F[1],E,S,1);for(let k=0;k<E;++k)D[M*E*2+k]=1-(1-S[k])**L,D[M*E*2+k+E]=D[M*E*2+k]}if(e.opacityTexture.resetFormatAndType(),e.opacityTexture.setMinificationFilter(K.LINEAR),e.opacityTexture.setMagnificationFilter(K.LINEAR),e._openGLRenderWindow.getWebgl2()||e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))e.opacityTexture.create2DFromRaw(E,2*f,1,me.FLOAT,D);else{const M=new Uint8ClampedArray(O);for(let V=0;V<O;++V)M[V]=255*D[V];e.opacityTexture.create2DFromRaw(E,2*f,1,me.UNSIGNED_CHAR,M)}g&&(e._openGLRenderWindow.setGraphicsResourceForObject(g,e.opacityTexture,p),g!==e._scalarOpacityFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(g,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalarOpacityFunc,t)),e._scalarOpacityFunc=g)}else e.opacityTexture=h.oglObject;const m=c.getRGBTransferFunction();p=an(m,u,f);const y=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((x=y==null?void 0:y.oglObject)!=null&&x.getHandle())||(y==null?void 0:y.hash)!==p){e.colorTexture=Ue.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const E=1024,O=E*2*f*3,D=new Uint8ClampedArray(O),S=new Float32Array(E*3);for(let M=0;M<f;++M){const V=c.getRGBTransferFunction(M),L=V.getRange();V.getTable(L[0],L[1],E,S,1);for(let F=0;F<E*3;++F)D[M*E*6+F]=255*S[F],D[M*E*6+F+E*3]=255*S[F]}e.colorTexture.resetFormatAndType(),e.colorTexture.setMinificationFilter(K.LINEAR),e.colorTexture.setMagnificationFilter(K.LINEAR),e.colorTexture.create2DFromRaw(E,2*f,3,me.UNSIGNED_CHAR,D),m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,p),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=y.oglObject;t.updateLabelOutlineThicknessTexture(a);const v=e._openGLRenderWindow.getGraphicsResourceForObject(o);if(p=vs(s,o),!((w=v==null?void 0:v.oglObject)!=null&&w.getHandle())||(v==null?void 0:v.hash)!==p){e.scalarTexture=Ue.newInstance(),e.scalarTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const E=s.getDimensions();e.scalarTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.scalarTexture.resetFormatAndType(),e.scalarTexture.create3DFilterableFromDataArray(E[0],E[1],E[2],o,e.renderable.getPreferSizeOverAccuracy()),o&&(e._openGLRenderWindow.setGraphicsResourceForObject(o,e.scalarTexture,p),o!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(o,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=o)}else e.scalarTexture=v.oglObject;if(!e.tris.getCABO().getElementCount()){const E=new Float32Array(12);for(let M=0;M<4;M++)E[M*3]=M%2*2-1,E[M*3+1]=M>1?1:-1,E[M*3+2]=-1;const O=new Uint16Array(8);O[0]=3,O[1]=0,O[2]=1,O[3]=3,O[4]=3,O[5]=0,O[6]=3,O[7]=2;const D=oe.newInstance({numberOfComponents:3,values:E});D.setName("points");const S=oe.newInstance({numberOfComponents:1,values:O});e.tris.getCABO().createVBO(S,"polys",St.SURFACE,{points:D,cellOffset:0})}e.VBOBuildTime.modified()},t.updateLabelOutlineThicknessTexture=i=>{var l;const a=i.getProperty().getLabelOutlineThickness(),s=e._openGLRenderWindow.getGraphicsResourceForObject(a),o=`${a.join("-")}`;if(!((l=s==null?void 0:s.oglObject)!=null&&l.getHandle())||(s==null?void 0:s.hash)!==o){e.labelOutlineThicknessTexture=Ue.newInstance(),e.labelOutlineThicknessTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const u=1024,f=1,g=u*f,h=new Uint8Array(g);for(let p=0;p<u;++p){const d=typeof a[p]<"u"?a[p]:a[0];h[p]=d}e.labelOutlineThicknessTexture.resetFormatAndType(),e.labelOutlineThicknessTexture.setMinificationFilter(K.NEAREST),e.labelOutlineThicknessTexture.setMagnificationFilter(K.NEAREST),e.labelOutlineThicknessTexture.create2DFromRaw(u,f,1,me.UNSIGNED_CHAR,h),a&&(e._openGLRenderWindow.setGraphicsResourceForObject(a,e.labelOutlineThicknessTexture,o),a!==e._labelOutlineThicknessArray&&(e._openGLRenderWindow.registerGraphicsResourceUser(a,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._labelOutlineThicknessArray,t)),e._labelOutlineThicknessArray=a)}else e.labelOutlineThicknessTexture=s.oglObject},t.isLabelmapOutlineRequired=i=>{const a=i.getProperty(),s=e.renderable;return a.getUseLabelOutline()||s.getBlendMode()===vi.LABELMAP_EDGE_PROJECTION_BLEND}}const y8={context:null,VBOBuildTime:null,scalarTexture:null,opacityTexture:null,opacityTextureString:null,colorTexture:null,colorTextureString:null,jitterTexture:null,labelOutlineThicknessTexture:null,labelOutlineThicknessTextureString:null,tris:null,framebuffer:null,copyShader:null,copyVAO:null,lastXYF:1,targetXYF:1,zBufferTexture:null,lastZBufferTexture:null,lightComplexity:0,fullViewportTime:1,idxToView:null,idxNormalMatrix:null,modelToView:null,projectionToView:null,avgWindowArea:0,avgFrameTime:0};function v8(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,y8,n),Be.extend(t,e,n),Qn.implementBuildShadersWithReplacements(t,e,n),e.VBOBuildTime={},Re(e.VBOBuildTime,{mtime:0}),e.tris=Ca.newInstance(),e.jitterTexture=Ue.newInstance(),e.jitterTexture.setWrapS(_r.REPEAT),e.jitterTexture.setWrapT(_r.REPEAT),e.framebuffer=Z3.newInstance(),e.idxToView=X(new Float64Array(16)),e.idxNormalMatrix=va(new Float64Array(9)),e.modelToView=X(new Float64Array(16)),e.projectionToView=X(new Float64Array(16)),e.projectionToWorld=X(new Float64Array(16)),je(t,e,["context"]),m8(t,e)}const T8=Ie(v8,"vtkOpenGLVolumeMapper");Dt("vtkVolumeMapper",T8);function Ts(t,e){switch(t){case"Float32Array":return Float32Array;case"Uint8Array":return Uint8Array;case"Uint16Array":case"Int16Array":return e?(console.debug(`${t} is not supported for volume rendering, switching back to Float32Array`),Float32Array):t==="Uint16Array"?Uint16Array:Int16Array;default:if(t)throw new Error("TargetBuffer should be Float32Array, Uint8Array, Uint16Array, or Int16Array");return Float32Array}}function dl(t,e,n={}){const{isVolumeBuffer:r=!1}=n,i=Ts(t,r),a=i.BYTES_PER_ELEMENT;return{numBytes:e*a,TypedArrayConstructor:i}}function Ea(t){return Fr.get(t)}function Ma(){return Fr.getAll()}const ea=t=>t&&typeof t=="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"&&Object.prototype.toString.call(t)!=="[object Date]",C8=t=>Array.isArray(t)?[]:{},Ur=(t,e)=>e&&e.clone===!0&&ea(t)?Oa(C8(t),t,e):t,No=(t,e,n)=>{const r=t.slice();return e.forEach(function(i,a){typeof r[a]>"u"?r[a]=Ur(i,n):ea(i)?r[a]=Oa(t[a],i,n):t.indexOf(i)===-1&&(r[a]=Ur(i,n))}),r},x8=(t,e,n)=>{const r={};return ea(t)&&Object.keys(t).forEach(function(i){r[i]=Ur(t[i],n)}),Object.keys(e).forEach(function(i){!ea(e[i])||!t[i]?r[i]=Ur(e[i],n):r[i]=Oa(t[i],e[i],n)}),r},Oa=(t={},e={},n=void 0)=>{const r=Array.isArray(e),a=(n||{arrayMerge:No}).arrayMerge||No;return r?Array.isArray(t)?a(t,e,n):Ur(e,n):x8(t,e,n)};class w8{constructor(e){this.numRequests={[Q.Interaction]:0,[Q.Thumbnail]:0,[Q.Prefetch]:0,[Q.Compute]:0},this.id=e||Rt(),this.requestPool={[Q.Interaction]:{0:[]},[Q.Thumbnail]:{0:[]},[Q.Prefetch]:{0:[]},[Q.Compute]:{0:[]}},this.grabDelay=5,this.awake=!1,this.numRequests={[Q.Interaction]:0,[Q.Thumbnail]:0,[Q.Prefetch]:0,[Q.Compute]:0},this.maxNumRequests={[Q.Interaction]:6,[Q.Thumbnail]:6,[Q.Prefetch]:5,[Q.Compute]:1e3}}setMaxSimultaneousRequests(e,n){this.maxNumRequests[e]=n}getMaxSimultaneousRequests(e){return this.maxNumRequests[e]}destroy(){this.timeoutHandle&&window.clearTimeout(this.timeoutHandle)}addRequest(e,n,r,i=0){const a={requestFn:e,type:n,additionalDetails:r};this.requestPool[n][i]===void 0&&(this.requestPool[n][i]=[]),this.requestPool[n][i].push(a),this.startGrabbing()}filterRequests(e){Object.keys(this.requestPool).forEach(n=>{const r=this.requestPool[n];Object.keys(r).forEach(i=>{r[i]=r[i].filter(a=>e(a))})})}clearRequestStack(e){if(!this.requestPool[e])throw new Error(`No category for the type ${e} found`);this.requestPool[e]={0:[]}}sendRequests(e){const n=this.maxNumRequests[e]-this.numRequests[e];let r=0;for(let i=0;i<n;i++){const a=this.getNextRequest(e);if(a===null)return!1;if(a){this.numRequests[e]++,this.awake=!0;let s;try{s=a.requestFn()}catch(o){console.warn("sendRequest failed",o)}s!=null&&s.finally?s.finally(()=>{this.numRequests[e]--,this.startAgain()}):(this.numRequests[e]--,r++)}}return r&&this.startAgain(),!0}getNextRequest(e){const n=this.getSortedPriorityGroups(e);for(const r of n)if(this.requestPool[e][r].length)return this.requestPool[e][r].shift();return null}startGrabbing(){const e=this.sendRequests(Q.Interaction),n=this.sendRequests(Q.Thumbnail),r=this.sendRequests(Q.Prefetch),i=this.sendRequests(Q.Compute);!e&&!n&&!r&&!i&&(this.awake=!1)}startAgain(){this.awake&&(this.grabDelay!==void 0?this.timeoutHandle||(this.timeoutHandle=window.setTimeout(()=>{this.timeoutHandle=null,this.startGrabbing()},this.grabDelay)):this.startGrabbing())}getSortedPriorityGroups(e){return Object.keys(this.requestPool[e]).map(Number).filter(r=>this.requestPool[e][r].length).sort((r,i)=>r-i)}getRequestPool(){return this.requestPool}}const bo={gpuTier:{tier:2},isMobile:!1,rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,strictZSpacingForVolumeViewport:!0},peerImport:t=>null};let Cs={...bo,rendering:{...bo.rendering}};function S8(){return/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel")}function ml(){return!S8()}function Rr(){return Cs.rendering.useCPURendering}function xs(){return Cs}async function R8(t){return Cs.peerImport(t)}const{vtkDebugMacro:oi}=R;function E8(t,e){e.classHierarchy.push("vtkCamera");const n=new Float64Array(3),r=new Float64Array([0,0,-1]),i=new Float64Array([0,1,0]),a=X(new Float64Array(16)),s=X(new Float64Array(16)),o=new Float64Array(3),c=new Float64Array(3),l=new Float64Array(3),u=X(new Float64Array(16)),f=X(new Float64Array(16)),g=new Float64Array(3),h=new Float64Array(3);function p(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const d=t.getViewMatrix();e.viewUp[0]=d[4],e.viewUp[1]=d[5],e.viewUp[2]=d[6],t.modified()},t.setPosition=(d,m,y)=>{d===e.position[0]&&m===e.position[1]&&y===e.position[2]||(e.position[0]=d,e.position[1]=m,e.position[2]=y,t.computeDistance(),t.modified())},t.setFocalPoint=(d,m,y)=>{d===e.focalPoint[0]&&m===e.focalPoint[1]&&y===e.focalPoint[2]||(e.focalPoint[0]=d,e.focalPoint[1]=m,e.focalPoint[2]=y,t.computeDistance(),t.modified())},t.setDistance=d=>{if(e.distance===d)return;e.distance=d,e.distance<1e-20&&(e.distance=1e-20,oi("Distance is set to minimum."));const m=e.directionOfProjection;e.focalPoint[0]=e.position[0]+m[0]*e.distance,e.focalPoint[1]=e.position[1]+m[1]*e.distance,e.focalPoint[2]=e.position[2]+m[2]*e.distance,t.modified()},t.computeDistance=()=>{const d=e.focalPoint[0]-e.position[0],m=e.focalPoint[1]-e.position[1],y=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(d*d+m*m+y*y),e.distance<1e-20){e.distance=1e-20,oi("Distance is set to minimum.");const T=e.directionOfProjection;e.focalPoint[0]=e.position[0]+T[0]*e.distance,e.focalPoint[1]=e.position[1]+T[1]*e.distance,e.focalPoint[2]=e.position[2]+T[2]*e.distance}e.directionOfProjection[0]=d/e.distance,e.directionOfProjection[1]=m/e.distance,e.directionOfProjection[2]=y/e.distance,p()},t.dolly=d=>{if(d<=0)return;const m=e.distance/d;t.setPosition(e.focalPoint[0]-m*e.directionOfProjection[0],e.focalPoint[1]-m*e.directionOfProjection[1],e.focalPoint[2]-m*e.directionOfProjection[2])},t.roll=d=>{const m=e.position,y=e.focalPoint,T=e.viewUp,v=new Float64Array([T[0],T[1],T[2],0]);X(u);const C=new Float64Array([y[0]-m[0],y[1]-m[1],y[2]-m[2]]);ct(u,u,Fe(d),C),yn(v,v,u),e.viewUp[0]=v[0],e.viewUp[1]=v[1],e.viewUp[2]=v[2],t.modified()},t.azimuth=d=>{const m=e.focalPoint;X(f),Se(f,f,m),ct(f,f,Fe(d),e.viewUp),Se(f,f,[-m[0],-m[1],-m[2]]),pe(g,e.position,f),t.setPosition(g[0],g[1],g[2])},t.yaw=d=>{const m=e.position;X(f),Se(f,f,m),ct(f,f,Fe(d),e.viewUp),Se(f,f,[-m[0],-m[1],-m[2]]),pe(h,e.focalPoint,f),t.setFocalPoint(h[0],h[1],h[2])},t.elevation=d=>{const m=e.focalPoint,y=t.getViewMatrix(),T=[-y[0],-y[1],-y[2]];X(f),Se(f,f,m),ct(f,f,Fe(d),T),Se(f,f,[-m[0],-m[1],-m[2]]),pe(g,e.position,f),t.setPosition(g[0],g[1],g[2])},t.pitch=d=>{const m=e.position,y=t.getViewMatrix(),T=[y[0],y[1],y[2]];X(f),Se(f,f,m),ct(f,f,Fe(d),T),Se(f,f,[-m[0],-m[1],-m[2]]),pe(h,e.focalPoint,f),t.setFocalPoint(...h)},t.zoom=d=>{d<=0||(e.parallelProjection?e.parallelScale/=d:e.viewAngle/=d,t.modified())},t.translate=(d,m,y)=>{const T=[d,m,y];$i(e.position,T,e.position),$i(e.focalPoint,T,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=d=>{const m=[...e.viewUp,1],y=[],T=[],v=[];m[0]+=e.position[0],m[1]+=e.position[1],m[2]+=e.position[2],yn(y,[...e.position,1],d),yn(T,[...e.focalPoint,1],d),yn(v,m,d),v[0]-=y[0],v[1]-=y[1],v[2]-=y[2],t.setPosition(...y.slice(0,3)),t.setFocalPoint(...T.slice(0,3)),t.setViewUp(...v.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=d=>{let m=d;m<1e-20&&(m=1e-20,oi("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+m)},t.setThicknessFromFocalPoint=d=>{let m=d;m<1e-20&&(m=1e-20,oi("Thickness is set to minimum.")),t.setClippingRange(e.distance-m/2,e.distance+m/2)},t.setRoll=d=>{},t.getRoll=()=>{},t.setObliqueAngles=(d,m)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=d=>{},t.getCameraLightTransformMatrix=d=>(Oe(d,e.cameraLightTransform),d),t.computeCameraLightTransform=()=>{Oe(a,t.getViewMatrix()),ke(a,a),is(s,[e.distance,e.distance,e.distance]),se(a,a,s),X(e.cameraLightTransform),Se(e.cameraLightTransform,a,[0,0,-1])},t.deepCopy=d=>{},t.physicalOrientationToWorldDirection=d=>{const m=xo(d[0],d[1],d[2],d[3]),y=En(),T=xo(0,0,1,0);return _4(y,m),Co(T,m,T),Co(T,T,y),[T[0],T[1],T[2]]},t.getPhysicalToWorldMatrix=d=>{t.getWorldToPhysicalMatrix(d),ke(d,d)},t.getWorldToPhysicalMatrix=d=>{X(d);const m=[3];Et(e.physicalViewNorth,e.physicalViewUp,m),d[0]=m[0],d[1]=m[1],d[2]=m[2],d[4]=e.physicalViewUp[0],d[5]=e.physicalViewUp[1],d[6]=e.physicalViewUp[2],d[8]=-e.physicalViewNorth[0],d[9]=-e.physicalViewNorth[1],d[10]=-e.physicalViewNorth[2],ue(d,d),ce(o,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),Gt(d,d,o),Se(d,d,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=d=>{ke(a,d),pe(o,n,a),t.computeDistance();const m=e.distance;t.setPosition(o[0],o[1],o[2]),pe(c,r,a),Pe(c,c,o),_e(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),pe(l,i,a),Pe(l,l,o),_e(l,l),t.setViewUp(l[0],l[1],l[2]),t.setDistance(m)},t.computeViewParametersFromPhysicalMatrix=d=>{t.getWorldToPhysicalMatrix(a),se(a,d,a),t.computeViewParametersFromViewMatrix(a)},t.setViewMatrix=d=>{e.viewMatrix=d,e.viewMatrix&&(Oe(a,e.viewMatrix),t.computeViewParametersFromViewMatrix(a),ue(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.viewMatrix;t2(a,e.position,e.focalPoint,e.viewUp),ue(a,a);const d=new Float64Array(16);return Oe(d,a),d},t.setProjectionMatrix=d=>{e.projectionMatrix=d},t.getProjectionMatrix=(d,m,y)=>{const T=new Float64Array(16);if(X(T),e.projectionMatrix){const x=1/e.physicalScale;return ce(o,x,x,x),Oe(T,e.projectionMatrix),Gt(T,T,o),ue(T,T),T}X(a);const v=e.clippingRange[1]-e.clippingRange[0],C=[e.clippingRange[0]+(m+1)*v/2,e.clippingRange[0]+(y+1)*v/2];if(e.parallelProjection){const x=e.parallelScale*d,w=e.parallelScale,E=(e.windowCenter[0]-1)*x,O=(e.windowCenter[0]+1)*x,D=(e.windowCenter[1]-1)*w,S=(e.windowCenter[1]+1)*w;ss(a,E,O,D,S,C[0],C[1]),ue(a,a)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const x=Math.tan(Fe(e.viewAngle)/2);let w,E;e.useHorizontalViewAngle===!0?(w=e.clippingRange[0]*x,E=e.clippingRange[0]*x/d):(w=e.clippingRange[0]*x*d,E=e.clippingRange[0]*x);const O=(e.windowCenter[0]-1)*w,D=(e.windowCenter[0]+1)*w,S=(e.windowCenter[1]-1)*E,M=(e.windowCenter[1]+1)*E,V=C[0],L=C[1];a[0]=2*V/(D-O),a[5]=2*V/(M-S),a[2]=(O+D)/(D-O),a[6]=(S+M)/(M-S),a[10]=-(V+L)/(L-V),a[14]=-1,a[11]=-2*V*L/(L-V),a[15]=0}}return Oe(T,a),T},t.getCompositeProjectionMatrix=(d,m,y)=>{const T=t.getViewMatrix(),v=t.getProjectionMatrix(d,m,y);return se(v,T,v),v},t.setDirectionOfProjection=(d,m,y)=>{if(e.directionOfProjection[0]===d&&e.directionOfProjection[1]===m&&e.directionOfProjection[2]===y)return;e.directionOfProjection[0]=d,e.directionOfProjection[1]=m,e.directionOfProjection[2]=y;const T=e.directionOfProjection;e.focalPoint[0]=e.position[0]+T[0]*e.distance,e.focalPoint[1]=e.position[1]+T[1]*e.distance,e.focalPoint[2]=e.position[2]+T[2]*e.distance,p()},t.setDeviceAngles=(d,m,y,T)=>{const v=[3];Et(e.physicalViewNorth,e.physicalViewUp,v);const C=X(new Float64Array(16));ct(C,C,Fe(d),e.physicalViewUp),ct(C,C,Fe(m),v),ct(C,C,Fe(y),e.physicalViewNorth),ct(C,C,Fe(-T),e.physicalViewUp);const x=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),w=new Float64Array(e.physicalViewNorth);pe(x,x,C),pe(w,w,C),t.setDirectionOfProjection(x[0],x[1],x[2]),t.setViewUp(w[0],w[1],w[2]),t.modified()},t.setOrientationWXYZ=(d,m,y,T)=>{const v=X(new Float64Array(16));if(d!==0&&(m!==0||y!==0||T!==0)){const w=Fe(d),E=En();os(E,[m,y,T],w),Hi(v,E)}const C=new Float64Array(3);pe(C,[0,0,-1],v);const x=new Float64Array(3);pe(x,[0,1,0],v),t.setDirectionOfProjection(...C),t.setViewUp(...x),t.modified()},t.computeClippingRange=d=>{let m=null,y=null;m=e.viewPlaneNormal,y=e.position;const T=-m[0],v=-m[1],C=-m[2],x=-(T*y[0]+v*y[1]+C*y[2]),w=[T*d[0]+v*d[2]+C*d[4]+x,1e-18];for(let E=0;E<2;E++)for(let O=0;O<2;O++)for(let D=0;D<2;D++){const S=T*d[D]+v*d[2+O]+C*d[4+E]+x;w[0]=S<w[0]?S:w[0],w[1]=S>w[1]?S:w[1]}return w}}const M8={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:Dn(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function yl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,M8,n),R.obj(t,e),R.get(t,e,["distance"]),R.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),R.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),R.setGetArray(t,e,["clippingRange","windowCenter"],2),R.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),E8(t,e)}const O8=R.newInstance(yl,"vtkCamera");var vl={newInstance:O8,extend:yl};const{vtkErrorMacro:D8}=R,V8=[1,-1,1,-1,1,-1];function I8(t,e){e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==n&&(e.size=n*r,e.values=R.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(r),t.modified())},t.setPoint=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.setTuple(n,i)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(n,r,i)=>t.insertNextTuple([n,r,i]),t.getBounds=()=>{if(t.getNumberOfComponents()===3){const i=t.getRange(0);e.bounds[0]=i[0],e.bounds[1]=i[1];const a=t.getRange(1);e.bounds[2]=a[0],e.bounds[3]=a[1];const s=t.getRange(2);return e.bounds[4]=s[0],e.bounds[5]=s[1],e.bounds}if(t.getNumberOfComponents()!==2)return D8(`getBounds called on an array with components of
        ${t.getNumberOfComponents()}`),V8;const n=t.getRange(0);e.bounds[0]=n[0],e.bounds[1]=n[1];const r=t.getRange(1);return e.bounds[2]=r[0],e.bounds[3]=r[1],e.bounds[4]=0,e.bounds[5]=0,e.bounds},t.computeBounds=t.getBounds,t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const L8={empty:!0,numberOfComponents:3,dataType:me.FLOAT,bounds:[1,-1,1,-1,1,-1]};function Tl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,L8,n),oe.extend(t,e,n),I8(t,e)}const N8=R.newInstance(Tl,"vtkPoints");var C0={newInstance:N8,extend:Tl};function Cl(t){let e=0;return t.filter((n,r)=>r===e?(e+=n+1,!0):!1)}function xl(t){let e=0;for(let n=0;n<t.length;)n+=t[n]+1,e++;return e}const b8={extractCellSizes:Cl,getNumberOfCells:xl};function F8(t,e){e.classHierarchy.push("vtkCellArray");const n={...t};t.getNumberOfCells=r=>(e.numberOfCells!==void 0&&!r||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=xl(t.getData())),e.numberOfCells),t.getCellSizes=r=>(e.cellSizes!==void 0&&!r||(e.cellSizes=Cl(t.getData())),e.cellSizes),t.resize=r=>{const i=t.getNumberOfTuples();n.resize(r);const a=t.getNumberOfTuples();a<i&&(a===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=r=>{n.setData(r,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=r=>{let i=r;const a=e.values[i++];return e.values.subarray(i,i+a)},t.insertNextCell=r=>{const i=t.getNumberOfCells();return t.insertNextTuples([r.length,...r]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(r.length),i}}function _8(t){return{empty:!0,numberOfComponents:1,dataType:me.UNSIGNED_INT,...t}}function wl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};oe.extend(t,e,_8(n)),F8(t,e)}const U8=R.newInstance(wl,"vtkCellArray");var kr={newInstance:U8,extend:wl,...b8};function k8(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(r){e.pointsIds=r;let i=e.points.getData();i.length!==3*e.pointsIds.length&&(i=R.newTypedArray(n.getDataType(),3*e.pointsIds.length));const a=n.getData();e.pointsIds.forEach((s,o)=>{let c=3*s,l=3*o;i[l]=a[c],i[++l]=a[++c],i[++l]=a[++c]}),e.points.setData(i)}else{e.points=n,e.pointsIds=new Array(n.getNumberOfPoints());for(let i=n.getNumberOfPoints()-1;i>=0;--i)e.pointsIds[i]=i}},t.getBounds=()=>{const n=e.points.getNumberOfPoints(),r=[];if(n){e.points.getPoint(0,r),e.bounds[0]=r[0],e.bounds[1]=r[0],e.bounds[2]=r[1],e.bounds[3]=r[1],e.bounds[4]=r[2],e.bounds[5]=r[2];for(let i=1;i<n;i++)e.points.getPoint(i,r),e.bounds[0]=r[0]<e.bounds[0]?r[0]:e.bounds[0],e.bounds[1]=r[0]>e.bounds[1]?r[0]:e.bounds[1],e.bounds[2]=r[1]<e.bounds[2]?r[1]:e.bounds[2],e.bounds[3]=r[1]>e.bounds[3]?r[1]:e.bounds[3],e.bounds[4]=r[2]<e.bounds[4]?r[2]:e.bounds[4],e.bounds[5]=r[2]>e.bounds[5]?r[2]:e.bounds[5]}else ya(e.bounds);return e.bounds},t.getLength2=()=>{t.getBounds();let n=0,r=0;for(let i=0;i<3;i++)r=e.bounds[2*i+1]-e.bounds[2*i],n+=r*r;return n},t.getParametricDistance=n=>{let r,i=0;for(let a=0;a<3;a++)n[a]<0?r=-n[a]:n[a]>1?r=n[a]-1:r=0,r>i&&(i=r);return i},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=n=>{n.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(n,r,i,a,s,o,c)=>{},t.evaluatePosition=(n,r,i,a,s,o)=>{R.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const P8={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function Sl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,P8,n),R.obj(t,e),e.points||(e.points=C0.newInstance()),R.get(t,e,["points","pointsIds"]),k8(t,e)}const G8=R.newInstance(Sl,"vtkCell");var ta={newInstance:G8,extend:Sl};function A8(t,e){let n=e;for(e>=t.array.length&&(n+=t.array.length);n>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=n}function B8(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),i=n.getNumberOfCells(),a=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let s=0;s<i;++s){const{cellPointIds:o}=n.getCellPoints(s);o.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(r),e.maxId=r-1;for(let s=0;s<i;++s){const{cellPointIds:o}=n.getCellPoints(s);o.forEach(c=>{t.insertCellReference(c,a[c]++,s)})}}else{for(let s=0;s<i;s++)ta.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(r),e.maxId=r-1;for(let s=0;s<i;++s)ta.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,a[c]++,s)})}},t.allocate=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(n).fill().map(()=>({ncells:0,cells:null})),e.extend=r,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=n=>e.array[n],t.getNcells=n=>e.array[n].ncells,t.getCells=n=>e.array[n].cells,t.insertNextPoint=n=>{e.array.push({ncells:n,cells:Array(n)}),++e.maxId},t.insertNextCellReference=(n,r)=>{e.array[n].cells[e.array[n].ncells++]=r},t.deletePoint=n=>{e.array[n].ncells=0,e.array[n].cells=null},t.removeCellReference=(n,r)=>{e.array[r].cells=e.array[r].cells.filter(i=>i!==n),e.array[r].ncells=e.array[r].cells.length},t.addCellReference=(n,r)=>{e.array[r].cells[e.array[r].ncells++]=n},t.resizeCellList=(n,r)=>{e.array[n].cells.length=r},t.squeeze=()=>{A8(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{e.array=[...n.array],e.extend=n.extend,e.maxId=n.maxId},t.incrementLinkCount=n=>{++e.array[n].ncells},t.allocateLinks=n=>{for(let r=0;r<n;++r)e.array[r].cells=new Array(e.array[r].ncells)},t.insertCellReference=(n,r,i)=>{e.array[n].cells[r]=i}}const W8={array:null,maxId:0,extend:0};function Rl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,W8,n),R.obj(t,e),B8(t,e)}const z8=R.newInstance(Rl,"vtkCellLinks");var $8={newInstance:z8,extend:Rl};const he={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_PIXEL:8,VTK_QUAD:9,VTK_TETRA:10,VTK_VOXEL:11,VTK_HEXAHEDRON:12,VTK_WEDGE:13,VTK_PYRAMID:14,VTK_PENTAGONAL_PRISM:15,VTK_HEXAGONAL_PRISM:16,VTK_QUADRATIC_EDGE:21,VTK_QUADRATIC_TRIANGLE:22,VTK_QUADRATIC_QUAD:23,VTK_QUADRATIC_POLYGON:36,VTK_QUADRATIC_TETRA:24,VTK_QUADRATIC_HEXAHEDRON:25,VTK_QUADRATIC_WEDGE:26,VTK_QUADRATIC_PYRAMID:27,VTK_BIQUADRATIC_QUAD:28,VTK_TRIQUADRATIC_HEXAHEDRON:29,VTK_QUADRATIC_LINEAR_QUAD:30,VTK_QUADRATIC_LINEAR_WEDGE:31,VTK_BIQUADRATIC_QUADRATIC_WEDGE:32,VTK_BIQUADRATIC_QUADRATIC_HEXAHEDRON:33,VTK_BIQUADRATIC_TRIANGLE:34,VTK_CUBIC_LINE:35,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42,VTK_PARAMETRIC_CURVE:51,VTK_PARAMETRIC_SURFACE:52,VTK_PARAMETRIC_TRI_SURFACE:53,VTK_PARAMETRIC_QUAD_SURFACE:54,VTK_PARAMETRIC_TETRA_REGION:55,VTK_PARAMETRIC_HEX_REGION:56,VTK_HIGHER_ORDER_EDGE:60,VTK_HIGHER_ORDER_TRIANGLE:61,VTK_HIGHER_ORDER_QUAD:62,VTK_HIGHER_ORDER_POLYGON:63,VTK_HIGHER_ORDER_TETRAHEDRON:64,VTK_HIGHER_ORDER_WEDGE:65,VTK_HIGHER_ORDER_PYRAMID:66,VTK_HIGHER_ORDER_HEXAHEDRON:67,VTK_LAGRANGE_CURVE:68,VTK_LAGRANGE_TRIANGLE:69,VTK_LAGRANGE_QUADRILATERAL:70,VTK_LAGRANGE_TETRAHEDRON:71,VTK_LAGRANGE_HEXAHEDRON:72,VTK_LAGRANGE_WEDGE:73,VTK_LAGRANGE_PYRAMID:74,VTK_NUMBER_OF_CELL_TYPES:75},x0=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function j8(t){return t<x0.length?x0[t]:"UnknownClass"}function H8(t){return x0.findIndex(t)}function K8(t){return t<he.VTK_QUADRATIC_EDGE||t===he.VTK_CONVEX_POINT_SET||t===he.VTK_POLYHEDRON}function q8(t){return t===he.VTK_TRIANGLE_STRIP||t===he.VTK_POLY_LINE||t===he.VTK_POLY_VERTEX}const X8={getClassNameFromTypeId:j8,getTypeIdFromClassName:H8,isLinear:K8,hasSubCells:q8};function Y8(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=n>0?n:1,e.extend=r>0?r:1,e.maxId=-1,e.typeArray=new Uint8Array(n),e.locationArray=new Uint32Array(n)},t.insertCell=(n,r,i)=>{e.typeArray[n]=r,e.locationArray[n]=i,n>e.maxId&&(e.maxId=n)},t.insertNextCell=(n,r)=>(t.insertCell(++e.maxId,n,r),e.maxId),t.setCellTypes=(n,r,i)=>{e.size=n,e.typeArray=r,e.locationArray=i,e.maxId=n-1},t.getCellLocation=n=>e.locationArray[n],t.deleteCell=n=>{e.typeArray[n]=he.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=n=>{const r=t.getNumberOfTypes();for(let i=0;i<r;++i)if(n===t.getCellType(i))return!0;return!1},t.insertNextType=n=>t.insertNextCell(n,-1),t.getCellType=n=>e.typeArray[n],t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{t.allocate(n.getSize(),n.getExtend()),e.typeArray.set(n.getTypeArray()),e.locationArray.set(n.getLocationArray()),e.maxId=n.getMaxId()}}const Z8={size:0,maxId:-1,extend:1e3};function El(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Z8,n),R.obj(t,e),R.get(t,e,["size","maxId","extend"]),R.getArray(t,e,["typeArray","locationArray"]),Y8(t,e)}const J8=R.newInstance(El,"vtkCellTypes");var Q8={newInstance:J8,extend:El,...X8};const ep={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var Ml={IntersectionState:ep};const{IntersectionState:Vi}=Ml;function Bn(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const i={t:Number.MIN_VALUE,distance:0},a=[];let s;a[0]=n[0]-e[0],a[1]=n[1]-e[1],a[2]=n[2]-e[2];const o=a[0]*(t[0]-e[0])+a[1]*(t[1]-e[1])+a[2]*(t[2]-e[2]),c=Y(a,a);let l=1e-5*o;return c!==0&&(i.t=o/c),l<0&&(l=-l),-l<c&&c<l||c<=0||i.t<0?s=e:i.t>1?s=n:(s=a,a[0]=e[0]+i.t*a[0],a[1]=e[1]+i.t*a[1],a[2]=e[2]+i.t*a[2]),r&&(r[0]=s[0],r[1]=s[1],r[2]=s[2]),i.distance=Ct(s,t),i}function Ol(t,e,n,r,i,a){const s=[],o=[],c=[];i[0]=0,a[0]=0,Ut(e,t,s),Ut(r,n,o),Ut(n,t,c);const l=[Y(s,s),-Y(s,o),-Y(s,o),Y(o,o)],u=[];if(u[0]=Y(s,c),u[1]=-Y(o,c),D1(l,u,2)===0){let f=Number.MAX_VALUE;const g=[t,e,n,r],h=[n,n,t,t],p=[r,r,e,e];a[0],a[0],i[0],i[0],i[0],i[0],a[0],a[0];let d;for(let m=0;m<4;m++)d=Bn(g[m],h[m],p[m]),d.distance<f&&(f=d.distance);return Vi.ON_LINE}return i[0]=u[0],a[0]=u[1],i[0]>=0&&i[0]<=1&&a[0]>=0&&a[0]<=1?Vi.YES_INTERSECTION:Vi.NO_INTERSECTION}const tp={distanceToLine:Bn,intersection:Ol};function np(t,e){e.classHierarchy.push("vtkLine");function n(r){return r>=0&&r<=1}t.getCellDimension=()=>1,t.intersectWithLine=(r,i,a,s,o)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};o[1]=0,o[2]=0;const l=[],u=[],f=[];e.points.getPoint(0,u),e.points.getPoint(1,f);const g=[],h=[],p=Ol(r,i,u,f,g,h);if(c.t=g[0],c.betweenPoints=n(c.t),o[0]=h[0],p===Vi.YES_INTERSECTION){for(let d=0;d<3;d++)s[d]=u[d]+o[0]*(f[d]-u[d]),l[d]=r[d]+c.t*(i[d]-r[d]);if(Ct(s,l)<=a*a)return c.intersect=1,c}else{let d;if(c.t<0)return d=Bn(r,u,f,s),d.distance<=a*a&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return d=Bn(i,u,f,s),d.distance<=a*a&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(o[0]<0)return o[0]=0,d=Bn(u,r,i,s),c.t=d.t,d.distance<=a*a&&(c.intersect=1),c;if(o[0]>1)return o[0]=1,d=Bn(f,r,i,s),c.t=d.t,d.distance<=a*a&&(c.intersect=1),c}return c},t.evaluateLocation=(r,i,a)=>{const s=[],o=[];e.points.getPoint(0,s),e.points.getPoint(1,o);for(let c=0;c<3;c++)i[c]=s[c]+r[0]*(o[c]-s[c]);a[0]=1-r[0],a[1]=r[0]},t.evaluateOrientation=(r,i,a)=>e.orientations?(Mi(i,e.orientations[0],e.orientations[1],r[0]),a[0]=1-r[0],a[1]=r[0],!0):!1}const rp={orientations:null};function Dl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rp,n),ta.extend(t,e,n),R.setGet(t,e,["orientations"]),np(t,e)}const ip=R.newInstance(Dl,"vtkLine");var rt={newInstance:ip,extend:Dl,...tp,...Ml};function ap(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=ht(e.points):e.points=C0.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const n=t.shallowCopy;t.shallowCopy=function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,i),e.points=C0.newInstance(),e.points.shallowCopy(r.getPoints())}}const sp={};function Vl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sp,n),E2.extend(t,e,n),R.setGet(t,e,["points"]),ap(t,e)}const op=R.newInstance(Vl,"vtkPointSet");var cp={newInstance:op,extend:Vl};function ws(t,e,n,r){const i=n[0]-e[0],a=n[1]-e[1],s=n[2]-e[2],o=t[0]-e[0],c=t[1]-e[1],l=t[2]-e[2];r[0]=a*l-s*c,r[1]=s*o-i*l,r[2]=i*c-a*o}function na(t,e,n,r){ws(t,e,n,r);const i=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);i!==0&&(r[0]/=i,r[1]/=i,r[2]/=i)}function lp(t,e,n,r,i,a){let s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,o=!1;const c=[],l=[],u=[],f=[],g=[];na(t,e,n,f),na(r,i,a,g);const h=-Y(f,t),p=-Y(g,r),d=[Y(g,t)+p,Y(g,e)+p,Y(g,n)+p];if(d[0]*d[1]>s&&d[0]*d[2]>s)return{intersect:!1,coplanar:o,pt1:c,pt2:l,surfaceId:u};const m=[Y(f,r)+h,Y(f,i)+h,Y(f,a)+h];if(m[0]*m[1]>s&&m[0]*m[2]>s)return{intersect:!1,coplanar:o,pt1:c,pt2:l,surfaceId:u};if(Math.abs(f[0]-g[0])<1e-9&&Math.abs(f[1]-g[1])<1e-9&&Math.abs(f[2]-g[2])<1e-9&&Math.abs(h-p)<1e-9)return o=!0,{intersect:!1,coplanar:o,pt1:c,pt2:l,surfaceId:u};const y=[t,e,n],T=[r,i,a],v=Y(f,g),C=(h-p*v)/(v*v-1),x=(p-h*v)/(v*v-1),w=[C*f[0]+x*g[0],C*f[1]+x*g[1],C*f[2]+x*g[2]],E=Et(f,g,[]);da(E);let O=0,D=0;const S=[],M=[];let V=50,L=50;for(let b=0;b<3;b++){const W=b,_=(b+1)%3,N=Ge.intersectWithLine(y[W],y[_],r,g);N.intersection&&N.t>0-s&&N.t<1+s&&(N.t<1+s&&N.t>1-s&&(V=O),S[O++]=Y(N.x,E)-Y(w,E));const I=Ge.intersectWithLine(T[W],T[_],t,f);I.intersection&&I.t>0-s&&I.t<1+s&&(I.t<1+s&&I.t>1-s&&(L=D),M[D++]=Y(I.x,E)-Y(w,E))}if(O>2){O--;const b=S[2];S[2]=S[V],S[V]=b}if(D>2){D--;const b=M[2];M[2]=M[L],M[L]=b}if(O!==2||D!==2)return{intersect:!1,coplanar:o,pt1:c,pt2:l,surfaceId:u};if(Number.isNaN(S[0])||Number.isNaN(S[1])||Number.isNaN(M[0])||Number.isNaN(M[1]))return{intersect:!1,coplanar:o,pt1:c,pt2:l,surfaceId:u};if(S[0]>S[1]){const b=S[1];S[1]=S[0],S[0]=b}if(M[0]>M[1]){const b=M[1];M[1]=M[0],M[0]=b}let F,k;return S[1]<M[0]||M[1]<S[0]?{intersect:!1,coplanar:o,pt1:c,pt2:l,surfaceId:u}:(S[0]<M[0]?S[1]<M[1]?(u[0]=2,u[1]=1,F=M[0],k=S[1]):(u[0]=2,u[1]=2,F=M[0],k=M[1]):S[1]<M[1]?(u[0]=1,u[1]=1,F=S[0],k=S[1]):(u[0]=1,u[1]=2,F=S[0],k=M[1]),a0(w,E,F,c),a0(w,E,k,l),{intersect:!0,coplanar:o,pt1:c,pt2:l,surfaceId:u})}const up={computeNormalDirection:ws,computeNormal:na,intersectWithTriangle:lp};function fp(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(n,r,i,a,s)=>{const o={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};s[2]=0;const c=[],l=i*i,u=[],f=[],g=[];e.points.getPoint(0,u),e.points.getPoint(1,f),e.points.getPoint(2,g);const h=[],p=[];if(na(u,f,g,h),h[0]!==0||h[1]!==0||h[2]!==0){const v=Ge.intersectWithLine(n,r,u,h);if(o.betweenPoints=v.betweenPoints,o.t=v.t,a[0]=v.x[0],a[1]=v.x[1],a[2]=v.x[2],!v.intersection)return s[0]=0,s[1]=0,o.intersect=0,o;const C=t.evaluatePosition(a,c,s,p);if(C.evaluation>=0)return C.dist2<=l?(o.intersect=1,o):(o.intersect=C.evaluation,o)}const d=Ct(u,f),m=Ct(f,g),y=Ct(g,u);e.line||(e.line=rt.newInstance()),d>m&&d>y?(e.line.getPoints().setPoint(0,u),e.line.getPoints().setPoint(1,f)):m>y&&m>d?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,g)):(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,u));const T=e.line.intersectWithLine(n,r,i,a,s);if(o.betweenPoints=T.betweenPoints,o.t=T.t,T.intersect){const v=[],C=[],x=[];for(let w=0;w<3;w++)v[w]=u[w]-g[w],C[w]=f[w]-g[w],x[w]=a[w]-g[w];return s[0]=Y(x,v)/y,s[1]=Y(x,C)/m,o.intersect=1,o}return s[0]=0,s[1]=0,o.intersect=0,o},t.evaluatePosition=(n,r,i,a)=>{const s={subId:0,dist2:0,evaluation:-1};let o,c;const l=[],u=[],f=[],g=[];let h;const p=[],d=[],m=[];let y=0,T=0;const v=[];let C,x,w,E=[];const O=[],D=[],S=[];s.subId=0,i[2]=0,e.points.getPoint(1,l),e.points.getPoint(2,u),e.points.getPoint(0,f),ws(l,u,f,g),Ge.generalizedProjectPoint(n,l,g,S);let M=0;for(o=0;o<3;o++)g[o]<0?h=-g[o]:h=g[o],h>M&&(M=h,T=o);for(c=0,o=0;o<3;o++)o!==T&&(v[c++]=o);for(o=0;o<2;o++)p[o]=S[v[o]]-f[v[o]],d[o]=l[v[o]]-f[v[o]],m[o]=u[v[o]]-f[v[o]];if(y=ye(d,m),y===0)return i[0]=0,i[1]=0,s.evaluation=-1,s;if(i[0]=ye(p,m)/y,i[1]=ye(d,p)/y,a[0]=1-(i[0]+i[1]),a[1]=i[0],a[2]=i[1],a[0]>=0&&a[0]<=1&&a[1]>=0&&a[1]<=1&&a[2]>=0&&a[2]<=1)r&&(s.dist2=Ct(S,n),r[0]=S[0],r[1]=S[1],r[2]=S[2]),s.evaluation=1;else{let V;if(r){if(a[1]<0&&a[2]<0)for(C=Ct(n,f),x=rt.distanceToLine(n,l,f,V,O),w=rt.distanceToLine(n,f,u,V,D),C<x?(s.dist2=C,E=f):(s.dist2=x,E=O),w<s.dist2&&(s.dist2=w,E=D),o=0;o<3;o++)r[o]=E[o];else if(a[2]<0&&a[0]<0)for(C=Ct(n,l),x=rt.distanceToLine(n,l,f,V,O),w=rt.distanceToLine(n,l,u,V,D),C<x?(s.dist2=C,E=l):(s.dist2=x,E=O),w<s.dist2&&(s.dist2=w,E=D),o=0;o<3;o++)r[o]=E[o];else if(a[1]<0&&a[0]<0)for(C=Ct(n,u),x=rt.distanceToLine(n,u,f,V,O),w=rt.distanceToLine(n,l,u,V,D),C<x?(s.dist2=C,E=u):(s.dist2=x,E=O),w<s.dist2&&(s.dist2=w,E=D),o=0;o<3;o++)r[o]=E[o];else if(a[0]<0){const L=rt.distanceToLine(n,l,u,r);s.dist2=L.distance}else if(a[1]<0){const L=rt.distanceToLine(n,u,f,r);s.dist2=L.distance}else if(a[2]<0){const L=rt.distanceToLine(n,l,f,r);s.dist2=L.distance}}s.evaluation=0}return s},t.evaluateLocation=(n,r,i)=>{const a=[],s=[],o=[];e.points.getPoint(0,a),e.points.getPoint(1,s),e.points.getPoint(2,o);const c=1-n[0]-n[1];for(let l=0;l<3;l++)r[l]=a[l]*c+s[l]*n[0]+o[l]*n[1];i[0]=c,i[1]=n[0],i[2]=n[1]},t.getParametricDistance=n=>{let r,i=0;const a=[];a[0]=n[0],a[1]=n[1],a[2]=1-n[0]-n[1];for(let s=0;s<3;s++)a[s]<0?r=-a[s]:a[s]>1?r=a[s]-1:r=0,r>i&&(i=r);return i}}const gp={};function Il(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gp,n),ta.extend(t,e,n),fp(t,e)}const hp=R.newInstance(Il,"vtkTriangle");var pp={newInstance:hp,extend:Il,...up};const ja=["verts","lines","polys","strips"],{vtkWarningMacro:Fo}=R,dp={[he.VTK_LINE]:rt,[he.VTK_POLY_LINE]:rt,[he.VTK_TRIANGLE]:pp};function mp(t,e){e.classHierarchy.push("vtkPolyData");function n(i){return i.replace(/(?:^\w|[A-Z]|\b\w)/g,a=>a.toUpperCase()).replace(/\s+/g,"")}ja.forEach(i=>{t[`getNumberOf${n(i)}`]=()=>e[i].getNumberOfCells(),e[i]?e[i]=ht(e[i]):e[i]=kr.newInstance()}),t.getNumberOfCells=()=>ja.reduce((i,a)=>i+e[a].getNumberOfCells(),0);const r=t.shallowCopy;t.shallowCopy=function(i){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(i,a),ja.forEach(s=>{e[s]=kr.newInstance(),e[s].shallowCopy(i.getReferenceByName(s))})},t.buildCells=()=>{const i=t.getNumberOfVerts(),a=t.getNumberOfLines(),s=t.getNumberOfPolys(),o=t.getNumberOfStrips(),c=i+a+s+o,l=new Uint8Array(c);let u=l;const f=new Uint32Array(c);let g=f;if(i){let h=0;e.verts.getCellSizes().forEach((p,d)=>{g[d]=h,u[d]=p>1?he.VTK_POLY_VERTEX:he.VTK_VERTEX,h+=p+1}),g=g.subarray(i),u=u.subarray(i)}if(a){let h=0;e.lines.getCellSizes().forEach((p,d)=>{g[d]=h,u[d]=p>2?he.VTK_POLY_LINE:he.VTK_LINE,p===1&&Fo("Building VTK_LINE ",d," with only one point, but VTK_LINE needs at least two points. Check the input."),h+=p+1}),g=g.subarray(a),u=u.subarray(a)}if(s){let h=0;e.polys.getCellSizes().forEach((p,d)=>{switch(g[d]=h,p){case 3:u[d]=he.VTK_TRIANGLE;break;case 4:u[d]=he.VTK_QUAD;break;default:u[d]=he.VTK_POLYGON;break}p<3&&Fo("Building VTK_TRIANGLE ",d," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),h+=p+1}),g+=g.subarray(s),u+=u.subarray(s)}if(o){let h=0;u.fill(he.VTK_TRIANGLE_STRIP,0,o),e.strips.getCellSizes().forEach((p,d)=>{g[d]=h,h+=p+1})}e.cells=Q8.newInstance(),e.cells.setCellTypes(c,l,f)},t.buildLinks=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=$8.newInstance(),i>0?e.links.allocate(i):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=i=>e.cells.getCellType(i),t.getCellPoints=i=>{const a=t.getCellType(i);let s=null;switch(a){case he.VTK_VERTEX:case he.VTK_POLY_VERTEX:s=e.verts;break;case he.VTK_LINE:case he.VTK_POLY_LINE:s=e.lines;break;case he.VTK_TRIANGLE:case he.VTK_QUAD:case he.VTK_POLYGON:s=e.polys;break;case he.VTK_TRIANGLE_STRIP:s=e.strips;break;default:return s=null,{type:0,cellPointIds:null}}const o=e.cells.getCellLocation(i),c=s.getCell(o);return{cellType:a,cellPointIds:c}},t.getPointCells=i=>e.links.getCells(i),t.getCellEdgeNeighbors=(i,a,s)=>{const o=e.links.getLink(a),c=e.links.getLink(s);return o.cells.filter(l=>l!==i&&c.cells.indexOf(l)!==-1)},t.getCell=function(i){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const s=t.getCellPoints(i),o=a||dp[s.cellType].newInstance();return o.initialize(t.getPoints(),s.cellPointIds),o}}const yp={};function Ll(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yp,n),cp.extend(t,e,n),R.get(t,e,["cells","links"]),R.setGet(t,e,["verts","lines","polys","strips"]),mp(t,e)}const vp=R.newInstance(Ll,"vtkPolyData");var wn={newInstance:vp,extend:Ll};const Tp=1e-6;function Cp(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=r=>{e.position=e.position.map((i,a)=>i+r[a]),t.modified()},t.getOrientationWXYZ=()=>{const r=En();h0(r,e.rotation);const i=new Float64Array(3),a=F4(i,r);return[y1(a),i[0],i[1],i[2]]},t.getOrientationQuaternion=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return h0(r,e.rotation)},t.rotateX=r=>{r!==0&&(ts(e.rotation,e.rotation,Fe(r)),t.modified())},t.rotateY=r=>{r!==0&&(ns(e.rotation,e.rotation,Fe(r)),t.modified())},t.rotateZ=r=>{r!==0&&(rs(e.rotation,e.rotation,Fe(r)),t.modified())},t.rotateWXYZ=(r,i,a,s)=>{if(r===0||i===0&&a===0&&s===0)return;const o=Fe(r),c=En();os(c,[i,a,s],o);const l=new Float64Array(16);Hi(l,c),se(e.rotation,e.rotation,l),t.modified()},t.rotateQuaternion=r=>{if(Math.abs(r[3])>=1-Tp)return;const i=Hi(new Float64Array(16),r);se(e.rotation,e.rotation,i),t.modified()},t.setOrientation=(r,i,a)=>r===e.orientation[0]&&i===e.orientation[1]&&a===e.orientation[2]?!1:(e.orientation=[r,i,a],X(e.rotation),t.rotateZ(a),t.rotateX(r),t.rotateY(i),t.modified(),!0),t.setUserMatrix=r=>Xr(e.userMatrix,r)?!1:(Oe(e.userMatrix,r),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){X(e.matrix),e.userMatrix&&se(e.matrix,e.matrix,e.userMatrix),Se(e.matrix,e.matrix,e.origin),Se(e.matrix,e.matrix,e.position),se(e.matrix,e.matrix,e.rotation),Gt(e.matrix,e.matrix,e.scale),Se(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),ue(e.matrix,e.matrix),e.isIdentity=!0;for(let r=0;r<4;++r)for(let i=0;i<4;++i)(r===i?1:0)!==e.matrix[r+i*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getCenter=()=>De.getCenter(e.bounds),t.getLength=()=>De.getLength(e.bounds),t.getXRange=()=>De.getXRange(e.bounds),t.getYRange=()=>De.getYRange(e.bounds),t.getZRange=()=>De.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function n(){t.computeMatrix()}t.onModified(n)}const xp={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function Nl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xp,n),F9.extend(t,e,n),e.matrixMTime={},R.obj(e.matrixMTime),R.get(t,e,["bounds","isIdentity"]),R.getArray(t,e,["orientation"]),R.setGetArray(t,e,["origin","position","scale"],3),e.matrix=X(new Float64Array(16)),e.rotation=X(new Float64Array(16)),e.userMatrix=X(new Float64Array(16)),e.transform=null,Cp(t,e)}const wp=R.newInstance(Nl,"vtkProp3D");var bl={newInstance:wp,extend:Nl};const{vtkErrorMacro:ci}=R;function Sp(t,e){e.classHierarchy.push("vtkPiecewiseFunction"),t.getSize=()=>e.nodes.length,t.getType=()=>{let n,r=0,i=0;e.nodes.length>0&&(r=e.nodes[0].y);for(let a=1;a<e.nodes.length;a++){if(n=e.nodes[a].y,n!==r)if(n>r)switch(i){case 0:case 1:i=1;break;case 2:default:i=3;break}else switch(i){case 0:case 2:i=2;break;case 1:default:i=3;break}if(r=n,i===3)break}switch(i){case 0:return"Constant";case 1:return"NonDecreasing";case 2:return"NonIncreasing";case 3:default:return"Varied"}},t.getDataPointer=()=>{const n=e.nodes.length;if(e.function=null,n>0){e.function=[];for(let r=0;r<n;r++)e.function[2*r]=e.nodes[r].x,e.function[2*r+1]=e.nodes[r].y}return e.function},t.getFirstNonZeroValue=()=>{if(e.nodes.length===0)return 0;let n=1,r=0,i=0;for(;i<e.nodes.length;i++)if(e.nodes[i].y!==0){n=0;break}return n?r=Number.MAX_VALUE:i>0?r=e.nodes[i-1].x:e.clamping?r=-Number.MAX_VALUE:r=e.nodes[0].x,r},t.getNodeValue=(n,r)=>{const i=e.nodes.length;return n<0||n>=i?(ci("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].y,r[2]=e.nodes[n].midpoint,r[3]=e.nodes[n].sharpness,1)},t.setNodeValue=(n,r)=>{const i=e.nodes.length;if(n<0||n>=i)return ci("Index out of range!"),-1;const a=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].y=r[1],e.nodes[n].midpoint=r[2],e.nodes[n].sharpness=r[3],a!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.addPoint=(n,r)=>t.addPointLong(n,r,.5,0),t.addPointLong=(n,r,i,a)=>{if(i<0||i>1)return ci("Midpoint outside range [0.0, 1.0]"),-1;if(a<0||a>1)return ci("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const s={x:n,y:r,midpoint:i,sharpness:a};e.nodes.push(s),t.sortAndUpdateRange();let o;for(o=0;o<e.nodes.length&&e.nodes[o].x!==n;o++);return o<e.nodes.length?o:-1},t.setNodes=n=>{e.nodes!==n&&(e.nodes=n,t.sortAndUpdateRange())},t.sortAndUpdateRange=()=>{e.nodes.sort((r,i)=>r.x-i.x),t.updateRange()||t.modified()},t.updateRange=()=>{const n=e.range.slice(),r=e.nodes.length;return r?(e.range[0]=e.nodes[0].x,e.range[1]=e.nodes[r-1].x):(e.range[0]=0,e.range[1]=0),n[0]===e.range[0]&&n[1]===e.range[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r;for(r=0;r<e.nodes.length&&e.nodes[r].x!==n;r++);if(r>=e.nodes.length)return-1;const i=r;let a=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(a=t.updateRange()),a||t.modified(),i},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addSegment=(n,r,i,a)=>{t.sortAndUpdateRange();for(let s=0;s<e.nodes.length;)e.nodes[s].x>=n&&e.nodes[s].x<=i?e.nodes.splice(s,1):s++;t.addPoint(n,r,.5,0),t.addPoint(i,a,.5,0)},t.getValue=n=>{const r=[];return t.getTable(n,n,1,r),r[0]},t.adjustRange=n=>{if(n.length<2)return 0;const r=t.getRange();r[0]<n[0]?t.addPoint(n[0],t.getValue(n[0])):t.addPoint(n[0],t.getValue(r[0])),r[1]>n[1]?t.addPoint(n[1],t.getValue(n[1])):t.addPoint(n[1],t.getValue(r[1])),t.sortAndUpdateRange();for(let i=0;i<e.nodes.length;)e.nodes[i].x>=n[0]&&e.nodes[i].x<=n[1]?e.nodes.splice(i,1):++i;return t.sortAndUpdateRange(),1},t.estimateMinNumberOfSamples=(n,r)=>{const i=t.findMinimumXDistance();return Math.ceil((r-n)/i)},t.findMinimumXDistance=()=>{const n=e.nodes.length;if(n<2)return-1;let r=e.nodes[1].x-e.nodes[0].x;for(let i=0;i<n-1;i++){const a=e.nodes[i+1].x-e.nodes[i].x;a<r&&(r=a)}return r},t.getTable=function(n,r,i,a){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,o,c=0;const l=e.nodes.length;let u=0;l!==0&&(u=e.nodes[l-1].y);let f=0,g=0,h=0,p=0,d=0,m=0,y=0;for(o=0;o<i;o++){const T=s*o;for(i>1?f=n+o/(i-1)*(r-n):f=.5*(n+r);c<l&&f>e.nodes[c].x;)c++,c<l&&(g=e.nodes[c-1].x,h=e.nodes[c].x,p=e.nodes[c-1].y,d=e.nodes[c].y,m=e.nodes[c-1].midpoint,y=e.nodes[c-1].sharpness,m<1e-5&&(m=1e-5),m>.99999&&(m=.99999));if(c>=l)a[T]=e.clamping?u:0;else if(c===0)a[T]=e.clamping?e.nodes[0].y:0;else{let v=(f-g)/(h-g);if(v<m?v=.5*v/m:v=.5+.5*(v-m)/(1-m),y>.99)if(v<.5){a[T]=p;continue}else{a[T]=d;continue}if(y<.01){a[T]=(1-v)*p+v*d;continue}v<.5?v=.5*(v*2)**(1+10*y):v>.5&&(v=1-.5*((1-v)*2)**(1+10*y));const C=v*v,x=C*v,w=2*x-3*C+1,E=-2*x+3*C,O=x-2*C+v,D=x-C,S=d-p,M=(1-y)*S;a[T]=w*p+E*d+O*M+D*M;const V=p<d?p:d,L=p>d?p:d;a[T]=a[T]<V?V:a[T],a[T]=a[T]>L?L:a[T]}}}}const Rp={range:[0,0],clamping:!0,allowDuplicateScalars:!1};function Fl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Rp,n),R.obj(t,e),e.nodes=[],R.setGet(t,e,["allowDuplicateScalars","clamping"]),R.setArray(t,e,["range"],2),R.getArray(t,e,["range"]),Sp(t,e)}const Ep=R.newInstance(Fl,"vtkPiecewiseFunction");var Pr={newInstance:Ep,extend:Fl};const{BlendMode:Kt,FilterMode:vr}=Of;function Mp(t,e,n,r,i){let a=null;return i?(a=i,a.removeAllPoints()):a=Pr.newInstance(),a.addPointLong(-1024,0,1,1),a.addPoint(t,e),a.addPoint(n,r),a}const Op={createRadonTransferFunction:Mp};function Dp(t,e){e.classHierarchy.push("vtkVolumeMapper");const n={...t};t.getBounds=()=>{const r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=Jn(),e.bounds},t.update=()=>{t.getInputData()},t.setBlendModeToComposite=()=>{t.setBlendMode(Kt.COMPOSITE_BLEND)},t.setBlendModeToMaximumIntensity=()=>{t.setBlendMode(Kt.MAXIMUM_INTENSITY_BLEND)},t.setBlendModeToMinimumIntensity=()=>{t.setBlendMode(Kt.MINIMUM_INTENSITY_BLEND)},t.setBlendModeToAverageIntensity=()=>{t.setBlendMode(Kt.AVERAGE_INTENSITY_BLEND)},t.setBlendModeToAdditiveIntensity=()=>{t.setBlendMode(Kt.ADDITIVE_INTENSITY_BLEND)},t.setBlendModeToRadonTransform=()=>{t.setBlendMode(Kt.RADON_TRANSFORM_BLEND)},t.getBlendModeAsString=()=>R.enumToString(Kt,e.blendMode),t.setAverageIPScalarRange=(r,i)=>{console.warn("setAverageIPScalarRange is deprecated use setIpScalarRange"),t.setIpScalarRange(r,i)},t.getFilterModeAsString=()=>R.enumToString(vr,e.filterMode),t.setFilterModeToOff=()=>{t.setFilterMode(vr.OFF)},t.setFilterModeToNormalized=()=>{t.setFilterMode(vr.NORMALIZED)},t.setFilterModeToRaw=()=>{t.setFilterMode(vr.RAW)},t.setGlobalIlluminationReach=r=>n.setGlobalIlluminationReach(pt(r,0,1)),t.setVolumetricScatteringBlending=r=>n.setVolumetricScatteringBlending(pt(r,0,1)),t.setVolumeShadowSamplingDistFactor=r=>n.setVolumeShadowSamplingDistFactor(r>=1?r:1),t.setAnisotropy=r=>n.setAnisotropy(pt(r,-.99,.99)),t.setLAOKernelSize=r=>n.setLAOKernelSize(Y0(pt(r,1,32))),t.setLAOKernelRadius=r=>n.setLAOKernelRadius(r>=1?r:1)}const Vp={bounds:[1,-1,1,-1,1,-1],sampleDistance:1,imageSampleDistance:1,maximumSamplesPerRay:1e3,autoAdjustSampleDistances:!0,initialInteractionScale:1,interactionSampleDistanceFactor:1,blendMode:Kt.COMPOSITE_BLEND,ipScalarRange:[-1e6,1e6],filterMode:vr.OFF,preferSizeOverAccuracy:!1,computeNormalFromOpacity:!1,volumetricScatteringBlending:0,globalIlluminationReach:0,volumeShadowSamplingDistFactor:5,anisotropy:0,localAmbientOcclusion:!1,LAOKernelSize:15,LAOKernelRadius:7};function _l(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vp,n),el.extend(t,e,n),R.setGet(t,e,["sampleDistance","imageSampleDistance","maximumSamplesPerRay","autoAdjustSampleDistances","initialInteractionScale","interactionSampleDistanceFactor","blendMode","filterMode","preferSizeOverAccuracy","computeNormalFromOpacity","volumetricScatteringBlending","globalIlluminationReach","volumeShadowSamplingDistFactor","anisotropy","localAmbientOcclusion","LAOKernelSize","LAOKernelRadius"]),R.setGetArray(t,e,["ipScalarRange"],2),R.event(t,e,"lightingActivated"),Dp(t,e)}const Ip=R.newInstance(_l,"vtkVolumeMapper");var Lp={newInstance:Ip,extend:_l,...Op};function Np(t,e){e.classHierarchy.push("vtkSharedVolumeMapper");const n=t.delete;t.delete=()=>{e.scalarTexture=null,n()}}const bp={scalarTexture:null};function Ul(t,e,n={}){Object.assign(e,bp,n),Lp.extend(t,e,n),R.setGet(t,e,["scalarTexture"]),Np(t,e)}const Fp=R.newInstance(Ul,"vtkSharedVolumeMapper");var _p={newInstance:Fp,extend:Ul};function ot(t){const e=t.indexOf(":");return t.substring(e+1)}function kl(t){let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return(e>>>0).toString(36)}const Up=1073741824;class kp{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._imageIdsToVolumeIdCache=new Map,this._geometryCache=new Map,this._imageCacheSize=0,this._maxCacheSize=3*Up,this._geometryCacheSize=0,this.setMaxCacheSize=e=>{if(!e||typeof e!="number"){const n=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(n)}this._maxCacheSize=e},this.isCacheable=e=>{const n=this.getBytesAvailable(),r=Array.from(this._imageCache.values()).reduce((a,s)=>s.sharedCacheKey?a:a+s.sizeInBytes,0);return n+r>=e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getCacheSize=()=>this._imageCacheSize,this._decacheImage=(e,n=!1)=>{const r=this._imageCache.get(e);if(!r)return;if(r.sharedCacheKey&&!n)throw new Error("Cannot decache an image with a shared cache key. You need to manually decache the volume first.");const{imageLoadObject:i}=r;i!=null&&i.cancelFn&&i.cancelFn(),i!=null&&i.decache&&i.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const n=this._volumeCache.get(e);if(!n)return;const{volumeLoadObject:r,volume:i}=n;i&&(i.cancelLoading&&i.cancelLoading(),i.imageData&&i.imageData.delete(),r.cancelFn&&r.cancelFn(),i.imageIds&&i.imageIds.forEach(a=>{const s=this._imageCache.get(a);s&&s.sharedCacheKey===e&&(s.sharedCacheKey=void 0)}),this._volumeCache.delete(e))},this.purgeCache=()=>{const e=this._imageCache.keys();for(this.purgeVolumeCache();;){const{value:n,done:r}=e.next();if(r)break;this.removeImageLoadObject(n,{force:!0}),H(ae,A.IMAGE_CACHE_IMAGE_REMOVED,{imageId:n})}},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:n,done:r}=e.next();if(r)break;this.removeVolumeLoadObject(n),H(ae,A.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:n})}},this.getVolumeLoadObject=e=>{if(e===void 0)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(n)return n.timeStamp=Date.now(),n.volumeLoadObject},this.putGeometryLoadObject=(e,n)=>{if(e===void 0)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(n.promise===void 0)throw new Error("putGeometryLoadObject: geometryLoadObject.promise must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putGeometryLoadObject: geometryLoadObject.cancel must be a function");const r={loaded:!1,geometryId:e,geometryLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,r),n.promise.then(i=>{try{this._putGeometryCommon(e,i,r)}catch(a){throw console.debug(`Error in _putGeometryCommon for geometry ${e}:`,a),a}}).catch(i=>{throw console.debug(`Error caching geometry ${e}:`,i),this._geometryCache.delete(e),i})},this.getGeometry=e=>{if(e===void 0)throw new Error("getGeometry: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometry},this.removeGeometryLoadObject=e=>{if(e===void 0)throw new Error("removeGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(e);if(!n)throw new Error("removeGeometryLoadObject: geometryId was not present in geometryCache");this.decrementGeometryCacheSize(n.sizeInBytes);const r={geometry:n,geometryId:e};H(ae,A.GEOMETRY_CACHE_GEOMETRY_REMOVED,r),this._decacheGeometry(e)},this._decacheGeometry=e=>{const n=this._geometryCache.get(e);if(!n)return;const{geometryLoadObject:r}=n;r.cancelFn&&r.cancelFn(),r.decache&&r.decache(),this._geometryCache.delete(e)},this.incrementGeometryCacheSize=e=>{this._geometryCacheSize+=e},this.decrementGeometryCacheSize=e=>{this._geometryCacheSize-=e},this.getImage=(e,n=st.FAR_REPLICATE)=>{var i;if(e===void 0)throw new Error("getImage: imageId must not be undefined");const r=this._imageCache.get(e);if(r&&(r.timeStamp=Date.now(),!(((i=r.image)==null?void 0:i.imageQualityStatus)<n)))return r.image},this.getVolume=(e,n=!1)=>{var i;if(e===void 0)throw new Error("getVolume: volumeId must not be undefined");const r=this._volumeCache.get(e);return r?(r.timeStamp=Date.now(),r.volume):n?(i=[...this._volumeCache.values()].find(a=>a.volumeId.includes(e)))==null?void 0:i.volume:void 0},this.getVolumes=()=>Array.from(this._volumeCache.values()).map(n=>n.volume),this.filterVolumesByReferenceId=e=>this.getVolumes().filter(r=>r.referencedVolumeId===e),this.removeImageLoadObject=(e,{force:n=!1}={})=>{if(e===void 0)throw new Error("removeImageLoadObject: imageId must not be undefined");const r=this._imageCache.get(e);if(!r)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this._decacheImage(e,n),this.incrementImageCacheSize(-r.sizeInBytes);const i={image:r,imageId:e};H(ae,A.IMAGE_CACHE_IMAGE_REMOVED,i)},this.removeVolumeLoadObject=e=>{if(e===void 0)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const n=this._volumeCache.get(e);if(!n)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");const r={volume:n,volumeId:e};H(ae,A.VOLUME_CACHE_VOLUME_REMOVED,r),this._decacheVolume(e)},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.getGeometryLoadObject=e=>{if(e===void 0)throw new Error("getGeometryLoadObject: geometryId must not be undefined");const n=this._geometryCache.get(e);if(n)return n.timeStamp=Date.now(),n.geometryLoadObject}}generateVolumeId(e){const n=e.map(ot).sort();let r=2166136261;for(const i of n){const a=kl(i);for(let s=0;s<a.length;s++)r^=a.charCodeAt(s),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24)}return`volume-${(r>>>0).toString(36)}`}getImageIdsForVolumeId(e){return Array.from(this._imageIdsToVolumeIdCache.entries()).filter(([n,r])=>r===e).map(([n])=>n)}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,n){let r=this.getBytesAvailable();if(r>=e)return r;const i=Array.from(this._imageCache.values()).filter(c=>!c.sharedCacheKey);function a(c,l){return c.timeStamp>l.timeStamp?1:c.timeStamp<l.timeStamp?-1:0}i.sort(a);const s=i.map(c=>c.imageId);let o=s;n&&(o=s.filter(c=>!n.includes(c)));for(const c of o)if(this.removeImageLoadObject(c),H(ae,A.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r;for(const c of s)if(this.removeImageLoadObject(c),H(ae,A.IMAGE_CACHE_IMAGE_REMOVED,{imageId:c}),r=this.getBytesAvailable(),r>=e)return r}_putImageCommon(e,n,r){if(!this._imageCache.has(e)){console.warn("The image was purged from the cache before it completed loading.");return}if(!n){console.warn("Image is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putImageCommon: image.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putImageCommon: image.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(A.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.image=n,r.sizeInBytes=n.sizeInBytes,this.incrementImageCacheSize(r.sizeInBytes);const i={image:r};H(ae,A.IMAGE_CACHE_IMAGE_ADDED,i),r.sharedCacheKey=n.sharedCacheKey}async putImageLoadObject(e,n){if(e===void 0)throw console.error("putImageLoadObject: imageId must not be undefined"),new Error("putImageLoadObject: imageId must not be undefined");if(n.promise===void 0)throw console.error("putImageLoadObject: imageLoadObject.promise must not be undefined"),new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");const r=this._imageCache.get(e);if(r!=null&&r.imageLoadObject)throw console.warn(`putImageLoadObject: imageId ${e} already in cache`),new Error("putImageLoadObject: imageId already in cache");if(n.cancelFn&&typeof n.cancelFn!="function")throw console.error("putImageLoadObject: imageLoadObject.cancel must be a function"),new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const i={...r,loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,i),this._imageCache.set(e,i),n.promise.then(a=>{try{this._putImageCommon(e,a,i)}catch(s){throw console.debug(`Error in _putImageCommon for image ${e}:`,s),s}}).catch(a=>{throw console.debug(`Error caching image ${e}:`,a),this._imageCache.delete(e),a})}putImageSync(e,n){if(e===void 0)throw new Error("putImageSync: imageId must not be undefined");if(this._imageCache.has(e))throw new Error("putImageSync: imageId already in cache");const r={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._imageCache.set(e,r);try{this._putImageCommon(e,n,r)}catch(i){throw this._imageCache.delete(e),i}}getImageLoadObject(e){if(e===void 0)throw new Error("getImageLoadObject: imageId must not be undefined");const n=this._imageCache.get(e);if(n)return n.timeStamp=Date.now(),n.imageLoadObject}isLoaded(e){const n=this._imageCache.get(e);return n?n.loaded:!1}getVolumeContainingImageId(e){const n=Array.from(this._volumeCache.keys()),r=ot(e);for(const i of n){const a=this._volumeCache.get(i);if(!a)return;const{volume:s}=a;if(!s.imageIds.length)return;const o=s.getImageURIIndex(r);if(o>-1)return{volume:s,imageIdIndex:o}}}getCachedImageBasedOnImageURI(e){const n=ot(e),i=Array.from(this._imageCache.keys()).find(a=>ot(a)===n);if(i)return this._imageCache.get(i)}_putVolumeCommon(e,n,r){var a;if(!this._volumeCache.get(e)){console.warn("The volume was purged from the cache before it completed loading.");return}r.loaded=!0,r.volume=n,(a=n.imageIds)==null||a.forEach(s=>{const o=this._imageCache.get(s);o&&(o.sharedCacheKey=e)});const i={volume:r};H(ae,A.VOLUME_CACHE_VOLUME_ADDED,i)}putVolumeSync(e,n){if(e===void 0)throw new Error("putVolumeSync: volumeId must not be undefined");if(this._volumeCache.has(e))throw new Error("putVolumeSync: volumeId already in cache");const r={loaded:!1,volumeId:e,volumeLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._volumeCache.set(e,r);try{this._putVolumeCommon(e,n,r)}catch(i){throw this._volumeCache.delete(e),i}}async putVolumeLoadObject(e,n){if(e===void 0)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(n.promise===void 0)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(n.cancelFn&&typeof n.cancelFn!="function")throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const r={loaded:!1,volumeId:e,volumeLoadObject:n,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,r),n.promise.then(i=>{try{this._putVolumeCommon(e,i,r)}catch(a){throw console.error(`Error in _putVolumeCommon for volume ${e}:`,a),this._volumeCache.delete(e),a}}).catch(i=>{throw this._volumeCache.delete(e),i})}_putGeometryCommon(e,n,r){if(!this._geometryCache.get(e)){console.warn("The geometry was purged from the cache before it completed loading.");return}if(!n){console.warn("Geometry is undefined");return}if(n.sizeInBytes===void 0||Number.isNaN(n.sizeInBytes))throw new Error("_putGeometryCommon: geometry.sizeInBytes must not be undefined");if(n.sizeInBytes.toFixed===void 0)throw new Error("_putGeometryCommon: geometry.sizeInBytes is not a number");if(!this.isCacheable(n.sizeInBytes))throw new Error(A.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(n.sizeInBytes),r.loaded=!0,r.geometry=n,r.sizeInBytes=n.sizeInBytes,this.incrementGeometryCacheSize(r.sizeInBytes);const i={geometry:r};H(ae,A.GEOMETRY_CACHE_GEOMETRY_ADDED,i)}putGeometrySync(e,n){if(e===void 0)throw new Error("putGeometrySync: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometrySync: geometryId already in cache");const r={loaded:!1,geometryId:e,geometryLoadObject:{promise:Promise.resolve(n)},timeStamp:Date.now(),sizeInBytes:0};this._geometryCache.set(e,r);try{this._putGeometryCommon(e,n,r)}catch(i){throw this._geometryCache.delete(e),i}}setPartialImage(e,n){const r=this._imageCache.get(e);if(!r){n&&this._imageCache.set(e,{image:n,imageId:e,loaded:!1,timeStamp:Date.now(),sizeInBytes:0});return}r.loaded&&(r.loaded=!1,r.imageLoadObject=null,this.incrementImageCacheSize(-r.sizeInBytes),r.sizeInBytes=0),r.image=n||r.image}getImageQuality(e){var r;const n=(r=this._imageCache.get(e))==null?void 0:r.image;return n?n.imageQualityStatus||st.FULL_RESOLUTION:void 0}}const q=new kp;function _o(t,e){const n=Ts(e),r=new n(t.length);return r.set(t),r}function Pp(t,e){e.classHierarchy.push("vtkStreamingOpenGLTexture"),e.updatedFrames=[],e.volumeId=null;const n=t.create3DFilterableFromRaw;t.create3DFilterableFromRaw=(o,c,l,u,f,g,h)=>{e.inputDataType=f,e.inputNumComps=u,n(o,c,l,u,f,g,h)};const r=t.updateVolumeInfoForGL;t.updateVolumeInfoForGL=(o,c)=>{const l=r(o,c);return e.volumeInfo.dataComputedScale=[1],e.volumeInfo.dataComputedOffset=[0],l},t.update3DFromRaw=()=>{const{volumeId:o}=e;if(!o)return;const c=q.getVolume(o);if(e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),c.isDynamicVolume()){s();return}return t.hasUpdatedFrames()&&a()};const i=t.modified;t.setUpdatedFrame=o=>{e.updatedFrames[o]=!0,i()},t.modified=()=>{i();const o=q.getVolume(e.volumeId);if(!o)return;const c=o.imageIds;for(let l=0;l<c.length;l++)e.updatedFrames[l]=!0};function a(){const o=q.getVolume(e.volumeId),c=o.imageIds;for(let l=0;l<e.updatedFrames.length;l++)if(e.updatedFrames[l]){const u=q.getImage(c[l]);if(!u)continue;let f=u.voxelManager.getScalarData();const g=e.context;o.dataType!==f.constructor.name&&(f=_o(f,o.dataType));const[h]=t.updateArrayDataTypeForGL(o.dataType,[f]);t.bind();const p=l;g.texSubImage3D(e.target,0,0,0,p,e.width,e.height,1,e.format,e.openGLDataType,h),t.deactivate(),e.updatedFrames[l]=null}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}function s(){const o=q.getVolume(e.volumeId),c=o.getCurrentDimensionGroupImageIds();if(!c.length)return!1;let l;for(let u=0;u<c.length;u++){const f=c[u],g=q.getImage(f);let h;g?(h=g.voxelManager.getScalarData(),l=h.constructor):(l=Ts(o.dataType,!0),h=new l(e.width*e.height));const p=e.context;o.dataType!==h.constructor.name&&(h=_o(h,o.dataType));const[d]=t.updateArrayDataTypeForGL(o.dataType,[h]);t.bind();let m=u;p.texSubImage3D(e.target,0,0,0,m,e.width,e.height,1,e.format,e.openGLDataType,d),t.deactivate()}return e.generateMipmap&&e.context.generateMipmap(e.target),t.deactivate(),!0}t.hasUpdatedFrames=()=>!e.updatedFrames.length||e.updatedFrames.some(o=>o),t.getUpdatedFrames=()=>e.updatedFrames,t.setVolumeId=o=>{e.volumeId=o},t.getVolumeId=()=>e.volumeId,t.setTextureParameters=({width:o,height:c,depth:l,numberOfComponents:u,dataType:f})=>{e.width??(e.width=o),e.height??(e.height=c),e.depth??(e.depth=l),e.inputNumComps??(e.inputNumComps=u),e.inputDataType??(e.inputDataType=f)},t.getTextureParameters=()=>({width:e.width,height:e.height,depth:e.depth,numberOfComponents:e.inputNumComps,dataType:e.inputDataType})}const Gp={updatedFrames:[]};function Pl(t,e,n={}){Object.assign(e,Gp,n),Ue.extend(t,e,n),Pp(t,e)}const Ap=R.newInstance(Pl,"vtkStreamingOpenGLTexture");var Bp={newInstance:Ap,extend:Pl};const Wp={isPerformingCoordinateTransformation:!1};function Gl(t,e,n={}){Object.assign(e,Wp,n),vl.extend(t,e,n),R.setGet(t,e,["isPerformingCoordinateTransformation"]),$p(t,e)}const zp=R.newInstance(Gl,"vtkSlabCamera");function $p(t,e){e.classHierarchy.push("vtkSlabCamera");const n=X(new Float64Array(16)),r=new Float64Array(3);t.getProjectionMatrix=(i,a,s)=>{const o=Dn();if(e.projectionMatrix){const g=1/e.physicalScale;return ce(r,g,g,g),Oe(o,e.projectionMatrix),Gt(o,o,r),ue(o,o),o}X(n);let c=e.clippingRange[0],l=e.clippingRange[1];e.isPerformingCoordinateTransformation&&(c=e.distance,l=e.distance+.1);const u=l-c,f=[c+(a+1)*u/2,c+(s+1)*u/2];if(e.parallelProjection){const g=e.parallelScale*i,h=e.parallelScale,p=(e.windowCenter[0]-1)*g,d=(e.windowCenter[0]+1)*g,m=(e.windowCenter[1]-1)*h,y=(e.windowCenter[1]+1)*h;ss(n,p,d,m,y,f[0],f[1]),ue(n,n)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const g=Math.tan(gt.radiansFromDegrees(e.viewAngle)/2);let h,p;e.useHorizontalViewAngle===!0?(h=c*g,p=c*g/i):(h=c*g*i,p=c*g);const d=(e.windowCenter[0]-1)*h,m=(e.windowCenter[0]+1)*h,y=(e.windowCenter[1]-1)*p,T=(e.windowCenter[1]+1)*p,v=f[0],C=f[1];n[0]=2*v/(m-d),n[5]=2*v/(T-y),n[2]=(d+m)/(m-d),n[6]=(y+T)/(T-y),n[10]=-(v+C)/(C-v),n[14]=-1,n[11]=-2*v*C/(C-v),n[15]=0}}return Oe(o,n),o}}var jp={newInstance:zp,extend:Gl};function xt(t){return Xe(t,"vtkVolume")||Xe(t,"vtkImageSlice")}function Xe(t,e){const n="isA"in t?t:t.actor;return n?!!n.isA(e):!1}const Er=[];function Ss(t,e=0){let n;for(n=0;n<Er.length&&!(Er[n].priority<=e);n++);Er.splice(n,0,{priority:e,provider:t})}function j(t,...e){for(let n=0;n<Er.length;n++){const r=Er[n].provider(t,...e);if(r!==void 0)return r}}function Zr(t,e){const{direction:n,spacing:r}=t,i=n.slice(0,3),a=n.slice(3,6),s=n.slice(6,9),o=[fe(i,e),fe(a,e),fe(s,e)],c=$();return ce(c,o[0]*r[0],o[1]*r[1],o[2]*r[2]),en(c)}function ra(t,e,n){const{direction:r,spacing:i,imageIds:a}=t;if(!a.length)return;const s=r.slice(6,9),o=fe(s,n);if(Math.abs(o)<1-Pt)return;const l=Zr({direction:r,spacing:i},n)/2;let u;for(let f=0;f<a.length;f++){const g=a[f],{imagePositionPatient:h}=j("imagePlaneModule",g),p=$();$e(p,e,h);const d=fe(p,n);Math.abs(d)<l&&(u=g)}return u}const Hp=t=>t,Uo=1e-6;let Al=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=X(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?Q3:Hp}rotateFromDirections(e,n){const r=new Float64Array(3),i=new Float64Array(3),a=new Float64Array(16);ce(r,e[0],e[1],e[2]),ce(i,n[0],n[1],n[2]),_e(r,r),_e(i,i);const s=fe(r,i);return s>=1?this:(ve(this.tmp,r,i),en(this.tmp)<Uo&&(ve(this.tmp,[1,0,0],e),en(this.tmp)<Uo&&ve(this.tmp,[0,1,0],e)),as(a,Math.acos(s),this.tmp),se(this.matrix,this.matrix,a),this)}rotate(e,n){return ce(this.tmp,...n),_e(this.tmp,this.tmp),ct(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return ts(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return ns(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return rs(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,n,r){return ce(this.tmp,e,n,r),Se(this.matrix,this.matrix,this.tmp),this}scale(e,n,r){return ce(this.tmp,e,n,r),Gt(this.matrix,this.matrix,this.tmp),this}multiply(e){return se(this.matrix,this.matrix,e),this}multiply3x3(e){return se(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return ke(this.matrix,this.matrix),this}identity(){return X(this.matrix),this}apply(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(Xr(K0,this.matrix))return this;const i=r===-1?e.length:n+r*3;for(let a=n;a<i;a+=3)ce(this.tmp,e[a],e[a+1],e[a+2]),pe(this.tmp,this.tmp,this.matrix),e[a]=this.tmp[0],e[a+1]=this.tmp[1],e[a+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&Oe(this.matrix,e),this}};function Kp(){return new Al(!0)}function qp(){return new Al(!1)}var vn={buildFromDegree:Kp,buildFromRadian:qp};function Bl(t){const e=t.getMapper().getInputData(),n=e.extentToBounds(e.getExtent());return[[n[0],n[2],n[4]],[n[0],n[2],n[5]],[n[0],n[3],n[4]],[n[0],n[3],n[5]],[n[1],n[2],n[4]],[n[1],n[2],n[5]],[n[1],n[3],n[4]],[n[1],n[3],n[5]]]}const Xp=Pt*Pt,Ha=t=>Math.abs(Math.abs(t)-1)<Xp,Ka=(t,e)=>Ha(t[e])||Ha(t[e+1])||Ha(t[e+2]),Yp=t=>Ka(t,0)&&Ka(t,3)&&Ka(t,6);function Da(t,e,n){const r=t.getMapper().getInputData();let i;const a=r.getDirection();if(Yp(a))i=Bl(t);else{const[f,g,h]=r.getDimensions();i=[[0,0,0],[f-1,0,0],[0,g-1,0],[f-1,g-1,0],[0,0,h-1],[f-1,0,h-1],[0,g-1,h-1],[f-1,g-1,h-1]].map(d=>r.indexToWorld(d))}const s=vn.buildFromDegree().identity().rotateFromDirections(e,[1,0,0]);i.forEach(f=>s.apply(f));const o=[...n];s.apply(o);const c=o[0];let l=1/0,u=-1/0;for(let f=0;f<8;f++){const g=i[f][0];g>u&&(u=g),g<l&&(l=g)}return{min:l,max:u,current:c,actor:t,viewPlaneNormal:e,focalPoint:n}}function qn(t,e,n,r,i,a){const{min:s,max:o,current:c}=n,l=$();$e(l,e,t);const u=Math.round((o-s)/i),g=(c-s)/(o-s)*u;let h=Math.round(g),p=[t[0]-r[0]*g*i,t[1]-r[1]*g*i,t[2]-r[2]*g*i];h+=a,h>u?h=u:h<0&&(h=0);const d=h*i;p=[p[0]+r[0]*d,p[1]+r[1]*d,p[2]+r[2]*d];const m=[p[0]+l[0],p[1]+l[1],p[2]+l[2]];return{newFocalPoint:p,newPosition:m}}const Zp={RGB:0,HSV:1,LAB:2,DIVERGING:3},Jp={LINEAR:0,LOG10:1};var Wl={ColorSpace:Zp,Scale:Jp};const{ColorSpace:it,Scale:Rs}=Wl,{ScalarMappingTarget:li}=sl,{vtkDebugMacro:Qp,vtkErrorMacro:Lt,vtkWarningMacro:e6}=R;function ko(t,e){const n=t[0],r=t[1],i=t[2],a=Math.sqrt(n*n+r*r+i*i),s=a>.001?Math.acos(n/a):0,o=s>.001?Math.atan2(i,r):0;e[0]=a,e[1]=s,e[2]=o}function t6(t,e){const n=t[0],r=t[1],i=t[2];e[0]=n*Math.cos(r),e[1]=n*Math.sin(r)*Math.cos(i),e[2]=n*Math.sin(r)*Math.sin(i)}function Po(t,e){if(t[0]>=e-.1)return t[2];const n=t[1]*Math.sqrt(e*e-t[0]*t[0])/(t[0]*Math.sin(t[1]));return t[2]>-.3*Math.PI?t[2]+n:t[2]-n}function n6(t,e){let n=t-e;for(n<0&&(n=-n);n>=2*Math.PI;)n-=2*Math.PI;return n>Math.PI&&(n=2*Math.PI-n),n}function Go(t,e,n,r){const i=[],a=[];mn(e,i),mn(n,a);const s=[],o=[];ko(i,s),ko(a,o);let c=t;if(s[1]>.05&&o[1]>.05&&n6(s[2],o[2])>.33*Math.PI){let f=Math.max(s[0],o[0]);f=Math.max(88,f),t<.5?(o[0]=f,o[1]=0,o[2]=0,c*=2):(s[0]=f,s[1]=0,s[2]=0,c=2*c-1)}s[1]<.05&&o[1]>.05?s[2]=Po(o,s[0]):o[1]<.05&&s[1]>.05&&(o[2]=Po(s,o[0]));const l=[];l[0]=(1-c)*s[0]+c*o[0],l[1]=(1-c)*s[1]+c*o[1],l[2]=(1-c)*s[2]+c*o[2];const u=[];t6(l,u),ji(u,r)}function r6(t,e){e.classHierarchy.push("vtkColorTransferFunction"),t.getSize=()=>e.nodes.length,t.addRGBPoint=(n,r,i,a)=>t.addRGBPointLong(n,r,i,a,.5,0),t.addRGBPointLong=function(n,r,i,a){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;if(s<0||s>1)return Lt("Midpoint outside range [0.0, 1.0]"),-1;if(o<0||o>1)return Lt("Sharpness outside range [0.0, 1.0]"),-1;e.allowDuplicateScalars||t.removePoint(n);const c={x:n,r,g:i,b:a,midpoint:s,sharpness:o};e.nodes.push(c),t.sortAndUpdateRange();let l=0;for(;l<e.nodes.length&&e.nodes[l].x!==n;l++);return l<e.nodes.length?l:-1},t.addHSVPoint=(n,r,i,a)=>t.addHSVPointLong(n,r,i,a,.5,0),t.addHSVPointLong=function(n,r,i,a){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:0;const c=[];return An([r,i,a],c),t.addRGBPoint(n,c[0],c[1],c[2],s,o)},t.setNodes=n=>{if(e.nodes!==n){const r=JSON.stringify(e.nodes);e.nodes=n;const i=JSON.stringify(e.nodes);if(t.sortAndUpdateRange()||r!==i)return t.modified(),!0}return!1},t.sortAndUpdateRange=()=>{const n=JSON.stringify(e.nodes);e.nodes.sort((a,s)=>a.x-s.x);const r=JSON.stringify(e.nodes),i=t.updateRange();return!i&&n!==r?(t.modified(),!0):i},t.updateRange=()=>{const n=[2];n[0]=e.mappingRange[0],n[1]=e.mappingRange[1];const r=e.nodes.length;return r?(e.mappingRange[0]=e.nodes[0].x,e.mappingRange[1]=e.nodes[r-1].x):(e.mappingRange[0]=0,e.mappingRange[1]=0),n[0]===e.mappingRange[0]&&n[1]===e.mappingRange[1]?!1:(t.modified(),!0)},t.removePoint=n=>{let r=0;for(;r<e.nodes.length&&e.nodes[r].x!==n;r++);const i=r;if(r>=e.nodes.length)return-1;let a=!1;return e.nodes.splice(r,1),(r===0||r===e.nodes.length)&&(a=t.updateRange()),a||t.modified(),i},t.movePoint=(n,r)=>{if(n!==r){t.removePoint(r);for(let i=0;i<e.nodes.length;i++)if(e.nodes[i].x===n){e.nodes[i].x=r,t.sortAndUpdateRange();break}}},t.removeAllPoints=()=>{e.nodes=[],t.sortAndUpdateRange()},t.addRGBSegment=(n,r,i,a,s,o,c,l)=>{t.sortAndUpdateRange();for(let u=0;u<e.nodes.length;)e.nodes[u].x>=n&&e.nodes[u].x<=s?e.nodes.splice(u,1):u++;t.addRGBPointLong(n,r,i,a,.5,0),t.addRGBPointLong(s,o,c,l,.5,0),t.modified()},t.addHSVSegment=(n,r,i,a,s,o,c,l)=>{const u=[r,i,a],f=[o,c,l],g=[],h=[];An(u,g),An(f,h),t.addRGBSegment(n,g[0],g[1],g[2],s,h[0],h[1],h[2])},t.mapValue=n=>{const r=[];return t.getColor(n,r),[Math.floor(255*r[0]+.5),Math.floor(255*r[1]+.5),Math.floor(255*r[2]+.5),255]},t.getColor=(n,r)=>{if(e.indexedLookup){const i=t.getSize(),a=t.getAnnotatedValueIndexInternal(n);if(a<0||i===0){const s=t.getNanColorByReference();r[0]=s[0],r[1]=s[1],r[2]=s[2]}else{const s=[];t.getNodeValue(a%i,s),r[0]=s[1],r[1]=s[2],r[2]=s[3]}return}t.getTable(n,n,1,r)},t.getRedValue=n=>{const r=[];return t.getColor(n,r),r[0]},t.getGreenValue=n=>{const r=[];return t.getColor(n,r),r[1]},t.getBlueValue=n=>{const r=[];return t.getColor(n,r),r[2]},t.getTable=(n,r,i,a)=>{const s=Number(n),o=Number(r);if(uo(s)||uo(o)){for(let D=0;D<i;D++)a[D*3+0]=e.nanColor[0],a[D*3+1]=e.nanColor[1],a[D*3+2]=e.nanColor[2];return}let c=0;const l=e.nodes.length;let u=0,f=0,g=0;l!==0&&(u=e.nodes[l-1].r,f=e.nodes[l-1].g,g=e.nodes[l-1].b);let h=0,p=0,d=0;const m=[0,0,0],y=[0,0,0];let T=0,v=0;const C=[];let x=e.scale===Rs.LOG10;x&&(x=e.mappingRange[0]>0);let w=0,E=0,O=0;x&&(w=Math.log10(s),E=Math.log10(o));for(let D=0;D<i;D++){const S=3*D;if(i>1?x?(O=w+D/(i-1)*(E-w),h=10**O):h=s+D/(i-1)*(o-s):x?(O=.5*(w+E),h=10**O):h=.5*(s+o),e.discretize){const M=e.mappingRange;if(h>=M[0]&&h<=M[1]){const V=e.numberOfValues,L=M[1]-M[0];if(V<=1)h=M[0]+L/2;else{const F=(h-M[0])/L,k=Y0(V*F);h=M[0]+k/(V-1)*L}}}for(;c<l&&h>e.nodes[c].x;)c++,c<l&&(p=e.nodes[c-1].x,d=e.nodes[c].x,x&&(p=Math.log10(p),d=Math.log10(d)),m[0]=e.nodes[c-1].r,y[0]=e.nodes[c].r,m[1]=e.nodes[c-1].g,y[1]=e.nodes[c].g,m[2]=e.nodes[c-1].b,y[2]=e.nodes[c].b,T=e.nodes[c-1].midpoint,v=e.nodes[c-1].sharpness,T<1e-5&&(T=1e-5),T>.99999&&(T=.99999));if(h>e.mappingRange[1])a[S]=0,a[S+1]=0,a[S+2]=0,e.clamping&&(t.getUseAboveRangeColor()?(a[S]=e.aboveRangeColor[0],a[S+1]=e.aboveRangeColor[1],a[S+2]=e.aboveRangeColor[2]):(a[S]=u,a[S+1]=f,a[S+2]=g));else if(h<e.mappingRange[0]||F1(h)&&h<0)a[S]=0,a[S+1]=0,a[S+2]=0,e.clamping&&(t.getUseBelowRangeColor()?(a[S]=e.belowRangeColor[0],a[S+1]=e.belowRangeColor[1],a[S+2]=e.belowRangeColor[2]):l>0&&(a[S]=e.nodes[0].r,a[S+1]=e.nodes[0].g,a[S+2]=e.nodes[0].b));else if(c===0&&(Math.abs(h-s)<1e-6||e.discretize))l>0?(a[S]=e.nodes[0].r,a[S+1]=e.nodes[0].g,a[S+2]=e.nodes[0].b):(a[S]=0,a[S+1]=0,a[S+2]=0);else{let M=0;if(x?M=(O-p)/(d-p):M=(h-p)/(d-p),M<T?M=.5*M/T:M=.5+.5*(M-T)/(1-T),v>.99)if(M<.5){a[S]=m[0],a[S+1]=m[1],a[S+2]=m[2];continue}else{a[S]=y[0],a[S+1]=y[1],a[S+2]=y[2];continue}if(v<.01){if(e.colorSpace===it.RGB)a[S]=(1-M)*m[0]+M*y[0],a[S+1]=(1-M)*m[1]+M*y[1],a[S+2]=(1-M)*m[2]+M*y[2];else if(e.colorSpace===it.HSV){const I=[],U=[];dr(m,I),dr(y,U),e.hSVWrap&&(I[0]-U[0]>.5||U[0]-I[0]>.5)&&(I[0]>U[0]?I[0]-=1:U[0]-=1);const G=[];G[0]=(1-M)*I[0]+M*U[0],G[0]<0&&(G[0]+=1),G[1]=(1-M)*I[1]+M*U[1],G[2]=(1-M)*I[2]+M*U[2],An(G,C),a[S]=C[0],a[S+1]=C[1],a[S+2]=C[2]}else if(e.colorSpace===it.LAB){const I=[],U=[];mn(m,I),mn(y,U);const G=[];G[0]=(1-M)*I[0]+M*U[0],G[1]=(1-M)*I[1]+M*U[1],G[2]=(1-M)*I[2]+M*U[2],ji(G,C),a[S]=C[0],a[S+1]=C[1],a[S+2]=C[2]}else e.colorSpace===it.DIVERGING?(Go(M,m,y,C),a[S]=C[0],a[S+1]=C[1],a[S+2]=C[2]):Lt("ColorSpace set to invalid value.",e.colorSpace);continue}M<.5?M=.5*(M*2)**(1+10*v):M>.5&&(M=1-.5*((1-M)*2)**(1+10*v));const V=M*M,L=V*M,F=2*L-3*V+1,k=-2*L+3*V,b=L-2*V+M,W=L-V;let _,N;if(e.colorSpace===it.RGB)for(let I=0;I<3;I++)_=y[I]-m[I],N=(1-v)*_,a[S+I]=F*m[I]+k*y[I]+b*N+W*N;else if(e.colorSpace===it.HSV){const I=[],U=[];dr(m,I),dr(y,U),e.hSVWrap&&(I[0]-U[0]>.5||U[0]-I[0]>.5)&&(I[0]>U[0]?I[0]-=1:U[0]-=1);const G=[];for(let P=0;P<3;P++)_=U[P]-I[P],N=(1-v)*_,G[P]=F*I[P]+k*U[P]+b*N+W*N,P===0&&G[P]<0&&(G[P]+=1);An(G,C),a[S]=C[0],a[S+1]=C[1],a[S+2]=C[2]}else if(e.colorSpace===it.LAB){const I=[],U=[];mn(m,I),mn(y,U);const G=[];for(let P=0;P<3;P++)_=U[P]-I[P],N=(1-v)*_,G[P]=F*I[P]+k*U[P]+b*N+W*N;ji(G,C),a[S]=C[0],a[S+1]=C[1],a[S+2]=C[2]}else e.colorSpace===it.DIVERGING?(Go(M,m,y,C),a[S]=C[0],a[S+1]=C[1],a[S+2]=C[2]):Lt("ColorSpace set to invalid value.");for(let I=0;I<3;I++)a[S+I]=a[S+I]<0?0:a[S+I],a[S+I]=a[S+I]>1?1:a[S+I]}}},t.getUint8Table=function(n,r,i){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.getMTime()<=e.buildTime&&e.tableSize===i&&e.tableWithAlpha!==a)return e.table;if(e.nodes.length===0)return Lt("Attempting to lookup a value with no points in the function"),e.table;const s=a?4:3;(e.tableSize!==i||e.tableWithAlpha!==a)&&(e.table=new Uint8Array(i*s),e.tableSize=i,e.tableWithAlpha=a);const o=[];t.getTable(n,r,i,o);for(let c=0;c<i;c++)e.table[c*s+0]=Math.floor(o[c*3+0]*255+.5),e.table[c*s+1]=Math.floor(o[c*3+1]*255+.5),e.table[c*s+2]=Math.floor(o[c*3+2]*255+.5),a&&(e.table[c*s+3]=255);return e.buildTime.modified(),e.table},t.buildFunctionFromArray=n=>{t.removeAllPoints();const r=n.getNumberOfComponents();for(let i=0;i<n.getNumberOfTuples();i++)switch(r){case 3:{e.nodes.push({x:i,r:n.getComponent(i,0),g:n.getComponent(i,1),b:n.getComponent(i,2),midpoint:.5,sharpness:0});break}case 4:{e.nodes.push({x:n.getComponent(i,0),r:n.getComponent(i,1),g:n.getComponent(i,2),b:n.getComponent(i,3),midpoint:.5,sharpness:0});break}case 5:{e.nodes.push({x:i,r:n.getComponent(i,0),g:n.getComponent(i,1),b:n.getComponent(i,2),midpoint:n.getComponent(i,4),sharpness:n.getComponent(i,5)});break}case 6:{e.nodes.push({x:n.getComponent(i,0),r:n.getComponent(i,1),g:n.getComponent(i,2),b:n.getComponent(i,3),midpoint:n.getComponent(i,4),sharpness:n.getComponent(i,5)});break}}t.sortAndUpdateRange()},t.buildFunctionFromTable=(n,r,i,a)=>{let s=0;t.removeAllPoints(),i>1&&(s=(r-n)/(i-1));for(let o=0;o<i;o++){const c={x:n+s*o,r:a[o*3],g:a[o*3+1],b:a[o*3+2],sharpness:0,midpoint:.5};e.nodes.push(c)}t.sortAndUpdateRange()},t.getNodeValue=(n,r)=>n<0||n>=e.nodes.length?(Lt("Index out of range!"),-1):(r[0]=e.nodes[n].x,r[1]=e.nodes[n].r,r[2]=e.nodes[n].g,r[3]=e.nodes[n].b,r[4]=e.nodes[n].midpoint,r[5]=e.nodes[n].sharpness,1),t.setNodeValue=(n,r)=>{if(n<0||n>=e.nodes.length)return Lt("Index out of range!"),-1;const i=e.nodes[n].x;return e.nodes[n].x=r[0],e.nodes[n].r=r[1],e.nodes[n].g=r[2],e.nodes[n].b=r[3],e.nodes[n].midpoint=r[4],e.nodes[n].sharpness=r[5],i!==r[0]?t.sortAndUpdateRange():t.modified(),1},t.getNumberOfAvailableColors=()=>{var r;if(e.indexedLookup&&t.getSize())return t.getSize();if(e.tableSize)return e.tableSize;const n=((r=e.nodes)==null?void 0:r.length)??0;return Math.max(4094,n)},t.getIndexedColor=(n,r)=>{const i=t.getSize();if(i>0&&n>=0){const s=[];t.getNodeValue(n%i,s);for(let o=0;o<3;++o)r[o]=s[o+1];r[3]=1;return}const a=t.getNanColorByReference();r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=1},t.fillFromDataPointer=(n,r)=>{if(!(n<=0||!r)){t.removeAllPoints();for(let i=0;i<n;i++)t.addRGBPoint(r[i*4],r[i*4+1],r[i*4+2],r[i*4+3])}},t.setMappingRange=(n,r)=>{const i=[n,r],a=t.getRange();if(a[1]===i[1]&&a[0]===i[0])return;if(i[1]===i[0]){Lt("attempt to set zero width color range");return}const s=(i[1]-i[0])/(a[1]-a[0]),o=i[0]-a[0]*s;for(let c=0;c<e.nodes.length;++c)e.nodes[c].x=e.nodes[c].x*s+o;e.mappingRange[0]=i[0],e.mappingRange[1]=i[1],t.modified()},t.adjustRange=n=>{const r=t.getRange(),i=[];r[0]<n[0]?(t.getColor(n[0],i),t.addRGBPoint(n[0],i[0],i[1],i[2])):(t.getColor(r[0],i),t.addRGBPoint(n[0],i[0],i[1],i[2])),r[1]>n[1]?(t.getColor(n[1],i),t.addRGBPoint(n[1],i[0],i[1],i[2])):(t.getColor(r[1],i),t.addRGBPoint(n[1],i[0],i[1],i[2])),t.sortAndUpdateRange();for(let a=0;a<e.nodes.length;)e.nodes[a].x>=n[0]&&e.nodes[a].x<=n[1]?e.nodes.splice(a,1):++a;return 1},t.estimateMinNumberOfSamples=(n,r)=>{const i=t.findMinimumXDistance();return Math.ceil((r-n)/i)},t.findMinimumXDistance=()=>{if(e.nodes.length<2)return-1;let n=Number.MAX_VALUE;for(let r=0;r<e.nodes.length-1;r++){const i=e.nodes[r+1].x-e.nodes[r].x;i<n&&(n=i)}return n},t.mapScalarsThroughTable=(n,r,i,a)=>{if(t.getSize()===0){Qp("Transfer Function Has No Points!");return}e.indexedLookup?t.mapDataIndexed(n,r,i,a):t.mapData(n,r,i,a)},t.mapData=(n,r,i,a)=>{if(t.getSize()===0){e6("Transfer Function Has No Points!");return}const s=Math.floor(t.getAlpha()*255+.5),o=n.getNumberOfTuples(),c=n.getNumberOfComponents(),l=r.getData(),u=n.getData(),f=[];if(i===li.RGBA)for(let g=0;g<o;g++){const h=u[g*c+a];t.getColor(h,f),l[g*4]=Math.floor(f[0]*255+.5),l[g*4+1]=Math.floor(f[1]*255+.5),l[g*4+2]=Math.floor(f[2]*255+.5),l[g*4+3]=s}if(i===li.RGB)for(let g=0;g<o;g++){const h=u[g*c+a];t.getColor(h,f),l[g*3]=Math.floor(f[0]*255+.5),l[g*3+1]=Math.floor(f[1]*255+.5),l[g*3+2]=Math.floor(f[2]*255+.5)}if(i===li.LUMINANCE)for(let g=0;g<o;g++){const h=u[g*c+a];t.getColor(h,f),l[g]=Math.floor(f[0]*76.5+f[1]*150.45+f[2]*28.05+.5)}if(i===li.LUMINANCE_ALPHA)for(let g=0;g<o;g++){const h=u[g*c+a];t.getColor(h,f),l[g*2]=Math.floor(f[0]*76.5+f[1]*150.45+f[2]*28.05+.5),l[g*2+1]=s}},t.applyColorMap=n=>{const r=JSON.stringify(e.colorSpace);n.ColorSpace&&(e.colorSpace=it[n.ColorSpace.toUpperCase()],e.colorSpace===void 0&&(Lt(`ColorSpace ${n.ColorSpace} not supported, using RGB instead`),e.colorSpace=it.RGB));let i=r!==JSON.stringify(e.colorSpace);const a=i||JSON.stringify(e.nanColor);if(n.NanColor)for(e.nanColor=[].concat(n.NanColor);e.nanColor.length<4;)e.nanColor.push(1);i=i||a!==JSON.stringify(e.nanColor);const s=i||JSON.stringify(e.nodes);if(n.RGBPoints){const l=n.RGBPoints.length;e.nodes=[];const u=.5,f=0;for(let g=0;g<l;g+=4)e.nodes.push({x:n.RGBPoints[g],r:n.RGBPoints[g+1],g:n.RGBPoints[g+2],b:n.RGBPoints[g+3],midpoint:u,sharpness:f})}const o=t.sortAndUpdateRange(),c=!o&&(i||s!==JSON.stringify(e.nodes));return c&&t.modified(),o||c}}const i6={clamping:!0,colorSpace:it.RGB,hSVWrap:!0,scale:Rs.LINEAR,nanColor:null,belowRangeColor:null,aboveRangeColor:null,useAboveRangeColor:!1,useBelowRangeColor:!1,allowDuplicateScalars:!1,table:null,tableSize:0,buildTime:null,nodes:null,discretize:!1,numberOfValues:256};function zl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,i6,n),sl.extend(t,e,n),e.table=[],e.nodes=[],e.nanColor=[.5,0,0,1],e.belowRangeColor=[0,0,0,1],e.aboveRangeColor=[1,1,1,1],e.buildTime={},R.obj(e.buildTime),R.get(t,e,["buildTime","mappingRange"]),R.setGet(t,e,["useAboveRangeColor","useBelowRangeColor","discretize","numberOfValues",{type:"enum",name:"colorSpace",enum:it},{type:"enum",name:"scale",enum:Rs}]),R.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),R.getArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"]),r6(t,e)}const a6=R.newInstance(zl,"vtkColorTransferFunction");var Mn={newInstance:a6,extend:zl,...Wl},s6=[{Name:"KAAMS",IndexedColors:[1,1,1,1,0,0,0,1,0,0,0,1,1,1,0,1,0,1,0,1,1,.63,.63,1,.67,.5,.33,1,.5,.75,.53,.35,.7,1,.75,.5],Annotations:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11]},{ColorSpace:"Diverging",Name:"Cool to Warm",NanColor:[1,1,0],RGBPoints:[0,.23137254902,.298039215686,.752941176471,.5,.865,.865,.865,1,.705882352941,.0156862745098,.149019607843]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Cool to Warm (Extended)",NanColor:[.25,0,0],RGBPoints:[0,0,0,.34902,.03125,.039216,.062745,.380392,.0625,.062745,.117647,.411765,.09375,.090196,.184314,.45098,.125,.12549,.262745,.501961,.15625,.160784,.337255,.541176,.1875,.2,.396078,.568627,.21875,.239216,.454902,.6,.25,.286275,.521569,.65098,.28125,.337255,.592157,.701961,.3125,.388235,.654902,.74902,.34375,.466667,.737255,.819608,.375,.572549,.819608,.878431,.40625,.654902,.866667,.909804,.4375,.752941,.917647,.941176,.46875,.823529,.956863,.968627,.5,.988235,.960784,.901961,.5,.941176,.984314,.988235,.52,.988235,.945098,.85098,.54,.980392,.898039,.784314,.5625,.968627,.835294,.698039,.59375,.94902,.733333,.588235,.625,.929412,.65098,.509804,.65625,.909804,.564706,.435294,.6875,.878431,.458824,.352941,.71875,.839216,.388235,.286275,.75,.760784,.294118,.211765,.78125,.701961,.211765,.168627,.8125,.65098,.156863,.129412,.84375,.6,.094118,.094118,.875,.54902,.066667,.098039,.90625,.501961,.05098,.12549,.9375,.45098,.054902,.172549,.96875,.4,.054902,.192157,1,.34902,.070588,.211765]},{ColorSpace:"Diverging",Name:"Warm to Cool",NanColor:[1,1,0],RGBPoints:[0,.705882352941,.0156862745098,.149019607843,.5,.865,.865,.865,1,.23137254902,.298039215686,.752941176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Warm to Cool (Extended)",NanColor:[.250004,0,0],RGBPoints:[0,.34902,0,.129412,.025,.4,.00392157,.101961,.05,.470588,.0156863,.0901961,.075,.54902,.027451,.0705882,.1,.619608,.0627451,.0431373,.125,.690196,.12549,.0627451,.15,.741176,.184314,.0745098,.175,.788235,.266667,.0941176,.2,.811765,.345098,.113725,.225,.831373,.411765,.133333,.25,.85098,.47451,.145098,.275,.870588,.54902,.156863,.3,.878431,.619608,.168627,.325,.890196,.658824,.196078,.35,.909804,.717647,.235294,.375,.929412,.776471,.278431,.395522,.94902,.823529,.321569,.418905,.968627,.87451,.407843,.444278,.980392,.917647,.509804,.470149,.988235,.956863,.643137,.483582,.992157,.964706,.713725,.499,.988235,.980392,.870588,.5,1,1,1,.501,.913725,.988235,.937255,.516418,.827451,.980392,.886275,.531343,.764706,.980392,.866667,.546766,.658824,.980392,.843137,.564179,.572549,.964706,.835294,.587562,.423529,.941176,.87451,.60597,.262745,.901961,.862745,.629851,.0705882,.854902,.870588,.651741,.0509804,.8,.85098,.681592,.0235294,.709804,.831373,.712935,.0313725,.615686,.811765,.75,.0313725,.537255,.788235,.775,.0392157,.466667,.768627,.8,.0509804,.396078,.741176,.825,.054902,.317647,.709804,.85,.054902,.243137,.678431,.875,.0431373,.164706,.639216,.9,.0313725,.0980392,.6,.925,.0392157,.0392157,.560784,.95,.105882,.0509804,.509804,.975,.113725,.0235294,.45098,1,.12549,0,.380392]},{ColorSpace:"RGB",Name:"Rainbow Desaturated",NanColor:[1,1,0],RGBPoints:[0,.278431372549,.278431372549,.858823529412,.143,0,0,.360784313725,.285,0,1,1,.429,0,.501960784314,0,.571,1,1,0,.714,1,.380392156863,0,.857,.419607843137,0,0,1,.878431372549,.301960784314,.301960784314]},{ColorSpace:"RGB",Name:"Cold and Hot",NanColor:[1,1,0],RGBPoints:[0,0,1,1,.45,0,0,1,.5,0,0,.501960784314,.55,1,0,0,1,1,1,0]},{ColorSpace:"RGB",Name:"Black-Body Radiation",NanColor:[0,.498039215686,1],RGBPoints:[0,0,0,0,.4,.901960784314,0,0,.8,.901960784314,.901960784314,0,1,1,1,1]},{ColorSpace:"RGB",Name:"X Ray",NanColor:[1,0,0],RGBPoints:[0,1,1,1,1,0,0,0]},{ColorSpace:"RGB",Name:"Grayscale",NanColor:[1,0,0],RGBPoints:[0,0,0,0,1,1,1,1]},{ColorSpace:"RGB",Name:"BkRd",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,1,0,0]},{ColorSpace:"RGB",Name:"BkGn",NanColor:[1,0,1],RGBPoints:[0,0,0,0,1,0,1,0]},{ColorSpace:"RGB",Name:"BkBu",NanColor:[1,1,0],RGBPoints:[0,0,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"BkMa",NanColor:[0,1,0],RGBPoints:[0,0,0,0,1,1,0,1]},{ColorSpace:"RGB",Name:"BkCy",NanColor:[0,1,1],RGBPoints:[0,0,0,0,1,0,1,1]},{ColorSpace:"RGB",Name:"Black, Blue and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,0,0,.501960784314,.666,0,.501960784314,1,1,1,1,1]},{ColorSpace:"RGB",Name:"Black, Orange and White",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.333,.501960784314,0,0,.666,1,.501960784314,0,1,1,1,1]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear YGB 1211g",NanColor:[.25,0,0],RGBPoints:[0,1,.988235,.968627,.02,1,.952941,.878431,.05,.968627,.905882,.776471,.1,.94902,.898039,.647059,.15,.901961,.878431,.556863,.2,.847059,.858824,.482353,.25,.690196,.819608,.435294,.3,.513725,.768627,.384314,.35,.337255,.721569,.337255,.4,.278431,.658824,.392157,.45,.231373,.639216,.435294,.5,.203922,.6,.486275,.55,.172549,.568627,.537255,.6,.141176,.517647,.54902,.65,.133333,.458824,.541176,.7,.12549,.396078,.529412,.75,.117647,.321569,.521569,.8,.121569,.258824,.509804,.85,.133333,.227451,.501961,.9,.145098,.192157,.490196,.95,.188235,.164706,.470588,1,.258824,.196078,.439216]},{ColorSpace:"CIELAB",Creator:"Francesca Samsel",Name:"Linear Green (Gr4L)",NanColor:[.25,0,0],RGBPoints:[0,.054902,.109804,.121569,.05,.07451,.172549,.180392,.1,.086275,.231373,.219608,.15,.094118,.278431,.25098,.2,.109804,.34902,.278431,.25,.113725,.4,.278431,.3,.117647,.45098,.270588,.35,.117647,.490196,.243137,.4,.113725,.521569,.203922,.45,.109804,.54902,.152941,.5,.082353,.588235,.082353,.55,.109804,.631373,.05098,.6,.211765,.678431,.082353,.65,.317647,.721569,.113725,.7,.431373,.760784,.160784,.75,.556863,.8,.239216,.8,.666667,.839216,.294118,.85,.784314,.878431,.396078,.9,.886275,.921569,.533333,.95,.960784,.94902,.670588,1,1,.984314,.901961]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Linear Blue (8_31f)",NanColor:[.25,0,0],RGBPoints:[0,.960784,1,.980392,.05,.815686,.960784,.913725,.1,.670588,.929412,.870588,.15,.556863,.901961,.843137,.2,.478431,.870588,.823529,.25,.439216,.831373,.803922,.3,.4,.8,.788235,.35,.376471,.768627,.768627,.4,.34902,.709804,.729412,.45,.32549,.654902,.690196,.5,.301961,.607843,.658824,.55,.247059,.545098,.619608,.6,.239216,.494118,.580392,.65,.227451,.439216,.541176,.7,.227451,.403922,.521569,.75,.231373,.368627,.501961,.8,.227451,.321569,.470588,.85,.219608,.282353,.439216,.9,.192157,.235294,.4,.95,.160784,.184314,.34902,1,.133333,.12549,.301961]},{ColorSpace:"HSV",Name:"Blue to Red Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,0,0,1,1,1,0,0]},{ColorSpace:"HSV",Name:"Red to Blue Rainbow",NanColor:[.498039215686,.498039215686,.498039215686],RGBPoints:[0,1,0,0,1,0,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended White",NanColor:[1,1,0],RGBPoints:[0,1,1,1,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Grey",NanColor:[1,1,0],RGBPoints:[0,.317647058824,.341176470588,.43137254902,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Rainbow Blended Black",NanColor:[1,1,0],RGBPoints:[0,0,0,0,.17,0,0,1,.34,0,1,1,.5,0,1,0,.67,1,1,0,.84,1,0,0,1,.878431372549,0,1]},{ColorSpace:"RGB",Name:"Blue to Yellow",NanColor:[1,0,0],RGBPoints:[0,.0392156862745,.0392156862745,.949019607843,1,.949019607843,.949019607843,.0392156862745]},{ColorSpace:"HSV",Name:"blot",RGBPoints:[0,0,0,1,.166,0,0,1,.167,1,0,1,.332,1,0,1,.333,0,1,1,.5,0,1,1,.501,0,1,0,.666,0,1,0,.667,1,1,0,.832,1,1,0,.833,1,0,0,1,1,0,0]},{ColorSpace:"Lab",Name:"CIELab Blue to Red",NanColor:[1,1,0],RGBPoints:[0,0,.6,.749019607843,1,.76862745098,.466666666667,.341176470588]},{ColorSpace:"RGB",Name:"jet",RGBPoints:[-1,0,0,.5625,-.777778,0,0,1,-.269841,0,1,1,-.015873,.5,1,.5,.238095,1,1,0,.746032,1,0,0,1,.5,0,0]},{ColorSpace:"RGB",Name:"rainbow",RGBPoints:[-1,0,0,1,-.5,0,1,1,0,0,1,0,.5,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"erdc_rainbow_bright",RGBPoints:[-1,.32549,.14902,.960784,-.866221,.297047,.375586,.963836,-.732441,.180302,.536818,.964627,-.598662,.1302,.649207,.929647,-.464883,.0445143,.749654,.855998,-.331104,.0271325,.830713,.721527,-.197324,.259504,.866145,.543555,-.0635452,.428364,.890725,.329819,.0702341,.568503,.898508,.187623,.204013,.738259,.890317,.0825461,.337793,.84546,.86136,.0147555,.471572,.912191,.808018,0,.605351,.962848,.710445,0,.73913,.999469,.600258,.0176284,.87291,.994156,.445975,.193912,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"erdc_rainbow_dark",RGBPoints:[-1,0,0,.423499,-.866221,0,.119346,.529237,-.732441,0,.238691,.634976,-.598662,0,.346852,.68788,-.464883,0,.45022,.718141,-.331104,0,.553554,.664839,-.197324,0,.651082,.519303,-.0635452,.115841,.72479,.352857,.0702341,.326771,.781195,.140187,.204013,.522765,.798524,.0284624,.337793,.703162,.788685,.00885756,.471572,.845118,.751133,0,.605351,.955734,.690825,0,.73913,.995402,.567916,.0618524,.87291,.987712,.403398,.164851,1,.980407,.247105,.262699]},{ColorSpace:"Lab",Name:"nic_CubicL",RGBPoints:[-1,.479965,.0118108,.5307,-.87451,.522213,.0551282,.706919,-.74902,.50839,.237278,.867764,-.623529,.451617,.373834,.987255,-.498039,.39365,.497255,.97506,-.372549,.328631,.599639,.891843,-.247059,.250043,.690286,.778553,-.121569,.249656,.764905,.645857,.00392157,.297954,.821466,.50449,.129412,.337509,.872595,.358447,.254902,.430011,.913789,.297079,.380392,.587191,.931381,.333353,.505882,.727937,.93591,.353742,.631373,.826403,.921081,.365066,.756863,.893201,.846317,.372662,.882353,.965347,.73884,.378506,1,.983235,.597451,.366856]},{ColorSpace:"Lab",Name:"nic_CubicYF",RGBPoints:[-1,.5151,.0482,.6697,-.87451,.520711,.168955,.800574,-.74902,.493694,.278596,.911824,-.623529,.440026,.369475,.984978,-.498039,.398932,.457593,.987053,-.372549,.350651,.540644,.929608,-.247059,.298827,.615625,.857729,-.121569,.239928,.685061,.769531,.00392157,.228832,.739349,.673287,.129412,.263297,.78608,.569988,.254902,.298107,.828337,.460214,.380392,.33092,.864071,.352674,.505882,.38306,.898169,.287309,.631373,.49023,.917481,.307961,.756863,.62372,.926026,.332309,.882353,.717458,.92527,.342476,1,.8,.9255,.3529]},{ColorSpace:"Lab",Name:"gist_earth",RGBPoints:[-1,0,0,0,-.87451,.239216,.027451,.415686,-.74902,.0901961,.254902,.556863,-.623529,.0941176,.352941,.54902,-.498039,.105882,.435294,.533333,-.372549,.12549,.52549,.501961,-.247059,.156863,.596078,.443137,-.121569,.196078,.65098,.380392,.00392157,.282353,.717647,.301961,.129412,.466667,.772549,.27451,.254902,.678431,.784314,.309804,.380392,.901961,.756863,.376471,.505882,.992157,.705882,.521569,.631373,1,.721569,.701961,.756863,1,.784314,.784314,.882353,1,.866667,.866667,1,1,1,1]},{ColorSpace:"Lab",Name:"2hot",RGBPoints:[-1,.0416667,0,0,-.873016,.208333,0,0,-.746032,.375,0,0,-.619048,.541667,0,0,-.492063,.708333,0,0,-.365079,.854137,0,0,-.238095,.937488,.039062,0,-.111111,1,.208333,0,.015873,1,.375,0,.142857,1,.541667,0,.269841,1,.708333,0,.396825,1,.858805,.03125,.52381,1,.947392,.15625,.650794,1,1,.3125,.777778,1,1,.5625,.904762,1,1,.8125,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_red2yellow_BW",RGBPoints:[-1,754296e-12,0,109827e-10,-.87451,.18285,.0264094,0,-.74902,.3066,0,0,-.623529,.422841,0,0,-.498039,.522945,0,0,-.372549,.605721,0,0,-.247059,.672502,.14168,0,-.121569,.728167,.244025,0,.00392157,.781215,.333454,0,.129412,.825,.423586,0,.254902,.855893,.516793,0,.380392,.880491,.608846,0,.505882,.910305,.695505,0,.631373,.94109,.779067,.223528,.756863,.967873,.858572,.473521,.882353,.986815,.933211,.751583,1,1,1,.999997]},{ColorSpace:"Lab",Name:"erdc_marine2gold_BW",RGBPoints:[-1,111641e-12,0,162551e-11,-.87451,.0413146,.0619808,.209857,-.74902,.0185557,.101341,.350684,-.623529,.00486405,.149847,.461054,-.498039,.0836345,.210845,.517906,-.372549,.173222,.276134,.541793,-.247059,.259857,.343877,.535869,-.121569,.362299,.408124,.504293,.00392157,.468266,.468276,.468257,.129412,.582781,.527545,.374914,.254902,.691591,.585251,.274266,.380392,.784454,.645091,.247332,.505882,.862299,.710383,.27518,.631373,.920863,.782923,.351563,.756863,.955792,.859699,.533541,.882353,.976162,.93433,.780671,1,1,1,.999983]},{ColorSpace:"Lab",Name:"erdc_blue2gold_BW",RGBPoints:[-1,0,0,0,-.87451,.0742735,.0440331,.230013,-.74902,.125276,.0258685,.415826,-.623529,.143879,.0163031,.591346,-.498039,.212261,.0627855,.705239,-.372549,.306048,.141178,.763636,-.247059,.391537,.232286,.773263,-.121569,.461734,.336633,.708321,.00392157,.54209,.427581,.590007,.129412,.61704,.508623,.460978,.254902,.702703,.579586,.309117,.380392,.790336,.644811,.170397,.505882,.870173,.710733,.117134,.631373,.93656,.781991,.157144,.756863,.965672,.862068,.409836,.882353,.985751,.936296,.714162,1,1,1,.999999]},{ColorSpace:"Lab",Name:"erdc_sapphire2gold_BW",RGBPoints:[-1,.107704,.107708,.107694,-.87451,.1851,.112354,.308554,-.74902,.236782,.114233,.48788,-.623529,.28296,.126187,.639464,-.498039,.344787,.171643,.739713,-.372549,.413325,.242371,.76913,-.247059,.481863,.3131,.719841,-.121569,.550402,.383829,.612222,.00392157,.61894,.454558,.51126,.129412,.687478,.525287,.39993,.254902,.756017,.596016,.289923,.380392,.824555,.666745,.255498,.505882,.892979,.736822,.27696,.631373,.938851,.804966,.351734,.756863,.966491,.874853,.53572,.882353,.982105,.94153,.782579,1,1,1,.999986]},{ColorSpace:"Lab",Name:"erdc_red2purple_BW",RGBPoints:[-1,0,0,0,-.87451,.167793,.0166271,.0431278,-.74902,.262608,.0107595,.0791181,-.623529,.351902,.0101858,.100926,-.498039,.441257,.0160835,.131919,-.372549,.5221,.0555972,.195625,-.247059,.593852,.104294,.310234,-.121569,.654628,.158115,.448486,.00392157,.707443,.220914,.570253,.129412,.749504,.293268,.67897,.254902,.781587,.370517,.779269,.380392,.809951,.451099,.855831,.505882,.84424,.531462,.900451,.631373,.865174,.620901,.91606,.756863,.875041,.714054,.910284,.882353,.880764,.80554,.896276,1,.887572,.887591,.887556]},{ColorSpace:"Lab",Name:"erdc_purple2pink_BW",RGBPoints:[-1,0,0,0,-.87451,.117562,.0291202,.175876,-.74902,.178368,.0458476,.285454,-.623529,.237731,.0680173,.387717,-.498039,.300877,.0956291,.484802,-.372549,.370929,.136858,.554985,-.247059,.449033,.189273,.58863,-.121569,.529971,.245796,.598587,.00392157,.609914,.300643,.610244,.129412,.697079,.351286,.616371,.254902,.785858,.401991,.617376,.380392,.862517,.45745,.64463,.505882,.91359,.525462,.705336,.631373,.932583,.61064,.767412,.756863,.922478,.706966,.817522,.882353,.901302,.803071,.856311,1,.887571,.887591,.887549]},{ColorSpace:"Lab",Name:"erdc_pbj_lin",RGBPoints:[-1,0,0,0,-.87451,.091821,.0611476,.10617,-.74902,.160311,.0900022,.192713,-.623529,.22484,.12126,.272128,-.498039,.291263,.157469,.340828,-.372549,.360015,.200388,.388903,-.247059,.437497,.250058,.387201,-.121569,.512636,.304969,.355955,.00392157,.582603,.360874,.33488,.129412,.655126,.416374,.306351,.254902,.725889,.473329,.279051,.380392,.778125,.537928,.302697,.505882,.815894,.606931,.382431,.631373,.839159,.679308,.497608,.756863,.854748,.751666,.631792,.882353,.869483,.822508,.768592,1,.887572,.887589,.887565]},{ColorSpace:"Lab",Name:"erdc_blue2green_muted",RGBPoints:[-1,.107704,.107708,.107695,-.87451,.141522,.13066,.270741,-.74902,.180123,.146119,.42308,-.623529,.210161,.169674,.551795,-.498039,.239701,.212939,.634969,-.372549,.253916,.282947,.653641,-.247059,.242791,.366933,.608521,-.121569,.226302,.446776,.52693,.00392157,.236237,.514689,.458798,.129412,.274641,.577589,.376069,.254902,.349625,.633993,.288131,.380392,.4437,.683677,.260497,.505882,.536247,.731214,.285424,.631373,.628472,.777128,.349151,.756863,.718259,.819287,.496825,.882353,.804768,.856164,.703299,1,.887571,.887591,.887548]},{ColorSpace:"Lab",Name:"erdc_blue2green_BW",RGBPoints:[-1,363578e-12,0,529374e-11,-.87451,.0539915,.0577948,.212806,-.74902,.0620393,.0758942,.388959,-.623529,.0697499,.102032,.54177,-.498039,.113295,.156156,.64334,-.372549,.152047,.243196,.670283,-.247059,.158096,.344084,.622864,-.121569,.151142,.43922,.532767,.00392157,.17155,.521588,.457719,.129412,.225861,.599141,.363997,.254902,.32328,.67007,.259083,.380392,.442344,.733697,.223754,.505882,.558409,.794941,.257411,.631373,.673875,.854344,.340822,.756863,.787244,.909326,.524717,.882353,.896483,.958063,.775914,1,1,1,.999982]},{ColorSpace:"Lab",Name:"GREEN-WHITE_LINEAR",RGBPoints:[-1,0,0,0,-.87451,0,.062745,0,-.74902,0,.12549,0,-.623529,0,.188235,0,-.498039,0,.25098,0,-.372549,0,.313725,0,-.247059,0,.376471,0,-.121569,.094118,.439216,0,.00392157,.196078,.501961,0,.129412,.294118,.564706,0,.254902,.396078,.627451,0,.380392,.498039,.690196,0,.505882,.6,.752941,.145098,.631373,.701961,.815686,.364706,.756863,.8,.878431,.580392,.882353,.901961,.941176,.796078,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_green2yellow_BW",RGBPoints:[-1,0,0,0,-.87451,0,.105542,.0603919,-.74902,0,.159454,.104148,-.623529,0,.219502,.15542,-.498039,0,.282276,.203811,-.372549,0,.346331,.235652,-.247059,0,.411765,.235428,-.121569,0,.477177,.217977,.00392157,.0593644,.541635,.21361,.129412,.233081,.604722,.210591,.254902,.369803,.664942,.226536,.380392,.498446,.722367,.288237,.505882,.601929,.782244,.380815,.631373,.703207,.840497,.512134,.756863,.803186,.896433,.674462,.882353,.903834,.950266,.846715,1,1,1,.999981]},{ColorSpace:"Lab",Name:"blue2cyan",RGBPoints:[-1,0,0,0,-.87451,0,.152941,.364706,-.74902,0,.254902,.470588,-.623529,0,.34902,.572549,-.498039,0,.443137,.670588,-.372549,0,.537255,.772549,-.247059,0,.627451,.870588,-.121569,0,.717647,.964706,.00392157,.0784314,.772549,1,.129412,.207843,.858824,1,.254902,.32549,.941176,1,.380392,.45098,1,1,.505882,.560784,1,1,.631373,.662745,1,1,.756863,.760784,1,1,.882353,.870588,1,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_blue2cyan_BW",RGBPoints:[-1,405298e-12,0,59012e-10,-.87451,.0207526,.0740933,.18093,-.74902,0,.121033,.30343,-.623529,0,.166892,.416095,-.498039,0,.216768,.524796,-.372549,.0164769,.275471,.608585,-.247059,.0544527,.344824,.659267,-.121569,.0880643,.419118,.688675,.00392157,.127938,.492556,.720256,.129412,.149476,.566946,.756918,.254902,.188961,.641333,.792122,.380392,.245482,.715336,.827609,.505882,.329216,.786235,.874761,.631373,.453558,.852803,.918466,.756863,.626281,.910493,.954,.882353,.82257,.958709,.980146,1,1,1,.999989]},{ColorSpace:"Lab",Name:"erdc_blue_BW",RGBPoints:[-1,0,0,0,-.87451,.0425591,.0763529,.150682,-.74902,.0569472,.119154,.275403,-.623529,.0635978,.164772,.395427,-.498039,.0774342,.213851,.510014,-.372549,.106815,.267034,.615102,-.247059,.122093,.324649,.720068,-.121569,.160851,.387068,.806956,.00392157,.213754,.453516,.878012,.129412,.26722,.524656,.932436,.254902,.326844,.599279,.968038,.380392,.403403,.674712,.984784,.505882,.499703,.745519,1,.631373,.615055,.813983,1,.756863,.74405,.879228,1,.882353,.877909,.941913,1,1,1,1,.999996]},{ColorSpace:"Lab",Name:"BLUE-WHITE",RGBPoints:[-1,0,0,0,-.87451,0,0,.082353,-.74902,0,0,.168627,-.623529,0,0,.254902,-.498039,0,0,.337255,-.372549,0,0,.423529,-.247059,0,0,.509804,-.121569,0,.101961,.592157,.00392157,0,.203922,.678431,.129412,0,.301961,.764706,.254902,0,.403922,.85098,.380392,0,.505882,.933333,.505882,0,.603922,1,.631373,.254902,.705882,1,.756863,.509804,.807843,1,.882353,.764706,.905882,1,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_purple_BW",RGBPoints:[-1,4264e-11,0,620844e-12,-.87451,.100579,.0593111,.145666,-.74902,.167794,.0889224,.254953,-.623529,.231446,.123339,.360511,-.498039,.296699,.163027,.461278,-.372549,.363211,.209286,.55306,-.247059,.431136,.260776,.637195,-.121569,.498202,.320012,.705799,.00392157,.567456,.380459,.778091,.129412,.629381,.445284,.8448,.254902,.688373,.517374,.895694,.380392,.74891,.590906,.93976,.505882,.805017,.667956,.977626,.631373,.850914,.752618,.992396,.756863,.89724,.838454,.994093,.882353,.948461,.922603,.994449,1,1,1,.999967]},{ColorSpace:"Lab",Name:"erdc_magenta_BW",RGBPoints:[-1,0,0,254023e-10,-.87451,.128696,.0456782,.11635,-.74902,.228133,.0476299,.201452,-.623529,.327273,.0374065,.282107,-.498039,.420953,.0408166,.35709,-.372549,.511562,.0642203,.430511,-.247059,.599552,.102686,.504257,-.121569,.684646,.150536,.579429,.00392157,.765817,.205978,.656062,.129412,.839176,.27229,.731807,.254902,.89536,.357594,.797309,.380392,.930238,.457825,.846984,.505882,.945921,.564536,.880571,.631373,.948995,.670753,.902279,.756863,.947124,.772819,.918171,.882353,.947265,.869424,.934352,1,.954719,.95475,.954726]},{ColorSpace:"Lab",Name:"magenta",RGBPoints:[-1,0,0,0,-.87451,.364706,0,.152941,-.74902,.470588,0,.254902,-.623529,.572549,0,.34902,-.498039,.670588,0,.443137,-.372549,.772549,0,.537255,-.247059,.870588,0,.627451,-.121569,.964706,0,.717647,.00392157,1,.0784314,.772549,.129412,1,.207843,.858824,.254902,1,.32549,.941176,.380392,1,.45098,1,.505882,1,.560784,1,.631373,1,.662745,1,.756863,1,.760784,1,.882353,1,.870588,1,1,1,1,1]},{ColorSpace:"Lab",Name:"RED-PURPLE",RGBPoints:[-1,0,0,0,-.87451,.188235,0,.007843,-.74902,.345098,0,.035294,-.623529,.439216,0,.098039,-.498039,.533333,0,.152941,-.372549,.627451,.015686,.211765,-.247059,.721569,.031373,.266667,-.121569,.8,.047059,.329412,.00392157,.862745,.047059,.403922,.129412,.941176,.062745,.466667,.254902,.988235,.078431,.54902,.380392,.988235,.141176,.643137,.505882,.988235,.25098,.729412,.631373,.988235,.376471,.811765,.756863,.988235,.54902,.886275,.882353,.988235,.752941,.952941,1,.996078,.996078,.996078]},{ColorSpace:"Lab",Name:"erdc_red_BW",RGBPoints:[-1,0,0,0,-.87451,.147204,.0480135,.0401815,-.74902,.253411,.0617478,.0301333,-.623529,.356059,.0746331,.0446897,-.498039,.457731,.0934935,.0636931,-.372549,.557199,.122714,.0860013,-.247059,.665179,.144238,.105585,-.121569,.763833,.187056,.138326,.00392157,.847035,.254558,.189407,.129412,.905663,.345937,.258215,.254902,.941431,.447111,.346277,.380392,.962608,.546927,.457571,.505882,.987833,.637276,.569944,.631373,.994202,.732176,.687958,.756863,.993304,.826268,.800567,.882353,.994413,.917205,.906393,1,1,1,.999979]},{ColorSpace:"Lab",Name:"RED_TEMPERATURE",RGBPoints:[-1,0,0,0,-.87451,.090196,0,0,-.74902,.180392,0,0,-.623529,.270588,0,0,-.498039,.360784,0,0,-.372549,.45098,0,0,-.247059,.545098,0,0,-.121569,.635294,0,0,.00392157,.72549,.058824,0,.129412,.815686,.176471,0,.254902,.905882,.294118,0,.380392,1,.411765,0,.505882,1,.533333,.027451,.631373,1,.65098,.27451,.756863,1,.768627,.521569,.882353,1,.886275,.768627,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_orange_BW",RGBPoints:[-1,0,0,253806e-10,-.87451,.135871,.0593824,0,-.74902,.224328,.0907216,0,-.623529,.318083,.119647,0,-.498039,.414443,.150246,0,-.372549,.511077,.184884,0,-.247059,.605501,.226033,0,-.121569,.695274,.275491,0,.00392157,.777826,.334445,0,.129412,.851498,.402441,0,.254902,.915899,.47759,602975e-9,.380392,.971984,.557882,.0361443,.505882,1,.641287,.135967,.631373,1,.725198,.27997,.756863,1,.808205,.438135,.882353,1,.89306,.587036,1,1,.977928,.721599]},{ColorSpace:"Lab",Name:"heated_object",RGBPoints:[-1,0,0,0,-.87451,.34902,.0862745,0,-.74902,.45098,.172549,0,-.623529,.52549,.231373,0,-.498039,.580392,.278431,0,-.372549,.623529,.313725,0,-.247059,.670588,.352941,0,-.121569,.717647,.392157,0,.00392157,.772549,.439216,0,.129412,.839216,.494118,0,.254902,.901961,.541176,0,.380392,.968627,.6,0,.505882,1,.658824,0,.631373,1,.721569,0,.756863,1,.827451,.298039,.882353,1,.976471,.72549,1,1,1,1]},{ColorSpace:"Lab",Name:"erdc_gold_BW",RGBPoints:[-1,0,0,190933e-10,-.87451,.128363,.0636265,0,-.74902,.193795,.111057,0,-.623529,.25976,.15987,0,-.498039,.328546,.210589,0,-.372549,.399726,.26332,0,-.247059,.472969,.318261,0,-.121569,.546245,.375827,0,.00392157,.61745,.436719,0,.129412,.685545,.501113,0,.254902,.749578,.568799,0,.380392,.80962,.6394,0,.505882,.865572,.712699,.10257,.631373,.917709,.787569,.233665,.756863,.966914,.863138,.369608,.882353,1,.939405,.496104,1,.999225,1,.612275]},{ColorSpace:"Lab",Name:"erdc_brown_BW",RGBPoints:[-1,33216e-11,0,483629e-11,-.87451,.14693,.0518172,0,-.74902,.225806,.0814996,0,-.623529,.301681,.111452,0,-.498039,.370487,.150664,0,-.372549,.43108,.199477,0,-.247059,.4849,.255107,0,-.121569,.536798,.313486,0,.00392157,.59286,.371167,0,.129412,.653119,.428135,0,.254902,.714589,.485917,.0379541,.380392,.774667,.54565,.116634,.505882,.831222,.608047,.183895,.631373,.880305,.674199,.260298,.756863,.922314,.742472,.367086,.882353,.959408,.811222,.497258,1,.993548,.875183,.622093]},{ColorSpace:"Lab",Name:"copper_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0784314,.0501961,.0313725,-.74902,.156863,.100392,.0627451,-.623529,.235294,.150588,.0941176,-.498039,.313725,.200784,.12549,-.372549,.392157,.25098,.156863,-.247059,.470588,.301176,.188235,-.121569,.54902,.351373,.219608,.00392157,.627451,.401569,.25098,.129412,.705882,.451765,.282353,.254902,.784314,.501961,.313725,.380392,.862745,.552157,.345098,.505882,.941176,.602353,.376471,.631373,1,.652549,.407843,.756863,1,.702745,.439216,.882353,1,.752941,.470588,1,1,.8,.5]},{ColorSpace:"Lab",Name:"pink_Matlab",RGBPoints:[-1,0,0,0,-.87451,.312416,.204524,.204524,-.74902,.441822,.289241,.289241,-.623529,.54112,.354246,.354246,-.498039,.624831,.409048,.409048,-.372549,.698582,.45733,.45733,-.247059,.764404,.502282,.500979,-.121569,.791292,.591516,.54112,.00392157,.817297,.66895,.578481,.129412,.842499,.738308,.613572,.254902,.866968,.801687,.646762,.380392,.890766,.86041,.678329,.505882,.913944,.913944,.711254,.631373,.936549,.936549,.79459,.756863,.958621,.958621,.869979,.882353,.980196,.980196,.939336,1,1,1,1]},{ColorSpace:"Lab",Name:"bone_Matlab",RGBPoints:[-1,0,0,0,-.87451,.054902,.054902,.075817,-.74902,.109804,.109804,.151634,-.623529,.164706,.164706,.227451,-.498039,.219608,.219608,.303268,-.372549,.27451,.27451,.379085,-.247059,.329412,.329902,.454412,-.121569,.384314,.405719,.509314,.00392157,.439216,.481536,.564216,.129412,.494118,.557353,.619118,.254902,.54902,.63317,.67402,.380392,.603922,.708987,.728922,.505882,.660294,.783824,.783824,.631373,.746569,.838725,.838725,.756863,.832843,.893627,.893627,.882353,.919118,.948529,.948529,1,1,1,1]},{ColorSpace:"Lab",Name:"gray_Matlab",RGBPoints:[-1,0,0,0,-.87451,.0627451,.0627451,.0627451,-.74902,.12549,.12549,.12549,-.623529,.188235,.188235,.188235,-.498039,.25098,.25098,.25098,-.372549,.313725,.313725,.313725,-.247059,.376471,.376471,.376471,-.121569,.439216,.439216,.439216,.00392157,.501961,.501961,.501961,.129412,.564706,.564706,.564706,.254902,.627451,.627451,.627451,.380392,.690196,.690196,.690196,.505882,.752941,.752941,.752941,.631373,.815686,.815686,.815686,.756863,.878431,.878431,.878431,.882353,.941176,.941176,.941176,1,1,1,1]},{ColorSpace:"Lab",Name:"Purples",RGBPoints:[-1,.247059,0,.490196,-.87451,.288397,.07677,.525629,-.74902,.32975,.153587,.561092,-.623529,.373057,.236263,.600461,-.498039,.416363,.319,.639923,-.372549,.459669,.405613,.685198,-.247059,.503345,.491534,.730058,-.121569,.562399,.54862,.757616,.00392157,.621453,.606075,.785544,.129412,.680508,.674971,.824914,.254902,.739562,.743406,.863899,.380392,.798616,.800492,.893426,.505882,.85684,.856655,.922491,.631373,.898178,.894056,.942176,.756863,.938654,.930919,.961646,.882353,.964245,.958478,.977393,1,.988235,.984314,.992157]},{ColorSpace:"Lab",Name:"Blues",RGBPoints:[-1,.031373,.188235,.419608,-.87451,.031373,.253195,.516063,-.74902,.031757,.318139,.612149,-.623529,.080969,.38113,.661361,-.498039,.130427,.444152,.710327,-.372549,.195386,.509112,.743791,-.247059,.260715,.573841,.777209,-.121569,.341423,.628958,.808704,.00392157,.422745,.684075,.839892,.129412,.523137,.739193,.861546,.254902,.622684,.793464,.883429,.380392,.701423,.826928,.910988,.505882,.778685,.8603,.937993,.631373,.825928,.891795,.953741,.756863,.87328,.923291,.969489,.882353,.922491,.954787,.985236,1,.968627,.984314,1]},{ColorSpace:"Lab",Name:"Greens",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546082,.271326,-.372549,.197232,.609073,.31857,-.247059,.257255,.671742,.365859,-.121569,.357647,.720953,.415071,.00392157,.45767,.769919,.465021,.129412,.546251,.811257,.537855,.254902,.634295,.852211,.610688,.380392,.709097,.883706,.683522,.505882,.78316,.914833,.755894,.631373,.842215,.938454,.818885,.756863,.899977,.961538,.880692,.882353,.935409,.975317,.92203,1,.968627,.988235,.960784]},{ColorSpace:"Lab",Name:"PuBu",RGBPoints:[-1,.301961,0,.294118,-.87451,.404321,.029527,.390573,-.74902,.50599,.059592,.486782,-.623529,.519769,.158016,.551742,-.498039,.533456,.256194,.616301,-.372549,.54133,.33887,.655671,-.247059,.54902,.421592,.695087,-.121569,.54902,.506236,.736424,.00392157,.550127,.590573,.777701,.129412,.585559,.665375,.81707,.254902,.622145,.739023,.855825,.380392,.687105,.784298,.879446,.505882,.752065,.829758,.903253,.631373,.817024,.87897,.930811,.756863,.880907,.927213,.957832,.882353,.926182,.958708,.975548,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"BuPu",RGBPoints:[-1,.007843,.219608,.345098,-.87451,.01178,.286536,.449427,-.74902,.015702,.35328,.553479,-.623529,.01767,.396586,.622376,-.498039,.021115,.4402,.690688,-.372549,.11757,.503191,.722184,-.247059,.214625,.565859,.753633,-.121569,.336671,.615071,.78316,.00392157,.457978,.663975,.812503,.129412,.556401,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821638,.903068,.631373,.873387,.864944,.92669,.756863,.927536,.907605,.949988,.882353,.964937,.9391,.967705,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGn",RGBPoints:[-1,.031373,.25098,.505882,-.87451,.031373,.329719,.590527,-.74902,.031911,.408397,.674787,-.623529,.100807,.479262,.710219,-.498039,.169704,.550219,.745744,-.372549,.238601,.62699,.787082,-.247059,.307958,.703114,.826759,-.121569,.39654,.752326,.797232,.00392157,.485121,.801046,.767705,.129412,.573702,.83451,.738178,.254902,.661592,.867743,.711034,.380392,.732457,.895302,.74253,.505882,.801845,.922307,.774579,.631373,.841215,.938055,.817885,.756863,.880907,.95391,.861084,.882353,.926182,.971626,.902422,1,.968627,.988235,.941176]},{ColorSpace:"Lab",Name:"GnBu",RGBPoints:[-1,0,.266667,.105882,-.87451,0,.347374,.139346,-.74902,538e-6,.427912,.172933,-.623529,.069435,.486967,.222145,-.498039,.138178,.546175,.272095,-.372549,.197232,.615071,.368551,-.247059,.256609,.683276,.464867,-.121569,.329443,.722645,.555417,.00392157,.403137,.762138,.645413,.129412,.503529,.805444,.718247,.254902,.603922,.848597,.790465,.380392,.704314,.887966,.847551,.505882,.802307,.926321,.903714,.631373,.851519,.944037,.941115,.756863,.899977,.961538,.976901,.882353,.935409,.975317,.984775,1,.968627,.988235,.992157]},{ColorSpace:"Lab",Name:"GnBuPu",RGBPoints:[-1,.003922,.27451,.211765,-.87451,.003922,.349312,.280661,-.74902,.003937,.423852,.349773,-.623529,.005905,.46519,.446228,-.498039,.009443,.506344,.542837,-.372549,.111803,.535871,.649135,-.247059,.214025,.565859,.753633,-.121569,.310481,.615071,.78316,.00392157,.407797,.663975,.812503,.129412,.531811,.703345,.836125,.254902,.65421,.742714,.859669,.380392,.736886,.782084,.881323,.505882,.81827,.821176,.902884,.631373,.873387,.854641,.922568,.756863,.927536,.888535,.942361,.882353,.964937,.929873,.964014,1,1,.968627,.984314]},{ColorSpace:"Lab",Name:"BuGnYl",RGBPoints:[-1,.031373,.113725,.345098,-.87451,.088458,.159,.463206,-.74902,.145052,.204567,.5807,-.623529,.139146,.287243,.620069,-.498039,.13318,.370196,.659562,-.372549,.123337,.470588,.706805,-.247059,.115386,.570335,.753126,-.121569,.186251,.643168,.761,.00392157,.258716,.71514,.768074,.129412,.380761,.760415,.750358,.254902,.503576,.806075,.732795,.380392,.645306,.861192,.719016,.505882,.783899,.91511,.705606,.631373,.858701,.944637,.6997,.756863,.931349,.973303,.698424,.882353,.966782,.987082,.777163,1,1,1,.85098]},{ColorSpace:"Lab",Name:"PuRd",RGBPoints:[-1,.286275,0,.415686,-.87451,.38273,.001968,.441276,-.74902,.479231,.003922,.466774,-.623529,.581592,.003922,.480554,-.498039,.683799,.00549,.494887,-.372549,.776317,.105882,.544098,-.247059,.867866,.206321,.592618,-.121569,.919047,.308681,.612303,.00392157,.968812,.411226,.632603,.129412,.974717,.519493,.671972,.254902,.980546,.626451,.71065,.380392,.984483,.701253,.732303,.505882,.988328,.77504,.755617,.631373,.990296,.828189,.812703,.756863,.992372,.880907,.869035,.882353,.996309,.926182,.912341,1,1,.968627,.952941]},{ColorSpace:"Lab",Name:"RdPu",RGBPoints:[-1,.403922,0,.121569,-.87451,.500377,0,.192434,-.74902,.596909,277e-6,.263037,-.623529,.703206,.035709,.300438,-.498039,.808612,.071296,.338854,-.372549,.857824,.116571,.441215,-.247059,.905513,.163552,.54293,-.121569,.889765,.281661,.617732,.00392157,.873156,.39897,.691611,.129412,.82985,.491488,.736886,.254902,.789081,.583237,.781853,.380392,.810734,.656071,.819254,.505882,.833126,.729181,.85684,.631373,.870527,.80792,.898178,.756863,.907605,.884398,.938331,.882353,.9391,.921799,.958016,1,.968627,.956863,.976471]},{ColorSpace:"Lab",Name:"Oranges",RGBPoints:[-1,.498039,.152941,.015686,-.87451,.57481,.182468,.013718,-.74902,.651765,.212042,.011734,-.623529,.752157,.247474,.007797,-.498039,.851719,.283368,.004475,-.372549,.898962,.348328,.039908,-.247059,.945652,.413426,.076401,-.121569,.969273,.484291,.157109,.00392157,.992157,.554971,.238185,.129412,.992157,.619931,.330704,.254902,.992157,.684967,.423837,.380392,.992157,.751895,.532103,.505882,.992249,.817716,.639354,.631373,.994218,.861023,.725967,.756863,.996186,.903576,.810965,.882353,.998155,.933103,.868051,1,1,.960784,.921569]},{ColorSpace:"Lab",Name:"Reds",RGBPoints:[-1,.403922,0,.05098,-.87451,.525967,.029527,.066728,-.74902,.647643,.058962,.082476,-.623529,.722445,.076678,.098224,-.498039,.797186,.095194,.114187,-.372549,.868051,.164091,.143714,-.247059,.937809,.233541,.173933,-.121569,.96143,.326059,.232987,.00392157,.984375,.418147,.292657,.129412,.986344,.496886,.371396,.254902,.988235,.575702,.450673,.380392,.988235,.656409,.543191,.505882,.98842,.736747,.635894,.631373,.992357,.809581,.732349,.756863,.996186,.880692,.826759,.882353,.998155,.92203,.885813,1,1,.960784,.941176]},{ColorSpace:"Lab",Name:"RdOr",RGBPoints:[-1,.498039,0,0,-.87451,.6004,0,0,-.74902,.702514,738e-6,477e-6,-.623529,.773379,.095225,.061499,-.498039,.843875,.189865,.12283,-.372549,.891119,.294195,.203537,-.247059,.937855,.397924,.283137,-.121569,.963445,.476663,.316601,.00392157,.988297,.555771,.351665,.129412,.990265,.646321,.436309,.254902,.992157,.735256,.519646,.380392,.992157,.784468,.570827,.505882,.992249,.833218,.623483,.631373,.994218,.872587,.706159,.756863,.996186,.911419,.788189,.882353,.998155,.940946,.859054,1,1,.968627,.92549]},{ColorSpace:"Lab",Name:"BrOrYl",RGBPoints:[-1,.4,.145098,.023529,-.87451,.500392,.174625,.019592,-.74902,.600784,.204291,.015656,-.623529,.701176,.251534,.011719,-.498039,.800984,.299146,.008397,-.372549,.863975,.370012,.043829,-.247059,.926321,.441107,.0794,-.121569,.961753,.521815,.120738,.00392157,.996078,.602645,.163122,.129412,.996078,.68729,.237924,.254902,.996078,.771011,.314879,.380392,.996078,.832034,.444798,.505882,.996171,.892042,.572595,.631373,.998139,.931411,.65724,.756863,1,.969489,.741669,.882353,1,.985236,.822376,1,1,1,.898039]},{ColorSpace:"Lab",Name:"RdOrYl",RGBPoints:[-1,.501961,0,.14902,-.87451,.622038,0,.14902,-.74902,.741761,4e-4,.148866,-.623529,.816563,.05158,.129181,-.498039,.890965,.10356,.110235,-.372549,.940177,.205921,.137793,-.247059,.988281,.308789,.165536,-.121569,.99025,.432803,.200969,.00392157,.992218,.555217,.236278,.129412,.994187,.628051,.267774,.254902,.996078,.701038,.301269,.380392,.996078,.777809,.383945,.505882,.996171,.852826,.466621,.631373,.998139,.892195,.549296,.756863,1,.931349,.632188,.882353,1,.966782,.7188,1,1,1,.8]},{ColorSpace:"Lab",Name:"CIELab_blue2red",RGBPoints:[-1,0,.6,.74902,1,.76863,.46667,.34118]},{ColorSpace:"Lab",Name:"blue2yellow",RGBPoints:[-1,0,0,1,0,.5,.5,.5,1,1,1,0]},{ColorSpace:"Lab",Name:"erdc_blue2gold",RGBPoints:[-1,.175119,.0438468,1,-.874016,.22383,.159771,.94557,-.748031,.27254,.233611,.891216,-.622047,.321251,.296526,.836857,-.496063,.369962,.354296,.782359,-.370079,.418672,.409139,.72754,-.244094,.467383,.462152,.672148,-.11811,.51609,.51396,.615825,.00787402,.572863,.55452,.559172,.133858,.630269,.593822,.517729,.259843,.689588,.624668,.47446,.385827,.745394,.656113,.428638,.511811,.798624,.688104,.379105,.637795,.849926,.720593,.323834,.76378,.899765,.753543,.258657,.889764,.948487,.78692,.171778,1,.990413,.816451,.00729848]},{ColorSpace:"Lab",Name:"erdc_blue2yellow",RGBPoints:[-1,.0830122,0,.495617,-.87451,.141973,.0551288,.57363,-.74902,.193048,.110258,.604561,-.623529,.234231,.165386,.57643,-.498039,.275413,.220515,.548299,-.372549,.316596,.275644,.520169,-.247059,.357778,.330773,.492038,-.121569,.398961,.385901,.463908,.00392157,.449929,.438487,.426815,.129412,.511572,.488299,.379944,.254902,.581222,.53603,.325741,.380392,.650871,.583761,.271538,.505882,.720521,.631493,.217335,.631373,.79017,.679224,.163132,.756863,.85982,.726955,.108929,.882353,.910254,.774159,.14112,1,.927513,.81759,.306289]},{ColorSpace:"Lab",Name:"erdc_cyan2orange",RGBPoints:[-1,.0471513,.213874,.414329,-.87451,.0674702,.256648,.439027,-.74902,.0959957,.299331,.462089,-.623529,.132428,.341872,.483212,-.498039,.188743,.38277,.500597,-.372549,.268511,.420229,.512179,-.247059,.352945,.455602,.519101,-.121569,.43893,.489368,.521538,.00392157,.522445,.522495,.522436,.129412,.600089,.555682,.53205,.254902,.67988,.587981,.539163,.380392,.761011,.619586,.544439,.505882,.84278,.650741,.548567,.631373,.910713,.687347,.557822,.756863,.952232,.734972,.577775,.882353,.975642,.789858,.604868,1,.990752,.843643,.632857]},{ColorSpace:"Lab",Name:"erdc_purple2green",RGBPoints:[-1,.235006,.0483128,.530899,-.87451,.302968,.108419,.552391,-.74902,.360241,.166059,.569502,-.623529,.406746,.226782,.579373,-.498039,.444073,.28964,.582094,-.372549,.473648,.353774,.577947,-.247059,.497636,.418154,.567911,-.121569,.519086,.481741,.553968,.00392157,.542884,.542914,.542875,.129412,.566303,.603989,.527499,.254902,.595218,.662965,.516857,.380392,.628641,.720701,.510673,.505882,.665373,.777849,.508165,.631373,.704182,.834921,.508303,.756863,.743846,.892328,.50999,.882353,.783158,.950422,.512181,1,.818617,1,.513888]},{ColorSpace:"Lab",Name:"erdc_purple2green_dark",RGBPoints:[-1,.107656,0,.428682,-.87451,.1924,0,.449799,-.74902,.255118,.0648939,.466726,-.623529,.304256,.133066,.476703,-.498039,.343202,.19716,.479793,-.372549,.373876,.260353,.476241,-.247059,.398497,.322872,.466953,-.121569,.420016,.384252,.453785,.00392157,.44319,.443216,.443186,.129412,.465553,.502139,.428233,.254902,.492959,.559151,.417591,.380392,.524654,.615092,.411016,.505882,.55959,.670583,.40779,.631373,.596614,.726102,.406948,.756863,.634544,.782032,.407439,.882353,.672183,.838703,.408237,1,.706131,.892759,.408452]},{ColorSpace:"Lab",Name:"coolwarm",RGBPoints:[-1,.229806,.298718,.753683,-.875,.303869,.406535,.844959,-.75,.383013,.509419,.917388,-.625,.466667,.604563,.968155,-.5,.552953,.688929,.995376,-.375,.639176,.7596,.998151,-.25,.722193,.813953,.976575,-.125,.798692,.849786,.931689,0,.865395,.86541,.865396,.125,.924128,.827385,.774508,.25,.958853,.769768,.678008,.375,.969954,.694267,.579375,.5,.958003,.602842,.481776,.625,.923945,.497309,.38797,.75,.869187,.378313,.300267,.875,.795632,.241284,.220526,1,.705673,.0155562,.150233]},{ColorSpace:"Lab",Name:"BuRd",RGBPoints:[-1,.019608,.188235,.380392,-.87451,.088504,.321107,.564937,-.74902,.163399,.444983,.697501,-.623529,.247059,.555709,.754095,-.498039,.420684,.676432,.818685,-.372549,.606459,.789773,.880277,-.247059,.761476,.868512,.924567,-.121569,.878047,.925721,.951942,.00392157,.969089,.966474,.964937,.129412,.983852,.897578,.846828,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"Spectral_lowBlue",RGBPoints:[-1,.368627,.309804,.635294,-.87451,.260361,.450058,.70173,-.74902,.248058,.591311,.717186,-.623529,.376009,.734025,.658132,-.498039,.537947,.814764,.64506,-.372549,.702345,.879585,.636678,-.247059,.84752,.938639,.607151,-.121569,.940408,.976163,.656055,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.937793,.398539,.270127,.756863,.861515,.282891,.299654,.882353,.746482,.144637,.288812,1,.619608,.003922,.258824]},{ColorSpace:"Lab",Name:"GnRP",RGBPoints:[-1,0,.266667,.105882,-.87451,.066436,.394617,.174779,-.74902,.168858,.524567,.25767,-.623529,.323875,.657439,.361015,-.498039,.504883,.772318,.506344,-.372549,.678431,.870127,.654902,-.247059,.803922,.921799,.780392,-.121569,.897116,.951942,.882814,.00392157,.967397,.965936,.967474,.129412,.928028,.879815,.930565,.254902,.866052,.780777,.882891,.380392,.77501,.665129,.821376,.505882,.675663,.537024,.737024,.631373,.57847,.396155,.645982,.756863,.492349,.223914,.547559,.882353,.375548,.096886,.423299,1,.25098,0,.294118]},{ColorSpace:"Lab",Name:"GYPi",RGBPoints:[-1,.152941,.392157,.098039,-.87451,.246444,.505344,.117724,-.74902,.351942,.614533,.161399,-.623529,.474971,.717878,.240138,-.498039,.611995,.811226,.392849,-.372549,.746328,.893118,.565321,-.247059,.859516,.94233,.747405,-.121569,.928105,.96386,.875663,.00392157,.969089,.966859,.968012,.129412,.983852,.910265,.948328,.254902,.979239,.833218,.914648,.380392,.949712,.729873,.862976,.505882,.905652,.58293,.763552,.631373,.85521,.410073,.652211,.756863,.793695,.183699,.531642,.882353,.683737,.063899,.420761,1,.556863,.003922,.321569]},{ColorSpace:"Lab",Name:"GnYlRd",RGBPoints:[-1,0,.407843,.215686,-.87451,.063975,.525952,.277201,-.74902,.177932,.633064,.332718,-.623529,.364937,.724106,.379469,-.498039,.527951,.797155,.40223,-.372549,.678431,.862822,.433449,-.247059,.803922,.916955,.514648,-.121569,.909419,.961861,.625067,.00392157,.999923,.997616,.745021,.129412,.997463,.921338,.61707,.254902,.995002,.824606,.499885,.380392,.992541,.701576,.39654,.505882,.973472,.547405,.318108,.631373,.939023,.389927,.245521,.756863,.867666,.239831,.176624,.882353,.762399,.110727,.151326,1,.647059,0,.14902]},{ColorSpace:"Lab",Name:"GBBr",RGBPoints:[-1,0,.235294,.188235,-.87451,.002461,.338639,.301423,-.74902,.055902,.448981,.417609,-.623529,.183852,.56955,.538178,-.498039,.357785,.700115,.660746,-.372549,.540177,.819531,.77624,-.247059,.714879,.890888,.864821,-.121569,.851134,.934564,.922645,.00392157,.960861,.959785,.95694,.129412,.963322,.927797,.83391,.254902,.939946,.868897,.68935,.380392,.883353,.775394,.517109,.505882,.808074,.625836,.324106,.631373,.717647,.476355,.15494,.756863,.592157,.358247,.06882,.882353,.458593,.26436,.031142,1,.329412,.188235,.019608]},{ColorSpace:"Lab",Name:"PuOr",RGBPoints:[-1,.498039,.231373,.031373,-.87451,.62599,.30273,.026451,-.74902,.746943,.387082,.037524,-.623529,.85767,.490427,.071972,-.498039,.936409,.617762,.236371,-.372549,.992695,.743099,.43291,-.247059,.995156,.841523,.63714,-.121569,.985313,.913802,.813687,.00392157,.966244,.966398,.967705,.129412,.889965,.89504,.938178,.254902,.806151,.804306,.894656,.380392,.712649,.688658,.833141,.505882,.594233,.554325,.744637,.631373,.474894,.404229,.652364,.756863,.366628,.217224,.563783,.882353,.266436,.089965,.434833,1,.176471,0,.294118]},{ColorSpace:"Lab",Name:"PRGn",RGBPoints:[-1,.25098,0,.294118,-.87451,.383852,.103345,.431911,-.74902,.497732,.234679,.55371,-.623529,.583852,.40692,.652134,-.498039,.681968,.545175,.742561,-.372549,.7807,.672357,.825221,-.247059,.871742,.788005,.886736,-.121569,.930488,.885198,.932872,.00392157,.966321,.968089,.965859,.129412,.892503,.950865,.877278,.254902,.796078,.91857,.772549,.380392,.670588,.866897,.647059,.505882,.493195,.765398,.496655,.631373,.314187,.649135,.354556,.756863,.15917,.516263,.251211,.882353,.062284,.386621,.170473,1,0,.266667,.105882]},{ColorSpace:"Lab",Name:"PiYG",RGBPoints:[-1,.556863,.003922,.321569,-.87451,.692195,.067897,.427374,-.74902,.797539,.197847,.539177,-.623529,.859054,.424221,.659746,-.498039,.908574,.592618,.770319,-.372549,.951557,.736332,.866205,-.247059,.981084,.839677,.917878,-.121569,.98293,.913802,.949558,.00392157,.96732,.968474,.965629,.129412,.92549,.963552,.869666,.254902,.852441,.939254,.736025,.380392,.739254,.890042,.553941,.505882,.60323,.805536,.382238,.631373,.467282,.711419,.235217,.756863,.344252,.608074,.156478,.882353,.2406,.49827,.116494,1,.152941,.392157,.098039]},{ColorSpace:"Lab",Name:"OrPu",RGBPoints:[-1,.176471,0,.294118,-.87451,.272434,.095963,.444214,-.74902,.373395,.228912,.56932,-.623529,.481661,.415917,.657901,-.498039,.601922,.562937,.750481,-.372549,.718493,.695886,.836986,-.247059,.811995,.811534,.898501,-.121569,.894733,.8995,.940023,.00392157,.969166,.966859,.963629,.129412,.98639,.910265,.803691,.254902,.995002,.835371,.624375,.380392,.992541,.736947,.420146,.505882,.931949,.609458,.224221,.631373,.85075,.483968,.069819,.756863,.740023,.380623,.035371,.882353,.617993,.29827,.026759,1,.498039,.231373,.031373]},{ColorSpace:"Lab",Name:"BrBG",RGBPoints:[-1,.329412,.188235,.019608,-.87451,.467205,.269435,.031911,-.74902,.6,.365629,.074202,-.623529,.72549,.483737,.160323,-.498039,.812995,.635832,.336409,-.372549,.88689,.781238,.527874,-.247059,.943483,.87474,.700115,-.121569,.963168,.929796,.841599,.00392157,.957247,.959938,.959554,.129412,.84406,.932872,.920185,.254902,.70396,.886428,.859285,.380392,.529258,.815071,.770704,.505882,.346251,.691811,.653057,.631373,.175855,.562015,.530642,.756863,.047905,.441446,.410073,.882353,.002307,.33218,.294348,1,0,.235294,.188235]},{ColorSpace:"Lab",Name:"GyRd",RGBPoints:[-1,.101961,.101961,.101961,-.87451,.227451,.227451,.227451,-.74902,.359939,.359939,.359939,-.623529,.502653,.502653,.502653,-.498039,.631373,.631373,.631373,-.372549,.749865,.749865,.749865,-.247059,.843368,.843368,.843368,-.121569,.926105,.926105,.926105,.00392157,.999846,.997232,.995694,.129412,.994925,.908651,.857901,.254902,.982468,.800692,.706113,.380392,.960323,.66782,.536332,.505882,.894579,.503806,.399769,.631373,.81707,.33218,.281046,.756863,.728489,.155017,.197386,.882353,.576932,.055363,.14925,1,.403922,0,.121569]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen",RGBPoints:[-1,.297553,0,.489074,-.87451,.40259,.151146,.567754,-.74902,.516038,.284843,.658231,-.623529,.629783,.423646,.750938,-.498039,.735198,.563697,.835956,-.372549,.82408,.695541,.903582,-.247059,.889091,.807454,.944862,-.121569,.92334,.886917,.951839,.00392157,.921045,.921084,.921003,.129412,.877324,.907455,.845381,.254902,.797649,.849713,.734695,.380392,.691646,.75964,.600532,.505882,.568981,.649159,.453807,.631373,.438945,.529756,.304259,.756863,.30973,.412001,.158303,.882353,.187078,.305111,.00251458,1,.101655,.220836,0]},{ColorSpace:"Lab",Name:"erdc_divHi_purpleGreen_dim",RGBPoints:[-1,.404088,.131038,.592767,-.87451,.486469,.230957,.651243,-.74902,.575165,.339335,.717723,-.623529,.662741,.454332,.784263,-.498039,.742071,.570213,.842918,-.372549,.806935,.678992,.886227,-.247059,.852219,.771315,.90763,-.121569,.873345,.837327,.901572,.00392157,.866783,.86682,.866745,.129412,.82839,.858225,.796812,.254902,.762578,.814287,.700202,.380392,.676429,.744229,.585735,.505882,.577033,.65732,.461526,.631373,.47128,.562476,.33476,.756863,.365461,.467957,.21076,.882353,.264758,.381138,.0878313,1,.182591,.312249,0]},{ColorSpace:"Lab",Name:"erdc_divLow_icePeach",RGBPoints:[-1,.480048,.817441,.998056,-.87451,.425898,.726921,.883187,-.74902,.366682,.629445,.761936,-.623529,.308756,.531002,.640217,-.498039,.258021,.43705,.523433,-.372549,.219244,.352381,.416348,-.247059,.195127,.281032,.322979,-.121569,.186286,.22627,.246525,.00392157,.192352,.19236,.192364,.129412,.255927,.214469,.191756,.254902,.340459,.254426,.206666,.380392,.444655,.309315,.234029,.505882,.565353,.376004,.270969,.631373,.697917,.450748,.314293,.756863,.836657,.529064,.360227,.882353,.972695,.614884,.413123,1,1,.705904,.472699]},{ColorSpace:"Lab",Name:"erdc_divLow_purpleGreen",RGBPoints:[-1,.956034,.666487,.952663,-.87451,.874457,.572698,.936352,-.74902,.753465,.488253,.909063,-.623529,.63309,.413507,.763833,-.498039,.514491,.345878,.620015,-.372549,.405008,.288141,.484376,-.247059,.311388,.241986,.363556,-.121569,.238722,.209044,.263449,.00392157,.192352,.192366,.192362,.129412,.200379,.233201,.168618,.254902,.230151,.291737,.165227,.380392,.279481,.366076,.178607,.505882,.344927,.453267,.205703,.631373,.421554,.549449,.242643,.756863,.503334,.649999,.284377,.882353,.583497,.749672,.324969,1,.650705,.837228,.356264]},{ColorSpace:"Lab",Name:"Haze_green",RGBPoints:[-1,1,.835294,.886275,-.87451,.937255,.756863,.870443,-.74902,.875817,.666376,.857807,-.623529,.778359,.583007,.808134,-.498039,.676253,.494118,.745098,-.372549,.561365,.390123,.682353,-.247059,.438344,.262745,.621496,-.121569,.321133,.141031,.558751,.00392157,.203922,.0217865,.495861,.129412,.265505,.129412,.433261,.254902,.311692,.255338,.37008,.380392,.356282,.377342,.310821,.505882,.39971,.488889,.258243,.631373,.442556,.604357,.205519,.756863,.48671,.71968,.152941,.882353,.529847,.830356,.100944,1,.572549,.933333,.054902]},{ColorSpace:"Lab",Name:"Haze_lime",RGBPoints:[-1,.704034,.784196,1,-.87451,.633111,.691418,.956078,-.74902,.564021,.600606,.912157,-.623529,.496827,.51189,.868235,-.498039,.43157,.425416,.824314,-.372549,.368248,.341347,.780392,-.247059,.306767,.259855,.736471,-.121569,.246862,.181069,.692549,.00392157,.191619,.109542,.648627,.129412,.257404,.194031,.604706,.254902,.321794,.278775,.560784,.380392,.387909,.364617,.516863,.505882,.456569,.451881,.472941,.631373,.527424,.540773,.42902,.756863,.599759,.631427,.385098,.882353,.673065,.723898,.341176,1,.742751,.812252,.3]},{ColorSpace:"RGB",Name:"Haze",RGBPoints:[-1,1,.835294,.996078,-.00392157,.023529,.141176,.498039,.00392157,.015686,.137255,.494118,1,.984314,.764706,0]},{ColorSpace:"Lab",Name:"Haze_cyan",RGBPoints:[-1,.956863,1,.835294,-.87451,.933188,.921714,.760784,-.74902,.870588,.803486,.671605,-.623529,.807843,.684096,.583297,-.498039,.745098,.569208,.494118,-.372549,.682353,.437763,.390123,-.247059,.621496,.288163,.262745,-.121569,.558751,.144517,.141031,.00392157,.495861,.0217865,.0413943,.129412,.433261,.137255,.129412,.254902,.37008,.263181,.255338,.380392,.306318,.381845,.372694,.505882,.243137,.503994,.494263,.631373,.180392,.629484,.619753,.756863,.117647,.754975,.747131,.882353,.054902,.876398,.866812,1,0,.988235,.976471]},{ColorSpace:"Lab",Name:"nic_Edge",RGBPoints:[-1,.191208,.191208,.191208,-.87451,.239484,.00545035,.614821,-.74902,.220593,.0617459,.863547,-.623529,.17509,.278988,.97794,-.498039,.143526,.576069,.998553,-.372549,.166456,.871883,.96594,-.247059,.376202,.993555,.981833,-.121569,.681996,.991297,.999239,.00392157,.954172,.952734,.94374,.129412,.999735,.99301,.662896,.254902,.979399,.991466,.357973,.380392,.968771,.854967,.162659,.505882,.999245,.556697,.144323,.631373,.973959,.26223,.177946,.756863,.852358,.0526707,.222974,.882353,.593889,.00912724,.238855,1,.191208,.191208,.191208]},{ColorSpace:"Lab",Name:"erdc_iceFire_H",RGBPoints:[-1,405432e-12,0,590122e-11,-.87451,0,.120401,.302675,-.74902,0,.216583,.524574,-.623529,.0552475,.345025,.6595,-.498039,.128047,.492588,.720288,-.372549,.188955,.641309,.792092,-.247059,.327673,.784935,.873434,-.121569,.60824,.892164,.935547,.00392157,.881371,.912178,.818099,.129412,.951407,.835621,.449279,.254902,.904481,.690489,0,.380392,.85407,.510864,0,.505882,.777093,.33018,88199e-8,.631373,.672862,.139087,.00269398,.756863,.508815,0,0,.882353,.299417,366289e-9,547829e-9,1,.0157519,.00332021,455569e-13]},{ColorSpace:"Lab",Name:"erdc_iceFire_L",RGBPoints:[-1,.870485,.913768,.832905,-.87451,.586919,.887865,.934003,-.74902,.31583,.776442,.867858,-.623529,.18302,.632034,.787722,-.498039,.117909,.484134,.713825,-.372549,.0507239,.335979,.654741,-.247059,0,.209874,.511832,-.121569,0,.114689,.28935,.00392157,.0157519,.00332021,455569e-13,.129412,.312914,0,0,.254902,.520865,0,0,.380392,.680105,.15255,.0025996,.505882,.785109,.339479,797922e-9,.631373,.857354,.522494,0,.756863,.910974,.699774,0,.882353,.951921,.842817,.478545,1,.881371,.912178,.818099]},{ColorSpace:"RGB",Name:"hsv",RGBPoints:[-1,1,0,0,-.666666,1,0,1,-.333333,0,0,1,0,0,1,1,.33333,0,1,0,.66666,1,1,0,1,1,0,0]},{ColorSpace:"Lab",Name:"hue_L60",RGBPoints:[-1,.964784,.400592,.349549,-.87451,.964915,.372498,.53785,-.74902,.892353,.401039,.759569,-.623529,.79263,.446956,.903017,-.498039,.682208,.49954,.966673,-.372549,.56392,.553082,.968836,-.247059,.442031,.606396,.901601,-.121569,.305499,.65701,.765784,.00392157,.197251,.687914,.620914,.129412,.193882,.701887,.472654,.254902,.249866,.706123,.320005,.380392,.35132,.697417,.202919,.505882,.498097,.669467,.125232,.631373,.637477,.626239,.107431,.756863,.762115,.56872,.155812,.882353,.889434,.481116,.240445,1,.964784,.400592,.349549]},{IndexedColors:[0,0,0,.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,.6509803921568628,.3372549019607843,.1568627450980392],Name:"Spectrum",NanColor:[.6509803921568628,.3372549019607843,.1568627450980392]},{IndexedColors:[.4745098039215686,.09019607843137255,.09019607843137255,.7098039215686275,.00392156862745098,.00392156862745098,.9372549019607843,.2784313725490196,.09803921568627451,.9764705882352941,.5137254901960784,.1411764705882353,1,.7058823529411765,0,1,.8980392156862745,.02352941176470588],Name:"Warm",NanColor:[1,.8980392156862745,.02352941176470588]},{IndexedColors:[.4588235294117647,.6941176470588235,.00392156862745098,.3450980392156863,.5019607843137255,.1607843137254902,.3137254901960784,.8431372549019608,.7490196078431373,.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.6039215686274509,.407843137254902,1,.3725490196078431,.2,.5019607843137255],Name:"Cool",NanColor:[.3725490196078431,.2,.5019607843137255]},{IndexedColors:[.2313725490196079,.407843137254902,.6705882352941176,.1098039215686274,.5843137254901961,.803921568627451,.3058823529411765,.8509803921568627,.9176470588235294,.4509803921568628,.6039215686274509,.8352941176470589,.2588235294117647,.2392156862745098,.6627450980392157,.3137254901960784,.3294117647058823,.5294117647058824,.06274509803921569,.1647058823529412,.3215686274509804],Name:"Blues",NanColor:[.06274509803921569,.1647058823529412,.3215686274509804]},{IndexedColors:[.1098039215686274,.5843137254901961,.803921568627451,.2313725490196079,.407843137254902,.6705882352941176,.4,.2431372549019608,.7176470588235294,.6352941176470588,.3294117647058823,.8117647058823529,.8705882352941177,.3803921568627451,.807843137254902,.8627450980392157,.3803921568627451,.5843137254901961,.2392156862745098,.06274509803921569,.3215686274509804],Name:"Wild Flower",NanColor:[.2392156862745098,.06274509803921569,.3215686274509804]},{IndexedColors:[.396078431372549,.4862745098039216,.2156862745098039,.4588235294117647,.6941176470588235,.00392156862745098,.6980392156862745,.7294117647058823,.1882352941176471,1,.8980392156862745,.02352941176470588,1,.7058823529411765,0,.9764705882352941,.5137254901960784,.1411764705882353],Name:"Citrus",NanColor:[.9764705882352941,.5137254901960784,.1411764705882353]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (11)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.4980392156862745,.2313725490196079,.03137254901960784,.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333,.1764705882352941,0,.2941176470588235],Name:"Brewer Diverging Purple-Orange (10)",NanColor:[.1764705882352941,0,.2941176470588235]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (9)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.8784313725490196,.5098039215686274,.0784313725490196,.9921568627450981,.7215686274509804,.3882352941176471,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6980392156862745,.6705882352941176,.8235294117647058,.5019607843137255,.4509803921568628,.6745098039215687,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (8)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.9686274509803922,.9686274509803922,.9686274509803922,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (7)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.7019607843137254,.3450980392156863,.02352941176470588,.9450980392156862,.6392156862745098,.2509803921568627,.996078431372549,.8784313725490196,.7137254901960784,.8470588235294118,.8549019607843137,.9215686274509803,.6,.5568627450980392,.7647058823529411,.3294117647058823,.1529411764705882,.5333333333333333],Name:"Brewer Diverging Purple-Orange (6)",NanColor:[.3294117647058823,.1529411764705882,.5333333333333333]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.9686274509803922,.9686274509803922,.9686274509803922,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (5)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9019607843137255,.3803921568627451,.00392156862745098,.9921568627450981,.7215686274509804,.3882352941176471,.6980392156862745,.6705882352941176,.8235294117647058,.3686274509803922,.2352941176470588,.6],Name:"Brewer Diverging Purple-Orange (4)",NanColor:[.3686274509803922,.2352941176470588,.6]},{IndexedColors:[.9450980392156862,.6392156862745098,.2509803921568627,.9686274509803922,.9686274509803922,.9686274509803922,.6,.5568627450980392,.7647058823529411],Name:"Brewer Diverging Purple-Orange (3)",NanColor:[.6,.5568627450980392,.7647058823529411]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (11)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.6196078431372549,.00392156862745098,.2588235294117647,.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353,.3686274509803922,.3098039215686275,.6352941176470588],Name:"Brewer Diverging Spectral (10)",NanColor:[.3686274509803922,.3098039215686275,.6352941176470588]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (9)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9568627450980393,.4274509803921568,.2627450980392157,.9921568627450981,.6823529411764706,.3803921568627451,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6705882352941176,.8666666666666667,.6431372549019608,.4,.7607843137254902,.6470588235294118,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (8)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,1,1,.7490196078431373,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (7)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8352941176470589,.2431372549019608,.3098039215686275,.9882352941176471,.5529411764705883,.3490196078431372,.996078431372549,.8784313725490196,.5450980392156862,.9019607843137255,.9607843137254902,.596078431372549,.6,.8352941176470589,.5803921568627451,.196078431372549,.5333333333333333,.7411764705882353],Name:"Brewer Diverging Spectral (6)",NanColor:[.196078431372549,.5333333333333333,.7411764705882353]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,1,1,.7490196078431373,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (5)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.8431372549019608,.09803921568627451,.1098039215686274,.9921568627450981,.6823529411764706,.3803921568627451,.6705882352941176,.8666666666666667,.6431372549019608,.1686274509803922,.5137254901960784,.7294117647058823],Name:"Brewer Diverging Spectral (4)",NanColor:[.1686274509803922,.5137254901960784,.7294117647058823]},{IndexedColors:[.9882352941176471,.5529411764705883,.3490196078431372,1,1,.7490196078431373,.6,.8352941176470589,.5803921568627451],Name:"Brewer Diverging Spectral (3)",NanColor:[.6,.8352941176470589,.5803921568627451]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (11)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.3294117647058823,.1882352941176471,.0196078431372549,.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922,0,.2352941176470588,.1882352941176471],Name:"Brewer Diverging Brown-Blue-Green (10)",NanColor:[0,.2352941176470588,.1882352941176471]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (9)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.7490196078431373,.5058823529411764,.1764705882352941,.8745098039215686,.7607843137254902,.4901960784313725,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.5019607843137255,.803921568627451,.7568627450980392,.207843137254902,.592156862745098,.5607843137254902,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (8)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.9607843137254902,.9607843137254902,.9607843137254902,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (7)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.5490196078431373,.3176470588235294,.0392156862745098,.8470588235294118,.7019607843137254,.396078431372549,.9647058823529412,.9098039215686274,.7647058823529411,.7803921568627451,.9176470588235294,.8980392156862745,.3529411764705883,.7058823529411765,.6745098039215687,.00392156862745098,.4,.3686274509803922],Name:"Brewer Diverging Brown-Blue-Green (6)",NanColor:[.00392156862745098,.4,.3686274509803922]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.9607843137254902,.9607843137254902,.9607843137254902,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (5)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.6509803921568628,.3803921568627451,.1019607843137255,.8745098039215686,.7607843137254902,.4901960784313725,.5019607843137255,.803921568627451,.7568627450980392,.00392156862745098,.5215686274509804,.4431372549019608],Name:"Brewer Diverging Brown-Blue-Green (4)",NanColor:[.00392156862745098,.5215686274509804,.4431372549019608]},{IndexedColors:[.8470588235294118,.7019607843137254,.396078431372549,.9607843137254902,.9607843137254902,.9607843137254902,.3529411764705883,.7058823529411765,.6745098039215687],Name:"Brewer Diverging Brown-Blue-Green (3)",NanColor:[.3529411764705883,.7058823529411765,.6745098039215687]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.4274509803921568,.1725490196078431,0,.2666666666666667,.1058823529411765],Name:"Brewer Sequential Blue-Green (9)",NanColor:[0,.2666666666666667,.1058823529411765]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8980392156862745,.9607843137254902,.9764705882352941,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (8)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.8,.9254901960784314,.9019607843137255,.4,.7607843137254902,.6431372549019608,.2549019607843137,.6823529411764706,.4627450980392157,.1372549019607843,.5450980392156862,.2705882352941176,0,.3450980392156863,.1411764705882353],Name:"Brewer Sequential Blue-Green (7)",NanColor:[0,.3450980392156863,.1411764705882353]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.8,.9254901960784314,.9019607843137255,.6,.8470588235294118,.788235294117647,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (6)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1725490196078431,.6352941176470588,.3725490196078431,0,.4274509803921568,.1725490196078431],Name:"Brewer Sequential Blue-Green (5)",NanColor:[0,.4274509803921568,.1725490196078431]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.6980392156862745,.8862745098039215,.8862745098039215,.4,.7607843137254902,.6431372549019608,.1372549019607843,.5450980392156862,.2705882352941176],Name:"Brewer Sequential Blue-Green (4)",NanColor:[.1372549019607843,.5450980392156862,.2705882352941176]},{IndexedColors:[.8980392156862745,.9607843137254902,.9764705882352941,.6,.8470588235294118,.788235294117647,.1725490196078431,.6352941176470588,.3725490196078431],Name:"Brewer Sequential Blue-Green (3)",NanColor:[.1725490196078431,.6352941176470588,.3725490196078431]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.6,.203921568627451,.01568627450980392,.4,.1450980392156863,.02352941176470588],Name:"Brewer Sequential Yellow-Orange-Brown (9)",NanColor:[.4,.1450980392156863,.02352941176470588]},{IndexedColors:[1,1,.8980392156862745,1,.9686274509803922,.7372549019607844,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (8)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.9254901960784314,.4392156862745098,.0784313725490196,.8,.2980392156862745,.00784313725490196,.5490196078431373,.1764705882352941,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (7)",NanColor:[.5490196078431373,.1764705882352941,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8901960784313725,.5686274509803921,.996078431372549,.7686274509803922,.3098039215686275,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (6)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8509803921568627,.3725490196078431,.05490196078431372,.6,.203921568627451,.01568627450980392],Name:"Brewer Sequential Yellow-Orange-Brown (5)",NanColor:[.6,.203921568627451,.01568627450980392]},{IndexedColors:[1,1,.8313725490196079,.996078431372549,.8509803921568627,.5568627450980392,.996078431372549,.6,.1607843137254902,.8,.2980392156862745,.00784313725490196],Name:"Brewer Sequential Yellow-Orange-Brown (4)",NanColor:[.8,.2980392156862745,.00784313725490196]},{IndexedColors:[1,.9686274509803922,.7372549019607844,.996078431372549,.7686274509803922,.3098039215686275,.8509803921568627,.3725490196078431,.05490196078431372],Name:"Brewer Sequential Yellow-Orange-Brown (3)",NanColor:[.8509803921568627,.3725490196078431,.05490196078431372]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.5058823529411764,.05882352941176471,.4862745098039216,.3019607843137255,0,.2941176470588235],Name:"Brewer Sequential Blue-Purple (9)",NanColor:[.3019607843137255,0,.2941176470588235]},{IndexedColors:[.9686274509803922,.9882352941176471,.9921568627450981,.8784313725490196,.9254901960784314,.9568627450980393,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (8)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5490196078431373,.4196078431372549,.6941176470588235,.5333333333333333,.2549019607843137,.615686274509804,.4313725490196079,.00392156862745098,.4196078431372549],Name:"Brewer Sequential Blue-Purple (7)",NanColor:[.4313725490196079,.00392156862745098,.4196078431372549]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7490196078431373,.8274509803921568,.9019607843137255,.6196078431372549,.7372549019607844,.8549019607843137,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (6)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.3372549019607843,.6549019607843137,.5058823529411764,.05882352941176471,.4862745098039216],Name:"Brewer Sequential Blue-Purple (5)",NanColor:[.5058823529411764,.05882352941176471,.4862745098039216]},{IndexedColors:[.9294117647058824,.9725490196078431,.984313725490196,.7019607843137254,.803921568627451,.8901960784313725,.5490196078431373,.5882352941176471,.7764705882352941,.5333333333333333,.2549019607843137,.615686274509804],Name:"Brewer Sequential Blue-Purple (4)",NanColor:[.5333333333333333,.2549019607843137,.615686274509804]},{IndexedColors:[.8784313725490196,.9254901960784314,.9568627450980393,.6196078431372549,.7372549019607844,.8549019607843137,.5333333333333333,.3372549019607843,.6549019607843137],Name:"Brewer Sequential Blue-Purple (3)",NanColor:[.5333333333333333,.3372549019607843,.6549019607843137]},{IndexedColors:[.4980392156862745,.788235294117647,.4980392156862745,.7450980392156863,.6823529411764706,.8313725490196079,.9921568627450981,.7529411764705882,.5254901960784314,1,1,.6,.2196078431372549,.4235294117647059,.6901960784313725,.9411764705882353,.00784313725490196,.4980392156862745,.7490196078431373,.3568627450980392,.09019607843137255,.4,.4,.4],Name:"Brewer Qualitative Accent",NanColor:[.4,.4,.4]},{IndexedColors:[.1058823529411765,.6196078431372549,.4666666666666667,.8509803921568627,.3725490196078431,.00784313725490196,.4588235294117647,.4392156862745098,.7019607843137254,.9058823529411765,.1607843137254902,.5411764705882353,.4,.6509803921568628,.1176470588235294,.9019607843137255,.6705882352941176,.00784313725490196,.6509803921568628,.4627450980392157,.1137254901960784,.4,.4,.4],Name:"Brewer Qualitative Dark2",NanColor:[.4,.4,.4]},{IndexedColors:[.4,.7607843137254902,.6470588235294118,.9882352941176471,.5529411764705883,.3843137254901961,.5529411764705883,.6274509803921569,.796078431372549,.9058823529411765,.5411764705882353,.7647058823529411,.6509803921568628,.8470588235294118,.3294117647058823,1,.8509803921568627,.1843137254901961,.8980392156862745,.7686274509803922,.5803921568627451,.7019607843137254,.7019607843137254,.7019607843137254],Name:"Brewer Qualitative Set2",NanColor:[.7019607843137254,.7019607843137254,.7019607843137254]},{IndexedColors:[.7019607843137254,.8862745098039215,.803921568627451,.9921568627450981,.803921568627451,.6745098039215687,.796078431372549,.8352941176470589,.9098039215686274,.9568627450980393,.792156862745098,.8941176470588236,.9019607843137255,.9607843137254902,.788235294117647,1,.9490196078431372,.6823529411764706,.9450980392156862,.8862745098039215,.8,.8,.8,.8],Name:"Brewer Qualitative Pastel2",NanColor:[.8,.8,.8]},{IndexedColors:[.984313725490196,.7058823529411765,.6823529411764706,.7019607843137254,.803921568627451,.8901960784313725,.8,.9215686274509803,.7725490196078432,.8705882352941177,.796078431372549,.8941176470588236,.996078431372549,.8509803921568627,.6509803921568628,1,1,.8,.8980392156862745,.8470588235294118,.7411764705882353,.9921568627450981,.8549019607843137,.9254901960784314,.9490196078431372,.9490196078431372,.9490196078431372],Name:"Brewer Qualitative Pastel1",NanColor:[.9490196078431372,.9490196078431372,.9490196078431372]},{IndexedColors:[.8941176470588236,.1019607843137255,.1098039215686274,.2156862745098039,.4941176470588236,.7215686274509804,.3019607843137255,.6862745098039216,.2901960784313726,.596078431372549,.3058823529411765,.6392156862745098,1,.4980392156862745,0,1,1,.2,.6509803921568628,.3372549019607843,.1568627450980392,.9686274509803922,.5058823529411764,.7490196078431373,.6,.6,.6],Name:"Brewer Qualitative Set1",NanColor:[.6,.6,.6]},{IndexedColors:[.6509803921568628,.807843137254902,.8901960784313725,.1215686274509804,.4705882352941176,.7058823529411765,.6980392156862745,.8745098039215686,.5411764705882353,.2,.6274509803921569,.1725490196078431,.984313725490196,.6039215686274509,.6,.8901960784313725,.1019607843137255,.1098039215686274,.9921568627450981,.7490196078431373,.4352941176470588,1,.4980392156862745,0,.792156862745098,.6980392156862745,.8392156862745098,.4156862745098039,.2392156862745098,.6039215686274509,1,1,.6],Name:"Brewer Qualitative Paired",NanColor:[1,1,.6]},{IndexedColors:[.5529411764705883,.8274509803921568,.7803921568627451,1,1,.7019607843137254,.7450980392156863,.7294117647058823,.8549019607843137,.984313725490196,.5019607843137255,.4470588235294118,.5019607843137255,.6941176470588235,.8274509803921568,.9921568627450981,.7058823529411765,.3843137254901961,.7019607843137254,.8705882352941177,.4117647058823529,.9882352941176471,.803921568627451,.8980392156862745,.8509803921568627,.8509803921568627,.8509803921568627,.7372549019607844,.5019607843137255,.7411764705882353,.8,.9215686274509803,.7725490196078432,1,.9294117647058824,.4352941176470588],Name:"Brewer Qualitative Set3",NanColor:[1,.9294117647058824,.4352941176470588]},{IndexedColors:[1,0,0,1,.862745,0,0,.695201,0],Name:"Traffic Lights",NanColor:[.803922,0,.803922]},{IndexedColors:[.908659,.604013,.581857,1,.862745,0,0,.695201,0],Name:"Traffic Lights For Deuteranopes",NanColor:[.803922,0,.803922]},{IndexedColors:[.4196078431372549,0,.07058823529411765,.9019607843137255,.9411764705882353,.0196078431372549,.01568627450980392,.6196078431372549,.00784313725490196],Name:"Traffic Lights For Deuteranopes 2",NanColor:[.803922,0,.803922]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Muted Blue-Green",NanColor:[.25,0,0],RGBPoints:[0,.109804,.27451,.301961,.02,.129412,.309804,.341176,.05,.14902,.341176,.380392,.1,.188235,.403922,.458824,.15,.227451,.447059,.521569,.2,.290196,.494118,.588235,.25,.368627,.552941,.670588,.3,.458824,.619608,.74902,.35,.588235,.713725,.85098,.4,.72549,.815686,.941176,.45,.831373,.882353,.980392,.475,.909804,.933333,1,.5,.980392,.984314,1,.5,.996078,1,.94902,.5,1,1,.980392,.5,.980392,.984314,1,.525,.972549,.988235,.890196,.55,.917647,.960784,.835294,.6,.835294,.921569,.772549,.65,.768627,.901961,.737255,.7,.670588,.831373,.654902,.75,.576471,.760784,.584314,.8,.498039,.678431,.521569,.85,.392157,.560784,.427451,.9,.294118,.45098,.333333,.95,.211765,.34902,.254902,1,.152941,.278431,.196078]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Green-Blue Asymmetric Divergent (62Blbc)",NanColor:[.25,0,0],RGBPoints:[0,.121569,.2,.145098,.05,.196078,.301961,.223529,.1,.258824,.4,.278431,.2,.341176,.54902,.341176,.25,.419608,.619608,.376471,.3,.545098,.701961,.392157,.35,.643137,.780392,.403922,.4,.729412,.819608,.45098,.45,.811765,.870588,.521569,.5,.898039,.909804,.564706,.55,.941176,.92549,.686275,.6,.960784,.94902,.776471,.64,1,1,1,.65,.890196,.988235,.972549,.7,.721569,.894118,.901961,.75,.631373,.823529,.839216,.8,.517647,.662745,.701961,.85,.384314,.494118,.54902,.9,.298039,.360784,.45098,.95,.223529,.25098,.34902,.99,.156863,.172549,.25098,1,.137255,.137255,.188235]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Asymmtrical Earth Tones (6_21b)",NanColor:[.25,0,0],RGBPoints:[0,.141176,.14902,.2,.05,.215686,.258824,.321569,.1,.243137,.368627,.380392,.15,.27451,.439216,.4,.2,.32549,.501961,.384314,.25,.403922,.6,.419608,.3,.486275,.701961,.454902,.35,.556863,.74902,.494118,.4,.670588,.8,.545098,.5,.854902,.901961,.631373,.55,.92549,.941176,.694118,.6,.960784,.94902,.776471,.65,.988235,.968627,.909804,.7,.839216,.815686,.772549,.75,.701961,.662745,.615686,.8,.6,.529412,.478431,.85,.501961,.403922,.360784,.9,.439216,.313725,.290196,1,.301961,.164706,.176471]},{ColorSpace:"Lab",Creator:"Francesca Samsel",Name:"Yellow 15",NanColor:[.25,0,0],RGBPoints:[0,1,1,.988235,.002,1,1,.988235,.05,.984314,.988235,.843137,.1,.988235,.988235,.741176,.15,.980392,.968627,.654902,.2,.980392,.945098,.576471,.25,.968627,.905882,.486275,.3,.968627,.862745,.388235,.35,.960784,.803922,.286275,.4,.94902,.741176,.219608,.45,.941176,.678431,.14902,.5,.929412,.607843,.094118,.55,.921569,.545098,.054902,.6,.909804,.486275,.035294,.65,.890196,.411765,.019608,.7,.8,.305882,0,.75,.760784,.239216,0,.8,.678431,.180392,.011765,.85,.6,.121569,.023529,.9,.501961,.054902,.031373,.95,.4,.039216,.058824,1,.301961,.047059,.090196]},{ColorSpace:"Diverging",Name:"Magma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002258,.001295,.018331,.007843,.003279,.002305,.023708,.011765,.004512,.00349,.029965,.015686,.00595,.004843,.03713,.019608,.007588,.006356,.044973,.023529,.009426,.008022,.052844,.027451,.011465,.009828,.06075,.031373,.013708,.011771,.068667,.035294,.016156,.01384,.076603,.039216,.018815,.016026,.084584,.043137,.021692,.01832,.09261,.047059,.024792,.020715,.100676,.05098,.028123,.023201,.108787,.054902,.031696,.025765,.116965,.058824,.03552,.028397,.125209,.062745,.039608,.03109,.133515,.066667,.04383,.03383,.141886,.070588,.048062,.036607,.150327,.07451,.05232,.039407,.158841,.078431,.056615,.04216,.167446,.082353,.060949,.044794,.176129,.086275,.06533,.047318,.184892,.090196,.069764,.049726,.193735,.094118,.074257,.052017,.20266,.098039,.078815,.054184,.211667,.101961,.083446,.056225,.220755,.105882,.088155,.058133,.229922,.109804,.092949,.059904,.239164,.113725,.097833,.061531,.248477,.117647,.102815,.06301,.257854,.121569,.107899,.064335,.267289,.12549,.113094,.065492,.276784,.129412,.118405,.066479,.286321,.133333,.123833,.067295,.295879,.137255,.12938,.067935,.305443,.141176,.135053,.068391,.315,.145098,.140858,.068654,.324538,.14902,.146785,.068738,.334011,.152941,.152839,.068637,.343404,.156863,.159018,.068354,.352688,.160784,.165308,.067911,.361816,.164706,.171713,.067305,.370771,.168627,.178212,.066576,.379497,.172549,.184801,.065732,.387973,.176471,.19146,.064818,.396152,.180392,.198177,.063862,.404009,.184314,.204935,.062907,.411514,.188235,.211718,.061992,.418647,.192157,.218512,.061158,.425392,.196078,.225302,.060445,.431742,.2,.232077,.059889,.437695,.203922,.238826,.059517,.443256,.207843,.245543,.059352,.448436,.211765,.25222,.059415,.453248,.215686,.258857,.059706,.45771,.219608,.265447,.060237,.46184,.223529,.271994,.060994,.46566,.227451,.278493,.061978,.46919,.231373,.284951,.063168,.472451,.235294,.291366,.064553,.475462,.239216,.29774,.066117,.478243,.243137,.304081,.067835,.480812,.247059,.310382,.069702,.483186,.25098,.316654,.07169,.48538,.254902,.322899,.073782,.487408,.258824,.329114,.075972,.489287,.262745,.335308,.078236,.491024,.266667,.341482,.080564,.492631,.270588,.347636,.082946,.494121,.27451,.353773,.085373,.495501,.278431,.359898,.087831,.496778,.282353,.366012,.090314,.49796,.286275,.372116,.092816,.499053,.290196,.378211,.095332,.500067,.294118,.384299,.097855,.501002,.298039,.390384,.100379,.501864,.301961,.396467,.102902,.502658,.305882,.402548,.10542,.503386,.309804,.408629,.10793,.504052,.313725,.414709,.110431,.504662,.317647,.420791,.11292,.505215,.321569,.426877,.115395,.505714,.32549,.432967,.117855,.50616,.329412,.439062,.120298,.506555,.333333,.445163,.122724,.506901,.337255,.451271,.125132,.507198,.341176,.457386,.127522,.507448,.345098,.463508,.129893,.507652,.34902,.46964,.132245,.507809,.352941,.47578,.134577,.507921,.356863,.481929,.136891,.507989,.360784,.488088,.139186,.508011,.364706,.494258,.141462,.507988,.368627,.500438,.143719,.50792,.372549,.506629,.145958,.507806,.376471,.512831,.148179,.507648,.380392,.519045,.150383,.507443,.384314,.52527,.152569,.507192,.388235,.531507,.154739,.506895,.392157,.537755,.156894,.506551,.396078,.544015,.159033,.506159,.4,.550287,.161158,.505719,.403922,.556571,.163269,.50523,.407843,.562866,.165368,.504692,.411765,.569172,.167454,.504105,.415686,.57549,.16953,.503466,.419608,.581819,.171596,.502777,.423529,.588158,.173652,.502035,.427451,.594508,.175701,.501241,.431373,.600868,.177743,.500394,.435294,.607238,.179779,.499492,.439216,.613617,.181811,.498536,.443137,.620005,.18384,.497524,.447059,.626401,.185867,.496456,.45098,.632805,.187893,.495332,.454902,.639216,.189921,.49415,.458824,.645633,.191952,.49291,.462745,.652056,.193986,.491611,.466667,.658483,.196027,.490253,.470588,.664915,.198075,.488836,.47451,.671349,.200133,.487358,.478431,.677786,.202203,.485819,.482353,.684224,.204286,.484219,.486275,.690661,.206384,.482558,.490196,.697098,.208501,.480835,.494118,.703532,.210638,.479049,.498039,.709962,.212797,.477201,.501961,.716387,.214982,.47529,.505882,.722805,.217194,.473316,.509804,.729216,.219437,.471279,.513725,.735616,.221713,.46918,.517647,.742004,.224025,.467018,.521569,.748378,.226377,.464794,.52549,.754737,.228772,.462509,.529412,.761077,.231214,.460162,.533333,.767398,.233705,.457755,.537255,.773695,.236249,.455289,.541176,.779968,.238851,.452765,.545098,.786212,.241514,.450184,.54902,.792427,.244242,.447543,.552941,.798608,.24704,.444848,.556863,.804752,.249911,.442102,.560784,.810855,.252861,.439305,.564706,.816914,.255895,.436461,.568627,.822926,.259016,.433573,.572549,.828886,.262229,.430644,.576471,.834791,.26554,.427671,.580392,.840636,.268953,.424666,.584314,.846416,.272473,.421631,.588235,.852126,.276106,.418573,.592157,.857763,.279857,.415496,.596078,.86332,.283729,.412403,.6,.868793,.287728,.409303,.603922,.874176,.291859,.406205,.607843,.879464,.296125,.403118,.611765,.884651,.30053,.400047,.615686,.889731,.305079,.397002,.619608,.8947,.309773,.393995,.623529,.899552,.314616,.391037,.627451,.904281,.31961,.388137,.631373,.908884,.324755,.385308,.635294,.913354,.330052,.382563,.639216,.917689,.3355,.379915,.643137,.921884,.341098,.377376,.647059,.925937,.346844,.374959,.65098,.929845,.352734,.372677,.654902,.933606,.358764,.370541,.658824,.937221,.364929,.368567,.662745,.940687,.371224,.366762,.666667,.944006,.377643,.365136,.670588,.94718,.384178,.363701,.67451,.95021,.39082,.362468,.678431,.953099,.397563,.361438,.682353,.955849,.4044,.360619,.686275,.958464,.411324,.360014,.690196,.960949,.418323,.35963,.694118,.96331,.42539,.359469,.698039,.965549,.432519,.359529,.701961,.967671,.439703,.35981,.705882,.96968,.446936,.360311,.709804,.971582,.45421,.36103,.713725,.973381,.46152,.361965,.717647,.975082,.468861,.363111,.721569,.97669,.476226,.364466,.72549,.97821,.483612,.366025,.729412,.979645,.491014,.367783,.733333,.981,.498428,.369734,.737255,.982279,.505851,.371874,.741176,.983485,.51328,.374198,.745098,.984622,.520713,.376698,.74902,.985693,.528148,.379371,.752941,.9867,.535582,.38221,.756863,.987646,.543015,.38521,.760784,.988533,.550446,.388365,.764706,.989363,.557873,.391671,.768627,.990138,.565296,.395122,.772549,.990871,.572706,.398714,.776471,.991558,.580107,.402441,.780392,.992196,.587502,.406299,.784314,.992785,.594891,.410283,.788235,.993326,.602275,.41439,.792157,.993834,.609644,.418613,.796078,.994309,.616999,.42295,.8,.994738,.62435,.427397,.803922,.995122,.631696,.431951,.807843,.99548,.639027,.436607,.811765,.99581,.646344,.441361,.815686,.996096,.653659,.446213,.819608,.996341,.660969,.45116,.823529,.99658,.668256,.456192,.827451,.996775,.675541,.461314,.831373,.996925,.682828,.466526,.835294,.997077,.690088,.471811,.839216,.997186,.697349,.477182,.843137,.997254,.704611,.482635,.847059,.997325,.711848,.488154,.85098,.997351,.719089,.493755,.854902,.997351,.726324,.499428,.858824,.997341,.733545,.505167,.862745,.997285,.740772,.510983,.866667,.997228,.747981,.516859,.870588,.997138,.75519,.522806,.87451,.997019,.762398,.528821,.878431,.996898,.769591,.534892,.882353,.996727,.776795,.541039,.886275,.996571,.783977,.547233,.890196,.996369,.791167,.553499,.894118,.996162,.798348,.55982,.898039,.995932,.805527,.566202,.901961,.99568,.812706,.572645,.905882,.995424,.819875,.57914,.909804,.995131,.827052,.585701,.913725,.994851,.834213,.592307,.917647,.994524,.841387,.598983,.921569,.994222,.84854,.605696,.92549,.993866,.855711,.612482,.929412,.993545,.862859,.619299,.933333,.99317,.870024,.626189,.937255,.992831,.877168,.633109,.941176,.99244,.88433,.640099,.945098,.992089,.89147,.647116,.94902,.991688,.898627,.654202,.952941,.991332,.905763,.661309,.956863,.99093,.912915,.668481,.960784,.99057,.920049,.675675,.964706,.990175,.927196,.682926,.968627,.989815,.934329,.690198,.972549,.989434,.94147,.697519,.976471,.989077,.948604,.704863,.980392,.988717,.955742,.712242,.984314,.988367,.962878,.719649,.988235,.988033,.970012,.727077,.992157,.987691,.977154,.734536,.996078,.987387,.984288,.742002,1,.987053,.991438,.749504]},{ColorSpace:"Diverging",Name:"Inferno (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.001462,466e-6,.013866,.003922,.002267,.00127,.01857,.007843,.003299,.002249,.024239,.011765,.004547,.003392,.030909,.015686,.006006,.004692,.038558,.019608,.007676,.006136,.046836,.023529,.009561,.007713,.055143,.027451,.011663,.009417,.06346,.031373,.013995,.011225,.071862,.035294,.016561,.013136,.080282,.039216,.019373,.015133,.088767,.043137,.022447,.017199,.097327,.047059,.025793,.019331,.10593,.05098,.029432,.021503,.114621,.054902,.033385,.023702,.123397,.058824,.037668,.025921,.132232,.062745,.042253,.028139,.141141,.066667,.046915,.030324,.150164,.070588,.051644,.032474,.159254,.07451,.056449,.034569,.168414,.078431,.06134,.03659,.177642,.082353,.066331,.038504,.186962,.086275,.071429,.040294,.196354,.090196,.076637,.041905,.205799,.094118,.081962,.043328,.215289,.098039,.087411,.044556,.224813,.101961,.09299,.045583,.234358,.105882,.098702,.046402,.243904,.109804,.104551,.047008,.25343,.113725,.110536,.047399,.262912,.117647,.116656,.047574,.272321,.121569,.122908,.047536,.281624,.12549,.129285,.047293,.290788,.129412,.135778,.046856,.299776,.133333,.142378,.046242,.308553,.137255,.149073,.045468,.317085,.141176,.15585,.044559,.325338,.145098,.162689,.043554,.333277,.14902,.169575,.042489,.340874,.152941,.176493,.041402,.348111,.156863,.183429,.040329,.354971,.160784,.190367,.039309,.361447,.164706,.197297,.0384,.367535,.168627,.204209,.037632,.373238,.172549,.211095,.03703,.378563,.176471,.217949,.036615,.383522,.180392,.224763,.036405,.388129,.184314,.231538,.036405,.3924,.188235,.238273,.036621,.396353,.192157,.244967,.037055,.400007,.196078,.25162,.037705,.403378,.2,.258234,.038571,.406485,.203922,.26481,.039647,.409345,.207843,.271347,.040922,.411976,.211765,.27785,.042353,.414392,.215686,.284321,.043933,.416608,.219608,.290763,.045644,.418637,.223529,.297178,.04747,.420491,.227451,.303568,.049396,.422182,.231373,.309935,.051407,.423721,.235294,.316282,.05349,.425116,.239216,.32261,.055634,.426377,.243137,.328921,.057827,.427511,.247059,.335217,.06006,.428524,.25098,.3415,.062325,.429425,.254902,.347771,.064616,.430217,.258824,.354032,.066925,.430906,.262745,.360284,.069247,.431497,.266667,.366529,.071579,.431994,.270588,.372768,.073915,.4324,.27451,.379001,.076253,.432719,.278431,.385228,.078591,.432955,.282353,.391453,.080927,.433109,.286275,.397674,.083257,.433183,.290196,.403894,.08558,.433179,.294118,.410113,.087896,.433098,.298039,.416331,.090203,.432943,.301961,.422549,.092501,.432714,.305882,.428768,.09479,.432412,.309804,.434987,.097069,.432039,.313725,.441207,.099338,.431594,.317647,.447428,.101597,.43108,.321569,.453651,.103848,.430498,.32549,.459875,.106089,.429846,.329412,.4661,.108322,.429125,.333333,.472328,.110547,.428334,.337255,.478558,.112764,.427475,.341176,.484789,.114974,.426548,.345098,.491022,.117179,.425552,.34902,.497257,.119379,.424488,.352941,.503493,.121575,.423356,.356863,.50973,.123769,.422156,.360784,.515967,.12596,.420887,.364706,.522206,.12815,.419549,.368627,.528444,.130341,.418142,.372549,.534683,.132534,.416667,.376471,.54092,.134729,.415123,.380392,.547157,.136929,.413511,.384314,.553392,.139134,.411829,.388235,.559624,.141346,.410078,.392157,.565854,.143567,.408258,.396078,.572081,.145797,.406369,.4,.578304,.148039,.404411,.403922,.584521,.150294,.402385,.407843,.590734,.152563,.40029,.411765,.59694,.154848,.398125,.415686,.603139,.157151,.395891,.419608,.60933,.159474,.393589,.423529,.615513,.161817,.391219,.427451,.621685,.164184,.388781,.431373,.627847,.166575,.386276,.435294,.633998,.168992,.383704,.439216,.640135,.171438,.381065,.443137,.64626,.173914,.378359,.447059,.652369,.176421,.375586,.45098,.658463,.178962,.372748,.454902,.66454,.181539,.369846,.458824,.670599,.184153,.366879,.462745,.676638,.186807,.363849,.466667,.682656,.189501,.360757,.470588,.688653,.192239,.357603,.47451,.694627,.195021,.354388,.478431,.700576,.197851,.351113,.482353,.7065,.200728,.347777,.486275,.712396,.203656,.344383,.490196,.718264,.206636,.340931,.494118,.724103,.20967,.337424,.498039,.729909,.212759,.333861,.501961,.735683,.215906,.330245,.505882,.741423,.219112,.326576,.509804,.747127,.222378,.322856,.513725,.752794,.225706,.319085,.517647,.758422,.229097,.315266,.521569,.76401,.232554,.311399,.52549,.769556,.236077,.307485,.529412,.775059,.239667,.303526,.533333,.780517,.243327,.299523,.537255,.785929,.247056,.295477,.541176,.791293,.250856,.29139,.545098,.796607,.254728,.287264,.54902,.801871,.258674,.283099,.552941,.807082,.262692,.278898,.556863,.812239,.266786,.274661,.560784,.817341,.270954,.27039,.564706,.822386,.275197,.266085,.568627,.827372,.279517,.26175,.572549,.832299,.283913,.257383,.576471,.837165,.288385,.252988,.580392,.841969,.292933,.248564,.584314,.846709,.297559,.244113,.588235,.851384,.30226,.239636,.592157,.855992,.307038,.235133,.596078,.860533,.311892,.230606,.6,.865006,.316822,.226055,.603922,.869409,.321827,.221482,.607843,.873741,.326906,.216886,.611765,.878001,.33206,.212268,.615686,.882188,.337287,.207628,.619608,.886302,.342586,.202968,.623529,.890341,.347957,.198286,.627451,.894305,.353399,.193584,.631373,.898192,.358911,.18886,.635294,.902003,.364492,.184116,.639216,.905735,.37014,.17935,.643137,.90939,.375856,.174563,.647059,.912966,.381636,.169755,.65098,.916462,.387481,.164924,.654902,.919879,.393389,.16007,.658824,.923215,.399359,.155193,.662745,.92647,.405389,.150292,.666667,.929644,.411479,.145367,.670588,.932737,.417627,.140417,.67451,.935747,.423831,.13544,.678431,.938675,.430091,.130438,.682353,.941521,.436405,.125409,.686275,.944285,.442772,.120354,.690196,.946965,.449191,.115272,.694118,.949562,.45566,.110164,.698039,.952075,.462178,.105031,.701961,.954506,.468744,.099874,.705882,.956852,.475356,.094695,.709804,.959114,.482014,.089499,.713725,.961293,.488716,.084289,.717647,.963387,.495462,.079073,.721569,.965397,.502249,.073859,.72549,.967322,.509078,.068659,.729412,.969163,.515946,.063488,.733333,.970919,.522853,.058367,.737255,.97259,.529798,.053324,.741176,.974176,.53678,.048392,.745098,.975677,.543798,.043618,.74902,.977092,.55085,.03905,.752941,.978422,.557937,.034931,.756863,.979666,.565057,.031409,.760784,.980824,.572209,.028508,.764706,.981895,.579392,.02625,.768627,.982881,.586606,.024661,.772549,.983779,.593849,.02377,.776471,.984591,.601122,.023606,.780392,.985315,.608422,.024202,.784314,.985952,.61575,.025592,.788235,.986502,.623105,.027814,.792157,.986964,.630485,.030908,.796078,.987337,.63789,.034916,.8,.987622,.64532,.039886,.803922,.987819,.652773,.045581,.807843,.987926,.66025,.05175,.811765,.987945,.667748,.058329,.815686,.987874,.675267,.065257,.819608,.987714,.682807,.072489,.823529,.987464,.690366,.07999,.827451,.987124,.697944,.087731,.831373,.986694,.70554,.095694,.835294,.986175,.713153,.103863,.839216,.985566,.720782,.112229,.843137,.984865,.728427,.120785,.847059,.984075,.736087,.129527,.85098,.983196,.743758,.138453,.854902,.982228,.751442,.147565,.858824,.981173,.759135,.156863,.862745,.980032,.766837,.166353,.866667,.978806,.774545,.176037,.870588,.977497,.782258,.185923,.87451,.976108,.789974,.196018,.878431,.974638,.797692,.206332,.882353,.973088,.805409,.216877,.886275,.971468,.813122,.227658,.890196,.969783,.820825,.238686,.894118,.968041,.828515,.249972,.898039,.966243,.836191,.261534,.901961,.964394,.843848,.273391,.905882,.962517,.851476,.285546,.909804,.960626,.859069,.29801,.913725,.95872,.866624,.31082,.917647,.956834,.874129,.323974,.921569,.954997,.881569,.337475,.92549,.953215,.888942,.351369,.929412,.951546,.896226,.365627,.933333,.950018,.903409,.380271,.937255,.948683,.910473,.395289,.941176,.947594,.917399,.410665,.945098,.946809,.924168,.426373,.94902,.946392,.930761,.442367,.952941,.946403,.937159,.458592,.956863,.946903,.943348,.47497,.960784,.947937,.949318,.491426,.964706,.949545,.955063,.50786,.968627,.95174,.960587,.524203,.972549,.954529,.965896,.540361,.976471,.957896,.971003,.556275,.980392,.961812,.975924,.571925,.984314,.966249,.980678,.587206,.988235,.971162,.985282,.602154,.992157,.976511,.989753,.61676,.996078,.982257,.994109,.631017,1,.988362,.998364,.644924]},{ColorSpace:"Diverging",Name:"Plasma (matplotlib)",NanColor:[0,1,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Nathaniel J. Smith & Stefan van der Walt",RGBPoints:[0,.050383,.029803,.527975,.003922,.063536,.028426,.533124,.007843,.075353,.027206,.538007,.011765,.086222,.026125,.542658,.015686,.096379,.025165,.547103,.019608,.10598,.024309,.551368,.023529,.115124,.023556,.555468,.027451,.123903,.022878,.559423,.031373,.132381,.022258,.56325,.035294,.140603,.021687,.566959,.039216,.148607,.021154,.570562,.043137,.156421,.020651,.574065,.047059,.16407,.020171,.577478,.05098,.171574,.019706,.580806,.054902,.17895,.019252,.584054,.058824,.186213,.018803,.587228,.062745,.193374,.018354,.59033,.066667,.200445,.017902,.593364,.070588,.207435,.017442,.596333,.07451,.21435,.016973,.599239,.078431,.221197,.016497,.602083,.082353,.227983,.016007,.604867,.086275,.234715,.015502,.607592,.090196,.241396,.014979,.610259,.094118,.248032,.014439,.612868,.098039,.254627,.013882,.615419,.101961,.261183,.013308,.617911,.105882,.267703,.012716,.620346,.109804,.274191,.012109,.622722,.113725,.280648,.011488,.625038,.117647,.287076,.010855,.627295,.121569,.293478,.010213,.62949,.12549,.299855,.009561,.631624,.129412,.30621,.008902,.633694,.133333,.312543,.008239,.6357,.137255,.318856,.007576,.63764,.141176,.32515,.006915,.639512,.145098,.331426,.006261,.641316,.14902,.337683,.005618,.643049,.152941,.343925,.004991,.64471,.156863,.35015,.004382,.646298,.160784,.356359,.003798,.64781,.164706,.362553,.003243,.649245,.168627,.368733,.002724,.650601,.172549,.374897,.002245,.651876,.176471,.381047,.001814,.653068,.180392,.387183,.001434,.654177,.184314,.393304,.001114,.655199,.188235,.399411,859e-6,.656133,.192157,.405503,678e-6,.656977,.196078,.41158,577e-6,.65773,.2,.417642,564e-6,.65839,.203922,.423689,646e-6,.658956,.207843,.429719,831e-6,.659425,.211765,.435734,.001127,.659797,.215686,.441732,.00154,.660069,.219608,.447714,.00208,.66024,.223529,.453677,.002755,.66031,.227451,.459623,.003574,.660277,.231373,.46555,.004545,.660139,.235294,.471457,.005678,.659897,.239216,.477344,.00698,.659549,.243137,.48321,.00846,.659095,.247059,.489055,.010127,.658534,.25098,.494877,.01199,.657865,.254902,.500678,.014055,.657088,.258824,.506454,.016333,.656202,.262745,.512206,.018833,.655209,.266667,.517933,.021563,.654109,.270588,.523633,.024532,.652901,.27451,.529306,.027747,.651586,.278431,.534952,.031217,.650165,.282353,.54057,.03495,.64864,.286275,.546157,.038954,.64701,.290196,.551715,.043136,.645277,.294118,.557243,.047331,.643443,.298039,.562738,.051545,.641509,.301961,.568201,.055778,.639477,.305882,.573632,.060028,.637349,.309804,.579029,.064296,.635126,.313725,.584391,.068579,.632812,.317647,.589719,.072878,.630408,.321569,.595011,.07719,.627917,.32549,.600266,.081516,.625342,.329412,.605485,.085854,.622686,.333333,.610667,.090204,.619951,.337255,.615812,.094564,.61714,.341176,.620919,.098934,.614257,.345098,.625987,.103312,.611305,.34902,.631017,.107699,.608287,.352941,.636008,.112092,.605205,.356863,.640959,.116492,.602065,.360784,.645872,.120898,.598867,.364706,.650746,.125309,.595617,.368627,.65558,.129725,.592317,.372549,.660374,.134144,.588971,.376471,.665129,.138566,.585582,.380392,.669845,.142992,.582154,.384314,.674522,.147419,.578688,.388235,.67916,.151848,.575189,.392157,.683758,.156278,.57166,.396078,.688318,.160709,.568103,.4,.69284,.165141,.564522,.403922,.697324,.169573,.560919,.407843,.701769,.174005,.557296,.411765,.706178,.178437,.553657,.415686,.710549,.182868,.550004,.419608,.714883,.187299,.546338,.423529,.719181,.191729,.542663,.427451,.723444,.196158,.538981,.431373,.72767,.200586,.535293,.435294,.731862,.205013,.531601,.439216,.736019,.209439,.527908,.443137,.740143,.213864,.524216,.447059,.744232,.218288,.520524,.45098,.748289,.222711,.516834,.454902,.752312,.227133,.513149,.458824,.756304,.231555,.509468,.462745,.760264,.235976,.505794,.466667,.764193,.240396,.502126,.470588,.76809,.244817,.498465,.47451,.771958,.249237,.494813,.478431,.775796,.253658,.491171,.482353,.779604,.258078,.487539,.486275,.783383,.2625,.483918,.490196,.787133,.266922,.480307,.494118,.790855,.271345,.476706,.498039,.794549,.27577,.473117,.501961,.798216,.280197,.469538,.505882,.801855,.284626,.465971,.509804,.805467,.289057,.462415,.513725,.809052,.293491,.45887,.517647,.812612,.297928,.455338,.521569,.816144,.302368,.451816,.52549,.819651,.306812,.448306,.529412,.823132,.311261,.444806,.533333,.826588,.315714,.441316,.537255,.830018,.320172,.437836,.541176,.833422,.324635,.434366,.545098,.836801,.329105,.430905,.54902,.840155,.33358,.427455,.552941,.843484,.338062,.424013,.556863,.846788,.342551,.420579,.560784,.850066,.347048,.417153,.564706,.853319,.351553,.413734,.568627,.856547,.356066,.410322,.572549,.85975,.360588,.406917,.576471,.862927,.365119,.403519,.580392,.866078,.36966,.400126,.584314,.869203,.374212,.396738,.588235,.872303,.378774,.393355,.592157,.875376,.383347,.389976,.596078,.878423,.387932,.3866,.6,.881443,.392529,.383229,.603922,.884436,.397139,.37986,.607843,.887402,.401762,.376494,.611765,.89034,.406398,.37313,.615686,.89325,.411048,.369768,.619608,.896131,.415712,.366407,.623529,.898984,.420392,.363047,.627451,.901807,.425087,.359688,.631373,.904601,.429797,.356329,.635294,.907365,.434524,.35297,.639216,.910098,.439268,.34961,.643137,.9128,.444029,.346251,.647059,.915471,.448807,.34289,.65098,.918109,.453603,.339529,.654902,.920714,.458417,.336166,.658824,.923287,.463251,.332801,.662745,.925825,.468103,.329435,.666667,.928329,.472975,.326067,.670588,.930798,.477867,.322697,.67451,.933232,.48278,.319325,.678431,.93563,.487712,.315952,.682353,.93799,.492667,.312575,.686275,.940313,.497642,.309197,.690196,.942598,.502639,.305816,.694118,.944844,.507658,.302433,.698039,.947051,.512699,.299049,.701961,.949217,.517763,.295662,.705882,.951344,.52285,.292275,.709804,.953428,.52796,.288883,.713725,.95547,.533093,.28549,.717647,.957469,.53825,.282096,.721569,.959424,.543431,.278701,.72549,.961336,.548636,.275305,.729412,.963203,.553865,.271909,.733333,.965024,.559118,.268513,.737255,.966798,.564396,.265118,.741176,.968526,.5697,.261721,.745098,.970205,.575028,.258325,.74902,.971835,.580382,.254931,.752941,.973416,.585761,.25154,.756863,.974947,.591165,.248151,.760784,.976428,.596595,.244767,.764706,.977856,.602051,.241387,.768627,.979233,.607532,.238013,.772549,.980556,.613039,.234646,.776471,.981826,.618572,.231287,.780392,.983041,.624131,.227937,.784314,.984199,.629718,.224595,.788235,.985301,.63533,.221265,.792157,.986345,.640969,.217948,.796078,.987332,.646633,.214648,.8,.98826,.652325,.211364,.803922,.989128,.658043,.2081,.807843,.989935,.663787,.204859,.811765,.990681,.669558,.201642,.815686,.991365,.675355,.198453,.819608,.991985,.681179,.195295,.823529,.992541,.68703,.19217,.827451,.993032,.692907,.189084,.831373,.993456,.69881,.186041,.835294,.993814,.704741,.183043,.839216,.994103,.710698,.180097,.843137,.994324,.716681,.177208,.847059,.994474,.722691,.174381,.85098,.994553,.728728,.171622,.854902,.994561,.734791,.168938,.858824,.994495,.74088,.166335,.862745,.994355,.746995,.163821,.866667,.994141,.753137,.161404,.870588,.993851,.759304,.159092,.87451,.993482,.765499,.156891,.878431,.993033,.77172,.154808,.882353,.992505,.777967,.152855,.886275,.991897,.784239,.151042,.890196,.991209,.790537,.149377,.894118,.990439,.796859,.14787,.898039,.989587,.803205,.146529,.901961,.988648,.809579,.145357,.905882,.987621,.815978,.144363,.909804,.986509,.822401,.143557,.913725,.985314,.828846,.142945,.917647,.984031,.835315,.142528,.921569,.982653,.841812,.142303,.92549,.98119,.848329,.142279,.929412,.979644,.854866,.142453,.933333,.977995,.861432,.142808,.937255,.976265,.868016,.143351,.941176,.974443,.874622,.144061,.945098,.97253,.88125,.144923,.94902,.970533,.887896,.145919,.952941,.968443,.894564,.147014,.956863,.966271,.901249,.14818,.960784,.964021,.90795,.14937,.964706,.961681,.914672,.15052,.968627,.959276,.921407,.151566,.972549,.956808,.928152,.152409,.976471,.954287,.934908,.152921,.980392,.951726,.941671,.152925,.984314,.949151,.948435,.152178,.988235,.946602,.95519,.150328,.992157,.944152,.961916,.146861,.996078,.941896,.96859,.140956,1,.940015,.975158,.131326]},{ColorSpace:"Diverging",Name:"Viridis (matplotlib)",NanColor:[1,0,0],Source:"https://github.com/BIDS/colormap/blob/master/colormaps.py",License:"CC0",Creator:"Eric Firing",RGBPoints:[0,.267004,.004874,.329415,.003922,.26851,.009605,.335427,.007843,.269944,.014625,.341379,.011765,.271305,.019942,.347269,.015686,.272594,.025563,.353093,.019608,.273809,.031497,.358853,.023529,.274952,.037752,.364543,.027451,.276022,.044167,.370164,.031373,.277018,.050344,.375715,.035294,.277941,.056324,.381191,.039216,.278791,.062145,.386592,.043137,.279566,.067836,.391917,.047059,.280267,.073417,.397163,.05098,.280894,.078907,.402329,.054902,.281446,.08432,.407414,.058824,.281924,.089666,.412415,.062745,.282327,.094955,.417331,.066667,.282656,.100196,.42216,.070588,.28291,.105393,.426902,.07451,.283091,.110553,.431554,.078431,.283197,.11568,.436115,.082353,.283229,.120777,.440584,.086275,.283187,.125848,.44496,.090196,.283072,.130895,.449241,.094118,.282884,.13592,.453427,.098039,.282623,.140926,.457517,.101961,.28229,.145912,.46151,.105882,.281887,.150881,.465405,.109804,.281412,.155834,.469201,.113725,.280868,.160771,.472899,.117647,.280255,.165693,.476498,.121569,.279574,.170599,.479997,.12549,.278826,.17549,.483397,.129412,.278012,.180367,.486697,.133333,.277134,.185228,.489898,.137255,.276194,.190074,.493001,.141176,.275191,.194905,.496005,.145098,.274128,.199721,.498911,.14902,.273006,.20452,.501721,.152941,.271828,.209303,.504434,.156863,.270595,.214069,.507052,.160784,.269308,.218818,.509577,.164706,.267968,.223549,.512008,.168627,.26658,.228262,.514349,.172549,.265145,.232956,.516599,.176471,.263663,.237631,.518762,.180392,.262138,.242286,.520837,.184314,.260571,.246922,.522828,.188235,.258965,.251537,.524736,.192157,.257322,.25613,.526563,.196078,.255645,.260703,.528312,.2,.253935,.265254,.529983,.203922,.252194,.269783,.531579,.207843,.250425,.27429,.533103,.211765,.248629,.278775,.534556,.215686,.246811,.283237,.535941,.219608,.244972,.287675,.53726,.223529,.243113,.292092,.538516,.227451,.241237,.296485,.539709,.231373,.239346,.300855,.540844,.235294,.237441,.305202,.541921,.239216,.235526,.309527,.542944,.243137,.233603,.313828,.543914,.247059,.231674,.318106,.544834,.25098,.229739,.322361,.545706,.254902,.227802,.326594,.546532,.258824,.225863,.330805,.547314,.262745,.223925,.334994,.548053,.266667,.221989,.339161,.548752,.270588,.220057,.343307,.549413,.27451,.21813,.347432,.550038,.278431,.21621,.351535,.550627,.282353,.214298,.355619,.551184,.286275,.212395,.359683,.55171,.290196,.210503,.363727,.552206,.294118,.208623,.367752,.552675,.298039,.206756,.371758,.553117,.301961,.204903,.375746,.553533,.305882,.203063,.379716,.553925,.309804,.201239,.38367,.554294,.313725,.19943,.387607,.554642,.317647,.197636,.391528,.554969,.321569,.19586,.395433,.555276,.32549,.1941,.399323,.555565,.329412,.192357,.403199,.555836,.333333,.190631,.407061,.556089,.337255,.188923,.41091,.556326,.341176,.187231,.414746,.556547,.345098,.185556,.41857,.556753,.34902,.183898,.422383,.556944,.352941,.182256,.426184,.55712,.356863,.180629,.429975,.557282,.360784,.179019,.433756,.55743,.364706,.177423,.437527,.557565,.368627,.175841,.44129,.557685,.372549,.174274,.445044,.557792,.376471,.172719,.448791,.557885,.380392,.171176,.45253,.557965,.384314,.169646,.456262,.55803,.388235,.168126,.459988,.558082,.392157,.166617,.463708,.558119,.396078,.165117,.467423,.558141,.4,.163625,.471133,.558148,.403922,.162142,.474838,.55814,.407843,.160665,.47854,.558115,.411765,.159194,.482237,.558073,.415686,.157729,.485932,.558013,.419608,.15627,.489624,.557936,.423529,.154815,.493313,.55784,.427451,.153364,.497,.557724,.431373,.151918,.500685,.557587,.435294,.150476,.504369,.55743,.439216,.149039,.508051,.55725,.443137,.147607,.511733,.557049,.447059,.14618,.515413,.556823,.45098,.144759,.519093,.556572,.454902,.143343,.522773,.556295,.458824,.141935,.526453,.555991,.462745,.140536,.530132,.555659,.466667,.139147,.533812,.555298,.470588,.13777,.537492,.554906,.47451,.136408,.541173,.554483,.478431,.135066,.544853,.554029,.482353,.133743,.548535,.553541,.486275,.132444,.552216,.553018,.490196,.131172,.555899,.552459,.494118,.129933,.559582,.551864,.498039,.128729,.563265,.551229,.501961,.127568,.566949,.550556,.505882,.126453,.570633,.549841,.509804,.125394,.574318,.549086,.513725,.124395,.578002,.548287,.517647,.123463,.581687,.547445,.521569,.122606,.585371,.546557,.52549,.121831,.589055,.545623,.529412,.121148,.592739,.544641,.533333,.120565,.596422,.543611,.537255,.120092,.600104,.54253,.541176,.119738,.603785,.5414,.545098,.119512,.607464,.540218,.54902,.119423,.611141,.538982,.552941,.119483,.614817,.537692,.556863,.119699,.61849,.536347,.560784,.120081,.622161,.534946,.564706,.120638,.625828,.533488,.568627,.12138,.629492,.531973,.572549,.122312,.633153,.530398,.576471,.123444,.636809,.528763,.580392,.12478,.640461,.527068,.584314,.126326,.644107,.525311,.588235,.128087,.647749,.523491,.592157,.130067,.651384,.521608,.596078,.132268,.655014,.519661,.6,.134692,.658636,.517649,.603922,.137339,.662252,.515571,.607843,.14021,.665859,.513427,.611765,.143303,.669459,.511215,.615686,.146616,.67305,.508936,.619608,.150148,.676631,.506589,.623529,.153894,.680203,.504172,.627451,.157851,.683765,.501686,.631373,.162016,.687316,.499129,.635294,.166383,.690856,.496502,.639216,.170948,.694384,.493803,.643137,.175707,.6979,.491033,.647059,.180653,.701402,.488189,.65098,.185783,.704891,.485273,.654902,.19109,.708366,.482284,.658824,.196571,.711827,.479221,.662745,.202219,.715272,.476084,.666667,.20803,.718701,.472873,.670588,.214,.722114,.469588,.67451,.220124,.725509,.466226,.678431,.226397,.728888,.462789,.682353,.232815,.732247,.459277,.686275,.239374,.735588,.455688,.690196,.24607,.73891,.452024,.694118,.252899,.742211,.448284,.698039,.259857,.745492,.444467,.701961,.266941,.748751,.440573,.705882,.274149,.751988,.436601,.709804,.281477,.755203,.432552,.713725,.288921,.758394,.428426,.717647,.296479,.761561,.424223,.721569,.304148,.764704,.419943,.72549,.311925,.767822,.415586,.729412,.319809,.770914,.411152,.733333,.327796,.77398,.40664,.737255,.335885,.777018,.402049,.741176,.344074,.780029,.397381,.745098,.35236,.783011,.392636,.74902,.360741,.785964,.387814,.752941,.369214,.788888,.382914,.756863,.377779,.791781,.377939,.760784,.386433,.794644,.372886,.764706,.395174,.797475,.367757,.768627,.404001,.800275,.362552,.772549,.412913,.803041,.357269,.776471,.421908,.805774,.35191,.780392,.430983,.808473,.346476,.784314,.440137,.811138,.340967,.788235,.449368,.813768,.335384,.792157,.458674,.816363,.329727,.796078,.468053,.818921,.323998,.8,.477504,.821444,.318195,.803922,.487026,.823929,.312321,.807843,.496615,.826376,.306377,.811765,.506271,.828786,.300362,.815686,.515992,.831158,.294279,.819608,.525776,.833491,.288127,.823529,.535621,.835785,.281908,.827451,.545524,.838039,.275626,.831373,.555484,.840254,.269281,.835294,.565498,.84243,.262877,.839216,.575563,.844566,.256415,.843137,.585678,.846661,.249897,.847059,.595839,.848717,.243329,.85098,.606045,.850733,.236712,.854902,.616293,.852709,.230052,.858824,.626579,.854645,.223353,.862745,.636902,.856542,.21662,.866667,.647257,.8584,.209861,.870588,.657642,.860219,.203082,.87451,.668054,.861999,.196293,.878431,.678489,.863742,.189503,.882353,.688944,.865448,.182725,.886275,.699415,.867117,.175971,.890196,.709898,.868751,.169257,.894118,.720391,.87035,.162603,.898039,.730889,.871916,.156029,.901961,.741388,.873449,.149561,.905882,.751884,.874951,.143228,.909804,.762373,.876424,.137064,.913725,.772852,.877868,.131109,.917647,.783315,.879285,.125405,.921569,.79376,.880678,.120005,.92549,.804182,.882046,.114965,.929412,.814576,.883393,.110347,.933333,.82494,.88472,.106217,.937255,.83527,.886029,.102646,.941176,.845561,.887322,.099702,.945098,.85581,.888601,.097452,.94902,.866013,.889868,.095953,.952941,.876168,.891125,.09525,.956863,.886271,.892374,.095374,.960784,.89632,.893616,.096335,.964706,.906311,.894855,.098125,.968627,.916242,.896091,.100717,.972549,.926106,.89733,.104071,.976471,.935904,.89857,.108131,.980392,.945636,.899815,.112838,.984314,.9553,.901065,.118128,.988235,.964894,.902323,.123941,.992157,.974417,.90359,.130215,.996078,.983868,.904867,.136897,1,.993248,.906157,.143936]},{ShowIndexedColorActiveValues:1,IndexedColors:[.07,.5,.7,1,1,1,.85,1,1,.8,.5,1,.76,1,0,1,.71,.71,.5,.5,.5,.05,.05,1,1,.05,.05,.7,1,1,.7,.89,.96,.67,.36,.95,.54,1,0,.75,.65,.65,.5,.6,.6,1,.5,0,1,1,.19,.12,.94,.12,.5,.82,.89,.56,.25,.83,.24,1,0,.9,.9,.9,.75,.76,.78,.65,.65,.67,.54,.6,.78,.61,.48,.78,.5,.48,.78,.44,.48,.78,.36,.48,.76,1,.48,.38,.49,.5,.69,.76,.56,.56,.4,.56,.56,.74,.5,.89,1,.63,0,.65,.16,.16,.36,.72,.82,.44,.18,.69,0,1,0,.58,1,1,.58,.88,.88,.45,.76,.79,.33,.71,.71,.23,.62,.62,.14,.56,.56,.04,.49,.55,0,.41,.52,.88,.88,1,1,.85,.56,.65,.46,.45,.4,.5,.5,.62,.39,.71,.83,.48,0,.58,0,.58,.26,.62,.69,.34,.09,.56,0,.79,0,.44,.83,1,1,1,.78,.85,1,.78,.78,1,.78,.64,1,.78,.56,1,.78,.38,1,.78,.27,1,.78,.19,1,.78,.12,1,.78,0,1,.61,0,.9,.46,0,.83,.32,0,.75,.22,0,.67,.14,.3,.76,1,.3,.65,1,.13,.58,.84,.15,.49,.67,.15,.4,.59,.09,.33,.53,.96,.93,.82,.8,.82,.12,.71,.71,.76,.65,.33,.3,.34,.35,.38,.62,.31,.71,.67,.36,0,.46,.31,.27,.26,.51,.59,.26,0,.4,0,.49,0,.44,.67,.98,0,.73,1,0,.63,1,0,.56,1,0,.5,1,0,.42,1,.33,.36,.95,.47,.36,.89,.54,.31,.89,.63,.21,.83,.7,.12,.83,.7,.12,.73,.7,.05,.65,.74,.05,.53,.78,0,.4,.8,0,.35,.82,0,.31,.85,0,.27,.88,0,.22,.9,0,.18,.91,0,.15,.92,0,.14,.93,0,.13,.94,0,.12,.95,0,.11,.96,0,.1,.97,0,.09,.98,0,.08,.99,0,.07,1,0,.06],Annotations:[0,"Xx",1,"H",2,"He",3,"Li",4,"Be",5,"B",6,"C",7,"N",8,"O",9,"F",10,"Ne",11,"Na",12,"Mg",13,"Al",14,"Si",15,"P",16,"S",17,"Cl",18,"Ar",19,"K",20,"Ca",21,"Sc",22,"Ti",23,"V",24,"Cr",25,"Mn",26,"Fe",27,"Co",28,"Ni",29,"Cu",30,"Zn",31,"Ga",32,"Ge",33,"As",34,"Se",35,"Br",36,"Kr",37,"Rb",38,"Sr",39,"Y",40,"Zr",41,"Nb",42,"Mo",43,"Tc",44,"Ru",45,"Rh",46,"Pd",47,"Ag",48,"Cd",49,"In",50,"Sn",51,"Sb",52,"Te",53,"I",54,"Xe",55,"Cs",56,"Ba",57,"La",58,"Ce",59,"Pr",60,"Nd",61,"Pm",62,"Sm",63,"Eu",64,"Gd",65,"Tb",66,"Dy",67,"Ho",68,"Er",69,"Tm",70,"Yb",71,"Lu",72,"Hf",73,"Ta",74,"W",75,"Re",76,"Os",77,"Ir",78,"Pt",79,"Au",80,"Hg",81,"Tl",82,"Pb",83,"Bi",84,"Po",85,"At",86,"Rn",87,"Fr",88,"Ra",89,"Ac",90,"Th",91,"Pa",92,"U",93,"Np",94,"Pu",95,"Am",96,"Cm",97,"Bk",98,"Cf",99,"Es",100,"Fm",101,"Md",102,"No",103,"Lr",104,"Rf",105,"Db",106,"Sg",107,"Bh",108,"Hs",109,"Mt",110,"Ds",111,"Rg",112,"Cn",113,"Uut",114,"Uuq",115,"Uup",116,"Uuh",117,"Uus",118,"Uuo"],Name:"BlueObeliskElements"}];const er=Object.create(null);s6.filter(t=>t.RGBPoints).filter(t=>t.ColorSpace!=="CIELAB").forEach(t=>{er[t.Name]=t});const tr=Object.keys(er);tr.sort();function o6(t){return er[t]}function c6(t){!t.RGBPoints||t.ColorSpace==="CIELAB"||(er[t.Name]||(tr.push(t.Name),tr.sort()),er[t.Name]=t)}function l6(t){const e=tr.indexOf(t);e>-1&&tr.splice(e,1),delete er[t]}var ia={addPreset:c6,removePresetByName:l6,getPresetByName:o6,rgbPresetNames:tr};function $l(t,e,n){return Math.abs(t-e)<=n}function u6(t,e,n=1e-5){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!$l(t[r],e[r],n))return!1;return!0}function Ao(t){return typeof t=="number"}function Bo(t){return t&&typeof t=="object"&&"length"in t&&typeof t.length=="number"&&t.length>0&&typeof t[0]=="number"}function Ne(t,e,n=1e-5){return typeof t!=typeof e||t===null||e===null?!1:Ao(t)&&Ao(e)?$l(t,e,n):Bo(t)&&Bo(e)?u6(t,e,n):!1}const jl=t=>typeof t=="number"?-t:t!=null&&t.map?t.map(jl):!t,w0=t=>typeof t=="number"?Math.abs(t):t!=null&&t.map?t.map(w0):t,Hl=(t,e,n=void 0)=>Ne(t,jl(e),n),f6=(t,e,n=void 0)=>Ne(w0(t),w0(e),n),Es=new Map;function g6(t){Es.set(t.Name,t)}function Gr(t){return Es.get(t)}function Kl(){return Array.from(Es.keys())}function Ms(t,e){const n=ia.rgbPresetNames.map(o=>ia.getPresetByName(o)),r=Kl().map(o=>Gr(o)),a=n.concat(r).find(o=>{const{RGBPoints:c}=o;if(c.length!==t.length)return!1;for(let l=0;l<c.length;l+=4)if(!Ne(c.slice(l+1,l+4),t.slice(l+1,l+4)))return!1;return!0});if(!a)return null;const s=[];if(Xe(e,"vtkVolume")){const o=e.getProperty().getScalarOpacity(0).getDataPointer();if(!o)return{name:a.Name};for(let c=0;c<o.length;c+=2)s.push({value:o[c],opacity:o[c+1]})}return{name:a.Name,opacity:s}}var h6=Object.freeze({__proto__:null,findMatchingColormap:Ms,getColormap:Gr,getColormapNames:Kl,registerColormap:g6});function Mr(t){if(!t)return;const e=t.getSize();for(let n=0;n<e;n++){const r=[];t.getNodeValue(n,r),r[1]=1-r[1],r[2]=1-r[2],r[3]=1-r[3],t.setNodeValue(n,r)}}const S0=(t,e,n)=>e-n/4*Math.log((1-t)/t);function Os(t,e){const n=Math.abs(e-t)+1,r=(t+e+1)/2;return{windowWidth:n,windowCenter:r}}function Or(t,e,n=qe.LINEAR){if(n===qe.LINEAR)return{lower:e-.5-(t-1)/2,upper:e-.5+(t-1)/2};if(n===qe.LINEAR_EXACT)return{lower:e-t/2,upper:e+t/2};if(n===qe.SAMPLED_SIGMOID){const r=S0(.01,e,t),i=S0(.99,e,t);return{lower:r,upper:i}}else throw new Error("Invalid VOI LUT function")}var p6=Object.freeze({__proto__:null,toLowHighRange:Or,toWindowLevel:Os});function Ds(t,e=1024){const{windowWidth:n,windowCenter:r}=Os(t.lower,t.upper),a=Array.from({length:e},(o,c)=>(c+1)/(e+2)).flatMap(o=>[S0(o,r,n),o,o,o,.5,0]),s=Mn.newInstance();return s.buildFunctionFromArray(oe.newInstance({values:a,numberOfComponents:6})),s}function Va(t,e){return t.worldToIndex(e).map(Math.round)}function Ii(t,e){return t.worldToIndex(e)}function aa(t){const e=t.getSize(),n=[];for(let r=0;r<e;r++){const i=[];t.getNodeValue(r,i),n.push(i)}return n}function Ia(t,e){e!=null&&e.length&&(t.removeAllPoints(),e.forEach(n=>{t.addRGBPoint(...n)}))}var d6=Object.freeze({__proto__:null,getTransferFunctionNodes:aa,setTransferFunctionNodes:Ia});const{InterpolationType:Tr,OpacityMode:m6}=pl,{vtkErrorMacro:qa}=R,Li=4;function y6(t,e){e.classHierarchy.push("vtkVolumeProperty"),t.getMTime=()=>{let i=e.mtime,a;for(let s=0;s<Li;s++)e.componentData[s].colorChannels===1?e.componentData[s].grayTransferFunction&&(a=e.componentData[s].grayTransferFunction.getMTime(),i=i>a?i:a):e.componentData[s].colorChannels===3&&e.componentData[s].rGBTransferFunction&&(a=e.componentData[s].rGBTransferFunction.getMTime(),i=i>a?i:a),e.componentData[s].scalarOpacity&&(a=e.componentData[s].scalarOpacity.getMTime(),i=i>a?i:a),e.componentData[s].gradientOpacity&&(e.componentData[s].disableGradientOpacity||(a=e.componentData[s].gradientOpacity.getMTime(),i=i>a?i:a));return i},t.getColorChannels=i=>i<0||i>3?(qa("Bad index - must be between 0 and 3"),0):e.componentData[i].colorChannels,t.setGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=!1;return e.componentData[i].grayTransferFunction!==a&&(e.componentData[i].grayTransferFunction=a,s=!0),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1,s=!0),s&&t.modified(),s},t.getGrayTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].grayTransferFunction===null&&(e.componentData[i].grayTransferFunction=Pr.newInstance(),e.componentData[i].grayTransferFunction.addPoint(0,0),e.componentData[i].grayTransferFunction.addPoint(1024,1),e.componentData[i].colorChannels!==1&&(e.componentData[i].colorChannels=1),t.modified()),e.componentData[i].grayTransferFunction},t.setRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,s=!1;return e.componentData[i].rGBTransferFunction!==a&&(e.componentData[i].rGBTransferFunction=a,s=!0),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3,s=!0),s&&t.modified(),s},t.getRGBTransferFunction=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].rGBTransferFunction===null&&(e.componentData[i].rGBTransferFunction=Mn.newInstance(),e.componentData[i].rGBTransferFunction.addRGBPoint(0,0,0,0),e.componentData[i].rGBTransferFunction.addRGBPoint(1024,1,1,1),e.componentData[i].colorChannels!==3&&(e.componentData[i].colorChannels=3),t.modified()),e.componentData[i].rGBTransferFunction},t.setScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return e.componentData[i].scalarOpacity!==a?(e.componentData[i].scalarOpacity=a,t.modified(),!0):!1},t.getScalarOpacity=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[i].scalarOpacity===null&&(e.componentData[i].scalarOpacity=Pr.newInstance(),e.componentData[i].scalarOpacity.addPoint(0,1),e.componentData[i].scalarOpacity.addPoint(1024,1),t.modified()),e.componentData[i].scalarOpacity},t.setComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(i<0||i>=Li)return qa("Invalid index"),!1;const s=Math.min(1,Math.max(0,a));return e.componentData[i].componentWeight!==s?(e.componentData[i].componentWeight=s,t.modified(),!0):!1},t.getComponentWeight=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return i<0||i>=Li?(qa("Invalid index"),0):e.componentData[i].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(Tr.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(Tr.LINEAR),t.setInterpolationTypeToFastLinear=()=>t.setInterpolationType(Tr.FAST_LINEAR),t.getInterpolationTypeAsString=()=>R.enumToString(Tr,e.interpolationType),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{const a=R.capitalize(i);t[`set${a}`]=(s,o)=>e.componentData[s][`${i}`]!==o?(e.componentData[s][`${i}`]=o,t.modified(),!0):!1}),["useGradientOpacity","scalarOpacityUnitDistance","gradientOpacityMinimumValue","gradientOpacityMinimumOpacity","gradientOpacityMaximumValue","gradientOpacityMaximumOpacity","opacityMode","forceNearestInterpolation"].forEach(i=>{const a=R.capitalize(i);t[`get${a}`]=s=>e.componentData[s][`${i}`]})}const v6={colorMixPreset:null,independentComponents:!0,interpolationType:Tr.FAST_LINEAR,shade:!1,ambient:.1,diffuse:.7,specular:.2,specularPower:10,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function ql(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,v6,n),R.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<Li;++r)e.componentData.push({colorChannels:1,grayTransferFunction:null,rGBTransferFunction:null,scalarOpacity:null,scalarOpacityUnitDistance:1,opacityMode:m6.FRACTIONAL,gradientOpacityMinimumValue:0,gradientOpacityMinimumOpacity:0,gradientOpacityMaximumValue:1,gradientOpacityMaximumOpacity:1,useGradientOpacity:!1,componentWeight:1,forceNearestInterpolation:!1})}R.setGet(t,e,["colorMixPreset","independentComponents","interpolationType","shade","ambient","diffuse","specular","specularPower","useLabelOutline","labelOutlineOpacity"]),R.setGetArray(t,e,["labelOutlineThickness"]),y6(t,e)}const T6=R.newInstance(ql,"vtkVolumeProperty");var C6={newInstance:T6,extend:ql,...pl};const{vtkDebugMacro:x6}=R;function w6(t,e){e.classHierarchy.push("vtkVolume"),t.getVolumes=()=>t,t.makeProperty=C6.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;const r=i=>i[0].map((a,s)=>i.map(o=>o[s]));if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce((i,a)=>i&&a[0]===a[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){x6("Recomputing bounds..."),e.mapperBounds=n.map(s=>s);const i=[];De.getCorners(n,i),t.computeMatrix();const a=new Float64Array(16);ue(a,e.matrix),i.forEach(s=>pe(s,s,a)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((s,o)=>o%2===0?i.reduce((c,l)=>c>l[o/2]?l[o/2]:c,s):i.reduce((c,l)=>c<l[(o-1)/2]?l[(o-1)/2]:c,s)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let n=e.mtime;if(e.property!==null){const r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}return n}}const S6={mapper:null,property:null,bounds:[1,-1,1,-1,1,-1]};function Xl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,S6,n),bl.extend(t,e,n),e.boundsMTime={},R.obj(e.boundsMTime),R.set(t,e,["property"]),R.setGet(t,e,["mapper"]),R.getArray(t,e,["bounds"],6),w6(t,e)}const R6=R.newInstance(Xl,"vtkVolume");var E6={newInstance:R6,extend:Xl};const{vtkErrorMacro:M6}=R;class O6{constructor(){this.segmentMapping={},this.segments=[null],this.faces=[]}addSegment(e){const n=e[0],r=e[e.length-1];if(n===r||e.length<2)return;const i=this.segmentMapping[n],a=this.segmentMapping[r];if(i!==void 0&&a!==void 0)if(Math.abs(i)===Math.abs(a)){const s=i<a?a:i,o=this.segments[s];if(i>0)for(let c=1;c<e.length-1;c++)o.push(e[c]);else for(let c=1;c<e.length-1;c++)o.unshift(e[e.length-1-c]);this.faces.push(o),this.segments[s]=null,this.segmentMapping[n]=void 0,this.segmentMapping[r]=void 0}else{const s=Math.abs(i),o=Math.abs(a),c=this.segments[s],l=this.segments[o];this.segments[s]=null,this.segments[o]=null,this.segmentMapping[c[0]]=void 0,this.segmentMapping[l[0]]=void 0,this.segmentMapping[c[c.length-1]]=void 0,this.segmentMapping[l[l.length-1]]=void 0,this.addSegment(e),this.addSegment(c),this.addSegment(l)}else if(i!==void 0){if(i>0){const s=this.segments[i];for(let o=1;o<e.length;o++)s.push(e[o]);this.segmentMapping[r]=i}else{const s=this.segments[-i];this.segmentMapping[r]=i;for(let o=1;o<e.length;o++)s.unshift(e[o])}this.segmentMapping[n]=void 0}else if(a!==void 0){if(a>0){const s=this.segments[a];for(let o=1;o<e.length;o++)s.push(e[e.length-1-o]);this.segmentMapping[n]=a}else{const s=this.segments[-a];this.segmentMapping[n]=a;for(let o=1;o<e.length;o++)s.unshift(e[e.length-o-1])}this.segmentMapping[r]=void 0}else{const s=this.segments.length;this.segments.push(e),this.segmentMapping[n]=-s,this.segmentMapping[r]=s}}}function D6(t,e){e.classHierarchy.push("vtkClosedPolyLineToSurfaceFilter"),t.requestData=(n,r)=>{const i=n[0];if(!i){M6("Invalid or missing input");return}const a=wn.newInstance();a.shallowCopy(i);const s=new O6,o=i.getLines().getData();let c=0;for(;c<o.length;){const g=o[c++],h=[];for(let p=0;p<g;p++)h.push(o[c+p]);s.addSegment(h),c+=g}const{faces:l}=s;let u=l.length;for(let g=0;g<l.length;g++)u+=l[g].length;const f=new Uint16Array(u);c=0;for(let g=0;g<l.length;g++){const h=l[g];f[c++]=h.length;for(let p=0;p<h.length;p++)f[c++]=h[p]}a.setPolys(kr.newInstance({values:f,name:"faces"})),r[0]=a}}const V6={};function Yl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,V6,n),R.obj(t,e),R.algo(t,e,1,1),D6(t,e)}const I6=R.newInstance(Yl,"vtkClosedPolyLineToSurfaceFilter");var L6={newInstance:I6,extend:Yl};const{vtkErrorMacro:Wo}=Ot;function N6(t){const e=t.getPolys().getData(),n=t.getStrips().getData(),r={cellSize:0,cell:[],done:!1,polyIdx:0,stripIdx:0,remainingStripLength:0,next(){if(r.polyIdx<e.length){r.cellSize=e[r.polyIdx];const i=r.polyIdx+1,a=i+r.cellSize;r.polyIdx=a;let s=0;for(let o=i;o<a;++o)r.cell[s++]=e[o]}else if(r.stripIdx<n.length){r.cellSize=3,r.remainingStripLength===0&&(r.remainingStripLength=n[r.stripIdx]-2,r.stripIdx+=3);const i=r.stripIdx-2,a=r.stripIdx+1;r.stripIdx++,r.remainingStripLength--;let s=0;for(let o=i;o<a;++o)r.cell[s++]=n[o]}else if(!r.done)r.done=!0;else throw new Error("Iterator is done")}};return r.next(),r}function b6(t,e){e.classHierarchy.push("vtkCutter");const n={...t};t.getMTime=()=>{let i=n.getMTime();return e.cutFunction&&(i=Math.max(i,e.cutFunction.getMTime())),i};function r(i,a){const s=i.getPoints(),o=s.getData(),c=s.getNumberOfPoints(),l=[],u=[],f=[];(!e.cutScalars||e.cutScalars.length<c)&&(e.cutScalars=new Float32Array(c));let g=0,h=0;for(;g<o.length;)e.cutScalars[h++]=e.cutFunction.evaluateFunction(o[g++],o[g++],o[g++]);const p=[],d=new Array(3),m=new Array(3),y=[];for(const v=N6(i);!v.done;v.next()){if(v.cellSize<=2)continue;for(let O=0;O<v.cellSize;)y[O]=e.cutScalars[v.cell[O++]];const C=y[0]>0;let x=!0;for(let O=1;O<v.cell.length;O++)if(y[O]>0!==C){x=!1;break}if(x)continue;const w=[];for(let O=0;O<v.cellSize;O++){const D=O+1===v.cellSize?0:O+1,S=y[O]>0;if(y[D]>0===S)continue;let V=O,L=D,F=y[L]-y[V];F<=0&&(V=D,L=O,F*=-1);let k=0;F!==0&&(k=(e.cutValue-y[V])/F);const b=v.cell[V],W=v.cell[L];d[0]=o[b*3],d[1]=o[b*3+1],d[2]=o[b*3+2],m[0]=o[W*3],m[1]=o[W*3+1],m[2]=o[W*3+2];const _=[d[0]+k*(m[0]-d[0]),d[1]+k*(m[1]-d[1]),d[2]+k*(m[2]-d[2])];w.push({pointEdge1:b,pointEdge2:W,intersectedPoint:_,newPointID:-1})}for(let O=0;O<w.length;O++){const D=w[O];let S=!1;for(let M=0;M<p.length;M++){const V=p[M],L=D.pointEdge1===V.pointEdge1&&D.pointEdge2===V.pointEdge2,F=D.intersectedPoint[0]===V.intersectedPoint[0]&&D.intersectedPoint[1]===V.intersectedPoint[1]&&D.intersectedPoint[2]===V.intersectedPoint[2];if(L||F){S=!0,w[O].newPointID=p[M].newPointID;break}}S||(l.push(D.intersectedPoint[0]),l.push(D.intersectedPoint[1]),l.push(D.intersectedPoint[2]),w[O].newPointID=l.length/3-1,p.push(w[O]))}const E=w.length;E===2?u.push(E,w[0].newPointID,w[1].newPointID):E>2&&(f.push(E),w.forEach(O=>{f.push(O.newPointID)}))}a.getPoints().setData(ga(s.getDataType(),l),3),u.length!==0&&a.getLines().setData(Uint16Array.from(u)),f.length!==0&&a.getPolys().setData(Uint16Array.from(f))}t.requestData=(i,a)=>{const s=i[0];if(!s){Wo("Invalid or missing input");return}if(!e.cutFunction){Wo("Missing cut function");return}const o=wn.newInstance();r(s,o),a[0]=o}}const F6={cutFunction:null,cutScalars:null,cutValue:0};function Zl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,F6,n),Re(t,e),k0(t,e,1,1),je(t,e,["cutFunction","cutValue"]),b6(t,e)}const _6=Ie(Zl,"vtkCutter");var U6={newInstance:_6,extend:Zl};const k6=[2,0,1,2,2,3,2,4,5,2,6,7,2,0,2,2,1,3,2,4,6,2,5,7,2,0,4,2,1,5,2,2,6,2,3,7],P6=[4,0,1,3,2,4,4,6,7,5,4,8,10,11,9,4,12,13,15,14,4,16,18,19,17,4,20,21,23,22];function G6(t,e){e.classHierarchy.push("vtkCubeSource");function n(r,i){if(e.deleted)return;const a=wn.newInstance();i[0]=a;const s=24,o=R.newTypedArray(e.pointType,s*3);a.getPoints().setData(o,3);const c=R.newTypedArray(e.pointType,s*3),l=oe.newInstance({name:"Normals",values:c,numberOfComponents:3});a.getPointData().setNormals(l);let u=2;e.generate3DTextureCoordinates===!0&&(u=3);const f=R.newTypedArray(e.pointType,s*u),g=oe.newInstance({name:"TextureCoordinates",values:f,numberOfComponents:u});a.getPointData().setTCoords(g);const h=[0,0,0],p=[0,0,0],d=[0,0];let m=0;h[0]=-e.xLength/2,p[0]=-1,p[1]=0,p[2]=0;for(let y=0;y<2;y++){h[1]=-e.yLength/2;for(let T=0;T<2;T++){d[1]=h[1]+.5,h[2]=-e.zLength/2;for(let v=0;v<2;v++)d[0]=(h[2]+.5)*(1-2*y),o[m*3]=h[0],o[m*3+1]=h[1],o[m*3+2]=h[2],c[m*3]=p[0],c[m*3+1]=p[1],c[m*3+2]=p[2],u===2?(f[m*u]=d[0],f[m*u+1]=d[1]):(f[m*u]=2*y-1,f[m*u+1]=2*T-1,f[m*u+2]=2*v-1),m++,h[2]+=e.zLength;h[1]+=e.yLength}h[0]+=e.xLength,p[0]+=2}h[1]=-e.yLength/2,p[1]=-1,p[0]=0,p[2]=0;for(let y=0;y<2;y++){h[0]=-e.xLength/2;for(let T=0;T<2;T++){d[0]=(h[0]+.5)*(2*y-1),h[2]=-e.zLength/2;for(let v=0;v<2;v++)d[1]=(h[2]+.5)*-1,o[m*3]=h[0],o[m*3+1]=h[1],o[m*3+2]=h[2],c[m*3]=p[0],c[m*3+1]=p[1],c[m*3+2]=p[2],u===2?(f[m*u]=d[0],f[m*u+1]=d[1]):(f[m*u]=2*T-1,f[m*u+1]=2*y-1,f[m*u+2]=2*v-1),m++,h[2]+=e.zLength;h[0]+=e.xLength}h[1]+=e.yLength,p[1]+=2}h[2]=-e.zLength/2,p[2]=-1,p[0]=0,p[1]=0;for(let y=0;y<2;y++){h[1]=-e.yLength/2;for(let T=0;T<2;T++){d[1]=h[1]+.5,h[0]=-e.xLength/2;for(let v=0;v<2;v++)d[0]=(h[0]+.5)*(2*y-1),o[m*3]=h[0],o[m*3+1]=h[1],o[m*3+2]=h[2],c[m*3]=p[0],c[m*3+1]=p[1],c[m*3+2]=p[2],u===2?(f[m*u]=d[0],f[m*u+1]=d[1]):(f[m*u]=2*v-1,f[m*u+1]=2*T-1,f[m*u+2]=2*y-1),m++,h[0]+=e.xLength;h[1]+=e.yLength}h[2]+=e.zLength,p[2]+=2}if(e.rotations&&vn.buildFromDegree().rotateX(e.rotations[0]).rotateY(e.rotations[1]).rotateZ(e.rotations[2]).apply(o).apply(c),e.center&&vn.buildFromRadian().translate(...e.center).apply(o),e.matrix){vn.buildFromRadian().setMatrix(e.matrix).apply(o);const y=[e.matrix[0],e.matrix[1],e.matrix[2],0,e.matrix[4],e.matrix[5],e.matrix[6],0,e.matrix[8],e.matrix[9],e.matrix[10],0,0,0,0,1];vn.buildFromRadian().setMatrix(y).apply(c)}e.generateFaces?a.getPolys().deepCopy(e._polys):a.getPolys().initialize(),e.generateLines?(a.getLines().deepCopy(e._lineCells),a.getPointData().setNormals(null)):a.getLines().initialize(),a.modified()}t.setBounds=function(){let r=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))r=arguments.length<=0?void 0:arguments[0];else for(let i=0;i<arguments.length;i++)r.push(i<0||arguments.length<=i?void 0:arguments[i]);r.length===6&&(t.setXLength(r[1]-r[0]),t.setYLength(r[3]-r[2]),t.setZLength(r[5]-r[4]),t.setCenter([(r[0]+r[1])/2,(r[2]+r[3])/2,(r[4]+r[5])/2]))},t.requestData=n}const A6={xLength:1,yLength:1,zLength:1,pointType:"Float64Array",generate3DTextureCoordinates:!1,generateFaces:!0,generateLines:!1};function Jl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,A6,n),R.obj(t,e),R.setGet(t,e,["xLength","yLength","zLength","generate3DTextureCoordinates","generateFaces","generateLines"]),R.setGetArray(t,e,["center","rotations"],3),R.setGetArray(t,e,["matrix"],16),e._polys=kr.newInstance({values:Uint16Array.from(P6)}),e._lineCells=kr.newInstance({values:Uint16Array.from(k6)}),R.moveToProtected(t,e,["polys","lineCells"]),R.algo(t,e,0,1),G6(t,e)}const B6=R.newInstance(Jl,"vtkCubeSource");var W6={newInstance:B6,extend:Jl};const{vtkErrorMacro:zo}=R;function z6(t,e){e.classHierarchy.push("vtkImageDataOutlineFilter");const n={...t};t.requestData=(r,i)=>{const a=r[0];if(!a||!a.isA("vtkImageData")){zo("Invalid or missing input");return}const s=a.getSpatialExtent();if(!s){zo("Unable to fetch spatial extents of input image.");return}e._cubeSource.setBounds(s),e._cubeSource.setMatrix(a.getIndexToWorld()),i[0]=e._cubeSource.getOutputData()},t.getMTime=()=>Math.max(n.getMTime(),e._cubeSource.getMTime()),t.setGenerateFaces=e._cubeSource.setGenerateFaces,t.setGenerateLines=e._cubeSource.setGenerateLines,t.getGenerateFaces=e._cubeSource.getGenerateFaces,t.getGenerateLines=e._cubeSource.getGenerateLines}const $6={};function Ql(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$6,n),R.obj(t,e),R.algo(t,e,1,1),e._cubeSource=W6.newInstance(),R.moveToProtected(t,e,["cubeSource","tmpOut"]),z6(t,e)}const j6=R.newInstance(Ql,"vtkImageDataOutlineFilter");var H6={newInstance:j6,extend:Ql};let Vs;function K6(t,e){e.classHierarchy.push("vtkAbstractTransform","vtkHomogeneousTransform","vtkTransform"),t.transformPoint=(n,r)=>(pe(r,n,e.matrix),r),t.transformPoints=(n,r)=>{const i=new Float64Array(3),a=new Float64Array(3);for(let s=0;s<n.length;s+=3)i[0]=n[s],i[1]=n[s+1],i[2]=n[s+2],pe(a,i,e.matrix),r[s]=a[0],r[s+1]=a[1],r[s+2]=a[2];return r},t.preMultiply=()=>{t.setPreMultiplyFlag(!0)},t.postMultiply=()=>{t.setPreMultiplyFlag(!1)},t.transformMatrix=(n,r)=>(e.preMultiplyFlag?se(r,e.matrix,n):se(r,n,e.matrix),r),t.transformMatrices=(n,r)=>{const i=new Float64Array(16),a=new Float64Array(16),s=e.preMultiplyFlag?()=>se(a,e.matrix,i):()=>se(a,i,e.matrix);for(let o=0;o<n.length;o+=16){for(let c=0;c<16;++c)i[c]=n[o+c];s();for(let c=0;c<16;++c)r[o+c]=a[c]}return r},t.getInverse=()=>Vs({matrix:gt.invertMatrix(Array.from(e.matrix),[],4),preMultiplyFlag:e.preMultiplyFlag})}const q6={preMultiplyFlag:!1,matrix:[...K0]};function eu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,q6,n),R.obj(t,e),R.setGet(t,e,["preMultiplyFlag"]),R.setGetArray(t,e,["matrix"],16),K6(t,e)}Vs=R.newInstance(eu,"vtkTransform");var X6={newInstance:Vs,extend:eu},Y6=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model coordinates
// WC - World coordinates
// VC - View coordinates
// DC - Display coordinates
// TC - Texture coordinates

// frag position in VC
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// camera and actor matrix values
//VTK::Camera::Dec

void main()
{
  //VTK::PositionVC::Impl

  //VTK::TCoord::Impl

  //VTK::Picking::Impl
}
`,Z6=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkImageResliceMapperFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the gpu image mapper fragment shader

// VC position of this fragment
//VTK::PositionVC::Dec

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

// the output of this shader
//VTK::Output::Dec

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  //VTK::TCoord::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;const{vtkErrorMacro:ln}=Ot;function $o(t,e,n){return e.identity(n),t.reduce((r,i,a)=>a===0?i?e.copy(r,i):e.identity(r):i?e.multiply(r,r,i):r,n)}function J6(t,e){e.classHierarchy.push("vtkOpenGLImageResliceMapper");function n(i){[e._scalars,e._colorTransferFunc,e._pwFunc].forEach(a=>i.unregisterGraphicsResourceUser(a,t))}t.buildPass=i=>{if(i){e.currentRenderPass=null,e._openGLImageSlice=t.getFirstAncestorOfType("vtkOpenGLImageSlice"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer");const a=e._openGLRenderer.getRenderable();e._openGLCamera=e._openGLRenderer.getViewNodeFor(a.getActiveCamera());const s=e._openGLRenderWindow;e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),s&&!s.isDeleted()&&s!==e._openGLRenderWindow&&n(s),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow)}},t.translucentPass=(i,a)=>{i&&(e.currentRenderPass=a,t.render())},t.zBufferPass=i=>{i&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=i=>t.zBufferPass(i),t.opaquePass=i=>{i&&t.render()},t.getCoincidentParameters=(i,a)=>e.renderable.getResolveCoincidentTopology()==Vt.PolygonOffset?e.renderable.getCoincidentTopologyPolygonOffsetParameters():null,t.render=()=>{const i=e._openGLImageSlice.getRenderable(),a=e._openGLRenderer.getRenderable();t.renderPiece(a,i)},t.renderPiece=(i,a)=>{if(t.invokeEvent({type:"StartEvent"}),e.renderable.update(),e.currentInput=e.renderable.getInputData(),!e.currentInput){ln("No input!");return}t.updateResliceGeometry(),t.renderPieceStart(i,a),t.renderPieceDraw(i,a),t.renderPieceFinish(i,a),t.invokeEvent({type:"EndEvent"})},t.renderPieceStart=(i,a)=>{t.updateBufferObjects(i,a),a.getProperty().getInterpolationType()===xn.NEAREST?(e.openGLTexture.setMinificationFilter(K.NEAREST),e.openGLTexture.setMagnificationFilter(K.NEAREST),e.colorTexture.setMinificationFilter(K.NEAREST),e.colorTexture.setMagnificationFilter(K.NEAREST),e.pwfTexture.setMinificationFilter(K.NEAREST),e.pwfTexture.setMagnificationFilter(K.NEAREST)):(e.openGLTexture.setMinificationFilter(K.LINEAR),e.openGLTexture.setMagnificationFilter(K.LINEAR),e.colorTexture.setMinificationFilter(K.LINEAR),e.colorTexture.setMagnificationFilter(K.LINEAR),e.pwfTexture.setMinificationFilter(K.LINEAR),e.pwfTexture.setMagnificationFilter(K.LINEAR)),e.lastBoundBO=null},t.renderPieceDraw=(i,a)=>{const s=e.context;e.openGLTexture.activate(),e.colorTexture.activate(),e.pwfTexture.activate(),t.updateShaders(e.tris,i,a),s.drawArrays(s.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate(),e.colorTexture.deactivate(),e.pwfTexture.deactivate()},t.renderPieceFinish=(i,a)=>{},t.updateBufferObjects=(i,a)=>{t.getNeedToRebuildBufferObjects(i,a)&&t.buildBufferObjects(i,a)},t.getNeedToRebuildBufferObjects=(i,a)=>{var s,o,c;return e.VBOBuildTime.getMTime()<t.getMTime()||e.VBOBuildTime.getMTime()<a.getMTime()||e.VBOBuildTime.getMTime()<e.renderable.getMTime()||e.VBOBuildTime.getMTime()<a.getProperty().getMTime()||e.VBOBuildTime.getMTime()<e.currentInput.getMTime()||e.VBOBuildTime.getMTime()<e.resliceGeom.getMTime()||!((s=e.openGLTexture)!=null&&s.getHandle())||!((o=e.colorTexture)!=null&&o.getHandle())||!((c=e.pwfTexture)!=null&&c.getHandle())},t.buildBufferObjects=(i,a)=>{var E,O,D,S;const s=e.currentInput;if(!s)return;const o=(E=s.getPointData())==null?void 0:E.getScalars();if(!o)return;const c=o.getNumberOfComponents();let l=vs(s,o);const u=e._openGLRenderWindow.getGraphicsResourceForObject(o);if(!((O=u==null?void 0:u.oglObject)!=null&&O.getHandle())||(u==null?void 0:u.hash)!==l){e.openGLTexture=Ue.newInstance(),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const M=s.getDimensions();e.openGLTexture.setOglNorm16Ext(e.context.getExtension("EXT_texture_norm16")),e.openGLTexture.resetFormatAndType(),e.openGLTexture.create3DFilterableFromDataArray(M[0],M[1],M[2],o),e._openGLRenderWindow.setGraphicsResourceForObject(o,e.openGLTexture,l),o!==e._scalars&&(e._openGLRenderWindow.registerGraphicsResourceUser(o,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._scalars,t)),e._scalars=o}else e.openGLTexture=u.oglObject;const g=a.getProperty(),h=g.getIndependentComponents(),p=h?c:1,d=h?2*p:1,m=g.getRGBTransferFunction();l=an(m,h,p);const y=e._openGLRenderWindow.getGraphicsResourceForObject(m);if(!((D=y==null?void 0:y.oglObject)!=null&&D.getHandle())||(y==null?void 0:y.hash)!==l){const V=1024*d*3,L=new Uint8ClampedArray(V);if(e.colorTexture=Ue.newInstance(),e.colorTexture.setOpenGLRenderWindow(e._openGLRenderWindow),m){const F=new Float32Array(3072);for(let k=0;k<p;k++){const b=g.getRGBTransferFunction(k),W=b.getRange();if(b.getTable(W[0],W[1],1024,F,1),h)for(let _=0;_<1024*3;_++)L[k*1024*6+_]=255*F[_],L[k*1024*6+_+1024*3]=255*F[_];else for(let _=0;_<1024*3;_++)L[k*1024*6+_]=255*F[_]}e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,d,3,me.UNSIGNED_CHAR,L)}else{for(let F=0;F<1024*3;++F)L[F]=255*F/(1023*3),L[F+1]=255*F/(1023*3),L[F+2]=255*F/(1023*3);e.colorTexture.resetFormatAndType(),e.colorTexture.create2DFromRaw(1024,1,3,me.UNSIGNED_CHAR,L)}m&&(e._openGLRenderWindow.setGraphicsResourceForObject(m,e.colorTexture,l),m!==e._colorTransferFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(m,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._colorTransferFunc,t)),e._colorTransferFunc=m)}else e.colorTexture=y.oglObject;const v=g.getPiecewiseFunction();l=an(v,h,p);const C=e._openGLRenderWindow.getGraphicsResourceForObject(v);if(!((S=C==null?void 0:C.oglObject)!=null&&S.getHandle())||(C==null?void 0:C.hash)!==l){const V=1024*d,L=new Uint8ClampedArray(V);if(e.pwfTexture=Ue.newInstance(),e.pwfTexture.setOpenGLRenderWindow(e._openGLRenderWindow),v){const F=new Float32Array(V),k=new Float32Array(1024);for(let b=0;b<p;++b){const W=g.getPiecewiseFunction(b);if(W===null)F.fill(1);else{const _=W.getRange();if(W.getTable(_[0],_[1],1024,k,1),h)for(let N=0;N<1024;N++)F[b*1024*2+N]=k[N],F[b*1024*2+N+1024]=k[N];else for(let N=0;N<1024;N++)F[b*1024*2+N]=k[N]}}e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,d,1,me.FLOAT,F)}else L.fill(255),e.pwfTexture.resetFormatAndType(),e.pwfTexture.create2DFromRaw(1024,1,1,me.UNSIGNED_CHAR,L);v&&(e._openGLRenderWindow.setGraphicsResourceForObject(v,e.pwfTexture,l),v!==e._pwFunc&&(e._openGLRenderWindow.registerGraphicsResourceUser(v,t),e._openGLRenderWindow.unregisterGraphicsResourceUser(e._pwFunc,t)),e._pwFunc=v)}else e.pwfTexture=C.oglObject;const w=`${e.resliceGeom.getMTime()}A${e.renderable.getSlabThickness()}`;if(!e.tris.getCABO().getElementCount()||e.VBOBuildString!==w){const M=oe.newInstance({numberOfComponents:3,values:e.resliceGeom.getPoints().getData()});M.setName("points");const V=oe.newInstance({numberOfComponents:1,values:e.resliceGeom.getPolys().getData()}),L={points:M,cellOffset:0};if(e.renderable.getSlabThickness()>0){const F=e.resliceGeom.getPointData().getNormals();F?L.normals=F:ln("Slab mode requested without normals")}e.tris.getCABO().createVBO(V,"polys",St.SURFACE,L)}e.VBOBuildString=w,e.VBOBuildTime.modified()},t.updateShaders=(i,a,s)=>{if(e.lastBoundBO=i,t.getNeedToRebuildShaders(i,a,s)){const o={Vertex:null,Fragment:null,Geometry:null};t.buildShaders(o,a,s);const c=e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(o.Vertex,o.Fragment,o.Geometry);c!==i.getProgram()&&(i.setProgram(c),i.getVAO().releaseGraphicsResources()),i.getShaderSourceTime().modified()}else e._openGLRenderWindow.getShaderCache().readyShaderProgram(i.getProgram());i.getVAO().bind(),t.setMapperShaderParameters(i,a,s),t.setCameraShaderParameters(i,a,s),t.setPropertyShaderParameters(i,a,s)},t.setMapperShaderParameters=(i,a,s)=>{const o=i.getProgram();if(i.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>i.getAttributeUpdateTime().getMTime()||i.getShaderSourceTime().getMTime()>i.getAttributeUpdateTime().getMTime())){o.isUniformUsed("texture1")&&o.setUniformi("texture1",e.openGLTexture.getTextureUnit()),o.isAttributeUsed("vertexWC")&&(i.getVAO().addAttributeArray(o,i.getCABO(),"vertexWC",i.getCABO().getVertexOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||ln("Error setting vertexWC in shader VAO.")),o.isAttributeUsed("normalWC")&&(i.getVAO().addAttributeArray(o,i.getCABO(),"normalWC",i.getCABO().getNormalOffset(),i.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||ln("Error setting normalWC in shader VAO.")),o.isUniformUsed("slabThickness")&&o.setUniformf("slabThickness",e.renderable.getSlabThickness()),o.isUniformUsed("spacing")&&o.setUniform3fv("spacing",e.currentInput.getSpacing()),o.isUniformUsed("slabType")&&o.setUniformi("slabType",e.renderable.getSlabType()),o.isUniformUsed("slabType")&&o.setUniformi("slabType",e.renderable.getSlabType()),o.isUniformUsed("slabTrapezoid")&&o.setUniformi("slabTrapezoid",e.renderable.getSlabTrapezoidIntegration());const l=i.getCABO().getCoordShiftAndScaleEnabled()?i.getCABO().getInverseShiftAndScaleMatrix():null;if(o.isUniformUsed("WCTCMatrix")){const u=e.currentInput,f=u.getDimensions();Oe(e.tmpMat4,u.getIndexToWorld()),Se(e.tmpMat4,e.tmpMat4,[-.5,-.5,-.5]),Gt(e.tmpMat4,e.tmpMat4,f),ke(e.tmpMat4,e.tmpMat4),l&&se(e.tmpMat4,e.tmpMat4,l),o.setUniformMatrix("WCTCMatrix",e.tmpMat4)}o.isUniformUsed("vboScaling")&&o.setUniform3fv("vboScaling",i.getCABO().getCoordScale()??[1,1,1]),i.getAttributeUpdateTime().modified()}if(e.haveSeenDepthRequest&&i.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),i.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(a,s);i.getProgram().setUniformf("coffset",c.offset),i.getProgram().isUniformUsed("cfactor")&&i.getProgram().setUniformf("cfactor",c.factor)}},t.setCameraShaderParameters=(i,a,s)=>{const o=e._openGLCamera.getKeyMatrices(a),c=e._openGLImageSlice.getKeyMatrices(),u=i.getCABO().getCoordShiftAndScaleEnabled()?i.getCABO().getInverseShiftAndScaleMatrix():null,f=i.getProgram();f.isUniformUsed("MCPCMatrix")&&(X(e.tmpMat4),f.setUniformMatrix("MCPCMatrix",$o([o.wcpc,c.mcwc,u],mo,e.tmpMat4))),f.isUniformUsed("MCVCMatrix")&&(X(e.tmpMat4),f.setUniformMatrix("MCVCMatrix",$o([o.wcvc,c.mcwc,u],mo,e.tmpMat4)))},t.setPropertyShaderParameters=(i,a,s)=>{const o=i.getProgram(),c=s.getProperty(),l=c.getOpacity();o.setUniformf("opacity",l);const u=e.openGLTexture.getComponents(),f=c.getIndependentComponents();if(f)for(let d=0;d<u;++d)o.setUniformf(`mix${d}`,c.getComponentWeight(d));const g=e.openGLTexture.getVolumeInfo();for(let d=0;d<u;d++){let m=c.getColorWindow(),y=c.getColorLevel();const T=f?d:0,v=c.getRGBTransferFunction(T);if(v&&c.getUseLookupTableScalarRange()){const w=v.getRange();m=w[1]-w[0],y=.5*(w[1]+w[0])}const C=g.scale[d]/m,x=(g.offset[d]-y)/m+.5;o.setUniformf(`cshift${d}`,x),o.setUniformf(`cscale${d}`,C)}const h=e.colorTexture.getTextureUnit();o.setUniformi("colorTexture1",h);for(let d=0;d<u;d++){let m=1,y=0;const T=f?d:0,v=c.getPiecewiseFunction(T);if(v){const C=v.getRange(),x=C[1]-C[0],w=.5*(C[0]+C[1]);m=g.scale[d]/x,y=(g.offset[d]-w)/x+.5}o.setUniformf(`pwfshift${d}`,y),o.setUniformf(`pwfscale${d}`,m)}const p=e.pwfTexture.getTextureUnit();o.setUniformi("pwfTexture1",p),o.setUniform4fv("backgroundColor",e.renderable.getBackgroundColor())},t.getNeedToRebuildShaders=(i,a,s)=>{var h;const o=e.openGLTexture.getComponents(),c=s.getProperty().getIndependentComponents(),l=e.renderable.getSlabThickness(),u=e.renderable.getSlabType(),f=e.renderable.getSlabTrapezoidIntegration();let g=!1;return(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(g=!0),g||e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||((h=i.getProgram())==null?void 0:h.getHandle())===0||e.lastTextureComponents!==o||e.lastIndependentComponents!==c||e.lastSlabThickness!==l||e.lastSlabType!==u||e.lastSlabTrapezoidIntegration!==f?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,e.lastTextureComponents=o,e.lastIndependentComponents=c,e.lastSlabThickness=l,e.lastSlabType=u,e.lastSlabTrapezoidIntegration=f,!0):!1},t.getShaderTemplate=(i,a,s)=>{i.Vertex=Y6,i.Fragment=Z6,i.Geometry=""},t.replaceShaderValues=(i,a,s)=>{if(t.replaceShaderTCoord(i,a,s),t.replaceShaderPositionVC(i,a,s),e.haveSeenDepthRequest){let o=i.Fragment;o=B.substitute(o,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,o=B.substitute(o,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,i.Fragment=o}t.replaceShaderCoincidentOffset(i,a,s)},t.replaceShaderTCoord=(i,a,s)=>{let o=i.Vertex;const c=i.Geometry;let l=i.Fragment;const u=["uniform mat4 WCTCMatrix;","out vec3 fragTexCoord;"],f=e.renderable.getSlabThickness();o=B.substitute(o,"//VTK::TCoord::Dec",u).result;const g=["fragTexCoord = (WCTCMatrix * vertexWC).xyz;"];o=B.substitute(o,"//VTK::TCoord::Impl",g).result;const h=e.openGLTexture.getComponents(),p=s.getProperty().getIndependentComponents();let d=["in vec3 fragTexCoord;","uniform highp sampler3D texture1;","uniform mat4 WCTCMatrix;","uniform float cshift0;","uniform float cscale0;","uniform float pwfshift0;","uniform float pwfscale0;","uniform sampler2D colorTexture1;","uniform sampler2D pwfTexture1;","uniform float opacity;","uniform vec4 backgroundColor;"];if(p){for(let y=1;y<h;y++)d=d.concat([`uniform float cshift${y};`,`uniform float cscale${y};`,`uniform float pwfshift${y};`,`uniform float pwfscale${y};`]);switch(h){case 1:d=d.concat(["uniform float mix0;","#define height0 0.5"]);break;case 2:d=d.concat(["uniform float mix0;","uniform float mix1;","#define height0 0.25","#define height1 0.75"]);break;case 3:d=d.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","#define height0 0.17","#define height1 0.5","#define height2 0.83"]);break;case 4:d=d.concat(["uniform float mix0;","uniform float mix1;","uniform float mix2;","uniform float mix3;","#define height0 0.125","#define height1 0.375","#define height2 0.625","#define height3 0.875"]);break;default:ln("Unsupported number of independent coordinates.")}}f>0&&(d=d.concat(["uniform vec3 spacing;","uniform float slabThickness;","uniform int slabType;","uniform int slabTrapezoid;","uniform vec3 vboScaling;"]),d=d.concat(["vec4 compositeValue(vec4 currVal, vec4 valToComp, int trapezoid)","{","  vec4 retVal = vec4(1.0);","  if (slabType == 0) // min","  {","    retVal = min(currVal, valToComp);","  }","  else if (slabType == 1) // max","  {","    retVal = max(currVal, valToComp);","  }","  else if (slabType == 3) // sum","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  else // mean","  {","    retVal = currVal + (trapezoid > 0 ? 0.5 * valToComp : valToComp); ","  }","  return retVal;","}"])),l=B.substitute(l,"//VTK::TCoord::Dec",d).result;let m=["if (any(greaterThan(fragTexCoord, vec3(1.0))) || any(lessThan(fragTexCoord, vec3(0.0))))","{","  // set the background color and exit","  gl_FragData[0] = backgroundColor;","  return;","}","vec4 tvalue = texture(texture1, fragTexCoord);"];if(f>0&&(m=m.concat(["// Get the first and last samples","int numSlices = 1;","float scaling = min(min(spacing.x, spacing.y), spacing.z) * 0.5;","vec3 normalxspacing = scaling * normalWCVSOutput;","float distTraveled = length(normalxspacing);","int trapezoid = 0;","while (distTraveled < slabThickness * 0.5)","{","  distTraveled += length(normalxspacing);","  float fnumSlices = float(numSlices);","  if (distTraveled > slabThickness * 0.5)","  {","    // Before stepping outside the slab, sample at the boundaries","    normalxspacing = normalWCVSOutput * slabThickness * 0.5 / fnumSlices;","    trapezoid = slabTrapezoid;","  }","  vec3 fragTCoordNeg = (WCTCMatrix * vec4(vertexWCVSOutput.xyz - fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordNeg);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","  vec3 fragTCoordPos = (WCTCMatrix * vec4(vertexWCVSOutput.xyz + fnumSlices * normalxspacing * vboScaling, 1.0)).xyz;","  if (!any(greaterThan(fragTCoordNeg, vec3(1.0))) && !any(lessThan(fragTCoordNeg, vec3(0.0))))","  {","    vec4 newVal = texture(texture1, fragTCoordPos);","    tvalue = compositeValue(tvalue, newVal, trapezoid);","    numSlices += 1;","  }","}","// Finally, if slab type is *mean*, divide the sum by the numSlices","if (slabType == 2)","{","  tvalue = tvalue / float(numSlices);","}"])),p){const y=["r","g","b","a"];for(let T=0;T<h;++T)m=m.concat([`vec3 tcolor${T} = mix${T} * texture2D(colorTexture1, vec2(tvalue.${y[T]} * cscale${T} + cshift${T}, height${T})).rgb;`,`float compWeight${T} = mix${T} * texture2D(pwfTexture1, vec2(tvalue.${y[T]} * pwfscale${T} + pwfshift${T}, height${T})).r;`]);switch(h){case 1:m=m.concat(["gl_FragData[0] = vec4(tcolor0.rgb, compWeight0 * opacity);"]);break;case 2:m=m.concat(["float weightSum = compWeight0 + compWeight1;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum))), opacity);"]);break;case 3:m=m.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum))), opacity);"]);break;case 4:m=m.concat(["float weightSum = compWeight0 + compWeight1 + compWeight2 + compWeight3;","gl_FragData[0] = vec4(vec3((tcolor0.rgb * (compWeight0 / weightSum)) + (tcolor1.rgb * (compWeight1 / weightSum)) + (tcolor2.rgb * (compWeight2 / weightSum)) + (tcolor3.rgb * (compWeight3 / weightSum))), opacity);"]);break;default:ln("Unsupported number of independent coordinates.")}}else switch(h){case 1:m=m.concat(["// Dependent components","float intensity = tvalue.r;","vec3 tcolor = texture2D(colorTexture1, vec2(intensity * cscale0 + cshift0, 0.5)).rgb;","float scalarOpacity = texture2D(pwfTexture1, vec2(intensity * pwfscale0 + pwfshift0, 0.5)).r;","gl_FragData[0] = vec4(tcolor, scalarOpacity * opacity);"]);break;case 2:m=m.concat(["float intensity = tvalue.r*cscale0 + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(intensity, 0.5)).rgb, pwfscale0*tvalue.g + pwfshift0);"]);break;case 3:m=m.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, opacity);"]);break;default:m=m.concat(["vec4 tcolor = cscale0*tvalue + cshift0;","gl_FragData[0] = vec4(texture2D(colorTexture1, vec2(tcolor.r,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.g,0.5)).r,","  texture2D(colorTexture1, vec2(tcolor.b,0.5)).r, tcolor.a);"])}l=B.substitute(l,"//VTK::TCoord::Impl",m).result,i.Vertex=o,i.Fragment=l,i.Geometry=c},t.replaceShaderPositionVC=(i,a,s)=>{let o=i.Vertex;const c=i.Geometry;let l=i.Fragment;const u=e.renderable.getSlabThickness();let f=["attribute vec4 vertexWC;"];f=f.concat([`//${t.getMTime()}${e.resliceGeomUpdateString}`]),u>0&&(f=f.concat(["attribute vec3 normalWC;","varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),o=B.substitute(o,"//VTK::PositionVC::Dec",f).result;let g=["gl_Position = MCPCMatrix * vertexWC;"];u>0&&(g=g.concat(["normalWCVSOutput = normalWC;","vertexWCVSOutput = vertexWC;"])),o=B.substitute(o,"//VTK::PositionVC::Impl",g).result,o=B.substitute(o,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result;let h=[];u>0&&(h=h.concat(["varying vec3 normalWCVSOutput;","varying vec4 vertexWCVSOutput;"])),l=B.substitute(l,"//VTK::PositionVC::Dec",h).result,i.Vertex=o,i.Geometry=c,i.Fragment=l};function r(i){gt.normalize(i);const a=[0,0,0];for(let s=0;s<3;++s){V4(a),a[s]=1;const o=gt.dot(i,a);if(o<-.999999||o>.999999)return[!0,s]}return[!1,2]}t.updateResliceGeometry=()=>{var f;let i="";const a=e.currentInput,s=a==null?void 0:a.getBounds();let o=!0,c=2;const l=e.renderable.getSlicePolyData(),u=e.renderable.getSlicePlane();if(l)i=i.concat(`PolyData${l.getMTime()}`);else if(u){i=i.concat(`Plane${u.getMTime()}`);const g=K1();a&&(i=i.concat(`Image${a.getMTime()}`),e4(g,...a.getDirection()),es(g,g));const h=[...u.getNormal()];Ei(h,h,g),[o,c]=r(h)}else{const g=Ge.newInstance();g.setNormal(0,0,1);let h=[0,1,0,1,0,1];a&&(h=s),g.setOrigin(h[0],h[2],.5*(h[5]+h[4])),e.renderable.setSlicePlane(g),i=i.concat(`Plane${u==null?void 0:u.getMTime()}`),a&&(i=i.concat(`Image${a.getMTime()}`))}if(!e.resliceGeom||e.resliceGeomUpdateString!==i){if(l)e.resliceGeom||(e.resliceGeom=wn.newInstance()),e.resliceGeom.getPoints().setData(l.getPoints().getData(),3),e.resliceGeom.getPolys().setData(l.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(l.getPointData().getNormals());else if(u)if(o){const g=new Float32Array(12),h=a.worldToIndex(u.getOrigin(),[0,0,0]),p=[(c+1)%3,(c+2)%3].sort(),d=a.getSpatialExtent();let m=0;for(let x=0;x<2;++x)for(let w=0;w<2;++w)g[m+c]=h[c],g[m+p[0]]=d[2*p[0]+w],g[m+p[1]]=d[2*p[1]+x],m+=3;e.transform.setMatrix(a.getIndexToWorld()),e.transform.transformPoints(g,g);const y=new Uint16Array(8);y[0]=3,y[1]=0,y[2]=1,y[3]=3,y[4]=3,y[5]=0,y[6]=3,y[7]=2;const T=u.getNormal();gt.normalize(T);const v=new Float32Array(12);for(let x=0;x<4;++x)v[3*x]=T[0],v[3*x+1]=T[1],v[3*x+2]=T[2];e.resliceGeom||(e.resliceGeom=wn.newInstance()),e.resliceGeom.getPoints().setData(g,3),e.resliceGeom.getPolys().setData(y,1);const C=oe.newInstance({numberOfComponents:3,values:v,name:"Normals"});e.resliceGeom.getPointData().setNormals(C)}else{e.outlineFilter.setInputData(a),e.cutter.setInputConnection(e.outlineFilter.getOutputPort()),e.cutter.setCutFunction(u),e.lineToSurfaceFilter.setInputConnection(e.cutter.getOutputPort()),e.lineToSurfaceFilter.update(),e.resliceGeom||(e.resliceGeom=wn.newInstance());const g=e.lineToSurfaceFilter.getOutputData();e.resliceGeom.getPoints().setData(g.getPoints().getData(),3),e.resliceGeom.getPolys().setData(g.getPolys().getData(),1),e.resliceGeom.getPointData().setNormals(g.getPointData().getNormals());const h=u.getNormal(),p=e.resliceGeom.getNumberOfPoints();gt.normalize(h);const d=new Float32Array(p*3);for(let y=0;y<p;++y)d[3*y]=h[0],d[3*y+1]=h[1],d[3*y+2]=h[2];const m=oe.newInstance({numberOfComponents:3,values:d,name:"Normals"});e.resliceGeom.getPointData().setNormals(m)}else ln("Something went wrong.","A default slice plane should have been created in the beginning of","updateResliceGeometry.");e.resliceGeomUpdateString=i,(f=e.resliceGeom)==null||f.modified()}},t.setOpenGLTexture=i=>{i&&(e.openGLTexture=i,e._externalOpenGLTexture=!0)},t.delete=Kr(()=>{e._openGLRenderWindow&&n(e._openGLRenderWindow)},t.delete)}const Q6={VBOBuildTime:{},VBOBuildString:null,haveSeenDepthRequest:!1,lastHaveSeenDepthRequest:!1,lastIndependentComponents:!1,lastTextureComponents:0,lastSlabThickness:0,lastSlabTrapezoidIntegration:0,lastSlabType:-1,openGLTexture:null,colorTextureString:null,pwfTextureString:null,resliceGeom:null,resliceGeomUpdateString:null,tris:null,colorTexture:null,pwfTexture:null,_externalOpenGLTexture:!1};function ed(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Q6,n),Be.extend(t,e,n),Qn.implementReplaceShaderCoincidentOffset(t,e,n),Qn.implementBuildShadersWithReplacements(t,e,n),e.tris=Ca.newInstance(),e.openGLTexture=null,e.colorTexture=null,e.pwfTexture=null,e.VBOBuildTime={},Re(e.VBOBuildTime),e.tmpMat4=X(new Float64Array(16)),e.outlineFilter=H6.newInstance(),e.outlineFilter.setGenerateFaces(!0),e.outlineFilter.setGenerateLines(!1),e.cubePolyData=wn.newInstance(),e.cutter=U6.newInstance(),e.lineToSurfaceFilter=L6.newInstance(),e.transform=X6.newInstance(),dt(t,e,["openGLTexture"]),J6(t,e)}const td=Ie(ed,"vtkOpenGLImageResliceMapper");Dt("vtkImageResliceMapper",td);const tu=Object.create(null);function or(t,e){tu[t]=e}function nd(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const rd={};function id(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rd,n),e.overrides=tu,W1.extend(t,e,n),nd(t,e)}R.newInstance(id,"vtkWebGPUViewNodeFactory");function ad(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(n,r,i,a)=>{if(X(n),e.renderable.getParallelProjection()){const s=e.renderable.getParallelScale(),o=s*r,c=s,l=(a[0]-1)*o,u=(a[0]+1)*o,f=(a[1]-1)*c,g=(a[1]+1)*c,h=1/(u-l),p=1/(g-f);n[0]=2*h,n[5]=2*p,n[10]=1/(i[1]-i[0]),n[12]=(u+l)*h,n[13]=(g+f)*p,n[14]=i[1]/(i[1]-i[0])}else{const s=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let o,c;e.renderable.getUseHorizontalViewAngle()===!0?(o=i[0]*s,c=i[0]*s/r):(o=i[0]*s*r,c=i[0]*s);const l=(a[0]-1)*o,u=(a[0]+1)*o,f=(a[1]-1)*c,g=(a[1]+1)*c;n[0]=2*i[0]/(u-l),n[5]=2*i[0]/(g-f),n[12]=(l+u)/(u-l),n[13]=(f+g)/(g-f),n[10]=0,n[14]=i[0],n[11]=-1,n[15]=0}},t.convertToOpenGLDepth=n=>{if(e.renderable.getParallelProjection())return 1-n;const r=e.renderable.getClippingRangeByReference();let i=-r[0]/n;return i=(r[0]+r[1])/(r[1]-r[0])+2*r[0]*r[1]/(i*(r[1]-r[0])),.5*i+.5},t.getKeyMatrices=n=>{const r=n.getRenderable(),i=n.getParent();if(Math.max(i.getMTime(),t.getMTime(),r.getMTime(),e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatrixTime.getMTime()){const a=e.renderable.getViewMatrix();Oe(e.keyMatrices.normalMatrix,a),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,ke(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),ue(e.keyMatrices.wcvc,a);const s=n.getStabilizedCenterByReference();Se(e.keyMatrices.scvc,e.keyMatrices.wcvc,s);const o=n.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,o,c,e.renderable.getWindowCenterByReference()),se(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),ke(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const sd={keyMatrixTime:null,keyMatrices:null};function od(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sd,n),Be.extend(t,e,n),e.keyMatrixTime={},R.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},R.setGet(t,e,["keyMatrixTime"]),ad(t,e)}const cd=R.newInstance(od);or("vtkCamera",cd);function ld(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=n=>{if(e.bindables.length===n.length){let r=!0;for(let i=0;i<e.bindables.length;i++)e.bindables[i]!==n[i]&&(r=!1);if(r)return}e.bindables=n,t.modified()},t.getBindGroupLayout=n=>{const r=[];for(let i=0;i<e.bindables.length;i++){const a=e.bindables[i].getBindGroupLayoutEntry();a.binding=i,r.push(a)}return n.getBindGroupLayout({entries:r})},t.getBindGroup=n=>{let r=t.getMTime();for(let a=0;a<e.bindables.length;a++){const s=e.bindables[a].getBindGroupTime().getMTime();r=s>r?s:r}if(r<e.bindGroupTime.getMTime())return e.bindGroup;const i=[];for(let a=0;a<e.bindables.length;a++){const s=e.bindables[a].getBindGroupEntry();s.binding=a,i.push(s)}return e.bindGroup=n.getHandle().createBindGroup({layout:t.getBindGroupLayout(n),entries:i,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=n=>{const r=[],i=n.getBindGroupLayoutCount(e.label);for(let a=0;a<e.bindables.length;a++)r.push(e.bindables[a].getShaderCode(a,i));return r.join(`
`)}}const ud={device:null,handle:null,label:null};function nu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ud,n),R.obj(t,e),e.bindables=[],e.bindGroupTime={},R.obj(e.bindGroupTime,{mtime:0}),R.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),R.setGet(t,e,["label","device","arrayInformation"]),ld(t,e)}const fd=R.newInstance(nu);var ru={newInstance:fd,extend:nu};function gd(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(n,r)=>{e.device=n,e.handle=e.device.getHandle().createShaderModule({code:r.getCode()})}}const hd={device:null,handle:null};function iu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hd,n),R.obj(t,e),R.get(t,e,["lastCameraMTime"]),R.setGet(t,e,["device","handle"]),gd(t,e)}const pd=R.newInstance(iu,"vtkWebGPUShaderModule");var dd={newInstance:pd,extend:iu};function md(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const i=Array.isArray(n)?n.join(`
`):n;let a=!1;t.search(e)!==-1&&(a=!0);let s="";r&&(s="g");const o=new RegExp(e,s),c=t.replace(o,i);return{replace:a,result:c}}function yd(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=n=>{const r=n.getType(),i=n.getHash(),a=e._shaderModules.keys();for(let o=0;o<a.length;o++){const c=a[o];if(c.getHash()===i&&c.getType()===r)return e._shaderModules.get(c)}const s=dd.newInstance();return s.initialize(e.device,n),e._shaderModules.set(n,s),s}}const vd={shaderModules:null,device:null,window:null};function au(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vd,n),e._shaderModules=new Map,R.obj(t,e),R.setGet(t,e,["device","window"]),yd(t,e)}const Td=R.newInstance(au,"vtkWebGPUShaderCache");var Qe={newInstance:Td,extend:au,substitute:md};function Cd(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(n,r)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=r;const i=[];for(let a=0;a<e.layouts.length;a++)i.push(e.layouts[a].layout);e.pipelineLayout=n.getHandle().createPipelineLayout({bindGroupLayouts:i}),e.pipelineDescription.layout=e.pipelineLayout;for(let a=0;a<e.shaderDescriptions.length;a++){const s=e.shaderDescriptions[a],o=n.getShaderModule(s);s.getType()==="vertex"&&(e.pipelineDescription.vertex.module=o.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),s.getType()==="fragment"&&(e.pipelineDescription.fragment.module=o.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=n.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=n=>{for(let r=0;r<e.shaderDescriptions.length;r++)if(e.shaderDescriptions[r].getType()===n)return e.shaderDescriptions[r];return null},t.addBindGroupLayout=n=>{n&&e.layouts.push({layout:n.getBindGroupLayout(e.device),label:n.getLabel()})},t.getBindGroupLayout=n=>e.layouts[n].layout,t.getBindGroupLayoutCount=n=>{for(let r=0;r<e.layouts.length;r++)if(e.layouts[r].label===n)return r;return 0},t.bindVertexInput=(n,r)=>{r.bindBuffers(n)}}const xd={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function su(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xd,n),Re(t,e),e.layouts=[],e.shaderDescriptions=[],dt(t,e,["handle","pipelineDescription"]),je(t,e,["device","renderEncoder","topology","vertexState"]),Cd(t,e)}const wd=Ie(su,"vtkWebGPUPipeline");var Sd={newInstance:wd,extend:su};function Rd(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=n=>e.outputNames.includes(n),t.addOutput=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(n),e.outputNames.push(r),e.outputInterpolations.push(i)},t.addBuiltinOutput=(n,r)=>{e.builtinOutputTypes.push(n),e.builtinOutputNames.push(r)},t.addBuiltinInput=(n,r)=>{e.builtinInputTypes.push(n),e.builtinInputNames.push(r)},t.replaceShaderCode=(n,r)=>{const i=[];let a=[];if(r&&i.push(r.getShaderCode()),n||e.builtinInputNames.length){const s=[];if(s.push(`struct ${e.type}Input
{`),n){const o=n.getOutputNamesByReference(),c=n.getOutputTypesByReference(),l=n.getOutputInterpolationsByReference();for(let u=0;u<o.length;u++)l[u]!==void 0?s.push(`  @location(${u}) @interpolate(${l[u]}) ${o[u]} : ${c[u]},`):s.push(`  @location(${u}) ${o[u]} : ${c[u]},`)}for(let o=0;o<e.builtinInputNames.length;o++)s.push(`  ${e.builtinInputNames[o]} : ${e.builtinInputTypes[o]},`);s.length>1&&(s.push("};"),a=s,i[i.length-1]+=",",i.push(`input: ${e.type}Input`))}if(i.length&&(e.code=Qe.substitute(e.code,"//VTK::IOStructs::Input",i).result),e.outputNames.length+e.builtinOutputNames.length){const s=[`struct ${e.type}Output
{`];for(let o=0;o<e.outputNames.length;o++)e.outputInterpolations[o]!==void 0?s.push(`  @location(${o}) @interpolate(${e.outputInterpolations[o]}) ${e.outputNames[o]} : ${e.outputTypes[o]},`):s.push(`  @location(${o}) ${e.outputNames[o]} : ${e.outputTypes[o]},`);for(let o=0;o<e.builtinOutputNames.length;o++)s.push(`  ${e.builtinOutputNames[o]} : ${e.builtinOutputTypes[o]},`);s.push("};"),a=a.concat(s),e.code=Qe.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=Qe.substitute(e.code,"//VTK::IOStructs::Dec",a).result}}const Ed={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function ou(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ed,n),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],R.obj(t,e),R.setGet(t,e,["type","hash","code"]),R.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),Rd(t,e)}const Md=R.newInstance(ou,"vtkWebGPUShaderDescription");var jo={newInstance:Md,extend:ou};const Ho={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function Od(t){return!t||t.length<6?0:t in Ho?Ho[t]:(J(`unknown format ${t}`),null)}function Dd(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const n=e===1?t.length-1:t.length-3,r=Number(t[n]);if(Number.isNaN(r))return J(`unknown format ${t}`),0;const i=5-r/2;return e*i}function Vd(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function Id(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{J(`unknown format ${t}`);return}const n=t.split("x")[0],r=Number(n[n.length-1]);if(Number.isNaN(r)){J(`unknown format ${t}`);return}return e+=8*(5-r/2),e+="Array",e}function Ld(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{J(`unknown format ${t}`);return}let n=1;return t[t.length-2]==="x"&&(n=Number(t[t.length-1])),n===4?`vec4<${e}>`:n===3?`vec3<${e}>`:n===2?`vec2<${e}>`:e}function Nd(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function bd(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";J(`unknown format ${t}`)}}var wt={getDetailsFromTextureFormat:Od,getByteStrideFromBufferFormat:Dd,getNumberOfComponentsFromBufferFormat:Vd,getNativeTypeFromBufferFormat:Id,getShaderTypeFromBufferFormat:Ld,getByteStrideFromShaderFormat:Nd,getNativeTypeFromShaderFormat:bd};function Fd(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!e.includes(t[n]))return!1;return!0}function _d(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(n,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",a=r;Array.isArray(a)||(a=[a]);for(let s=0;s<e.inputs.length;s++)if(Fd(e.inputs[s].names,a)){if(e.inputs[s].buffer===n)return;e.inputs[s].buffer=n;return}e.inputs.push({buffer:n,stepMode:i,names:a}),e.inputs=e.inputs.sort((s,o)=>s.names[0]<o.names[0]?-1:s.names[0]>o.names[0]?1:0)},t.removeBufferIfPresent=n=>{for(let r=0;r<e.inputs.length;r++)e.inputs[r].names.includes(n)&&e.inputs.splice(r,1)},t.getBuffer=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer;return null},t.hasAttribute=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return!0;return!1},t.getAttributeTime=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let n="",r=0;for(let i=0;i<e.inputs.length;i++)for(let a=0;a<e.inputs[i].names.length;a++){const s=e.inputs[i].buffer.getArrayInformation()[a],o=wt.getShaderTypeFromBufferFormat(s.format);r>0&&(n+=`,
`),n=`${n}  @location(${r}) ${e.inputs[i].names[a]} : ${o}`,r++}return n},t.getVertexInputInformation=()=>{const n={};if(e.inputs.length){const r=[];let i=0;for(let a=0;a<e.inputs.length;a++){const s=e.inputs[a].buffer,o={arrayStride:s.getStrideInBytes(),stepMode:e.inputs[a].stepMode,attributes:[]},c=s.getArrayInformation();for(let l=0;l<e.inputs[a].names.length;l++)o.attributes.push({shaderLocation:i,offset:c[l].offset,format:c[l].format}),i++;r.push(o)}n.buffers=r}return n},t.bindBuffers=n=>{for(let r=0;r<e.inputs.length;r++)n.setVertexBuffer(r,e.inputs[r].buffer.getHandle());e.indexBuffer&&n.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const Ud={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function cu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ud,n),Re(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],je(t,e,["created","device","handle","indexBuffer"]),_d(t,e)}const kd=Ie(cu,"vtkWebGPUVertexInput");var Pd={newInstance:kd,extend:cu};const Gd=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,Ad=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function Bd(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(n,r,i)=>{const a=jo.newInstance({type:"vertex",hash:n,code:e.vertexShaderTemplate}),s=jo.newInstance({type:"fragment",hash:n,code:e.fragmentShaderTemplate}),o=r.getShaderDescriptions();o.push(a),o.push(s);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,l=new RegExp("//VTK::[^:]*::","g"),f=c.match(l).filter((g,h,p)=>p.indexOf(g)===h).map(g=>`replaceShader${g.substring(7,g.length-2)}`);for(let g=0;g<f.length;g++){const h=f[g];h!=="replaceShaderIOStructs"&&e.shaderReplacements.has(h)&&e.shaderReplacements.get(h)(n,r,i)}t.replaceShaderIOStructs(n,r,i)},t.replaceShaderIOStructs=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.replaceShaderCode(null,i),r.getShaderDescription("fragment").replaceShaderCode(a)},t.replaceShaderRenderEncoder=(n,r,i)=>{e.renderEncoder.replaceShaderCode(r)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(n,r,i)=>{if(!e.WebGPURenderer)return;const a=e.WebGPURenderer.getBindGroup().getShaderCode(r),s=r.getShaderDescription("vertex");let o=s.getCode();o=Qe.substitute(o,"//VTK::Renderer::Dec",[a]).result,s.setCode(o);const c=r.getShaderDescription("fragment");o=c.getCode(),o=Qe.substitute(o,"//VTK::Renderer::Dec",[a]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(n,r,i)=>{const a=e.bindGroup.getShaderCode(r),s=r.getShaderDescription("vertex");let o=s.getCode();o=Qe.substitute(o,"//VTK::Mapper::Dec",[a]).result,s.setCode(o);const c=r.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),o=c.getCode(),o=Qe.substitute(o,"//VTK::Mapper::Dec",[a]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let s=a.getCode();s=Qe.substitute(s,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,a.setCode(s)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(n,r,i)=>{r.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=n=>{e.textureViews.includes(n)||e.textureViews.push(n)},t.prepareToDraw=n=>{e.renderEncoder=n,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=n=>{n.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=n=>{t.prepareToDraw(n),n.setPipeline(e.pipeline),t.draw(n)},t.draw=n=>{const r=n.getBoundPipeline();n.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(n),r.bindVertexInput(n,e.vertexInput);const i=e.vertexInput.getIndexBuffer();i?n.drawIndexed(i.getIndexCount(),e.numberOfInstances,0,0,0):n.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const n=[...e.additionalBindables];e.UBO&&n.push(e.UBO),e.SSBO&&n.push(e.SSBO);for(let r=0;r<e.textureViews.length;r++){n.push(e.textureViews[r]);const i=e.textureViews[r].getSampler();i&&n.push(i)}return n},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=Sd.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const Wd={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function lu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wd,n),Be.extend(t,e,n),e.textureViews=[],e.vertexInput=Pd.newInstance(),e.bindGroup=ru.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||Ad,e.vertexShaderTemplate=e.vertexShaderTemplate||Gd,e.shaderReplacements=new Map,R.get(t,e,["pipeline","vertexInput"]),R.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),Bd(t,e)}const zd=R.newInstance(lu,"vtkWebGPUSimpleMapper");var $d={newInstance:zd,extend:lu};function jd(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(n,r,i)=>{const a=r.getShaderDescription("vertex");a.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),a.addOutput("vec4<f32>","vertexVC");let s=a.getCode();s=Qe.substitute(s,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,a.setCode(s)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const n=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(n,["vertexBC"]),e.numberOfVertices=6}}const Hd={};function uu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Hd,n),$d.extend(t,e,n),jd(t,e)}const Kd=R.newInstance(uu,"vtkWebGPUFullScreenQuad");var R0={newInstance:Kd,extend:uu};const qd={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},Xd={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var Jr={BufferUsage:qd,PrimitiveTypes:Xd};const Xa=["getMappedRange","mapAsync","unmap"];function Yd(t,e,n,r){const i=r.byteLength,a=t.createBuffer({size:i,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),s=a.getMappedRange(0,i);new Uint8Array(s).set(new Uint8Array(r)),a.unmap();const o=t.createCommandEncoder();o.copyBufferToBuffer(a,0,e,n,i);const c=o.finish();t.queue.submit([c]),a.destroy()}function Zd(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n,usage:r,label:e.label}),e.sizeInBytes=n,e.usage=r},t.write=n=>{Yd(e.device.getHandle(),e.handle,0,n.buffer)},t.createAndWrite=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n.byteLength,usage:r,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=n.byteLength,e.usage=r,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(n.buffer)),e.handle.unmap()};for(let n=0;n<Xa.length;n++)t[Xa[n]]=function(){return e.handle[Xa[n]](...arguments)}}const Jd={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function fu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Jd,n),R.obj(t,e),R.get(t,e,["handle","sizeInBytes","usage"]),R.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),Zd(t,e)}const Qd=R.newInstance(fu);var E0={newInstance:Qd,extend:fu,...Jr};const{Representation:Ko}=fh,{PrimitiveTypes:Xt}=Jr;class e7{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return!0}get(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return this.values[n]}set(e,n){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=n)}}function t7(t){switch(t){case Xt.Points:return"points";case Xt.Lines:return"lines";case Xt.Triangles:case Xt.TriangleEdges:return"polys";case Xt.TriangleStripEdges:case Xt.TriangleStrips:return"strips";default:return""}}function ui(t,e,n){let r=t.pointIdToFlatId[e];return r<0&&(r=t.flatId,t.pointIdToFlatId[e]=r,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=n,t.flatId++),r}function n7(t,e,n){const r=t.length;for(let s=0;s<r;s++){let o=t[s];if(n.cellProvokedMap.has(o)){n.ibo[n.iboId++]=n.cellProvokedMap.get(o);for(let c=s+1;c<s+r;c++){o=t[c%r];const l=ui(n,o,e);n.ibo[n.iboId++]=l}return}}for(let s=0;s<r;s++){let o=t[s];if(!n.provokedPointIds[o]){let c=ui(n,o,e);n.provokedPointIds[o]=1,n.cellProvokedMap.set(o,c),n.flatIdToCellId[c]=e,n.ibo[n.iboId++]=c;for(let l=s+1;l<s+r;l++)o=t[l%r],c=ui(n,o,e),n.ibo[n.iboId++]=c;return}}let i=t[0],a=n.flatId;n.cellProvokedMap.set(i,a),n.flatIdToPointId[n.flatId]=i,n.flatIdToCellId[n.flatId]=e,n.flatId++,n.ibo[n.iboId++]=a;for(let s=1;s<r;s++)i=t[s],a=ui(n,i,e),n.ibo[n.iboId++]=a}function r7(t,e,n){const r=t.length;n.iboSize+=r;for(let i=0;i<r;i++){const a=t[i];if(n.cellProvokedMap.has(a))return}for(let i=0;i<r;i++){const a=t[i];if(!n.provokedPointIds[a]){n.provokedPointIds[a]=1,n.cellProvokedMap.set(a,1);return}}n.cellProvokedMap.set(t[0],1),n.extraPoints++}let bt;const qo=new Uint32Array(1),nt=new Uint32Array(2),$t=new Uint32Array(3),Ya={anythingToPoints(t,e,n,r,i){for(let a=0;a<t;++a)qo[0]=e[n+a],bt(qo,r,i)},linesToWireframe(t,e,n,r,i){for(let a=0;a<t-1;++a)nt[0]=e[n+a],nt[1]=e[n+a+1],bt(nt,r,i)},polysToWireframe(t,e,n,r,i){if(t>2)for(let a=0;a<t;++a)nt[0]=e[n+a],nt[1]=e[n+(a+1)%t],bt(nt,r,i)},stripsToWireframe(t,e,n,r,i){if(t>2){for(let a=0;a<t-1;++a)nt[0]=e[n+a],nt[1]=e[n+a+1],bt(nt,r,i);for(let a=0;a<t-2;a++)nt[0]=e[n+a],nt[1]=e[n+a+2],bt(nt,r,i)}},polysToSurface(t,e,n,r,i){for(let a=0;a<t-2;a++)$t[0]=e[n],$t[1]=e[n+a+1],$t[2]=e[n+a+2],bt($t,r,i)},stripsToSurface(t,e,n,r,i){for(let a=0;a<t-2;a++)$t[0]=e[n+a],$t[1]=e[n+a+1+a%2],$t[2]=e[n+a+1+(a+1)%2],bt($t,r,i)}};function i7(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=n=>{const r=n.cells,i=n.primitiveType,a=n.representation,s=n.cellOffset,o=r.getData(),c=o.length,l=t7(i),u=n.numberOfPoints,f={provokedPointIds:new Uint8Array(u),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new e7};let g=null;a===Ko.POINTS||i===Xt.Points?g=Ya.anythingToPoints:a===Ko.WIREFRAME||i===Xt.Lines?g=Ya[`${l}ToWireframe`]:g=Ya[`${l}ToSurface`],bt=r7;let h=s||0;for(let p=0;p<c;)f.cellProvokedMap.clear(),g(o[p],o,p+1,h,f),p+=o[p]+1,h++;u<=65535?f.flatIdToPointId=new Uint16Array(u+f.extraPoints):f.flatIdToPointId=new Uint32Array(u+f.extraPoints),u+f.extraPoints<36863?f.pointIdToFlatId=new Int16Array(u):f.pointIdToFlatId=new Int32Array(u),u+f.extraPoints<=65535?(f.ibo=new Uint16Array(f.iboSize),n.format="uint16"):(f.ibo=new Uint32Array(f.iboSize),n.format="uint32"),h<=65535?f.flatIdToCellId=new Uint16Array(u+f.extraPoints):f.flatIdToCellId=new Uint32Array(u+f.extraPoints),f.pointIdToFlatId.fill(-1),f.provokedPointIds.fill(0),bt=n7,h=s||0;for(let p=0;p<c;)f.cellProvokedMap.clear(),g(o[p],o,p+1,h,f),p+=o[p]+1,h++;delete f.provokedPointIds,delete f.pointIdToFlatId,n.nativeArray=f.ibo,e.flatIdToPointId=f.flatIdToPointId,e.flatIdToCellId=f.flatIdToCellId,e.flatSize=f.flatId,e.indexCount=f.iboId}}const a7={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function gu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,a7,n),E0.extend(t,e,n),R.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),i7(t,e)}const s7=R.newInstance(gu);var o7={newInstance:s7,extend:gu,...Jr};const{BufferUsage:jt}=Jr,{vtkErrorMacro:c7}=Ot,{VtkDataTypes:un}=oe,l7={};function u7(t){let e;switch(t.getDataType()){case un.UNSIGNED_CHAR:e="uint8";break;case un.FLOAT:e="float32";break;case un.UNSIGNED_INT:e="uint32";break;case un.INT:e="sint32";break;case un.DOUBLE:e="float32";break;case un.UNSIGNED_SHORT:e="uint16";break;case un.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||c7(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function Xo(t,e,n,r,i){const a={},s=t.getFlatSize();if(!s)return a;let o=[0,0,0,0];i.shift&&(i.shift.length?o=i.shift:o.fill(i.shift));let c=[1,1,1,1];i.scale&&(i.scale.length?c=i.scale:c.fill(i.scale));const l=Object.prototype.hasOwnProperty.call(i,"packExtra")?i.packExtra:!1;let u,f=0;const g=n+(l?1:0),h=sr(r,s*g);let p=t.getFlatIdToPointId();i.cellData&&(p=t.getFlatIdToCellId()),n===1?u=function(m){h[f++]=c[0]*e[m]+o[0]}:n===2?u=function(m){h[f++]=c[0]*e[m]+o[0],h[f++]=c[1]*e[m+1]+o[1]}:n===3&&!l?u=function(m){h[f++]=c[0]*e[m]+o[0],h[f++]=c[1]*e[m+1]+o[1],h[f++]=c[2]*e[m+2]+o[2]}:n===3&&l?u=function(m){h[f++]=c[0]*e[m]+o[0],h[f++]=c[1]*e[m+1]+o[1],h[f++]=c[2]*e[m+2]+o[2],h[f++]=c[3]*1+o[3]}:n===4&&(u=function(m){h[f++]=c[0]*e[m]+o[0],h[f++]=c[1]*e[m+1]+o[1],h[f++]=c[2]*e[m+2]+o[2],h[f++]=c[3]*e[m+3]+o[3]});for(let d=0;d<s;d++){const m=n*p[d];u(m)}return a.nativeArray=h,a}function f7(t,e,n,r){const i=[t[r*3]-t[n*3],t[r*3+1]-t[n*3+1],t[r*3+2]-t[n*3+2]],a=[t[e*3]-t[n*3],t[e*3+1]-t[n*3+1],t[e*3+2]-t[n*3+2]],s=[];return Et(i,a,s),da(s),s}function g7(t,e){const n=e.getData(),r=t.getData();if(!r||!n)return null;const i=new Int8Array(t.getNumberOfCells()*4),a=r.length;let s=0;for(let o=0;o<a;){const c=f7(n,r[o+1],r[o+2],r[o+3]);i[s++]=127*c[0],i[s++]=127*c[1],i[s++]=127*c[2],i[s++]=127,o+=r[o]+1}return i}function h7(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function n(r){r.dataArray&&!r.nativeArray&&(r.nativeArray=r.dataArray.getData());let i,a;if(r.usage===jt.Index&&(i=o7.newInstance({label:r.label}),i.setDevice(e.device),a=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,i.buildIndexBuffer(r),i.createAndWrite(r.nativeArray,a),i.setArrayInformation([{format:r.format}])),i||(i=E0.newInstance({label:r.label}),i.setDevice(e.device)),r.usage===jt.UniformArray&&(a=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i.createAndWrite(r.nativeArray,a)),r.usage===jt.Storage&&(a=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,i.createAndWrite(r.nativeArray,a)),r.usage===jt.Texture&&(a=GPUBufferUsage.COPY_SRC,i.createAndWrite(r.nativeArray,a)),r.usage===jt.PointArray){a=GPUBufferUsage.VERTEX;const s=wt.getNativeTypeFromBufferFormat(r.format),o=Xo(r.indexBuffer,r.dataArray.getData(),r.dataArray.getNumberOfComponents(),s,{packExtra:r.packExtra,shift:r.shift,scale:r.scale,cellData:r.cellData,cellOffset:r.cellOffset});i.createAndWrite(o.nativeArray,a),i.setStrideInBytes(wt.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format,interpolation:r.cellData?"flat":"perspective"}])}if(r.usage===jt.NormalsFromPoints){a=GPUBufferUsage.VERTEX;const s=wt.getNativeTypeFromBufferFormat(r.format),o=g7(r.cells,r.dataArray),c=Xo(r.indexBuffer,o,4,s,{cellData:!0});i.createAndWrite(c.nativeArray,a),i.setStrideInBytes(wt.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format,interpolation:"flat"}])}return r.usage===jt.RawVertex&&(a=GPUBufferUsage.VERTEX,i.createAndWrite(r.nativeArray,a),i.setStrideInBytes(wt.getByteStrideFromBufferFormat(r.format)),i.setArrayInformation([{offset:0,format:r.format}])),i.setSourceTime(r.time),i}t.hasBuffer=r=>e.device.hasCachedObject(r),t.getBuffer=r=>r.hash?e.device.getCachedObject(r.hash,n,r):n(r),t.getBufferForPointArray=(r,i)=>{const a=u7(r),s={hash:`${r.getMTime()}I${i.getMTime()}${a}`,usage:jt.PointArray,format:a,dataArray:r,indexBuffer:i};return t.getBuffer(s)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=E0.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const r=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(r,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const p7={device:null,fullScreenQuadBuffer:null};function hu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,p7,n),Re(t,e),je(t,e,["device"]),h7(t,e)}const d7=Ie(hu);var pu={newInstance:d7,extend:hu,...l7,...Jr};const{BufferUsage:m7}=pu,{vtkErrorMacro:Fn}=R;function y7(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){Fn(`entry named ${n} already exists`);return}e._bufferEntryNames.set(n,e.bufferEntries.length);const i=wt.getByteStrideFromShaderFormat(r);e.bufferEntries.push({name:n,type:r,sizeInBytes:i,offset:e.sizeInBytes,nativeType:wt.getNativeTypeFromShaderFormat(r)}),e.sizeInBytes+=i},t.send=n=>{if(!e._buffer){const r={nativeArray:e.Float32Array,usage:m7.Storage,label:e.label};e._buffer=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e._sendTime.modified();return}n.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[n]=R.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r,i)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){Fn(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const o=e[s.nativeType];o[(s.offset+r*e.sizeInBytes)/o.BYTES_PER_ELEMENT]=i},t.setArray=(n,r,i)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){Fn(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const o=e[s.nativeType],c=(s.offset+r*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let l=0;l<i.length;l++)o[c+l]=i[l]},t.setAllInstancesFromArray=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Fn(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const s=e[a.nativeType],o=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(a.offset+c*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let u=0;u<o;u++)s[l+u]=r[c*o+u]}},t.setAllInstancesFromArrayColorToFloat=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Fn(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const s=e[a.nativeType],o=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const l=(a.offset+c*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let u=0;u<o;u++)s[l+u]=r[c*o+u]/255}},t.setAllInstancesFromArray3x3To4x4=(n,r)=>{const i=e._bufferEntryNames.get(n);if(i===void 0){Fn(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const s=e[a.nativeType],o=9;for(let c=0;c<e.numberOfInstances;c++){const l=(a.offset+c*e.sizeInBytes)/s.BYTES_PER_ELEMENT;for(let u=0;u<3;u++)for(let f=0;f<3;f++)s[l+u*4+f]=r[c*o+u*3+f]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(n,r)=>{const i=[`struct ${e.label}StructEntry
{`];for(let a=0;a<e.bufferEntries.length;a++){const s=e.bufferEntries[a];i.push(`  ${s.name}: ${s.type},`)}return i.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${n}) @group(${r}) var<storage, read> ${e.label}: ${e.label}Struct;
`),i.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const v7={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function du(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,v7,n),R.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},R.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},R.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},R.get(t,e,["bindGroupTime"]),R.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),y7(t,e)}const T7=R.newInstance(du,"vtkWebGPUStorageBuffer");var C7={newInstance:T7,extend:du};const{BufferUsage:x7}=pu,{vtkErrorMacro:Za}=R;function w7(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){Za(`entry named ${n} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(n,e.bufferEntries.length),e.bufferEntries.push({name:n,type:r,sizeInBytes:wt.getByteStrideFromShaderFormat(r),offset:-1,nativeType:wt.getNativeTypeFromShaderFormat(r),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let n=0;const r=[];let i=4;for(let a=0;a<e.bufferEntries.length;a++){const s=e.bufferEntries[a];s.sizeInBytes%16===0&&(i=Math.max(16,i)),s.sizeInBytes%8===0&&(i=Math.max(8,i))}for(let a=0;a<e.bufferEntries.length;a++){const s=e.bufferEntries[a];s.packed===!1&&s.sizeInBytes%16===0&&(s.packed=!0,s.offset=n,r.push(s),n+=s.sizeInBytes)}for(let a=0;a<e.bufferEntries.length;a++){const s=e.bufferEntries[a];if(s.packed===!1&&s.sizeInBytes===12)for(let o=0;o<e.bufferEntries.length;o++){const c=e.bufferEntries[o];if(c.packed===!1&&c.sizeInBytes===4){s.packed=!0,s.offset=n,r.push(s),n+=s.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let a=0;a<e.bufferEntries.length;a++){const s=e.bufferEntries[a];if(!s.packed&&s.sizeInBytes%8===0)for(let o=a+1;o<e.bufferEntries.length;o++){const c=e.bufferEntries[o];if(!c.packed&&c.sizeInBytes%8===0){s.packed=!0,s.offset=n,r.push(s),n+=s.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let a=0;a<e.bufferEntries.length;a++){const s=e.bufferEntries[a];if(!s.packed&&s.sizeInBytes%8===0){let o=!1;for(let c=0;!o&&c<e.bufferEntries.length;c++){const l=e.bufferEntries[c];if(!l.packed&&l.sizeInBytes===4)for(let u=c+1;u<e.bufferEntries.length;u++){const f=e.bufferEntries[u];if(!f.packed&&f.sizeInBytes===4){s.packed=!0,s.offset=n,r.push(s),n+=s.sizeInBytes,l.packed=!0,l.offset=n,r.push(l),n+=l.sizeInBytes,f.packed=!0,f.offset=n,r.push(f),n+=f.sizeInBytes,o=!0;break}}}}}for(let a=0;a<e.bufferEntries.length;a++){const s=e.bufferEntries[a];!s.packed&&s.sizeInBytes>4&&(s.packed=!0,s.offset=n,r.push(s),n+=s.sizeInBytes)}for(let a=0;a<e.bufferEntries.length;a++){const s=e.bufferEntries[a];s.packed||(s.packed=!0,s.offset=n,r.push(s),n+=s.sizeInBytes)}e.bufferEntries=r,e._bufferEntryNames.clear();for(let a=0;a<e.bufferEntries.length;a++)e._bufferEntryNames.set(e.bufferEntries[a].name,a);e.sizeInBytes=n,e.sizeInBytes=i*Math.ceil(e.sizeInBytes/i),e.sortDirty=!1},t.sendIfNeeded=n=>{if(!e.UBO){const r={nativeArray:e.Float32Array,usage:x7.UniformArray,label:e.label};e.UBO=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(n.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[n]=R.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(n);if(i===void 0){Za(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const s=e[a.nativeType];a.lastValue!==r&&(s[a.offset/s.BYTES_PER_ELEMENT]=r,e.sendDirty=!0),a.lastValue=r},t.setArray=(n,r)=>{t.sortBufferEntries();const i=e._bufferEntryNames.get(n);if(i===void 0){Za(`entry named ${n} not found in UBO`);return}const a=e.bufferEntries[i];t.createView(a.nativeType);const s=e[a.nativeType];let o=!1;for(let c=0;c<r.length;c++)(!a.lastValue||a.lastValue[c]!==r[c])&&(s[a.offset/s.BYTES_PER_ELEMENT+c]=r[c],o=!0);o&&(e.sendDirty=!0,a.lastValue=[...r])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(n,r)=>{t.sortBufferEntries();const i=[`struct ${e.label}Struct
{`];for(let a=0;a<e.bufferEntries.length;a++){const s=e.bufferEntries[a];i.push(`  ${s.name}: ${s.type},`)}return i.push(`};
@binding(${n}) @group(${r}) var<uniform> ${e.label}: ${e.label}Struct;`),i.join(`
`)}}const S7={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function mu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,S7,n),R.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},R.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},R.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,R.get(t,e,["binding","bindGroupTime"]),R.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),w7(t,e)}const R7=R.newInstance(mu,"vtkWebGPUUniformBuffer");var Dr={newInstance:R7,extend:mu};const{vtkDebugMacro:E7}=Ot,Yo=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,M7=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,fi=new Float64Array(16),Zo=new Float64Array(16);function O7(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function D7(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const n=e.camera.getClippingRange(),r=e.camera.getPositionByReference(),i=e.camera.getDirectionOfProjectionByReference(),a=[],s=[];tn(s,i,.5*(n[0]+n[1])),rn(a,r,s),$e(s,a,e.stabilizedCenter),s2(s)/(n[1]-n[0])>e.recenterThreshold&&(e.stabilizedCenter=a,e.stabilizedTime.modified())},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let i=0;i<r.length;++i)r[i].getSwitch()>0&&n++;return n||(E7("No lights are on, creating one."),e.renderable.createLight()),n},t.updateUBO=()=>{var r;const n=e.UBO.getSendTime();if(e._parent.getMTime()>n||t.getMTime()>n||e.camera.getMTime()>n||e.renderable.getMTime()>n){const i=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",i.wcvc),e.UBO.setArray("SCPCMatrix",i.scpc),e.UBO.setArray("PCSCMatrix",i.pcsc),e.UBO.setArray("SCVCMatrix",i.scvc),e.UBO.setArray("VCPCMatrix",i.vcpc),e.UBO.setArray("WCVCNormals",i.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",(r=e.renderable.getEnvironmentTexture())==null?void 0:r.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const a=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[a.usize,a.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const s=e._parent.getDevice();e.UBO.sendIfNeeded(s)}},t.updateSSBO=()=>{const n=e.renderable.getLights(),r=e.webgpuCamera.getKeyMatrices(t);let i=`${e.renderable.getMTime()}`;for(let a=0;a<n.length;a++)i+=n[a].getMTime();if(i!==e.lightTimeString){const a=new Float32Array(n.length*4),s=new Float32Array(n.length*4),o=new Float32Array(n.length*4),c=new Float32Array(n.length*4);for(let u=0;u<n.length;u++){const f=u*4,g=n[u].getPosition();pe(g,g,r.wcvc),a[f]=g[0],a[f+1]=g[1],a[f+2]=g[2],a[f+3]=0,s[f]=-n[u].getDirection()[0],s[f+1]=-n[u].getDirection()[1],s[f+2]=-n[u].getDirection()[2],s[f+3]=0,o[f]=n[u].getColor()[0],o[f+1]=n[u].getColor()[1],o[f+2]=n[u].getColor()[2],o[f+3]=n[u].getIntensity()*5,c[f]=O7(n[u]),c[f+1]=Math.cos(Fe(n[u].getConeAngle())),c[f+2]=Math.cos(Fe(n[u].getConeAngle()+n[u].getConeFalloff())),c[f+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(n.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",a),e.SSBO.setAllInstancesFromArray("LightDir",s),e.SSBO.setAllInstancesFromArray("LightColor",o),e.SSBO.setAllInstancesFromArray("LightData",c);const l=e._parent.getDevice();e.SSBO.send(l)}e.lightTimeString=i},t.scissorAndViewport=n=>{const r=t.getYInvertedTiledSizeAndOrigin();n.getHandle().setViewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize,0,1),n.getHandle().setScissorRect(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)},t.bindUBO=n=>{n.activateBindGroup(e.bindGroup)},t.opaquePass=n=>{n?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{var a;if(e.renderable.getTransparent()||e.suppressClear)return;const n=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=R0.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(Yo);const s=Dr.newInstance({label:"mapperUBO"});s.addEntry("FSQMatrix","mat4x4<f32>"),s.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(s),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&((a=e.backgroundTex)!=null&&a.getImageLoaded())){e.clearFSQ.setFragmentShaderTemplate(M7);const s=Dr.newInstance({label:"mapperUBO"});s.addEntry("FSQMatrix","mat4x4<f32>"),s.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(s);const o=n.getTextureManager().getTextureForVTKTexture(e.backgroundTex);if(o.getReady()){const c=o.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([c]),e.backgroundTexLoaded=!0;const l=e.backgroundTex.getInterpolate()?"linear":"nearest";c.addSampler(n,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:l,magFilter:l,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=R0.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(Yo);const s=Dr.newInstance({label:"mapperUBO"});s.addEntry("FSQMatrix","mat4x4<f32>"),s.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(s)}const r=e.webgpuCamera.getKeyMatrices(t),i=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",i),ue(Zo,r.normalMatrix),Ki(fi,r.scvc,r.pcsc),Ki(fi,Zo,fi),e.clearFSQ.getUBO().setArray("FSQMatrix",fi),e.clearFSQ.getUBO().sendIfNeeded(n),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.convertToOpenGLDepth=n=>e.webgpuCamera.convertToOpenGLDepth(n),t.getYInvertedTiledSizeAndOrigin=()=>{const n=t.getTiledSizeAndOrigin(),r=e._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],i=n[0]-r[0],a=n[1]-r[1],s=e._parent.normalizedDisplayToDisplay(i,a),o=Math.round(s[0]),c=Math.round(s[1]),l=n[2]-r[0],u=n[3]-r[1],f=e._parent.normalizedDisplayToDisplay(l,u);let g=Math.round(f[0])-o,h=Math.round(f[1])-c;return g<0&&(g=0),h<0&&(h=0),{usize:g,vsize:h,lowerLeftU:o,lowerLeftV:c}},t.getPropFromID=n=>{for(let r=0;r<e.children.length;r++)if((e.children[r].getPropID?e.children[r].getPropID():-1)===n)return e.children[r];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const V7={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function I7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,V7,n),Be.extend(t,e,n),e.UBO=Dr.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=C7.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=ru.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=X(new Float64Array(16)),e.stabilizedTime={},Re(e.stabilizedTime,{mtime:0}),dt(t,e,["bindGroup","stabilizedTime"]),Hr(t,e,["stabilizedCenter"]),je(t,e,["renderEncoder","selector","suppressClear","UBO"]),D7(t,e)}const L7=Ie(I7,"vtkWebGPURenderer");or("vtkRenderer",L7);function N7(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=n,e.options.addressModeU=r.addressModeU?r.addressModeU:"clamp-to-edge",e.options.addressModeV=r.addressModeV?r.addressModeV:"clamp-to-edge",e.options.addressModeW=r.addressModeW?r.addressModeW:"clamp-to-edge",e.options.magFilter=r.magFilter?r.magFilter:"nearest",e.options.minFilter=r.minFilter?r.minFilter:"nearest",e.options.mipmapFilter=r.mipmapFilter?r.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(n,r)=>`@binding(${n}) @group(${r}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const b7={device:null,handle:null,label:null,options:null};function yu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,b7,n),R.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},R.obj(e.bindGroupTime,{mtime:0}),R.get(t,e,["bindGroupTime","handle","options"]),R.setGet(t,e,["bindGroupLayoutEntry","device","label"]),N7(t,e)}const F7=R.newInstance(yu);var _7={newInstance:F7,extend:yu};const{SlicingMode:Jo}=Ra,U7=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Image::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  //VTK::Image::Sample

  // var computedColor: vec4<f32> = vec4<f32>(1.0,0.7, 0.5, 1.0);

//VTK::RenderEncoder::Impl

  return output;
}
`;function k7(t,e,n){if(e.apply(t)){const i=t.getIndependentComponents();return`${t.getMTime()}-${i}-${n}`}return"0"}const Ze=new Float64Array(16),vt=new Float64Array(16),gi=new Float64Array(16),Nt=new Float64Array(4),Ee=new Float64Array(4);function P7(t,e){e.classHierarchy.push("vtkWebGPUImageMapper"),t.buildPass=i=>{if(i){e.WebGPUImageSlice=t.getFirstAncestorOfType("vtkWebGPUImageSlice"),e.WebGPURenderer=e.WebGPUImageSlice.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice();const a=e.WebGPURenderer.getRenderable();e.renderable.getSliceAtFocalPoint()&&e.renderable.setSliceFromCamera(a.getActiveCamera())}},t.translucentPass=i=>{i&&t.render()},t.opaquePass=i=>{i&&t.render()},t.render=()=>{e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw)},t.computePipelineHash=()=>{const i=e.currentInput.getExtent();i[0]===i[1]||i[2]===i[3]||i[4]===i[5]?(e.dimensions=2,e.pipelineHash="img2"):(e.dimensions=3,e.pipelineHash="img3")},t.updateUBO=()=>{const i=e.UBO.getSendTime(),a=e.WebGPUImageSlice.getRenderable(),s=a.getMapper();if(t.getMTime()>i||e.renderable.getMTime()>i||a.getProperty().getMTime()>i){const o=s.getInputData(),c=e.WebGPURenderer.getStabilizedCenterByReference();X(Ze),Se(Ze,Ze,c);const l=a.getMatrix();ue(vt,l),ke(vt,vt),se(Ze,vt,Ze);const u=o.getWorldToIndex();se(Ze,u,Ze),ke(gi,Ze),Ta(vt,[.5,.5,.5]),se(Ze,vt,Ze);const f=o.getDimensions();X(vt),Gt(vt,vt,[1/f[0],1/f[1],1/f[2]]),se(Ze,vt,Ze),e.UBO.setArray("SCTCMatrix",Ze);const g=e.currentInput.getExtent(),{ijkMode:h}=e.renderable.getClosestIJKAxis();let p=e.renderable.getSlice();h!==e.renderable.getSlicingMode()&&(p=e.renderable.getSliceAtPosition(p));let d=2,m=0,y=1;h===Jo.I?(d=0,m=1,y=2):h===Jo.J&&(d=1,m=2,y=0),Nt[d]=p,Nt[m]=g[m*2]-.5,Nt[y]=g[y*2]-.5,Nt[3]=1,yn(Nt,Nt,gi),e.UBO.setArray("Origin",Nt),Ee[d]=p,Ee[m]=g[m*2+1]+.5,Ee[y]=g[y*2]-.5,Ee[3]=1,yn(Ee,Ee,gi),To(Ee,Ee,Nt),Ee[3]=1,e.UBO.setArray("Axis1",Ee),Ee[d]=p,Ee[m]=g[m*2]-.5,Ee[y]=g[y*2+1]+.5,Ee[3]=1,yn(Ee,Ee,gi),To(Ee,Ee,Nt),Ee[3]=1,e.UBO.setArray("Axis2",Ee);const T=[1,1,1,1],v=[0,0,0,0],C=e.textureViews[0],x=C.getTexture().getScale(),w=C.getTexture().getNumberOfComponents();for(let E=0;E<w;E++){let O=a.getProperty().getColorWindow(),D=a.getProperty().getColorLevel();const M=a.getProperty().getRGBTransferFunction(0);if(M){const V=M.getRange();O=V[1]-V[0],D=.5*(V[1]+V[0])}T[E]=x/O,v[E]=-D/O+.5}e.UBO.setArray("cScale",T),e.UBO.setArray("cShift",v),e.UBO.sendIfNeeded(e.device)}},t.updateLUTImage=()=>{const i=e.WebGPUImageSlice.getRenderable().getProperty();t.getTextureViews()[0].getTexture().getNumberOfComponents();const s=1,o=k7(i,i.getRGBTransferFunction,s);if(e.colorTextureString!==o){e.numRows=s;const c=new Uint8ClampedArray(e.numRows*2*e.rowLength*4);let l=i.getRGBTransferFunction();if(l){const u=new Float32Array(e.rowLength*3);for(let f=0;f<s;f++){l=i.getRGBTransferFunction(f);const g=l.getRange();l.getTable(g[0],g[1],e.rowLength,u,1);for(let h=0;h<e.rowLength;h++){const p=f*e.rowLength*8+h*4;c[p]=255*u[h*3],c[p+1]=255*u[h*3+1],c[p+2]=255*u[h*3+2],c[p+3]=255;for(let d=0;d<4;d++)c[p+e.rowLength*4+d]=c[p+d]}}}else for(let u=0;u<e.rowLength;++u){const f=255*u/(e.rowLength-1);c[u*4]=f,c[u*4+1]=f,c[u*4+2]=f,c[u*4+3]=255;for(let g=0;g<4;g++)c[u*4+e.rowLength*4+g]=c[u*4+g]}{const u={nativeArray:c,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},g=e.device.getTextureManager().getTexture(u).createView("tfunTexture");e.textureViews[1]=g}e.colorTextureString=o}};const n=t.updateBuffers;t.updateBuffers=()=>{n();const i=e.device.getTextureManager().getTextureForImageData(e.currentInput),a=e.textureViews;if(!a[0]||a[0].getTexture()!==i){const c=i.createView("imgTexture");a[0]=c}t.updateLUTImage(),t.updateUBO();const o=e.WebGPUImageSlice.getRenderable().getProperty().getInterpolationType()===xn.NEAREST?"nearest":"linear";(!e.clampSampler||o!==e.clampSampler.getOptions().minFilter)&&(e.clampSampler=_7.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:o,magFilter:o}),e.additionalBindables=[e.clampSampler])};const r=t.getShaderReplacements();t.replaceShaderPosition=(i,a,s)=>{const o=a.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=o.getCode();const l=["var pos: vec4<f32> = mapperUBO.Origin +","   (vertexBC.x * 0.5 + 0.5) * mapperUBO.Axis1 + (vertexBC.y * 0.5 + 0.5) * mapperUBO.Axis2;","pos.w = 1.0;"];e.dimensions===2?l.push("var tcoord : vec2<f32> = (mapperUBO.SCTCMatrix * pos).xy;"):l.push("var tcoord : vec3<f32> = (mapperUBO.SCTCMatrix * pos).xyz;"),l.push("output.tcoordVS = tcoord;","output.Position = rendererUBO.SCPCMatrix * pos;"),c=Qe.substitute(c,"//VTK::Position::Impl",l).result,o.setCode(c)},r.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(i,a,s)=>{const o=a.getShaderDescription("vertex");e.dimensions===2?o.addOutput("vec2<f32>","tcoordVS"):o.addOutput("vec3<f32>","tcoordVS")},r.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderImage=(i,a,s)=>{const o=a.getShaderDescription("fragment");let c=o.getCode();e.dimensions===3?c=Qe.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result:c=Qe.substitute(c,"//VTK::Image::Sample",["    var computedColor: vec4<f32> =","      textureSampleLevel(imgTexture, clampSampler, input.tcoordVS, 0.0);","//VTK::Image::Sample"]).result,c=Qe.substitute(c,"//VTK::Image::Sample",["    var coord: vec2<f32> =","      vec2<f32>(computedColor.r * mapperUBO.cScale.r + mapperUBO.cShift.r, 0.5);","    computedColor = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);"]).result,o.setCode(c)},r.set("replaceShaderImage",t.replaceShaderImage)}const G7={rowLength:1024};function A7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,G7,n),R0.extend(t,e,n),t.setFragmentShaderTemplate(U7),e.UBO=Dr.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.UBO.addEntry("Origin","vec4<f32>"),e.UBO.addEntry("Axis2","vec4<f32>"),e.UBO.addEntry("Axis1","vec4<f32>"),e.UBO.addEntry("cScale","vec4<f32>"),e.UBO.addEntry("cShift","vec4<f32>"),e.lutBuildTime={},Re(e.lutBuildTime,{mtime:0}),e.imagemat=X(new Float64Array(16)),e.imagematinv=X(new Float64Array(16)),e.VBOBuildTime={},Re(e.VBOBuildTime),P7(t,e)}const B7=Ie(A7,"vtkWebGPUImageMapper");or("vtkImageMapper",B7);function W7(t,e){e.classHierarchy.push("vtkWebGPUImageSlice"),t.buildPass=n=>{if(!(!e.renderable||!e.renderable.getVisibility())&&n){if(!e.renderable)return;e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes()}},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children.forEach(r=>{r.traverse(n)}),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix(),i=n.getStabilizedCenterByReference();e.bufferShift[0]=r[3]-i[0],e.bufferShift[1]=r[7]-i[1],e.bufferShift[2]=r[11]-i[2],ue(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?X(e.keyMatrices.normalMatrix):(Oe(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,ke(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),ue(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),Se(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),Se(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-i[0],-i[1],-i[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const z7={bufferShift:void 0,keyMatrixTime:null,keyMatrices:null,propID:void 0};function $7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,z7,n),Be.extend(t,e,n),e.keyMatricesTime={},Re(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},e.keyMatrixTime={},Re(e.keyMatrixTime,{mtime:0}),e.keyMatrices={mcwc:X(new Float64Array(16))},e.bufferShift=[0,0,0,0],dt(t,e,["propID","keyMatricesTime"]),W7(t,e)}const j7=Ie($7,"vtkWebGPUImageSlice");or("vtkImageSlice",j7);function H7(t,e){e.classHierarchy.push("vtkWebGPUVolume"),t.buildPass=i=>{!e.renderable||!e.renderable.getVisibility()||i&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),e.renderable.getMapper().update())},t.queryPass=(i,a)=>{if(i){if(!e.renderable||!e.renderable.getVisibility())return;const s=e.renderable.getMapper().getBounds();if(!s||s.length!==6||s[0]>s[1])return;a.addVolume(t)}};const n=new Float64Array(3),r=new Float64Array(3);t.getBoundingCubePoints=(i,a)=>{const s=e.renderable.getMapper().getInputData();if(!s)return;const o=s.getExtent(),c=e.renderable.getMatrix();let l=0;for(let u=4;u<6;u++){n[2]=o[u];for(let f=2;f<4;f++){n[1]=o[f];for(let g=0;g<2;g++){n[0]=o[g],s.indexToWorld(n,r);let h=a+l*3;i[h++]=c[0]*r[0]+c[1]*r[1]+c[2]*r[2]+c[3],i[h++]=c[4]*r[0]+c[5]*r[1]+c[6]*r[2]+c[7],i[h++]=c[8]*r[0]+c[9]*r[1]+c[10]*r[2]+c[11],l++}}}},t.getKeyMatrices=i=>{if(Math.max(e.renderable.getMTime(),i.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const a=e.renderable.getMatrix(),s=i.getStabilizedCenterByReference();ue(e.keyMatrices.bcwc,a),Se(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-s[0],-s[1],-s[2]]),e.keyMatricesTime.modified()}return e.keyMatrices}}const K7={propID:void 0,keyMatricesTime:null};function q7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,K7,n),Be.extend(t,e,n),e.keyMatricesTime={},R.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={bcwc:new Float64Array(16),bcsc:new Float64Array(16)},R.get(t,e,["propID","keyMatricesTime"]),H7(t,e)}const X7=R.newInstance(q7,"vtkWebGPUVolume");or("vtkVolume",X7);function Y7(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const i=e.WebGPURenderer.getAspectRatio(),a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,s=e.WebGPURenderer.getTiledSizeAndOrigin(),o=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),a,i,s,o)}}const Z7={};function J7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Z7,n),Be.extend(t,e,n),Y7(t,e)}const Q7=R.newInstance(J7,"vtkWebGPUPixelSpaceCallbackMapper");or("vtkPixelSpaceCallbackMapper",Q7);const Qo=[[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],ec=[[0,-1,0],[0,1,0]],em=[[0,-1,0],[0,1,0],[0,0,-1]],tm=[[0,-1,0],[0,1,0],[0,0,1]],Bs=class Bs{static copyMap(e,n){for(const[r,i]of n.rows)e.rows.set(r,structuredClone(i))}constructor(e,n,r=1){this.rows=new Map,this.height=1,this.width=1,this.depth=1,this.jMultiple=1,this.kMultiple=1,this.numComps=1,this.pixelDataConstructor=Uint8Array,this.updateScalarData=function(i){i.fill(0);const a=(s,o,c)=>{const{start:l,end:u,value:f}=o;for(let g=l;g<u;g++)i[s+g]=f};this.forEach(a)},this.get=i=>{const a=i%this.jMultiple,s=(i-a)/this.jMultiple,o=this.getRLE(a,s);return(o==null?void 0:o.value)??this.defaultValue},this.getRun=(i,a)=>{const s=i+a*this.height;return this.rows.get(s)},this.set=(i,a)=>{if(a===void 0)return;const s=i%this.width,o=(i-s)/this.width,c=this.rows.get(o);if(!c){this.rows.set(o,[{start:s,end:s+1,value:a}]);return}const l=this.findIndex(c,s),u=c[l],f=c[l-1];if(!u){if(!f||f.value!==a||f.end!==s){c[l]={start:s,end:s+1,value:a};return}f.end++;return}const{start:g,end:h,value:p}=u;if(a===p&&s>=g)return;const d={start:s,end:s+1,value:a},m=s>g,y=m?l+1:l,T=m?u:f;let v=m?c[l+1]:u;if((T==null?void 0:T.value)===a&&(T==null?void 0:T.end)===s){T.end++,(v==null?void 0:v.value)===a&&v.start===s+1?(T.end=v.end,c.splice(l,1)):(v==null?void 0:v.start)===s&&(v.start++,v.start===v.end&&(c.splice(l,1),v=c[l],(v==null?void 0:v.start)===s+1&&v.value===a&&(T.end=v.end,c.splice(l,1))));return}if((v==null?void 0:v.value)===a&&v.start===s+1){v.start--,(T==null?void 0:T.end)>s&&(T.end=s,T.end===T.start&&c.splice(l,1));return}if((v==null?void 0:v.start)===s&&v.end===s+1){v.value=a;const C=c[l+1];(C==null?void 0:C.start)==s+1&&C.value===a&&(c.splice(l+1,1),v.end=C.end);return}s===(v==null?void 0:v.start)&&v.start++,m&&h>s+1?c.splice(y,0,d,{start:s+1,end:T.end,value:T.value}):c.splice(y,0,d),(T==null?void 0:T.end)>s&&(T.end=s)},this.width=e,this.height=n,this.depth=r,this.jMultiple=e,this.kMultiple=this.jMultiple*n}toIJK(e){const n=e%this.jMultiple,r=(e-n)/this.jMultiple%this.height,i=Math.floor(e/this.kMultiple);return[n,r,i]}toIndex([e,n,r]){return e+r*this.kMultiple+n*this.jMultiple}getRLE(e,n,r=0){const i=this.rows.get(n+r*this.height);if(!i)return;const a=this.findIndex(i,e),s=i[a];return e>=(s==null?void 0:s.start)?s:void 0}has(e){const n=e%this.jMultiple,r=(e-n)/this.jMultiple,i=this.getRLE(n,r);return(i==null?void 0:i.value)!==void 0}delete(e){const n=e%this.width,r=(e-n)/this.width,i=this.rows.get(r);if(!i)return;const a=this.findIndex(i,n),s=i[a];if(!s||s.start>n)return;if(s.end===n+1){s.end--,s.start>=s.end&&(i.splice(a,1),i.length||this.rows.delete(r));return}if(s.start===n){s.start++;return}const o={value:s.value,start:n+1,end:s.end};s.end=n,i.splice(a+1,0,o)}findIndex(e,n){for(let r=0;r<e.length;r++){const{end:i}=e[r];if(n<i)return r}return e.length}forEach(e,n){const r=n==null?void 0:n.rowModified;for(const[i,a]of this.rows){const s=r?[...a]:a;for(const o of s)e(i*this.width,o,a)}}forEachRow(e){for(const[n,r]of this.rows)e(n*this.width,r)}clear(){this.rows.clear()}keys(){return[...this.rows.keys()]}getPixelData(e=0,n){n?n.fill(0):n=new this.pixelDataConstructor(this.width*this.height*this.numComps);const{width:r,height:i,numComps:a}=this;for(let s=0;s<i;s++){const o=this.getRun(s,e);if(o)if(a===1)for(const c of o){const l=s*r,{start:u,end:f,value:g}=c;for(let h=u;h<f;h++)n[l+h]=g}else for(const c of o){const l=s*r*a,{start:u,end:f,value:g}=c;for(let h=u;h<f;h+=a)for(let p=0;p<a;p++)n[l+h+p]=g[p]}}return n}floodFill(e,n,r,i,a){const s=this.getRLE(e,n,r);if(!s)throw new Error(`Initial point ${e},${n},${r} isn't in the RLE`);const o=[[s,n,r]],c=s.value;if(c===i)throw new Error(`source (${c}) and destination (${i}) are identical`);return this.flood(o,c,i,a)}flood(e,n,r,i){let a=0;const{planar:s=!0,diagonals:o=!0,singlePlane:c=!1}=i||{},l={planar:s,diagonals:o,singlePlane:c};for(;e.length;){const u=e.pop(),[f]=u;if(f.value!==n)continue;f.value=r,a+=f.end-f.start;const g=this.findAdjacents(u,l).filter(h=>h&&h[0].value===n);e.push(...g)}return a}fillFrom(e,n){for(let r=n[2][0];r<=n[2][1];r++)for(let i=n[1][0];i<=n[1][1];i++){let a,s;for(let o=n[0][0];o<=n[0][1];o++){const c=e(o,i,r);if(c===void 0){a=void 0;continue}s||(s=[],this.rows.set(i+r*this.height,s)),a&&a.value!==c&&(a=void 0),a||(a={start:o,end:o,value:c},s.push(a)),a.end++}}}findAdjacents(e,{diagonals:n=!0,planar:r=!0,singlePlane:i=!1}){const[a,s,o,c]=e,{start:l,end:u}=a,f=l>0&&this.getRLE(l-1,s,o),g=u<this.width&&this.getRLE(u,s,o),h=n?[l>0?l-1:l,u<this.width?u+1:u]:[l,u],p=[];f&&p.push([f,s,o]),g&&p.push([g,s,o]);for(const d of c||(i?ec:Qo)){const[,m,y]=d,T=m+s,v=y+o;if(T<0||T>=this.height||v<0||v>=this.depth)continue;const C=this.getRun(T,v);if(C)for(const x of C){const w=c||i&&ec||r&&y>0&&tm||r&&y<0&&em||Qo;x.end<=h[0]||x.start>=h[1]||p.push([x,T,v,w])}}return p}};Bs.getScalarData=function(e=Uint8ClampedArray){const n=new e(this.frameSize);return this.map.updateScalarData(n),n};let Yt=Bs,Ni=class Cr{constructor(e={}){this._dimensions=3,this._length=0,this._byteSize=4,this.growSize=128;const{initialSize:n=1024,dimensions:r=3,growSize:i=128}=e,a=n*r;this.growSize=i,this.array=new ArrayBuffer(a*this._byteSize),this.data=new Float32Array(this.array),this._dimensions=r}forEach(e){for(let n=0;n<this._length;n++)e(this.getPoint(n),n)}get length(){return this._length}get dimensions(){return this._dimensions}get dimensionLength(){return this._length*this._dimensions}getPoint(e){if(e<0&&(e+=this._length),e<0||e>=this._length)return;const n=this._dimensions*e;return this.data.subarray(n,n+this._dimensions)}getPointArray(e){const n=[];if(e<0&&(e+=this._length),e<0||e>=this._length)return;const r=this._dimensions*e;for(let i=0;i<this._dimensions;i++)n.push(this.data[i+r]);return n}grow(e=1,n=this.growSize){if(this.dimensionLength+e*this._dimensions<=this.data.length)return;const r=this.data.length+n,i=new ArrayBuffer(r*this._dimensions*this._byteSize),a=new Float32Array(i);a.set(this.data),this.data=a,this.array=i}reverse(){const e=Math.floor(this._length/2);for(let n=0;n<e;n++){const r=n*this._dimensions,i=(this._length-1-n)*this._dimensions;for(let a=0;a<this._dimensions;a++){const s=this.data[r+a];this.data[r+a]=this.data[i+a],this.data[i+a]=s}}}getTypedArray(){return this.data}push(e){this.grow(1);const n=this.length*this._dimensions;for(let r=0;r<this._dimensions;r++)this.data[r+n]=e[r];this._length++}map(e){const n=[];for(let r=0;r<this._length;r++)n.push(e(this.getPoint(r),r));return n}get points(){return this.map(e=>e)}toXYZ(){const e={x:[],y:[]};this._dimensions>=3&&(e.z=[]);const{x:n,y:r,z:i}=e;return this.forEach(a=>{n.push(a[0]),r.push(a[1]),i&&i.push(a[2])}),e}static fromXYZ({x:e,y:n,z:r}){const i=Cr.create3(e.length);let a=0;for(let s=0;s<e.length;s++)i.data[a++]=e[s],i.data[a++]=n[s],i.data[a++]=r?r[s]:0;return i._length=e.length,i}subselect(e=10,n=0){const r=new Cr({initialSize:e,dimensions:this._dimensions});for(let i=0;i<e;i++){const a=(n+Math.floor(this.length*i/e))%this.length;r.push(this.getPoint(a))}return r}static create3(e=128,n){e=Math.max(e,(n==null?void 0:n.length)||0);const r=new Cr({initialSize:e,dimensions:3});return n&&n.forEach(i=>r.push(i)),r}static create2(e=128){return new Cr({initialSize:e,dimensions:2})}};function vu(t){const e=$(),n=t.getDimensions(),r=Ni.create3(n[0]),i=Ni.create3(n[1]),a=Ni.create3(n[2]),s=t.getDirection(),o=s.slice(0,3),c=s.slice(3,6),l=s.slice(6,9),u=t.getSpacing(),[f,g,h]=u,p=t.indexToWorld([0,0,0]),d=xe(o[0]*f,o[1]*f,o[2]*f),m=xe(c[0]*g,c[1]*g,c[2]*g),y=xe(l[0]*h,l[1]*h,l[2]*h),T=$();for(let w=0;w<n[0];w++)r.push(rn(T,p,tn(T,d,w)));for(let w=0;w<n[1];w++)i.push(tn(T,m,w));for(let w=0;w<n[2];w++)a.push(tn(T,y,w));const v=r.getTypedArray(),C=i.getTypedArray(),x=a.getTypedArray();return(w,E=e)=>{const[O,D,S]=w,M=O*3,V=D*3,L=S*3;return E[0]=v[M]+C[V]+x[L],E[1]=v[M+1]+C[V+1]+x[L+1],E[2]=v[M+2]+C[V+2]+x[L+2],E}}function Is(t,e){const{pointInShapeFn:n,callback:r,boundsIJK:i,returnPoints:a=!1}=e;let s;if(t.getScalarData)s=t.getScalarData();else{const f=t.getPointData().getScalars();if(f)s=f.getData();else{const{voxelManager:g}=t.get("voxelManager")||{};g&&(s=g.getCompleteScalarDataArray())}}const o=t.getDimensions(),c=[[0,o[0]],[0,o[1]],[0,o[2]]],u=nm({imageData:t,bounds:i||c,scalarData:s,pointInShapeFn:n,callback:r});return a?u:void 0}function nm({imageData:t,bounds:e,scalarData:n,pointInShapeFn:r,callback:i}){const[[a,s],[o,c],[l,u]]=e,{numComps:f}=t,g=t.getDimensions(),h=vu(t),p=[0,0,0],d=f||n.length/g[2]/g[1]/g[0],m=g[0]*d,y=g[1]*m,T=[];for(let v=l;v<=u;v++){p[2]=v;const C=v*y;for(let x=o;x<=c;x++){p[1]=x;const w=C+x*m;for(let E=a;E<=s;E++){p[0]=E;const O=h(p);if(r(O,p)){const D=w+E*d;let S;d>2?S=[n[D],n[D+1],n[D+2]]:S=n[D],T.push({value:S,index:D,pointIJK:p,pointLPS:O.slice()}),i({value:S,index:D,pointIJK:p,pointLPS:O})}}}}return T}function rm({voxelManager:t,bounds:e,imageData:n,pointInShapeFn:r,callback:i,returnPoints:a}){const[[s,o],[c,l],[u,f]]=e,g=vu(n),h=[0,0,0],p=[];for(let d=u;d<=f;d++){h[2]=d;for(let m=c;m<=l;m++){h[1]=m;for(let y=s;y<=o;y++){h[0]=y;const T=g(h);if(r(T,h)){const v=t.toIndex(h),C=t.getAtIndex(v);a&&p.push({value:C,index:v,pointIJK:[...h],pointLPS:T.slice()}),i==null||i({value:C,index:v,pointIJK:h,pointLPS:T})}}}}return p}const im=5*1024;let nr=class Me{constructor(e,n){this.modifiedSlices=new Set,this.boundsIJK=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]],this.scalarData=null,this._sliceDataCache=null,this.getAtIJK=(r,i,a)=>{const s=this.toIndex([r,i,a]);return this._get(s)},this.setAtIJK=(r,i,a,s)=>{const o=this.toIndex([r,i,a]),c=this._set(o,s);return c!==!1&&(this.modifiedSlices.add(a),Me.addBounds(this.boundsIJK,[r,i,a])),c},this.getAtIJKPoint=([r,i,a])=>this.getAtIJK(r,i,a),this.setAtIJKPoint=([r,i,a],s)=>{this.setAtIJK(r,i,a,s)},this.getAtIndex=r=>this._get(r),this.setAtIndex=(r,i)=>{const a=this._set(r,i);if(a!==!1){const s=this.toIJK(r);this.modifiedSlices.add(s[2]),Me.addBounds(this.boundsIJK,s)}return a},this.getMiddleSliceData=()=>{const r=Math.floor(this.dimensions[2]/2);return this.getSliceData({sliceIndex:r,slicePlane:2})},this.forEach=(r,i={})=>{const a=i.boundsIJK||this.getBoundsIJK(),s=i.isInObject||this.isInObject||(()=>!0),o=i.returnPoints||!1,c=i.imageData,l=Math.min(a[0][0],a[0][1]),u=Math.max(a[0][0],a[0][1]),f=Math.min(a[1][0],a[1][1]),g=Math.max(a[1][0],a[1][1]),h=Math.min(a[2][0],a[2][1]),p=Math.max(a[2][0],a[2][1]),d=[];if(c)return rm({voxelManager:this,imageData:i.imageData,bounds:[[l,u],[f,g],[h,p]],pointInShapeFn:s,callback:r,returnPoints:o});if(this.map){if(this.map instanceof Yt)return this.rleForEach(r,i);for(const m of this.map.keys()){const y=this.toIJK(m);if(!s(null,y))continue;const T=this._get(m);o&&d.push({value:T,index:m,pointIJK:y,pointLPS:null}),r({value:T,index:m,pointIJK:y,pointLPS:null})}return d}else{for(let m=h;m<=p;m++){const y=m*this.frameSize;for(let T=f;T<=g;T++){const v=y+T*this.width;for(let C=l,x=v+C;C<=u;C++,x++){const w=this.getAtIndex(x),E=[C,T,m];s(null,E)&&(o&&d.push({value:w,index:x,pointIJK:E,pointLPS:null}),r({value:w,index:x,pointIJK:[C,T,m],pointLPS:null}))}}}return d}},this.getSliceData=({sliceIndex:r,slicePlane:i})=>{const[a,s,o]=this.dimensions,c=a*s,l=r*c;let u;const f=this.getConstructor();function g(p){return typeof p=="function"}if(!g(f))return new Uint8Array(0);let h;switch(i){case 0:u=s*o,h=new f(u);for(let p=0;p<s;p++)for(let d=0;d<o;d++){const m=r+p*a+d*c;this.setSliceDataValue(h,p*o+d,this._get(m))}break;case 1:u=a*o,h=new f(u);for(let p=0;p<a;p++)for(let d=0;d<o;d++){const m=p+r*a+d*c;this.setSliceDataValue(h,p+d*a,this._get(m))}break;case 2:u=a*s,h=new f(u);for(let p=0;p<u;p++)this.setSliceDataValue(h,p,this._get(l+p));break;default:throw new Error("Oblique plane - todo - implement as ortho normal vector")}return h},this.dimensions=e,this.width=e[0],this.frameSize=this.width*e[1],this._get=n._get,this._set=n._set,this._id=n._id||"",this._getConstructor=n._getConstructor,this.numberOfComponents=this.numberOfComponents||1,this.scalarData=n.scalarData,this._getScalarData=n._getScalarData,this._updateScalarData=n._updateScalarData}getMinMax(){let e,n;const r=({value:i})=>{const a=Array.isArray(i);if(e===void 0&&(e=a?[...i]:i,n=a?[...i]:i),a)for(let s=0;s<i.length;s++)e[s]=Math.min(e[s],i[s]),n[s]=Math.max(n[s],i[s]);else e=Math.min(e,i),n=Math.max(n,i)};return this.forEach(r,{boundsIJK:this.getDefaultBounds()}),{min:e,max:n}}toIJK(e){return[e%this.width,Math.floor(e%this.frameSize/this.width),Math.floor(e/this.frameSize)]}toIndex(e){return e[0]+e[1]*this.width+e[2]*this.frameSize}getDefaultBounds(){return this.dimensions.map(e=>[0,e-1])}getBoundsIJK(){return this.boundsIJK[0][0]<this.dimensions[0]?this.boundsIJK:this.getDefaultBounds()}rleForEach(e,n){const r=(n==null?void 0:n.boundsIJK)||this.getBoundsIJK(),{isWithinObject:i}=n||{},a=this.map;a.defaultValue=void 0;for(let s=r[2][0];s<=r[2][1];s++)for(let o=r[1][0];o<=r[1][1];o++){const c=a.getRun(o,s);if(c)for(const l of c){const{start:u,end:f,value:g}=l,h=this.toIndex([0,o,s]);for(let p=u;p<f;p++){const d={value:g,index:h+p,pointIJK:[p,o,s]};(i==null?void 0:i(d))!==!1&&e(d)}}}}getScalarData(e=!1){var n;if(this.scalarData)return(n=this._updateScalarData)==null||n.call(this,this.scalarData),this.scalarData;if(this._getScalarData){const r=this._getScalarData();return e&&console.log("Not transient, should store value",r),r}throw new Error("No scalar data available")}setScalarData(e){this.scalarData=e}getScalarDataLength(){if(this.scalarData)return this.scalarData.length;if(this._getScalarDataLength)return this._getScalarDataLength();throw new Error("No scalar data available")}get sizeInBytes(){return this.getScalarDataLength()*this.bytePerVoxel}get bytePerVoxel(){return this.scalarData?this.scalarData.BYTES_PER_ELEMENT:this._get(0).BYTES_PER_ELEMENT}clear(){var e,n;(e=this.map)==null||e.clear(),this.boundsIJK.map(r=>{r[0]=1/0,r[1]=-1/0}),this.modifiedSlices.clear(),(n=this.points)==null||n.clear()}getConstructor(){return this.scalarData?this.scalarData.constructor:this._getConstructor?this._getConstructor():(console.warn("No scalar data available or can be used to get the constructor"),Float32Array)}getArrayOfModifiedSlices(){return Array.from(this.modifiedSlices)}resetModifiedSlices(){this.modifiedSlices.clear()}static addBounds(e,n){e||(e=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),e[0][0]=Math.min(n[0],e[0][0]),e[0][1]=Math.max(n[0],e[0][1]),e[1][0]=Math.min(n[1],e[1][0]),e[1][1]=Math.max(n[1],e[1][1]),e[2][0]=Math.min(n[2],e[2][0]),e[2][1]=Math.max(n[2],e[2][1])}addPoint(e){const n=Array.isArray(e)?e[0]+this.width*e[1]+this.frameSize*e[2]:e;this.points||(this.points=new Set),this.points.add(n)}getPoints(){return this.points?[...this.points].map(e=>this.toIJK(e)):[]}setSliceDataValue(e,n,r){if(Array.isArray(r))for(let i=0;i<r.length;i++)e[n*r.length+i]=this.toNumber(r[i]);else e[n]=this.toNumber(r)}toNumber(e){return typeof e=="number"?e:Array.isArray(e)&&e[0]||0}static _createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r=3}){const i=new Me(e,{_get:a=>(a*=r,[n[a++],n[a++],n[a++]]),_id:"_createRGBScalarVolumeVoxelManager",_set:(a,s)=>{a*=3;const o=!Ne(n[a],s);return n[a++]=s[0],n[a++]=s[1],n[a++]=s[2],o},numberOfComponents:r,scalarData:n});return i.clear=()=>{n.fill(0)},i}static createImageVolumeVoxelManager({dimensions:e,imageIds:n,numberOfComponents:r=1}){const i=e[0]*e[1];function a(u){const f=Math.floor(u/i);if(f<0||f>=e[2])return{};const g=n[f];if(!g)return console.warn(`ImageId not found for sliceIndex: ${f}`),{pixelData:null,pixelIndex:null};const h=q.getImage(g);if(!h)return console.warn(`Image not found for imageId: ${g}`),{pixelData:null,pixelIndex:null};const p=h.voxelManager,d=u%i;return{voxelManager:p,pixelIndex:d}}function s(u){const{voxelManager:f,pixelIndex:g}=a(u);return!f||g===null?null:f.getAtIndex(g)}function o(u,f){const{voxelManager:g,pixelIndex:h}=a(u);if(!g||h===null)return!1;const p=g.getAtIndex(h),d=!Ne(f,p);return d&&(g.setAtIndex(h,f),!0)}const c=()=>{const{voxelManager:u,pixelIndex:f}=a(0);return!u||f===null?null:u.getConstructor()},l=new Me(e,{_get:s,_set:o,numberOfComponents:r,_getConstructor:c,_id:"createImageVolumeVoxelManager"});return l.getMiddleSliceData=()=>{const u=Math.floor(e[2]/2);return l.getSliceData({sliceIndex:u,slicePlane:2})},l.clear=()=>{for(const u of n)q.getImage(u).voxelManager.clear()},l.getRange=()=>{let u=1/0,f=-1/0;for(const g of n){const h=q.getImage(g);h&&(h.minPixelValue<u&&(u=h.minPixelValue),h.maxPixelValue>f&&(f=h.maxPixelValue))}return u===1/0&&f===-1/0?[0,0]:[u,f]},l._getScalarDataLength=()=>{const{voxelManager:u,pixelIndex:f}=a(0);return!u||f===null?0:u.getScalarDataLength()*e[2]},l.getCompleteScalarDataArray=()=>{const u=l._getConstructor();if(!u)return new Uint8Array(0);const f=l.getScalarDataLength(),g=new u(f),h=e[0]*e[1]*r;for(let p=0;p<e[2];p++){const{voxelManager:d,pixelIndex:m}=a(p*h/r);if(d&&m!==null){const y=p*h,T=d.getScalarData();if(r===1)g.set(T,y);else for(let v=0;v<T.length;v+=r)for(let C=0;C<r;C++)g[y+v+C]=T[v+C]}}return g},l.setCompleteScalarDataArray=u=>{const f=e[0]*e[1]*r,g=l._getConstructor();let h=1/0,p=-1/0;for(let d=0;d<e[2];d++){const{voxelManager:m}=a(d*f/r);if(m&&g){const y=d*f,T=y+f,v=new g(f);if(v.set(u.subarray(y,T)),m.scalarData)m.scalarData.set(v),m.modifiedSlices.add(d);else for(let w=0;w<f;w++)m.setAtIndex(w,v[w]);for(let w=0;w<v.length;w++){const E=v[w];h=Math.min(h,E),p=Math.max(p,E)}const C=n[d],x=q.getImage(C);x&&(x.minPixelValue=h,x.maxPixelValue=p)}}for(let d=0;d<e[2];d++)l.modifiedSlices.add(d);l.boundsIJK=[[0,e[0]-1],[0,e[1]-1],[0,e[2]-1]]},l}static createScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r}){if(e.length!==3)throw new Error("Dimensions must be provided as [number, number, number] for [width, height, depth]");if(!r&&(r=n.length/e[0]/e[1]/e[2],r>4||r<1||r===2))throw new Error(`Number of components ${r} must be 1, 3 or 4`);return r>1?Me._createRGBScalarVolumeVoxelManager({dimensions:e,scalarData:n,numberOfComponents:r}):Me._createNumberVolumeVoxelManager({dimensions:e,scalarData:n})}static createScalarDynamicVolumeVoxelManager({imageIdGroups:e,dimensions:n,dimensionGroupNumber:r=1,timePoint:i=0,numberOfComponents:a=1}){let s=0;if(r!==void 0?s=r-1:i!==void 0&&(console.warn("Warning: timePoint parameter is deprecated. Please use dimensionGroupNumber instead. timePoint is zero-based while dimensionGroupNumber starts at 1."),s=i),!a){const l=q.getImage(e[0][0]);if(!l)throw new Error("Unable to determine number of components: No image found");if(a=l.getPixelData().length/(n[0]*n[1]),a>4||a<1||a===2)throw new Error(`Number of components ${a} must be 1, 3 or 4`)}const o=e.map(l=>Me.createImageVolumeVoxelManager({dimensions:n,imageIds:l,numberOfComponents:a})),c=new Me(n,{_get:l=>o[s]._get(l),_set:(l,u)=>o[s]._set(l,u),numberOfComponents:a,_id:"createScalarDynamicVolumeVoxelManager"});return c.getScalarDataLength=()=>o[s].getScalarDataLength(),c.getConstructor=()=>o[s].getConstructor(),c.getRange=()=>o[s].getRange(),c.getMiddleSliceData=()=>o[s].getMiddleSliceData(),c.setTimePoint=l=>{console.warn("Warning: setTimePoint is deprecated. Please use setDimensionGroupNumber instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),c.setDimensionGroupNumber(l+1)},c.setDimensionGroupNumber=l=>{s=l-1,c._get=u=>o[s]._get(u),c._set=(u,f)=>o[s]._set(u,f)},c.getAtIndexAndTimePoint=(l,u)=>(console.warn("Warning: getAtIndexAndTimePoint is deprecated. Please use getAtIndexAndDimensionGroup instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),c.getAtIndexAndDimensionGroup(l,u+1)),c.getAtIndexAndDimensionGroup=(l,u)=>o[u-1]._get(l),c.getTimePointScalarData=l=>(console.warn("Warning: getTimePointScalarData is deprecated. Please use getDimensionGroupScalarData instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),c.getDimensionGroupScalarData(l+1)),c.getDimensionGroupScalarData=l=>o[l-1].getCompleteScalarDataArray(),c.getCurrentTimePointScalarData=()=>(console.warn("Warning: getCurrentTimePointScalarData is deprecated. Please use getCurrentDimensionGroupScalarData instead."),c.getCurrentDimensionGroupScalarData()),c.getCurrentDimensionGroupScalarData=()=>o[s].getCompleteScalarDataArray(),c.getCurrentTimePoint=()=>(console.warn("Warning: getCurrentTimePoint is deprecated. Please use getCurrentDimensionGroupNumber instead. Note that timePoint is zero-based while dimensionGroupNumber starts at 1."),s),c.getCurrentDimensionGroupNumber=()=>s+1,c}static createImageVoxelManager({width:e,height:n,scalarData:r,numberOfComponents:i=1}){const a=[e,n,1];if(!i&&(i=r.length/e/n,i>4||i<1||i===2))throw new Error(`Number of components ${i} must be 1, 3 or 4`);return i>1?Me._createRGBScalarVolumeVoxelManager({dimensions:a,scalarData:r,numberOfComponents:i}):Me._createNumberVolumeVoxelManager({dimensions:a,scalarData:r})}static _createNumberVolumeVoxelManager({dimensions:e,scalarData:n}){const r=new Me(e,{_get:i=>n[i],_set:(i,a)=>{const s=n[i]!==a;return n[i]=a,s},_getConstructor:()=>n.constructor,_id:"_createNumberVolumeVoxelManager"});return r.scalarData=n,r.clear=()=>{r.scalarData.fill(0)},r.getMiddleSliceData=()=>{const i=Math.floor(e[2]/2);return r.getSliceData({sliceIndex:i,slicePlane:2})},r}static createMapVoxelManager({dimension:e}){const n=new Map,r=new Me(e,{_get:n.get.bind(n),_set:(i,a)=>n.set(i,a)&&!0,_id:"createMapVoxelManager"});return r.map=n,r}static createHistoryVoxelManager({sourceVoxelManager:e}){const n=new Map,{dimensions:r}=e,i=new Me(r,{_get:a=>n.get(a),_set:function(a,s){if(n.has(a))s===n.get(a)&&n.delete(a);else{const o=this.sourceVoxelManager.getAtIndex(a);if(o===s)return!1;n.set(a,o)}this.sourceVoxelManager.setAtIndex(a,s)},_id:"createHistoryVoxelManager"});return i.map=n,i.scalarData=e.scalarData,i.sourceVoxelManager=e,i}static createRLEHistoryVoxelManager(e){const{dimensions:n}=e,r=new Yt(n[0],n[1],n[2]),i=new Me(n,{_get:a=>r.get(a),_set:function(a,s){const o=r.get(a);if(o===void 0){const c=this.sourceVoxelManager.getAtIndex(a);if(c===s||c===void 0&&s===0||s===null)return!1;r.set(a,c??0)}else(s===o||s===null)&&(r.delete(a),s=o);this.sourceVoxelManager.setAtIndex(a,s)},_getScalarData:Yt.getScalarData,_updateScalarData:a=>(r.updateScalarData(a),a),_id:"createRLEHistoryVoxelManager"});return i.map=r,i.sourceVoxelManager=e,i}static createLazyVoxelManager({dimensions:e,planeFactory:n}){const r=new Map,[i,a]=e,s=i*a,o=new Me(e,{_get:c=>r.get(Math.floor(c/s))[c%s],_set:(c,l)=>{const u=Math.floor(c/s);let f=r.get(u);return f||(f=n(i,a),r.set(u,f)),f[c%s]=l,!0},_id:"createLazyVoxelManager"});return o.map=r,o}static createRLEVolumeVoxelManager({dimensions:e}){const[n,r,i]=e,a=new Yt(n,r,i),s=new Me(e,{_get:o=>a.get(o),_set:(o,c)=>(a.set(o,c),!0),_getScalarData:Yt.getScalarData,_updateScalarData:o=>(a.updateScalarData(o),o),_id:"createRLEVolumeVoxelManager"});return s.map=a,s.getPixelData=a.getPixelData.bind(a),s}static createRLEImageVoxelManager({dimensions:e}){const[n,r]=e;return Me.createRLEVolumeVoxelManager({dimensions:[n,r,1]})}static addInstanceToImage(e){const{width:n,height:r}=e,i=e.voxelManager.getScalarData();if(i.length>=n*r){e.voxelManager=Me.createScalarVolumeVoxelManager({dimensions:[n,r,1],scalarData:i});return}e.voxelManager=Me.createRLEVolumeVoxelManager({dimensions:[n,r,1]}),e.getPixelData=e.voxelManager.getPixelData,e.sizeInBytes=im}};class Ls{constructor(e){this._imageIdsIndexMap=new Map,this._imageURIsIndexMap=new Map,this.cornerstoneImageMetaData=null,this.isPreScaled=!1,this.numTimePoints=null,this.numFrames=null;const{imageIds:n,scaling:r,dimensions:i,spacing:a,origin:s,direction:o,dataType:c,volumeId:l,referencedVolumeId:u,metadata:f,referencedImageIds:g,additionalDetails:h,voxelManager:p,numberOfComponents:d}=e;if(!c)throw new Error('Data type is required, please provide a data type as string such as "Uint8Array", "Float32Array", etc.');let{imageData:m}=e;this.imageIds=n,this.volumeId=l,this.metadata=f,this.dimensions=i,this.spacing=a,this.origin=s,this.direction=o,this.dataType=c,this.vtkOpenGLTexture=Bp.newInstance(),this.vtkOpenGLTexture.setVolumeId(l),this.voxelManager=p??nr.createImageVolumeVoxelManager({dimensions:i,imageIds:n,numberOfComponents:d}),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],m||(m=rl.newInstance(),m.setDimensions(i),m.setSpacing(a),m.setDirection(o),m.setOrigin(s)),m.set({dataType:c,voxelManager:this.voxelManager,id:l,numberOfComponents:d||1}),m.set({hasScalarVolume:!1}),this.imageData=m,this.numFrames=this._getNumFrames(),this._reprocessImageIds(),r&&(this.scaling=r),u&&(this.referencedVolumeId=u),g&&(this.referencedImageIds=g),h&&(this.additionalDetails=h)}get sizeInBytes(){return this.voxelManager.sizeInBytes}get imageIds(){return this._imageIds}set imageIds(e){this._imageIds=e,this._reprocessImageIds()}_reprocessImageIds(){this._imageIdsIndexMap.clear(),this._imageURIsIndexMap.clear(),this._imageIds.forEach((e,n)=>{const r=ot(e);this._imageIdsIndexMap.set(e,n),this._imageURIsIndexMap.set(r,n)})}isDynamicVolume(){return this.numTimePoints>1}getImageIdIndex(e){return this._imageIdsIndexMap.get(e)}getImageIdByIndex(e){return this._imageIds[e]}getImageURIIndex(e){return this._imageURIsIndexMap.get(e)}load(e){}destroy(){this.imageData.delete(),this.imageData=null,this.voxelManager.clear(),this.vtkOpenGLTexture.releaseGraphicsResources(),this.vtkOpenGLTexture.delete()}invalidate(){for(let e=0;e<this.imageIds.length;e++)this.vtkOpenGLTexture.setUpdatedFrame(e);this.imageData.modified()}modified(){this.imageData.modified(),this.vtkOpenGLTexture.modified(),this.numFrames=this._getNumFrames()}removeFromCache(){q.removeVolumeLoadObject(this.volumeId)}getScalarDataLength(){return this.voxelManager.getScalarDataLength()}_getNumFrames(){return this.isDynamicVolume()?this.numTimePoints:this.imageIds.length}imageIdIndexToFrameIndex(e){return e%this.numFrames}getCornerstoneImages(){const{imageIds:e}=this;return e.map(n=>q.getImage(n))}}let fr={};const La={add:(t,e)=>{La.addRaw(t,{...e,metadata:structuredClone(e.metadata)})},addRaw:(t,e)=>{const n=e.type;fr[t]||(fr[t]={}),fr[t][n]=e.metadata},get:(t,e)=>{var n;return(n=fr[e])==null?void 0:n[t]},clear:()=>{fr={}}};Ss(La.get);const Mt=new w8("imageLoadPool");Mt.grabDelay=0;Mt.setMaxSimultaneousRequests(Q.Interaction,1e3);Mt.setMaxSimultaneousRequests(Q.Thumbnail,1e3);Mt.setMaxSimultaneousRequests(Q.Prefetch,1e3);const am={};let sm;function Tu(t,e){const n=q.getImageLoadObject(t);if(n)return tc(n.promise,t),n;const r=t.split(":")[0],i=am[r]||sm;if(!i)throw new Error(`loadImageFromImageLoader: No image loader found for scheme '${r}'`);const a=i(t,e);return tc(a.promise,t),a}function tc(t,e){Promise.resolve(t).then(n=>{om(n),H(ae,A.IMAGE_LOADED,{image:n})}).catch(n=>{const r={imageId:e,error:n};H(ae,A.IMAGE_LOAD_FAILED,r)})}function om(t){if(!t.voxelManager){const{width:e,height:n,numberOfComponents:r}=t,i=nr.createImageVoxelManager({scalarData:t.getPixelData(),width:e,height:n,numberOfComponents:r});t.voxelManager=i,t.getPixelData=()=>i.getScalarData(),delete t.imageFrame.pixelData}}function cm(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadImage: parameter imageId must not be undefined");return Tu(t,e).promise}function rr(t,e={priority:0,requestType:"prefetch"}){if(t===void 0)throw new Error("loadAndCacheImage: parameter imageId must not be undefined");const n=Tu(t,e);return q.getImageLoadObject(t)||q.putImageLoadObject(t,n),n.promise}function lm(t,e){const{scalarData:n,origin:r,direction:i,targetBuffer:a,skipCreateBuffer:s,onCacheAdd:o,frameOfReferenceUID:c,voxelRepresentation:l}=e,u=e.dimensions,f=e.spacing;if(!u||!f)throw new Error("createAndCacheLocalImage: dimensions and spacing are required");const g=u[0],h=u[1],p=f[0],d=f[1],m={frameOfReferenceUID:c,rows:h,columns:g,imageOrientationPatient:i??[1,0,0,0,1,0],rowCosines:i?i.slice(0,3):[1,0,0],columnCosines:i?i.slice(3,6):[0,1,0],imagePositionPatient:r??[0,0,0],pixelSpacing:[d,p],rowPixelSpacing:d,columnPixelSpacing:p},y=g*h,T=n.length/y;let v;if(n){if(!(n instanceof Uint8Array||n instanceof Float32Array||n instanceof Uint16Array||n instanceof Int16Array))throw new Error("createAndCacheLocalImage: scalarData must be of type Uint8Array, Uint16Array, Int16Array or Float32Array");v=n}else if(!s){const{TypedArrayConstructor:L}=dl(a==null?void 0:a.type,y);v=new L(y)}let C,x,w;if(v instanceof Uint8Array)C=8,x=8,w=7;else if(v instanceof Uint16Array)C=16,x=16,w=15;else if(v instanceof Int16Array)C=16,x=16,w=15;else if(v instanceof Float32Array)C=32,x=32,w=31;else throw new Error("Unsupported scalarData type");const E={samplesPerPixel:1,photometricInterpretation:v.length>u[0]*u[1]?"RGB":"MONOCHROME2",rows:h,columns:g,bitsAllocated:C,bitsStored:x,highBit:w},O={imagePlaneModule:m,imagePixelModule:E};["imagePlaneModule","imagePixelModule"].forEach(L=>{La.add(t,{type:L,metadata:O[L]||{}})});const D=l===n0.RLE&&nr.createRLEImageVoxelManager({dimensions:u})||nr.createImageVoxelManager({height:h,width:g,numberOfComponents:T,scalarData:v});let S=v[0],M=v[0];for(let L=1;L<v.length;L++)v[L]<S&&(S=v[L]),v[L]>M&&(M=v[L]);const V={imageId:t,intercept:0,windowCenter:0,windowWidth:0,color:E.photometricInterpretation==="RGB",numberOfComponents:E.samplesPerPixel,dataType:a==null?void 0:a.type,slope:1,minPixelValue:S,maxPixelValue:M,rows:E.rows,columns:E.columns,getCanvas:void 0,height:E.rows,width:E.columns,rgba:void 0,columnPixelSpacing:m.columnPixelSpacing,rowPixelSpacing:m.rowPixelSpacing,FrameOfReferenceUID:m.frameOfReferenceUID,invert:!1,getPixelData:()=>D.getScalarData(),voxelManager:D,sizeInBytes:n.byteLength};return o==null||o(V),q.putImageSync(V.imageId,V),V}function Cu(t){const e=t[0],{pixelRepresentation:n,bitsAllocated:r,bitsStored:i,highBit:a,photometricInterpretation:s,samplesPerPixel:o}=j("imagePixelModule",e),c=[],l=j("voiLutModule",e);let u;if(l){const{windowWidth:T,windowCenter:v}=l;if(u=l==null?void 0:l.voiLUTFunction,Array.isArray(T))for(let C=0;C<T.length;C++)c.push({windowWidth:T[C],windowCenter:v[C]});else c.push({windowWidth:T,windowCenter:v})}else c.push({windowWidth:void 0,windowCenter:void 0});const{modality:f,seriesInstanceUID:g}=j("generalSeriesModule",e),{imageOrientationPatient:h,pixelSpacing:p,frameOfReferenceUID:d,columns:m,rows:y}=j("imagePlaneModule",e);return{BitsAllocated:r,BitsStored:i,SamplesPerPixel:o,HighBit:a,PhotometricInterpretation:s,PixelRepresentation:n,Modality:f,ImageOrientationPatient:h,PixelSpacing:p,FrameOfReferenceUID:d,Columns:m,Rows:y,voiLut:c,VOILUTFunction:u,SeriesInstanceUID:g}}function xu(t){const{imagePositionPatient:e,imageOrientationPatient:n}=j("imagePlaneModule",t[0]),r=xe(n[0],n[1],n[2]),i=xe(n[3],n[4],n[5]),a=$();ve(a,r,i);const s=xe(e[0],e[1],e[2]),o=t[0].split(":")[0]==="wadouri";let c;function l(h){const{imagePositionPatient:p}=j("imagePlaneModule",h),d=$(),m=xe(p[0],p[1],p[2]);return $e(d,s,m),fe(d,a)}if(o){const h=[t[0],t[Math.floor(t.length/2)]];l(h[0]),l(h[1]);const p=j("imagePlaneModule",h[1]);if(!p)throw new Error("Incomplete metadata required for volume construction.");const d=$(),m=xe(p.imagePositionPatient[0],p.imagePositionPatient[1],p.imagePositionPatient[2]);$e(d,s,m);const y=fe(d,a);c=Math.abs(y)/Math.floor(t.length/2)}else{const h=t.map(d=>({distance:l(d),imageId:d}));h.sort((d,m)=>m.distance-d.distance);const p=h.length;c=Math.abs(h[p-1].distance-h[0].distance)/(p-1)}const{sliceThickness:u,spacingBetweenSlices:f}=j("imagePlaneModule",t[0]),{strictZSpacingForVolumeViewport:g}=xs().rendering;return c===0&&!g&&(f?(console.debug("Could not calculate spacing. Using spacingBetweenSlices"),c=f):u?(console.debug("Could not calculate spacing and no spacingBetweenSlices. Using sliceThickness"),c=u):(console.debug("Could not calculate spacing. The VolumeViewport visualization is compromised. Setting spacing to 1 to render"),c=1)),c}function wu(t,e){const{imagePositionPatient:n,imageOrientationPatient:r}=j("imagePlaneModule",t[0]);if(!e){const u=xe(r[0],r[1],r[2]),f=xe(r[3],r[4],r[5]);e=$(),ve(e,u,f)}const i=t[0].split(":")[0]==="wadouri",a=xu(t);let s;function o(u){const{imagePositionPatient:f}=j("imagePlaneModule",u),g=$();return $e(g,n,f),fe(g,e)}if(i){const u=[t[0],t[Math.floor(t.length/2)]];s=t;const f=o(u[0]),g=o(u[1]);f-g<0&&s.reverse()}else{const u=t.map(f=>({distance:o(f),imageId:f}));u.sort((f,g)=>g.distance-f.distance),s=u.map(f=>f.imageId)}const{imagePositionPatient:c}=j("imagePlaneModule",s[0]);return{zSpacing:a,origin:c,sortedImageIds:s}}function Su(t){const e=j("modalityLutModule",t)||{},n=j("generalSeriesModule",t)||{},{modality:r}=n,i={rescaleSlope:e.rescaleSlope||1,rescaleIntercept:e.rescaleIntercept??0,modality:r},a=j("scalingModule",t)||{};return{...i,...r==="PT"&&{suvbw:a.suvbw,suvbsa:a.suvbsa,suvlbm:a.suvlbm}}}const Ns=t=>Object.values(t).some(n=>typeof n=="number"&&!Number.isInteger(n)),nc={Uint8Array:"Uint8Array",Int16Array:"Int16Array",Uint16Array:"Uint16Array",Float32Array:"Float32Array"};function Ru(t,e){const n=Cu(t),{ImageOrientationPatient:r,PixelSpacing:i,Columns:a,Rows:s}=n,o=xe(r[0],r[1],r[2]),c=xe(r[3],r[4],r[5]),l=$();ve(l,o,c);const{zSpacing:u,origin:f,sortedImageIds:g}=wu(t,l),h=t.length,p=[i[1],i[0],u],d=[a,s,h].map(y=>Math.floor(y)),m=[...o,...c,...l];return{dimensions:d,spacing:p,origin:f,dataType:um(g,n),direction:m,metadata:n,imageIds:g,volumeId:e,voxelManager:null,numberOfComponents:n.PhotometricInterpretation==="RGB"?3:1}}function um(t,e){const{BitsAllocated:n,PixelRepresentation:r}=e,i=r===1,a=fm(t);if(a)return a;const[s,o,c]=[0,Math.floor(t.length/2),t.length-1],l=[s,o,c].map(h=>Su(t[h])),u=l.some(h=>h.rescaleIntercept<0||h.rescaleSlope<0),f=l.some(h=>Ns(h)),g=ml();switch(n){case 8:return"Uint8Array";case 16:return g&&f?"Float32Array":i||u?"Int16Array":!i&&!u?"Uint16Array":"Float32Array";case 24:return"Uint8Array";case 32:return"Float32Array";default:throw new Error(`Bits allocated of ${n} is not defined to generate scalarData for the volume.`)}}function fm(t){const n=[0,Math.floor(t.length/2),t.length-1].map(i=>q.getImage(t[i]));if(!n.every(Boolean))return null;const r=n[0].getPixelData().constructor.name;return n.every(i=>i.getPixelData().constructor.name===r)&&r in nc?nc[r]:null}class ir{constructor(e){this.name=e||"unknown"}static as(e){if(e.iterator)return e.iterator;const n=new ir("as iterator");return e.then(r=>{try{n.add(r,!0)}catch(i){n.reject(i)}},r=>{n.reject(r)}),n}add(e,n=!1){this.nextValue=e,this.done||(this.done=n),this.waiting&&(this.waiting.resolve(e),this.waiting=void 0)}resolve(){this.done=!0,this.waiting&&(this.waiting.resolve(this.nextValue),this.waiting=void 0)}reject(e){var n;this.rejectReason=e,(n=this.waiting)==null||n.reject(e)}getRecent(){if(this.rejectReason)throw this.rejectReason;return this.nextValue}async*[Symbol.asyncIterator](){for(;!this.done;){if(this.rejectReason)throw this.rejectReason;if(this.nextValue!==void 0&&(yield this.nextValue,this.done))break;this.waiting||(this.waiting={},this.waiting.promise=new Promise((e,n)=>{this.waiting.resolve=e,this.waiting.reject=n})),await this.waiting.promise}yield this.nextValue}async forEach(e,n){let r=0;try{for await(const i of this){const{done:a}=this;try{await e(i,a,r),r++}catch(s){if(!a){console.warn("Caught exception in intermediate value",s);continue}if(n)n(s,a);else throw s}}}catch(i){if(n)n(i,!0);else throw i}}generate(e,n){return e(this,this.reject.bind(this)).then(()=>{this.done||this.resolve()},r=>{this.reject(r),n?n(r):console.warn("Couldn't process because",r)})}async nextPromise(){for await(const e of this)if(e)return e;return this.nextValue}async donePromise(){for await(const e of this);return this.nextValue}getNextPromise(){const e=this.nextPromise();return e.iterator=this,e}getDonePromise(){const e=this.donePromise();return e.iterator=this,e}}const _n=new Map,rc="imageRetrieveConfiguration",Ar={IMAGE_RETRIEVE_CONFIGURATION:rc,clear:()=>{_n.clear()},add:(t,e)=>{_n.set(t,e)},clone:()=>new Map(_n),restore:t=>{_n.clear(),t.forEach((e,n)=>{_n.set(n,e)})},get:(t,...e)=>{if(t===rc)return e.map(n=>_n.get(n)).find(n=>n!==void 0)}};Ss(Ar.get.bind(Ar));function Eu(t){const e=Ma(),n=[];return e.forEach(r=>{const a=r.getVolumeViewports().filter(s=>s.hasVolumeId(t));n.push(...a)}),n}const M0=t=>{const e=gm(t);e!=null&&e.length&&e.forEach(({renderingEngine:n,viewportIds:r})=>{n.hasBeenDestroyed||n.renderViewports(r)})};function gm(t){const e=Ma(),n=[];return e.forEach(r=>{const i=Eu(t);i.length&&n.push({renderingEngine:r,viewportIds:i.map(a=>a.id)})}),n}const ic=[{id:"initialImages",retrieveType:"single"}],hm=[{id:"lossySequential",retrieveType:"singleFast"},{id:"finalSequential",retrieveType:"singleFinal"}],Ja=[{offset:-1,imageQualityStatus:st.ADJACENT_REPLICATE},{offset:1,imageQualityStatus:st.ADJACENT_REPLICATE},{offset:2,imageQualityStatus:st.FAR_REPLICATE}],pm=[{id:"initialImages",positions:[.5,0,-1],retrieveType:"default",requestType:Q.Thumbnail,priority:5,nearbyFrames:Ja},{id:"quarterThumb",decimate:4,offset:3,requestType:Q.Thumbnail,retrieveType:"multipleFast",priority:6,nearbyFrames:Ja},{id:"halfThumb",decimate:4,offset:1,priority:7,requestType:Q.Thumbnail,retrieveType:"multipleFast",nearbyFrames:Ja},{id:"quarterFull",decimate:4,offset:2,priority:8,requestType:Q.Thumbnail,retrieveType:"multipleFinal"},{id:"halfFull",decimate:4,offset:0,priority:9,requestType:Q.Thumbnail,retrieveType:"multipleFinal"},{id:"threeQuarterFull",decimate:4,offset:1,priority:10,requestType:Q.Thumbnail,retrieveType:"multipleFinal"},{id:"finalFull",decimate:4,offset:3,priority:11,requestType:Q.Thumbnail,retrieveType:"multipleFinal"},{id:"errorRetrieve"}];function Mu(t,e,n=0){const r=[];for(let i=n;i<t.length;i+=e)r.push(i);return r}function dm(t,e,n){var r;if((r=e==null?void 0:e.nearbyRequests)!=null&&r.length)for(const i of e.nearbyRequests)try{const{itemId:a,imageQualityStatus:s}=i,o=q.getImageQuality(a);if(o!==void 0&&o>=s)continue;const c={...n,imageId:a,imageQualityStatus:s};q.setPartialImage(a,c),t.successCallback(a,c)}catch(a){console.warn("Couldn't fill nearby item ",i.itemId,a)}}const $n=class $n{constructor(e){this.stages=e.stages||ic,this.retrieveOptions=e.retrieveOptions||{}}loadImages(e,n){return new mm(this,e,n).loadImages()}};$n.createProgressive=Ou,$n.interleavedRetrieveStages={stages:pm},$n.singleRetrieveStages={stages:ic},$n.sequentialRetrieveStages={stages:hm};let sa=$n;class mm{constructor(e,n,r){this.outstandingRequests=0,this.stageStatusMap=new Map,this.displayedIterator=new ir("displayed"),this.stages=e.stages,this.retrieveOptions=e.retrieveOptions,this.imageIds=n,this.listener=r}async loadImages(){const e=this.createStageRequests();this.outstandingRequests=e.length;for(const n of e)this.addRequest(n);return this.outstandingRequests===0?Promise.resolve(null):this.displayedIterator.getDonePromise()}sendRequest(e,n){const{imageId:r,next:i}=e,a=(u,f)=>{this.listener.errorCallback(r,c||!i,u),f&&this.updateStageStatus(e.stage,u)},s=(n.loader||rr)(r,n),o=ir.as(s);let c=!1;return o.forEach(async(u,f)=>{const g=q.getImageQuality(r);if(!u){console.warn("No image retrieved",r);return}const{imageQualityStatus:h}=u;if(c||(c=h===st.FULL_RESOLUTION),g!==void 0&&g>h){this.updateStageStatus(e.stage,null,!0);return}this.listener.successCallback(r,u),this.displayedIterator.add(u),f&&this.updateStageStatus(e.stage),dm(this.listener,e,u)},a).finally(()=>{if(!c&&i)q.setPartialImage(r),this.addRequest(i,n.streamingData);else{c||this.listener.errorCallback(r,!0,"Couldn't decode"),this.outstandingRequests--;for(let u=i;u;u=u.next)this.updateStageStatus(u.stage,null,!0)}this.outstandingRequests<=0&&this.displayedIterator.resolve()}),o.getDonePromise().catch(u=>null)}addRequest(e,n={}){const{imageId:r,stage:i}=e,a=this.listener.getLoaderImageOptions(r);if(!a)return;const{retrieveType:s="default"}=i,{retrieveOptions:o}=this,c=o[s]||o.default,l={...a,retrieveType:s,retrieveOptions:c,streamingData:n},u=i.priority??-5,f=i.requestType||Q.Interaction,g={imageId:r};Mt.addRequest(this.sendRequest.bind(this,e,l),f,g,u)}updateStageStatus(e,n,r=!1){const{id:i}=e,a=this.stageStatusMap.get(i);if(a&&(a.imageLoadPendingCount--,n?a.imageLoadFailedCount++:r||a.totalImageCount++,!r&&!a.stageStartTime&&(a.stageStartTime=Date.now()),!a.imageLoadPendingCount)){const{imageLoadFailedCount:s,totalImageCount:o,stageStartTime:c=Date.now(),startTime:l}=a,u={stageId:i,numberOfFailures:s,numberOfImages:o,stageDurationInMS:c?Date.now()-c:null,startDurationInMS:Date.now()-l};H(ae,A.IMAGE_RETRIEVAL_STAGE,u),this.stageStatusMap.delete(i)}}createStageRequests(){const e=new Array,n=new Map,r=(i,a)=>{const s=a<0?this.imageIds.length+a:a<1?Math.floor((this.imageIds.length-1)*a):a,o=this.imageIds[s];if(!o)throw new Error(`No value found to add to requests at ${a}`);const c={imageId:o,stage:i,index:s,nearbyRequests:this.findNearbyRequests(s,i)};this.addStageStatus(i);const l=n.get(o);l?l.next=c:e.push(c),n.set(o,c)};for(const i of this.stages)(i.positions||Mu(this.imageIds,i.decimate||1,i.offset??0)).forEach(s=>{r(i,s)});return e}findNearbyRequests(e,n){const r=new Array;if(!n.nearbyFrames)return r;for(const i of n.nearbyFrames){const a=e+i.offset;a<0||a>=this.imageIds.length||r.push({itemId:this.imageIds[a],imageQualityStatus:i.imageQualityStatus,index:a})}return r}addStageStatus(e){const{id:n}=e,r=this.stageStatusMap.get(n)||{stageId:n,startTime:Date.now(),stageStartTime:null,totalImageCount:0,imageLoadFailedCount:0,imageLoadPendingCount:0};return r.imageLoadPendingCount++,this.stageStatusMap.set(n,r),r}}function Ou(t){return new sa(t)}const ac=Q.Prefetch;class ym extends Ls{constructor(e,n){super(e),this.framesLoaded=0,this.framesProcessed=0,this.framesUpdated=0,this.autoRenderOnLoad=!0,this.cachedFrames=[],this.reRenderTarget=0,this.reRenderFraction=2,this.imagesLoader=this,this.cancelLoading=()=>{const{loadStatus:r}=this;if(!r||!r.loading)return;r.loading=!1,r.cancelled=!0,this.clearLoadCallbacks();const i=({additionalDetails:a})=>a.volumeId!==this.volumeId;Mt.filterRequests(i)},this.loadStatus=n.loadStatus}invalidateVolume(e){const{vtkOpenGLTexture:n}=this,{numFrames:r}=this;for(let i=0;i<r;i++)n.setUpdatedFrame(i);this.modified(),e&&M0(this.volumeId)}clearLoadCallbacks(){this.loadStatus.callbacks=[]}callLoadStatusCallback(e){const{framesUpdated:n,framesProcessed:r,totalNumFrames:i}=e,{volumeId:a,reRenderFraction:s,loadStatus:o,metadata:c}=this,{FrameOfReferenceUID:l}=c;if(this.autoRenderOnLoad&&(n>this.reRenderTarget||r===i)&&(this.reRenderTarget+=s,M0(a)),r===i){o.callbacks.forEach(f=>f(e));const u={FrameOfReferenceUID:l,volumeId:a};H(ae,A.IMAGE_VOLUME_LOADING_COMPLETED,u)}}updateTextureAndTriggerEvents(e,n,r=st.FULL_RESOLUTION){const i=this.imageIdIndexToFrameIndex(e),{cachedFrames:a,numFrames:s,totalNumFrames:o}=this,{FrameOfReferenceUID:c}=this.metadata;if(a[i]>r||a[i]===st.FULL_RESOLUTION)return;const u=r===st.FULL_RESOLUTION;a[e]=r,this.framesUpdated++,u&&(this.framesLoaded++,this.framesProcessed++);const f={FrameOfReferenceUID:c,volumeId:this.volumeId,numberOfFrames:s,framesProcessed:this.framesProcessed};H(ae,A.IMAGE_VOLUME_MODIFIED,f),u&&this.framesProcessed===this.totalNumFrames&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!0,imageIdIndex:e,imageId:n,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:s,totalNumFrames:o,complete:u,imageQualityStatus:r}),this.vtkOpenGLTexture.setUpdatedFrame(i),this.loadStatus.loaded&&(this.loadStatus.callbacks=[])}successCallback(e,n){const r=this.getImageIdIndex(e),{imageQualityStatus:i}=n;if(this.loadStatus.cancelled){console.warn("volume load cancelled, returning for imageIdIndex: ",r);return}this.updateTextureAndTriggerEvents(r,e,i),this.isDynamicVolume()&&this.checkDimensionGroupCompletion(r)}errorCallback(e,n,r){if(!n)return;const{totalNumFrames:i,numFrames:a}=this,s=this.getImageIdIndex(e);this.framesProcessed++,this.framesProcessed===i&&(this.loadStatus.loaded=!0,this.loadStatus.loading=!1),this.callLoadStatusCallback({success:!1,imageId:e,imageIdIndex:s,error:r,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,framesUpdated:this.framesUpdated,numFrames:a,totalNumFrames:i}),this.loadStatus.loaded&&(this.loadStatus.callbacks=[]);const o={error:r,imageIdIndex:s,imageId:e};H(ae,A.IMAGE_LOAD_ERROR,o)}load(e){const{imageIds:n,loadStatus:r,numFrames:i}=this,{transferSyntaxUID:a}=j("transferSyntax",n[0])||{},s=j(Ar.IMAGE_RETRIEVE_CONFIGURATION,this.volumeId,a,"volume");if(this.imagesLoader=this.isDynamicVolume()?this:s?(s.create||sa.createProgressive)(s):this,r.loading===!0)return;const{loaded:o}=this.loadStatus,c=n.length;if(o){e&&e({success:!0,framesLoaded:c,framesProcessed:c,numFrames:i,totalNumFrames:c});return}e&&this.loadStatus.callbacks.push(e),this._prefetchImageIds()}getLoaderImageOptions(e){const{transferSyntaxUID:n}=j("transferSyntax",e)||{},r=j("imagePlaneModule",e)||{},{rows:i,columns:a}=r,s=this.getImageIdIndex(e),o=j("modalityLutModule",e)||{},c=j("generalSeriesModule",e)||{},l={rescaleSlope:o.rescaleSlope,rescaleIntercept:o.rescaleIntercept,modality:c.modality};if(l.modality==="PT"){const h=j("scalingModule",e);h&&(this._addScalingToVolume(h),l.suvbw=h.suvbw)}const u=Ns(l),f=ml();if(this.isPreScaled=!0,l&&l.rescaleSlope!==void 0&&l.rescaleIntercept!==void 0){const{rescaleSlope:h,rescaleIntercept:p}=l;this.isPreScaled=typeof h=="number"&&typeof p=="number"}return!f&&u&&(this.isPreScaled=!1),{targetBuffer:{type:this.dataType,rows:i,columns:a},allowFloatRendering:f,preScale:{enabled:this.isPreScaled,scalingParameters:l},transferPixelData:!0,requestType:ac,transferSyntaxUID:n,additionalDetails:{imageId:e,imageIdIndex:s,volumeId:this.volumeId}}}callLoadImage(e,n,r){const{cachedFrames:i}=this;if(i[n]===st.FULL_RESOLUTION)return;const a=o=>{const{image:c}=o.detail;c.imageId===e&&(this.vtkOpenGLTexture.setUpdatedFrame(n),ae.removeEventListener(A.IMAGE_CACHE_IMAGE_ADDED,a))};return ae.addEventListener(A.IMAGE_CACHE_IMAGE_ADDED,a),ir.as(rr(e,r)).forEach(o=>{this.successCallback(e,o)},this.errorCallback.bind(this,n,e))}getImageIdsRequests(e,n){this.totalNumFrames=this.imageIds.length;const r=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(r/100),this.reRenderTarget=this.reRenderFraction),e.map(a=>{const s=this.getImageIdIndex(a),o=ac,c=n,l=this.getLoaderImageOptions(a);return{callLoadImage:this.callLoadImage.bind(this),imageId:a,imageIdIndex:s,options:l,priority:c,requestType:o,additionalDetails:{volumeId:this.volumeId}}})}getImageLoadRequests(e){throw new Error("Abstract method")}getImageIdsToLoad(){throw new Error("Abstract method")}loadImages(){return this.loadStatus.loading=!0,this.getImageLoadRequests(5).reverse().forEach(n=>{if(!n)return;const{callLoadImage:r,imageId:i,imageIdIndex:a,options:s,priority:o,requestType:c,additionalDetails:l}=n;Mt.addRequest(r.bind(this,i,a,s),c,l,o)}),Promise.resolve(!0)}_prefetchImageIds(){this.loadStatus.loading=!0;const e=[...this.getImageIdsToLoad()];this.totalNumFrames=this.imageIds.length;const n=2;return this.autoRenderOnLoad&&(this.reRenderFraction=this.totalNumFrames*(n/100),this.reRenderTarget=this.reRenderFraction),this.imagesLoader.loadImages(e,this).catch(r=>{console.debug("progressive loading failed to complete",r)})}_addScalingToVolume(e){if(this.scaling)return;const{suvbw:n,suvlbm:r,suvbsa:i}=e,a={};r&&(a.suvbwToSuvlbm=r/n),i&&(a.suvbwToSuvbsa=i/n),n&&(a.suvbw=n),this.scaling={PT:a}}checkDimensionGroupCompletion(e){}}class vm extends ym{constructor(e,n){e.imageIds||(e.imageIds=n.imageIds),super(e,n),this.getImageIdsToLoad=()=>{const{imageIds:r}=this;return this.numFrames=r.length,r}}getScalarData(){return this.voxelManager.getScalarData()}getImageLoadRequests(e){const{imageIds:n}=this;return this.getImageIdsRequests(n,e)}}function Tm(t,e){if(!e||!e.imageIds||!e.imageIds.length)throw new Error("ImageIds must be provided to create a streaming image volume");async function n(){if(e.imageIds[0].split(":")[0]==="wadouri"){const[p,d]=[Math.floor(e.imageIds.length/2),e.imageIds.length-1],m=[0,p,d];await Promise.all(m.map(y=>q.isLoaded(e.imageIds[y])?Promise.resolve(!0):new Promise((T,v)=>{const C=e.imageIds[y];Mt.addRequest(async()=>{cm(C).then(()=>{console.log(`Prefetched imageId: ${C}`),T(!0)}).catch(x=>{v(x)})},Q.Prefetch,{volumeId:t},1)}))).catch(console.error)}const i=Ru(e.imageIds,t),{dimensions:a,spacing:s,origin:o,direction:c,metadata:l,imageIds:u,dataType:f,numberOfComponents:g}=i;return new vm({volumeId:t,metadata:l,dimensions:a,spacing:s,origin:o,direction:c,imageIds:u,dataType:f,numberOfComponents:g},{imageIds:u,loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}})}const r=n();return{promise:r,decache:()=>{r.then(i=>{i.destroy(),i=null})},cancel:()=>{r.then(i=>{i.cancelLoading()})}}}const Du={};let bi=Tm;function Vu(t,e){const n=t.indexOf(":"),r=t.substring(0,n);let i=Du[r];if(i==null){if(bi==null||typeof bi!="function")throw new Error(`No volume loader for scheme ${r} has been registered`);i=bi}const a=i(t,e);return a.promise.then(function(s){H(ae,A.VOLUME_LOADED,{volume:s})},function(s){const o={volumeId:t,error:s};H(ae,A.VOLUME_LOADED_FAILED,o)}),a}function Cm(t,e={imageIds:[]}){if(t===void 0)throw new Error("loadVolume: parameter volumeId must not be undefined");let n=q.getVolumeLoadObject(t);return n!==void 0?n.promise:(n=Vu(t,e),n.promise.then(r=>r))}async function xm(t,e){if(t===void 0)throw new Error("createAndCacheVolume: parameter volumeId must not be undefined");let n=q.getVolumeLoadObject(t);return n!==void 0||(n=Vu(t,e),q.putVolumeLoadObject(t,n)),n.promise}function wm(t,e={}){const{metadata:n,dimensions:r,spacing:i,origin:a,direction:s,scalarData:o,targetBuffer:c,preventCache:l=!1}=e,u=q.getVolume(t);if(u)return u;const f=r[0]*r[1],g=o?o.constructor.name:(c==null?void 0:c.type)??"Float32Array",h=f*r[2];let p;switch(g){case"Uint8Array":case"Int8Array":p=h;break;case"Uint16Array":case"Int16Array":p=h*2;break;case"Float32Array":p=h*4;break}if(!q.isCacheable(p))throw new Error(`Cannot created derived volume: Volume with id ${t} is not cacheable.`);const m=[];for(let v=0;v<r[2];v++){const C=`${t}_slice_${v}`;m.push(C);const x=o.subarray(v*f,(v+1)*f);lm(C,{scalarData:x,dimensions:[r[0],r[1]],spacing:[i[0],i[1]],origin:a,direction:s,targetBuffer:{type:g}})}const y=new Ls({volumeId:t,metadata:structuredClone(n),dimensions:[r[0],r[1],r[2]],spacing:i,origin:a,direction:s,imageIds:m,dataType:g}),T=nr.createImageVolumeVoxelManager({imageIds:m,dimensions:r,numberOfComponents:1});return y.voxelManager=T,l||q.putVolumeSync(t,y),y}function Sm(){return Object.keys(Du)}function Rm(){return bi.name}function Em(t,e){const n=_p.newInstance();xs().rendering.preferSizeOverAccuracy&&n.setPreferSizeOverAccuracy(!0),n.setInputData(t);const r=t.getSpacing(),i=(r[0]+r[1]+r[2])/6;return n.setMaximumSamplesPerRay(4e3),n.setSampleDistance(i),n.setScalarTexture(e),n}const Mm=0,Om=Q.Prefetch;async function bs(t,e){let n=Vm(e);!n&&e.imageIds.length&&(n=await Im(e),n=Dm(e,n)),!(n.lower===0&&n.upper===0||n.lower===void 0||n.upper===void 0)&&t.getProperty().getRGBTransferFunction(0).setMappingRange(n.lower,n.upper)}function Dm(t,e){const n=t.imageIds,r=Math.floor(n.length/2),i=n[r],a=j("generalSeriesModule",i)||{};return Lm(a.modality,t)?{lower:0,upper:5}:e}function Vm(t){const{imageIds:e,metadata:n}=t;let r;if(e!=null&&e.length){const i=Math.floor(e.length/2),a=e[i],s=j("voiLutModule",a);if(s&&s.windowWidth&&s.windowCenter){s!=null&&s.voiLUTFunction&&(r={},r.voiLUTFunction=s==null?void 0:s.voiLUTFunction);const{windowWidth:o,windowCenter:c}=s,l=Array.isArray(o)?o[0]:o,u=Array.isArray(c)?c[0]:c;l!==0&&(r={windowWidth:l,windowCenter:u})}}else r=n.voiLut[0];if(r&&(r.windowWidth!==0||r.windowCenter!==0)){const{lower:i,upper:a}=Or(Number(r.windowWidth),Number(r.windowCenter),r.voiLUTFunction);return{lower:i,upper:a}}}async function Im(t){var h;const{imageIds:e}=t,n=Math.floor(e.length/2),r=t.imageIds[n],i=j("generalSeriesModule",r)||{},{modality:a}=i,s=j("modalityLutModule",r)||{},o={rescaleSlope:s.rescaleSlope,rescaleIntercept:s.rescaleIntercept,modality:a};let c;if(a==="PT"){const p=j("scalingModule",r);p&&(c={...o,suvbw:p.suvbw})}const l={priority:Mm,requestType:Om,preScale:{scalingParameters:c}};let u=q.getImage(r);(h=t.referencedImageIds)!=null&&h.length||(u=await rr(r,{...l,ignoreCache:!0}));let{min:f,max:g}=u.voxelManager.getMinMax();return(f==null?void 0:f.length)>1&&(f=Math.min(...f),g=Math.max(...g)),{lower:f,upper:g}}function Lm(t,e){var n;return!(t!=="PT"||!e.isPreScaled||!((n=e.scaling)!=null&&n.PT.suvbw))}async function sc(t,e,n,r=!1){const{volumeId:i,callback:a,blendMode:s}=t,o=await Cm(i);if(!o)throw new Error(`imageVolume with id: ${o.volumeId} does not exist`);const{imageData:c,vtkOpenGLTexture:l}=o,u=Em(c,l);s&&u.setBlendMode(s);const f=E6.newInstance();f.setMapper(u);const{numberOfComponents:g}=c.get("numberOfComponents");return f.getProperty().set({viewportId:n}),g===3&&f.getProperty().setIndependentComponents(!1),await bs(f,o),a&&a({volumeActor:f,volumeId:i}),r||Nm(e,n,f,i),f}function Nm(t,e,n,r){const i=n.getProperty().getRGBTransferFunction(0).getRange(),a={viewportId:e,range:{lower:i[0],upper:i[1]},volumeId:r};H(t,A.VOI_MODIFIED,a)}const Iu=t=>{const e="volumeId:",n=t.includes(e)?t.substring(e.length):t,r=n.indexOf("sliceIndex=");return r===-1?n:n.substring(0,r-1)},bm=1+Pt,Fm=(t,e)=>e===t.substring(0,Math.min(t.length,e.length)),oc=t=>!!Sm().find(e=>Fm(t.volumeId,e));function Fs(t,e,n,r=!1){const{viewPlaneNormal:i}=e,a=t.getActors();if(!a.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const s=a.map(l=>{const u=l.referencedId??l.uid;return q.getVolume(u)}).filter(l=>!!l);if(n){const l=Iu(n),u=s.findIndex(p=>l.includes(p.volumeId)),f=s[u],{uid:g}=a[u],h=cc(f,i,t,r);return{imageVolume:f,spacingInNormalDirection:h,actorUID:g}}if(!s.length)return{spacingInNormalDirection:null,imageVolume:null,actorUID:null};const o={spacingInNormalDirection:1/0,imageVolume:null,actorUID:null},c=s.find(oc);for(let l=0;l<s.length;l++){const u=s[l];if(c&&!oc(u))continue;const f=cc(u,i,t);f*bm<o.spacingInNormalDirection&&(o.spacingInNormalDirection=f,o.imageVolume=u,o.actorUID=a[l].uid)}return o}function cc(t,e,n,r=!1){const{slabThickness:i}=n.getProperties();let a=i;return(!i||!r)&&(a=Zr(t,e)),a}function oa(t){const e=t.getCamera(),{spacingInNormalDirection:n,imageVolume:r}=Fs(t,e);if(!r)return;const{viewPlaneNormal:i,focalPoint:a}=e,s=t.getActors().find(p=>p.referencedId===r.volumeId||p.uid===r.volumeId);s||console.warn("No actor found for with actorUID of",r.volumeId);const o=s.actor,c=Da(o,i,a),{min:l,max:u,current:f}=c,g=Math.round((u-l)/n)+1;let h=(f-l)/(u-l)*g;return h=Math.floor(h),h>g-1?h=g-1:h<0&&(h=0),{numberOfSlices:g,imageIndex:h}}const Wn={};function _m(t){Wn[t]!==void 0&&delete Wn[t]}function Um(t){const{renderingEngineId:e,viewportId:n}=t.detail,i=Ea(e).getViewport(n);if(!("setVolumes"in i))throw new Error("volumeNewImageEventDispatcher: viewport does not have setVolumes method");Wn[i.id]===void 0&&(Wn[i.id]=0);const a=oa(i);if(!a){console.warn(`volumeNewImageEventDispatcher: sliceData is undefined for viewport ${i.id}`);return}const{numberOfSlices:s,imageIndex:o}=a;if(Wn[i.id]===o)return;Wn[i.id]=o;const c={imageIndex:o,viewportId:n,renderingEngineId:e,numberOfSlices:s};H(i.element,A.VOLUME_NEW_IMAGE,c)}function Lu(t,e,n){const[r,i,a]=t,[s,o,c]=e,[l,u,f,g]=n,h=s-r,p=o-i,d=c-a,m=-1*(l*r+u*i+f*a-g)/(l*h+u*p+f*d),y=h*m+r,T=p*m+i,v=d*m+a;return[y,T,v]}function Nu(t,e,n=!1){const[r,i,a]=t,s=r*e[0]+i*e[1]+a*e[2];if(n){const o=Math.sqrt(r*r+i*i+a*a);return[r/o,i/o,a/o,s/o]}return[r,i,a,s]}function km(t,e,n){const[r,i,a,s]=t,[o,c,l,u]=e,[f,g,h,p]=n,d=ni(r,o,f,i,c,g,a,l,h),m=ni(s,u,p,i,c,g,a,l,h),y=ni(r,o,f,s,u,p,a,l,h),T=ni(r,o,f,i,c,g,s,u,p),v=Nn(m)/Nn(d),C=Nn(y)/Nn(d),x=Nn(T)/Nn(d);return[v,C,x]}function bu(t,e,n=!1){const[r,i,a,s]=t,[o,c,l]=e,u=r*o+i*c+a*l-s,f=Math.abs(u)/Math.sqrt(r*r+i*i+a*a);return(n?Math.sign(u):1)*f}var Pm=Object.freeze({__proto__:null,linePlaneIntersection:Lu,planeDistanceToPoint:bu,planeEquation:Nu,threePlaneIntersection:km});function O0(t){return Array.isArray(t)?t.some(e=>Number.isNaN(e)):Number.isNaN(t)}function Br(t){if(t===null||typeof t!="object"||typeof t=="function"||typeof structuredClone=="function")return t;if(Array.isArray(t))return t.map(Br);{const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=Br(t[n]));return e}}const Lr=class Lr{constructor(e){this.insetImageMultiplier=1.1,this.flipHorizontal=!1,this.flipVertical=!1,this.viewportStatus=Ke.NO_DATA,this._suppressCameraModifiedEvents=!1,this.hasPixelSpacing=!0,this.getProperties=()=>({}),this.setRotation=n=>{},this.viewportWidgets=new Map,this.addWidget=(n,r)=>{this.viewportWidgets.set(n,r)},this.getWidget=n=>this.viewportWidgets.get(n),this.getWidgets=()=>Array.from(this.viewportWidgets.values()),this.removeWidgets=()=>{this.getWidgets().forEach(r=>{if(r.getEnabled()&&r.setEnabled(!1),r.getActor&&r.getRenderer){const i=r.getActor(),a=r.getRenderer();a&&i&&a.removeActor(i)}})},this.id=e.id,this.renderingEngineId=e.renderingEngineId,this.type=e.type,this.element=e.element,this.canvas=e.canvas,this.sx=e.sx,this.sy=e.sy,this.sWidth=e.sWidth,this.sHeight=e.sHeight,this._actors=new Map,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.defaultOptions=Br(e.defaultOptions),this.suppressEvents=e.defaultOptions.suppressEvents?e.defaultOptions.suppressEvents:!1,this.options=Br(e.defaultOptions),this.isDisabled=!1}static get useCustomRenderingPipeline(){return!1}setRendered(){this.viewportStatus===Ke.NO_DATA||this.viewportStatus===Ke.LOADING||(this.viewportStatus=Ke.RENDERED)}getRenderingEngine(){return Fr.get(this.renderingEngineId)}getRenderer(){var n;const e=this.getRenderingEngine();if(!e||e.hasBeenDestroyed)throw new Error("Rendering engine has been destroyed");return(n=e.offscreenMultiRenderWindow)==null?void 0:n.getRenderer(this.id)}render(){this.getRenderingEngine().renderViewport(this.id)}setOptions(e,n=!1){var r,i;this.options=structuredClone(e),(r=this.options)!=null&&r.displayArea&&this.setDisplayArea((i=this.options)==null?void 0:i.displayArea),n&&this.render()}reset(e=!1){this.options=structuredClone(this.defaultOptions),e&&this.render()}getSliceViewInfo(){throw new Error("Method not implemented.")}flip({flipHorizontal:e,flipVertical:n}){const r=this.getDefaultImageData();if(!r)return;const i=this.getCamera(),{viewPlaneNormal:a,viewUp:s,focalPoint:o,position:c}=i,l=ve($(),a,s);let u=M4($(),s);const f=kt($(),a),g=r2(c,o),p=r.getDimensions().map(x=>Math.floor(x/2)),d=[p[0],p[1],p[2]],m=r.indexToWorld(d,$()),y=this._getFocalPointForResetCamera(m,i,{resetPan:!0,resetToCenter:!1}),T=Pe($(),o,y),v=en(T),C=x=>{const w=tn($(),x,2*fe(T,x));return Pe(w,w,T),_e(w,w),w};if(e){const x=C(u),w=ze($(),y,x,v),E=ze($(),w,f,g);this.setCamera({viewPlaneNormal:f,position:E,focalPoint:w}),this.flipHorizontal=!this.flipHorizontal}if(n){u=kt(u,s);const x=C(l),w=ze($(),y,x,v),E=ze($(),w,f,g);this.setCamera({focalPoint:w,viewPlaneNormal:f,viewUp:u,position:E}),this.flipVertical=!this.flipVertical}this.render()}getDefaultImageData(){const e=this.getDefaultActor();if(e&&xt(e))return e.actor.getMapper().getInputData()}getDefaultActor(){return this.getActors()[0]}getActors(){return Array.from(this._actors.values())}getActorUIDs(){return Array.from(this._actors.keys())}getActor(e){return this._actors.get(e)}getImageActor(e){const n=this.getActors();let r=n[0];return e&&(r=n.find(a=>a.referencedId===e)),!r||!xt(r)?null:r.actor}getActorUIDByIndex(e){const n=this.getActors()[e];if(n)return n.uid}getActorByIndex(e){return this.getActors()[e]}setActors(e){this.removeAllActors(),this.addActors(e,{resetCamera:!0})}_removeActor(e){const n=this.getActor(e);if(!n){console.warn(`Actor ${e} does not exist for this viewport`);return}this.getRenderer().removeViewProp(n.actor),this._actors.delete(e)}removeActors(e){e.forEach(n=>{this._removeActor(n)})}addActors(e,n={}){const{resetCamera:r=!1}=n,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn("Viewport::addActors::Rendering engine has not been initialized or has been destroyed");return}e.forEach(o=>{this.addActor(o)});const a=this.getViewPresentation(),s=this.getViewReference();this.resetCamera(),r||(this.setViewReference(s),this.setViewPresentation(a))}addActor(e){const{uid:n,actor:r}=e,i=this.getRenderingEngine();if(!i||i.hasBeenDestroyed){console.warn(`Cannot add actor UID of ${n} Rendering Engine has been destroyed`);return}if(!n||!r)throw new Error("Actors should have uid and vtk Actor properties");if(this.getActor(n)){console.warn(`Actor ${n} already exists for this viewport`);return}const a=this.getRenderer();a==null||a.addActor(r),this._actors.set(n,Object.assign({},e)),this.updateCameraClippingPlanesAndRange()}removeAllActors(){var e;(e=this.getRenderer())==null||e.removeAllViewProps(),this._actors=new Map}resetCameraNoEvent(){this._suppressCameraModifiedEvents=!0,this.resetCamera(),this._suppressCameraModifiedEvents=!1}setCameraNoEvent(e){this._suppressCameraModifiedEvents=!0,this.setCamera(e),this._suppressCameraModifiedEvents=!1}_getViewImageDataIntersections(e,n,r){const i=r[0],a=r[1],s=r[2],o=i*n[0]+a*n[1]+s*n[2],c=e.getBounds(),l=this._getEdges(c),u=[];for(const f of l){const[[g,h,p],[d,m,y]]=f;if(i*(d-g)+a*(m-h)+s*(y-p)===0)continue;const T=Lu([g,h,p],[d,m,y],[i,a,s,o]);this._isInBounds(T,c)&&u.push(T)}return u}setInterpolationType(e,n){}setDisplayArea(e,n=!1){var s;if(!e)return;const{storeAsInitialCamera:r,type:i}=e;r&&(this.options.displayArea=e);const{_suppressCameraModifiedEvents:a}=this;if(this._suppressCameraModifiedEvents=!0,this.setCamera(this.fitToCanvasCamera),i==="SCALE"?this.setDisplayAreaScale(e):(this.setInterpolationType(((s=this.getProperties())==null?void 0:s.interpolationType)??Jt.LINEAR),this.setDisplayAreaFit(e)),r&&(this.initialCamera=this.getCamera()),this._suppressCameraModifiedEvents=a,!n&&!a){const o={viewportId:this.id,displayArea:e,storeAsInitialCamera:r};H(this.element,A.DISPLAY_AREA_MODIFIED,o),this.setCamera(this.getCamera())}}setDisplayAreaScale(e){const{scale:n=1}=e,r=this.canvas,i=r.height,a=r.width;if(i<8||a<8)return;const c=this.getDefaultImageData().getSpacing()[1];this.setInterpolationType(Jt.NEAREST),this.setCamera({parallelScale:i*c/(2*n)}),delete e.imageArea,this.setDisplayAreaFit(e);const{focalPoint:l,position:u,viewUp:f,viewPlaneNormal:g}=this.getCamera(),h=$();if(r.height%2&&ze(h,h,f,n*.5*c),r.width%2){const p=ve($(),f,g);ze(h,h,p,n*.5*c)}!h[0]&&!h[1]&&!h[2]||this.setCamera({focalPoint:rn($(),l,h),position:rn($(),u,h)})}setDisplayAreaFit(e){const{imageArea:n,imageCanvasPoint:r}=e,i=(window==null?void 0:window.devicePixelRatio)||1,a=this.getDefaultImageData();if(!a)return;const s=this.sWidth/i,o=this.sHeight/i,c=a.getDimensions(),l=this.worldToCanvas(a.indexToWorld([0,0,0])),u=this.worldToCanvas(a.indexToWorld([c[0],c[1],c[2]])),f=[Math.abs(u[0]-l[0]),Math.abs(u[1]-l[1])],[g,h]=f;let p=this.getZoom()/this.insetImageMultiplier;if(n){const[d,m]=n,y=Math.max(Math.abs(g/s),Math.abs(h/o)),T=Math.abs(d*g/s),v=Math.abs(m*h/o),C=this.getZoom(),x=this.getZoom(this.fitToCanvasCamera);p=(T>v?y/T:y/v)*C/x,this.setZoom(this.insetImageMultiplier*p,!1)}if(r){console.log("Starting pan update zoom=",p);const{imagePoint:d,canvasPoint:m=d||[.5,.5]}=r,[y,T]=m,v=s*(y-.5),C=o*(T-.5),[x,w]=d||m,E=p,O=this.insetImageMultiplier*E*g*(.5-x),D=this.insetImageMultiplier*E*h*(.5-w),S=O+v,M=D+C,V=[S,M];console.log("delta point",S,this.getPan()[0],O,v),cs(V,V,this.getPan()),this.setPan(V,!1)}}getDisplayArea(){var e;return(e=this.options)==null?void 0:e.displayArea}resetCamera(e){const{resetPan:n=!0,resetZoom:r=!0,resetToCenter:i=!0,storeAsInitialCamera:a=!0}=e||{},s=this.getRenderer();this.setCameraNoEvent({flipHorizontal:!1,flipVertical:!1});const o=this.getCamera(),c=s.computeVisiblePropBounds(),l=[0,0,0],u=this.getDefaultImageData();if(u){const L=u.getSpacing();c[0]=c[0]+L[0]/2,c[1]=c[1]-L[0]/2,c[2]=c[2]+L[1]/2,c[3]=c[3]-L[1]/2,c[4]=c[4]+L[2]/2,c[5]=c[5]-L[2]/2}const f=this.getVtkActiveCamera(),g=f.getViewPlaneNormal(),h=f.getViewUp();if(l[0]=(c[0]+c[1])/2,l[1]=(c[2]+c[3])/2,l[2]=(c[4]+c[5])/2,u){const F=u.getDimensions().map(b=>Math.floor(b/2)),k=[F[0],F[1],F[2]];u.indexToWorld(k,l)}const{widthWorld:p,heightWorld:d}=this._getWorldDistanceViewUpAndViewRight(c,h,g),m=[this.sWidth,this.sHeight],y=p/d,T=m[0]/m[1],v=y/T,C=v<1?this.insetImageMultiplier*d/2:this.insetImageMultiplier*d*v/2,x=Lr.boundsRadius(c)*(this.type===Ce.VOLUME_3D?10:1),w=this.insetImageMultiplier*x,E=Math.abs(gt.dot(h,g))>.999?[-h[2],h[0],h[1]]:h,O=this._getFocalPointForResetCamera(l,o,{resetPan:n,resetToCenter:i}),D=[O[0]+w*g[0],O[1]+w*g[1],O[2]+w*g[2]];s.resetCameraClippingRange(c);const S=[-Te.MAXIMUM_RAY_DISTANCE,Te.MAXIMUM_RAY_DISTANCE];f.setPhysicalScale(x),f.setPhysicalTranslation(-O[0],-O[1],-O[2]),this.setCamera({parallelScale:r?C:o.parallelScale,focalPoint:O,position:D,viewAngle:90,viewUp:E,clippingRange:S});const M=this.getCamera();this.setFitToCanvasCamera(this.getCamera()),a&&this.setInitialCamera(M),r&&this.setZoom(1,a);const V={type:"ResetCameraEvent",renderer:s};return s.invokeEvent(V),this.triggerCameraModifiedEventIfNecessary(o,M),u&&this.options.displayArea&&r&&n&&i&&this.setDisplayArea(this.options.displayArea),!0}setInitialCamera(e){this.initialCamera=e}setFitToCanvasCamera(e){this.fitToCanvasCamera=e}getPan(e=this.initialCamera){if(!e)return[0,0];const r=this.getVtkActiveCamera().getFocalPoint(),i=this.canvasToWorld([0,0]),a=this.worldToCanvas(Pe([0,0,0],e.focalPoint,i)),s=this.worldToCanvas(Pe([0,0,0],r,i));return qi([0,0],a,s)}getCurrentImageIdIndex(){throw new Error("Not implemented")}getSliceIndex(){throw new Error("Not implemented")}getImageData(){throw new Error("Not implemented")}getViewReferenceId(e){return null}setPan(e,n=!1){const r=this.getCamera(),{focalPoint:i,position:a}=r,s=this.canvasToWorld([0,0]),o=qi([0,0],e,this.getPan());if(Math.abs(o[0])<1&&Math.abs(o[1])<1&&!n)return;const c=Pe($(),this.canvasToWorld(o),s),l=Pe($(),i,c),u=Pe($(),a,c);this.setCamera({...r,focalPoint:l,position:u},n)}getZoom(e=this.initialCamera){if(!e)return 1;const n=this.getVtkActiveCamera(),{parallelScale:r}=e;return r/n.getParallelScale()}setZoom(e,n=!1){const r=this.getCamera(),{parallelScale:i}=this.initialCamera,a=i/e;r.parallelScale===a&&!n||this.setCamera({...r,parallelScale:a},n)}_getFocalPointForViewPlaneReset(e){const{focalPoint:n,viewPlaneNormal:r}=this.getCamera(),i=this._getViewImageDataIntersections(e,n,r);let a=0,s=0,o=0;return i.forEach(([l,u,f])=>{a+=l,s+=u,o+=f}),[a/i.length,s/i.length,o/i.length]}getCanvas(){return this.canvas}getVtkActiveCamera(){const e=this.getRenderer();return e?e.getActiveCamera():(console.warn("No renderer found for the viewport"),null)}getCameraNoRotation(){const e=this.getVtkActiveCamera(),n=(o,c)=>o.some(l=>isNaN(l))?c:o,r=n([...e.getViewUp()],[0,1,0]),i=n([...e.getViewPlaneNormal()],[0,0,-1]),a=n([...e.getPosition()],[0,0,1]),s=n([...e.getFocalPoint()],[0,0,0]);return{viewUp:r,viewPlaneNormal:i,position:a,focalPoint:s,parallelProjection:e.getParallelProjection(),parallelScale:e.getParallelScale(),viewAngle:e.getViewAngle(),flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}getCamera(){return{...this.getCameraNoRotation(),rotation:this.getRotation()}}setCamera(e,n=!1){const r=this.getVtkActiveCamera(),i=this.getCamera(),a=Object.assign({},i,e),{viewUp:s,viewPlaneNormal:o,position:c,focalPoint:l,parallelScale:u,viewAngle:f,flipHorizontal:g,flipVertical:h,clippingRange:p}=e;if(g!==void 0){const y=g&&!this.flipHorizontal||!g&&this.flipHorizontal;y&&this.flip({flipHorizontal:y})}if(h!==void 0){const y=h&&!this.flipVertical||!h&&this.flipVertical;y&&this.flip({flipVertical:y})}s!==void 0&&r.setViewUp(s),o!==void 0&&r.setDirectionOfProjection(-o[0],-o[1],-o[2]),c!==void 0&&r.setPosition(...c),l!==void 0&&r.setFocalPoint(...l),u!==void 0&&r.setParallelScale(u),f!==void 0&&r.setViewAngle(f),p!==void 0&&r.setClippingRange(p);const d=i.focalPoint,m=i.viewUp;if(d&&l||m&&s){const y=r.getViewPlaneNormal(),T=r.getViewUp();let v=!1,C=!1;if(l){const x=[l[0]-d[0],l[1]-d[1],l[2]-d[2]];v=Math.abs(gt.dot(x,y))>0}if(s&&(C=!Ne(T,m)),v||C){const x=this.getDefaultActor();if(!(x!=null&&x.actor))return;Xe(x,"vtkActor")||this.updateClippingPlanesForActors(a),(Xe(x,"vtkImageSlice")||this.type===Ce.VOLUME_3D)&&this.getRenderer().resetCameraClippingRange()}}n&&this.setInitialCamera(a),this.triggerCameraModifiedEventIfNecessary(i,this.getCamera())}triggerCameraModifiedEventIfNecessary(e,n){if(!this._suppressCameraModifiedEvents&&!this.suppressEvents){const r={previousCamera:e,camera:n,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};H(this.element,A.CAMERA_MODIFIED,r)}}updateCameraClippingPlanesAndRange(){const e=this.getCamera();this.updateClippingPlanesForActors(e),this.getRenderer().resetCameraClippingRange()}async updateClippingPlanesForActors(e){this.getActors().map(r=>{if(!r.actor)return;const i=r.actor.getMapper();let a=r!=null&&r.clippingFilter?r==null?void 0:r.clippingFilter.getClippingPlanes():i.getClippingPlanes();a.length===0&&(r!=null&&r.clippingFilter)&&(a=[Ge.newInstance(),Ge.newInstance()]);let s=Te.MINIMUM_SLAB_THICKNESS;r.slabThickness&&(s=r.slabThickness);const{viewPlaneNormal:o,focalPoint:c}=e;this.setOrientationOfClippingPlanes(a,s,o,c),H(this.element,A.CLIPPING_PLANES_UPDATED,{actorEntry:r,focalPoint:c,vtkPlanes:a,viewport:this})})}setOrientationOfClippingPlanes(e,n,r,i){if(e.length<2)return;const a=[r[0],r[1],r[2]];gt.multiplyScalar(a,n),e[0].setNormal(r);const s=[0,0,0];gt.subtract(i,a,s),e[0].setOrigin(s),e[1].setNormal(-r[0],-r[1],-r[2]);const o=[0,0,0];gt.add(i,a,o),e[1].setOrigin(o)}getClippingPlanesForActor(e){if(e||(e=this.getDefaultActor()),!e.actor)throw new Error("Invalid actor entry: Actor is undefined");const n=e.actor.getMapper();let r=e!=null&&e.clippingFilter?e==null?void 0:e.clippingFilter.getClippingPlanes():n.getClippingPlanes();return r.length===0&&(e!=null&&e.clippingFilter)&&(r=[Ge.newInstance(),Ge.newInstance()]),r}_getWorldDistanceViewUpAndViewRight(e,n,r){const i=this._getCorners(e),a=this._getCorners(e),s=ve($(),n,r);let o=vn.buildFromDegree().identity().rotateFromDirections(n,[1,0,0]);i.forEach(g=>o.apply(g));let c=1/0,l=-1/0;for(let g=0;g<8;g++){const h=i[g][0];h>l&&(l=h),h<c&&(c=h)}o=vn.buildFromDegree().identity().rotateFromDirections([s[0],s[1],s[2]],[1,0,0]),a.forEach(g=>o.apply(g));let u=1/0,f=-1/0;for(let g=0;g<8;g++){const h=a[g][0];h>f&&(f=h),h<u&&(u=h)}return{widthWorld:f-u,heightWorld:l-c}}getViewReference(e){const{focalPoint:n,viewPlaneNormal:r,viewUp:i}=this.getCamera();return{FrameOfReferenceUID:this.getFrameOfReferenceUID(),cameraFocalPoint:n,viewPlaneNormal:r,viewUp:i,sliceIndex:(e==null?void 0:e.sliceIndex)??this.getSliceIndex()}}isReferenceViewable(e,n){if(e.FrameOfReferenceUID&&e.FrameOfReferenceUID!==this.getFrameOfReferenceUID())return!1;const{viewPlaneNormal:r}=e,i=this.getCamera();return r&&!Ne(r,i.viewPlaneNormal)&&!Ne(kt(i.viewPlaneNormal,i.viewPlaneNormal),r)?n==null?void 0:n.withOrientation:!0}getViewPresentation(e={rotation:!0,displayArea:!0,zoom:!0,pan:!0,flipHorizontal:!0,flipVertical:!0}){const n={},{rotation:r,displayArea:i,zoom:a,pan:s,flipHorizontal:o,flipVertical:c}=e;r&&(n.rotation=this.getRotation()),i&&(n.displayArea=this.getDisplayArea());const l=this.getZoom();return a&&(n.zoom=l),s&&(n.pan=this.getPan(),So(n.pan,n.pan,1/l)),o&&(n.flipHorizontal=this.flipHorizontal),c&&(n.flipVertical=this.flipVertical),n}setViewReference(e){}setViewPresentation(e){if(!e)return;const{displayArea:n,zoom:r=this.getZoom(),pan:i,rotation:a,flipHorizontal:s=this.flipHorizontal,flipVertical:o=this.flipVertical}=e;n!==this.getDisplayArea()&&this.setDisplayArea(n),this.setZoom(r),i&&this.setPan(So([0,0],i,r)),a>=0&&this.setRotation(a),(s||o)&&this.flip({flipHorizontal:s,flipVertical:o})}_getCorners(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}_getFocalPointForResetCamera(e,n,{resetPan:r=!0,resetToCenter:i=!0}){if(i&&r)return e;if(i&&!r)return O0(n.focalPoint)?e:n.focalPoint;if(!i&&r){const a=n,s=a.focalPoint,o=a.viewPlaneNormal,c=Pe($(),e,s),l=fe(c,o),u=ze($(),e,o,-1*l);return[u[0],u[1],u[2]]}if(!r&&!i)return O0(n.focalPoint)?e:n.focalPoint}_isInBounds(e,n){const[r,i,a,s,o,c]=n,[l,u,f]=e;return!(l<r||l>i||u<a||u>s||f<o||f>c)}_getEdges(e){const[n,r,i,a,s,o,c,l]=this._getCorners(e);return[[n,r],[n,s],[n,i],[r,a],[r,o],[i,a],[i,c],[a,l],[s,c],[s,o],[o,l],[c,l]]}static boundsRadius(e){const n=(e[1]-e[0])**2,r=(e[3]-e[2])**2,i=(e[5]-e[4])**2;return Math.sqrt(n+r+i||1)*.5}setDataIds(e,n){throw new Error("Unsupported operatoin setDataIds")}};Lr.CameraViewPresentation={rotation:!0,pan:!0,zoom:!0,displayArea:!0},Lr.TransferViewPresentation={windowLevel:!0,paletteLut:!0};let ar=Lr;function Fu(t,e,n=!1){const r=t.getCamera(),{focalPoint:i,viewPlaneNormal:a}=r,{spacingInNormalDirection:s,actorUID:o}=Fs(t,r,e,n);if(!o)throw new Error(`Could not find image volume with id ${e} in the viewport`);const c=t.getActor(o);if(!c)return console.warn("No actor found for with actorUID of",o),null;const l=c.actor;return{sliceRange:Da(l,a,i),spacingInNormalDirection:s,camera:r}}function Xn(t,e,n=!1){const{sliceRange:r,spacingInNormalDirection:i,camera:a}=Fu(t,e,n),{min:s,max:o,current:c}=r,l=Math.round((o-s)/i),f=(c-s)/(o-s)*l,g=Math.round(f);return{numScrollSteps:l,currentStepIndex:g,sliceRangeInfo:{sliceRange:r,spacingInNormalDirection:i,camera:a}}}function _u(t){let e=[];const[n,r]=t.getRange();t.getTable(n,r,1024,e),e=e.filter((h,p)=>p%3===0);const i=[...Array(1024).keys()].map((h,p)=>n+(r-n)/1023*p),a=e[256],s=Math.log((1-a)/a),o=i[256],c=e[256*3],l=Math.log((1-c)/c),u=i[256*3],f=Math.round(4*(u-o)/(s-l)),g=Math.round(o+f*s/4);return[Math.round(g-f/2),Math.round(g+f/2)]}function Uu(t,e){const n=e.colorTransfer.split(" ").splice(1).map(parseFloat),{shiftRange:r}=Gm(n),i=r[0],a=r[1]-r[0],s=Mn.newInstance(),o=[];for(let C=0;C<n.length;C+=4){let x=n[C];const w=n[C+1],E=n[C+2],O=n[C+3];x=(x-i)/a,o.push([x,w,E,O])}Am(o,r,s),t.getProperty().setRGBTransferFunction(0,s);const c=e.scalarOpacity.split(" ").splice(1).map(parseFloat),l=Pr.newInstance(),u=[];for(let C=0;C<c.length;C+=2){let x=c[C];const w=c[C+1];x=(x-i)/a,u.push([x,w])}Bm(u,r,l);const f=t.getProperty();f.setScalarOpacity(0,l);const[g,h,p,d]=e.gradientOpacity.split(" ").splice(1).map(parseFloat);f.setUseGradientOpacity(0,!0),f.setGradientOpacityMinimumValue(0,g),f.setGradientOpacityMinimumOpacity(0,h),f.setGradientOpacityMaximumValue(0,p),f.setGradientOpacityMaximumOpacity(0,d),e.interpolation==="1"&&f.setInterpolationTypeToFastLinear(),f.setShade(e.shade==="1");const m=parseFloat(e.ambient),y=parseFloat(e.diffuse),T=parseFloat(e.specular),v=parseFloat(e.specularPower);f.setAmbient(m),f.setDiffuse(y),f.setSpecular(T),f.setSpecularPower(v)}function Gm(t){let e=1/0,n=-1/0;for(let i=0;i<t.length;i+=4)e=Math.min(e,t[i]),n=Math.max(n,t[i]);const r=(n-e)/2;return{shiftRange:[-r,r],min:e,max:n}}function Am(t,e,n){const r=e[1]-e[0],i=t.map(([a,s,o,c])=>[a*r+e[0],s,o,c]);return n.removeAllPoints(),i.forEach(([a,s,o,c])=>n.addRGBPoint(a,s,o,c)),i}function Bm(t,e,n){const r=e[1]-e[0],i=t.map(([a,s])=>[a*r+e[0],s]);return n.removeAllPoints(),i.forEach(([a,s])=>n.addPoint(a,s)),i}class Na extends ar{constructor(e){if(super(e),this.useCPURendering=!1,this.perVolumeIdDefaultProperties=new Map,this.viewportProperties={},this.volumeIds=new Set,this.setRotation=i=>{const a=this.getPan(this.fitToCanvasCamera),s=this.getPan(),o=this.getCamera(),c=Xi([0,0],a,s);this.setPan(c,!1);const{flipVertical:l}=this.getCamera(),u=l?kt([0,0,0],this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:u}),this.rotateCamera(i);const f=this.getPan(),g=this.getPan(this.fitToCanvasCamera),h=Xi([0,0],f,g),p=cs([0,0],a,h);if(this.setPan(p,!1),this._suppressCameraModifiedEvents)return;const d=this.getCamera(),m={previousCamera:o,camera:d,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};H(this.element,A.CAMERA_MODIFIED,m)},this.getDefaultProperties=i=>{let a;return i!==void 0&&(a=this.perVolumeIdDefaultProperties.get(i)),a!==void 0?a:{...this.globalDefaultProperties}},this.getProperties=i=>{var x;if(!this._getApplicableVolumeActor(i))return;const{colormap:s,VOILUTFunction:o,interpolationType:c,invert:l,slabThickness:u,preset:f}=this.viewportProperties;if(i||(i=this.getVolumeId()),!q.getVolume(i))return null;const h=this.getActors().find(w=>w.referencedId===i);if(!h)return;const d=h.actor.getProperty().getRGBTransferFunction(0),[m,y]=((x=this.viewportProperties)==null?void 0:x.VOILUTFunction)==="SIGMOID"?_u(d):d.getRange(),T={lower:m,upper:y},v=this.getColormap(i);return{colormap:i&&v?v:s,voiRange:T,VOILUTFunction:o,interpolationType:c,invert:l,slabThickness:u,preset:f}},this.getColormap=i=>{const a=this._getApplicableVolumeActor(i);if(!a)return;const{volumeActor:s}=a,o=this._getOrCreateColorTransferFunction(i),{nodes:c}=o.getState(),l=c.reduce((f,g)=>(f.push(g.x,g.r,g.g,g.b),f),[]);return Ms(l,s)},this.getRotation=()=>{const{viewUp:i,viewPlaneNormal:a,flipVertical:s}=this.getCameraNoRotation(),o=s?kt([0,0,0],this.initialViewUp):this.initialViewUp;if(!o)return 0;const c=a2(o,i)*180/Math.PI,l=ve([0,0,0],o,i);return fe(l,a)>=0?c:(360-c)%360},this.getFrameOfReferenceUID=()=>this._FrameOfReferenceUID,this.canvasToWorld=i=>{var p,d;const a=this.getVtkActiveCamera();(p=a.setIsPerformingCoordinateTransformation)==null||p.call(a,!0);const s=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),u=window.devicePixelRatio||1,f=[i[0]*u,i[1]*u],g=[f[0]+this.sx,f[1]+this.sy];g[1]=l[1]-g[1];const h=c.displayToWorld(g[0],g[1],0,s);return(d=a.setIsPerformingCoordinateTransformation)==null||d.call(a,!1),[h[0],h[1],h[2]]},this.worldToCanvas=i=>{var p;const a=this.getVtkActiveCamera();(p=a.setIsPerformingCoordinateTransformation)==null||p.call(a,!0);const s=this.getRenderer(),c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),u=c.worldToDisplay(...i,s);u[1]=l[1]-u[1];const f=[u[0]-this.sx,u[1]-this.sy],g=window.devicePixelRatio||1,h=[f[0]/g,f[1]/g];return a.setIsPerformingCoordinateTransformation(!1),h},this.hasImageURI=i=>this.getActors().filter(s=>Xe(s,"vtkVolume")).some(({uid:s,referencedId:o})=>{const c=q.getVolume(o||s);return c!=null&&c.imageIds?c.imageIds.map(ot).includes(i):!1}),this.getImageIds=i=>{const a=this._getApplicableVolumeActor(i);if(!a)throw new Error(`No actor found for the given volumeId: ${i}`);const s=a.volumeId,o=q.getVolume(s);if(!o)throw new Error(`imageVolume with id: ${s} does not exist in cache`);return o.imageIds},this.useCPURendering=Rr(),this.useCPURendering)throw new Error("VolumeViewports cannot be used whilst CPU Fallback Rendering is enabled.");const n=this.getRenderer(),r=jp.newInstance();switch(n.setActiveCamera(r),this.type){case Ce.ORTHOGRAPHIC:r.setParallelProjection(!0);break;case Ce.VOLUME_3D:r.setParallelProjection(!0);break;case Ce.PERSPECTIVE:r.setParallelProjection(!1);break;default:throw new Error(`Unrecognized viewport type: ${this.type}`)}this.initializeVolumeNewImageEventDispatcher()}static get useCustomRenderingPipeline(){return!1}getSliceViewInfo(){throw new Error("Method not implemented.")}applyViewOrientation(e,n=!0){const{viewPlaneNormal:r,viewUp:i}=this._getOrientationVectors(e),a=this.getVtkActiveCamera();a.setDirectionOfProjection(-r[0],-r[1],-r[2]),a.setViewUpFrom(i),this.initialViewUp=i,n&&this.resetCamera({resetOrientation:!1,resetRotation:!1})}initializeVolumeNewImageEventDispatcher(){const e=r.bind(this),n=i.bind(this);function r(a){const{viewportId:s}=a.detail;s!==this.id||this.isDisabled||!this.getImageData()||Um(a)}function i(a){const{viewportId:s}=a.detail;s===this.id&&(this.element.removeEventListener(A.CAMERA_MODIFIED,e),ae.removeEventListener(A.ELEMENT_DISABLED,n),_m(s))}this.element.removeEventListener(A.CAMERA_MODIFIED,e),this.element.addEventListener(A.CAMERA_MODIFIED,e),ae.addEventListener(A.ELEMENT_DISABLED,n)}setVOILUTFunction(e,n,r){Object.values(qe).includes(e)||(e=qe.LINEAR);const{voiRange:i}=this.getProperties();this.setVOI(i,n,r),this.viewportProperties.VOILUTFunction=e}setColormap(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i,s=Mn.newInstance();let o=Gr(e.name);const{name:c}=e;if(o||(o=ia.getPresetByName(c)),!o)throw new Error(`Colormap ${e} not found`);const l=a.getProperty().getRGBTransferFunction(0).getRange();if(s.applyColorMap(o),s.setMappingRange(l[0],l[1]),a.getProperty().setRGBTransferFunction(0,s),this.viewportProperties.colormap=e,!r){const u={viewportId:this.id,colormap:e,volumeId:n};H(this.element,A.VOI_MODIFIED,u),H(this.element,A.COLORMAP_MODIFIED,u)}}setOpacity(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r,a=Pr.newInstance();if(typeof e.opacity=="number"){const s=i.getProperty().getRGBTransferFunction(0).getRange();a.addPoint(s[0],e.opacity),a.addPoint(s[1],e.opacity)}else e.opacity.forEach(({opacity:s,value:o})=>{a.addPoint(o,s)});i.getProperty().setScalarOpacity(0,a),this.viewportProperties.colormap||(this.viewportProperties.colormap={}),this.viewportProperties.colormap.opacity=e.opacity}setInvert(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const a=i.volumeId,s=this._getOrCreateColorTransferFunction(a);if(Mr(s),this.viewportProperties.invert=e,!r){const o={...this.getVOIModifiedEventDetail(a),invertStateChanged:!0};H(this.element,A.VOI_MODIFIED,o)}}getVOIModifiedEventDetail(e){const n=this._getApplicableVolumeActor(e);if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);const a=n.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange(),s=this.getColormap(e),{VOILUTFunction:o,invert:c}=this.getProperties(e);return{viewportId:this.id,range:{lower:a[0],upper:a[1]},volumeId:n.volumeId,VOILUTFunction:o,colormap:s,invert:c}}_getOrCreateColorTransferFunction(e){const n=this._getApplicableVolumeActor(e);if(!n)return null;const{volumeActor:r}=n,i=r.getProperty().getRGBTransferFunction(0);if(i)return i;const a=Mn.newInstance();return r.getProperty().setRGBTransferFunction(0,a),a}setInterpolationType(e,n){const r=this._getApplicableVolumeActor(n);if(!r)return;const{volumeActor:i}=r;i.getProperty().setInterpolationType(e),this.viewportProperties.interpolationType=e}setVOI(e,n,r=!1){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i,s=i.volumeId,o=e;if(typeof o>"u")throw new Error("voiRangeToUse is undefined, need to implement this in the new volume model");const{VOILUTFunction:c}=this.getProperties(s);if(c===qe.SAMPLED_SIGMOID){const l=Ds(o);a.getProperty().setRGBTransferFunction(0,l)}else{const{lower:l,upper:u}=o;a.getProperty().getRGBTransferFunction(0).setRange(l,u)}if(!r){const l={...this.getVOIModifiedEventDetail(s)};H(this.element,A.VOI_MODIFIED,l)}this.viewportProperties.voiRange=o}rotateCamera(e){const n=e-this.getRotation();this.getVtkActiveCamera().roll(-n)}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:this.perVolumeIdDefaultProperties.set(n,e)}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perVolumeIdDefaultProperties.delete(e),this.resetToDefaultProperties(e))}getViewReference(e={}){const n=super.getViewReference(e),r=this.getVolumeId(e);if((e==null?void 0:e.forFrameOfReference)!==!1&&(n.volumeId=r),typeof(e==null?void 0:e.sliceIndex)!="number")return n;const{viewPlaneNormal:i}=n,a=(e==null?void 0:e.sliceIndex)-this.getSliceIndex(),{sliceRangeInfo:s}=Xn(this,r,!0),{sliceRange:o,spacingInNormalDirection:c,camera:l}=s,{focalPoint:u,position:f}=l,{newFocalPoint:g}=qn(u,f,o,i,c,a);return n.cameraFocalPoint=g,n}isReferenceViewable(e,n){if(!e.FrameOfReferenceUID||!super.isReferenceViewable(e,n))return!1;if(n!=null&&n.withNavigation)return!0;const r=this.getSliceIndex(),{sliceIndex:i}=e;return Array.isArray(i)?i[0]<=r&&r<=i[1]:i===void 0||i===r}scroll(e=1){const n=this.getVolumeId(),{sliceRangeInfo:r}=Xn(this,n,!0);if(!r)return;const{sliceRange:i,spacingInNormalDirection:a,camera:s}=r,{focalPoint:o,viewPlaneNormal:c,position:l}=s,{newFocalPoint:u,newPosition:f}=qn(o,l,i,c,a,e);this.setCamera({focalPoint:u,position:f})}setViewReference(e){if(!e)return;const n=this.getVolumeId(),{viewPlaneNormal:r,FrameOfReferenceUID:i,cameraFocalPoint:a,viewUp:s}=e;let{sliceIndex:o}=e;const{focalPoint:c,viewPlaneNormal:l,position:u}=this.getCamera(),f=Hl(l,r),g=Ne(l,r);if(typeof o=="number"&&e.volumeId===n&&(f||g)){const{currentStepIndex:h,sliceRangeInfo:p,numScrollSteps:d}=Xn(this,n,!0),{sliceRange:m,spacingInNormalDirection:y}=p;f&&(o=d-o-1);const T=o-h,{newFocalPoint:v,newPosition:C}=qn(c,u,m,l,y,T);this.setCamera({focalPoint:v,position:C})}else if(i===this.getFrameOfReferenceUID()){if(r&&!f&&!g){this.setOrientation({viewPlaneNormal:r,viewUp:s}),this.setViewReference(e);return}if(a){const h=Pe([0,0,0],a,c),p=r??l,d=fe(h,p);Ne(d,0)||tn(h,p,d);const m=rn([0,0,0],c,h),y=rn([0,0,0],u,h);this.setCamera({focalPoint:m,position:y})}}else throw new Error(`Incompatible view refs: ${i}!==${this.getFrameOfReferenceUID()}`)}setProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:i,preset:a,interpolationType:s,slabThickness:o}={},c,l=!1){this.globalDefaultProperties==null&&this.setDefaultProperties({voiRange:e,VOILUTFunction:n,invert:r,colormap:i,preset:a,slabThickness:o}),r!==void 0&&this.viewportProperties.invert!==r&&this.setInvert(r,c,l),i!=null&&i.name&&this.setColormap(i,c,l),(i==null?void 0:i.opacity)!=null&&this.setOpacity(i,c),e!==void 0&&this.setVOI(e,c,l),typeof s<"u"&&this.setInterpolationType(s),n!==void 0&&this.setVOILUTFunction(n,c,l),a!==void 0&&this.setPreset(a,c,l),o!==void 0&&this.setSlabThickness(o)}resetToDefaultProperties(e){var r,i;const n=this.globalDefaultProperties;(r=n.colormap)!=null&&r.name&&this.setColormap(n.colormap,e),((i=n.colormap)==null?void 0:i.opacity)!=null&&this.setOpacity(n.colormap,e),n.voiRange!==void 0&&this.setVOI(n.voiRange,e),n.VOILUTFunction!==void 0&&this.setVOILUTFunction(n.VOILUTFunction,e),n.invert!==void 0&&this.setInvert(n.invert,e),n.slabThickness!==void 0&&(this.setSlabThickness(n.slabThickness),this.viewportProperties.slabThickness=n.slabThickness),n.preset!==void 0&&this.setPreset(n.preset,e,!1),n.preset!==void 0&&this.setPreset(n.preset,e,!1),this.render()}setPreset(e,n,r){const i=this._getApplicableVolumeActor(n);if(!i)return;const{volumeActor:a}=i;let s=e;typeof s=="string"&&(s=Vf.find(o=>o.name===e)),s&&(Uu(a,s),this.viewportProperties.preset=s,this.render(),r||H(this.element,A.PRESET_MODIFIED,{viewportId:this.id,volumeId:i.volumeId,actor:a,presetName:s.name}))}async setVolumes(e,n=!1,r=!1){const i=q.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist, you need to create/allocate the volume first`);const a=i.metadata.FrameOfReferenceUID;this._isValidVolumeInputArray(e,a),this._FrameOfReferenceUID=a,e.forEach(o=>{this._addVolumeId(o.volumeId)});const s=[];for(let o=0;o<e.length;o++){const{volumeId:c,actorUID:l,slabThickness:u,...f}=e[o],g=await sc(e[o],this.element,this.id,r),h=l||Rt();s.push({uid:h,actor:g,slabThickness:u,referencedId:c,...f})}this._setVolumeActors(s),this.viewportStatus=Ke.PRE_RENDER,this.initializeColorTransferFunction(e),H(this.element,A.VOLUME_VIEWPORT_NEW_VOLUME,{viewportId:this.id,volumeActors:s}),n&&this.render()}async addVolumes(e,n=!1,r=!1){const i=q.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);const a=[];this._isValidVolumeInputArray(e,this._FrameOfReferenceUID),e.forEach(s=>{this._addVolumeId(s.volumeId)});for(let s=0;s<e.length;s++){const{volumeId:o,visibility:c,actorUID:l,slabThickness:u,...f}=e[s],g=await sc(e[s],this.element,this.id,r);c||g.setVisibility(!1);const h=l||Rt();a.push({uid:h,actor:g,slabThickness:u,referencedId:o,...f})}this.addActors(a),this.initializeColorTransferFunction(e),n&&this.render()}removeVolumeActors(e,n=!1){this.removeActors(e),n&&this.render()}setOrientation(e,n=!0){console.warn('Method "setOrientation" needs implementation')}initializeColorTransferFunction(e){const n=e[0].volumeId,r=this._getOrCreateColorTransferFunction(n);!this.initialTransferFunctionNodes&&r&&(this.initialTransferFunctionNodes=aa(r))}_getApplicableVolumeActor(e){const n=this.getActors();if(!(n!=null&&n.length))return;if(e){const i=n.find(a=>a.referencedId===e);return i?{volumeActor:i.actor,volumeId:e,actorUID:i.uid}:void 0}const r=n[0];return{volumeActor:r.actor,volumeId:r.referencedId,actorUID:r.uid}}async _isValidVolumeInputArray(e,n){const r=e.length;for(let i=1;i<r;i++){const a=q.getVolume(e[i].volumeId);if(n!==a.metadata.FrameOfReferenceUID)throw new Error(`Volumes being added to viewport ${this.id} do not share the same FrameOfReferenceUID. This is not yet supported`)}return!0}getBounds(){return this.getRenderer().computeVisiblePropBounds()}flip(e){super.flip(e)}hasVolumeId(e){return this.volumeIds.has(e)}hasVolumeURI(e){for(const n of this.volumeIds)if(n.includes(e))return!0;return!1}getImageData(e){var o,c,l;if(!this.getDefaultActor())return;e||(e=this.getVolumeId());const r=(o=this.getActors())==null?void 0:o.find(u=>u.referencedId===e);if(!Xe(r,"vtkVolume"))return;const i=r.actor,a=q.getVolume(e),s=i.getMapper().getInputData();return{dimensions:s.getDimensions(),spacing:s.getSpacing(),origin:s.getOrigin(),direction:s.getDirection(),imageData:i.getMapper().getInputData(),metadata:{Modality:(c=a==null?void 0:a.metadata)==null?void 0:c.Modality,FrameOfReferenceUID:(l=a==null?void 0:a.metadata)==null?void 0:l.FrameOfReferenceUID},get scalarData(){var u;return(u=a==null?void 0:a.voxelManager)==null?void 0:u.getScalarData()},scaling:a==null?void 0:a.scaling,hasPixelSpacing:!0,voxelManager:a==null?void 0:a.voxelManager}}setCameraClippingRange(){throw new Error("Method not implemented.")}getSliceIndex(){throw new Error("Method not implemented.")}setCamera(e,n){super.setCamera(e,n),this.setCameraClippingRange()}_setVolumeActors(e){for(let n=0;n<e.length;n++)this.viewportProperties.invert=!1;this.setActors(e)}_getOrientationVectors(e){if(typeof e=="object"){if(e.viewPlaneNormal&&e.viewUp)return e;throw new Error("Invalid orientation object. It must contain viewPlaneNormal and viewUp")}else{if(typeof e=="string"&&dn[e])return this.viewportProperties.orientation=e,dn[e];throw new Error(`Invalid orientation: ${e}. Valid orientations are: ${Object.keys(dn).join(", ")}`)}}getSlabThickness(){const e=this.getActors();let n=Te.MINIMUM_SLAB_THICKNESS;return e.forEach(r=>{r.slabThickness>n&&(n=r.slabThickness)}),n}getIntensityFromWorld(e){const n=this.getDefaultActor();if(!Xe(n,"vtkVolume"))return;const{actor:r}=n,i=r.getMapper().getInputData(),a=q.getVolume(this.getVolumeId()),s=Va(i,e);return a.voxelManager.getAtIJKPoint(s)}getVolumeId(e){const n=this.getActors();if(!n)return;if(!(e!=null&&e.volumeId)){const i=n.find(a=>a.actor.getClassName()==="vtkVolume");return(i==null?void 0:i.referencedId)||(i==null?void 0:i.uid)}const r=n.find(i=>i.actor.getClassName()==="vtkVolume"&&i.referencedId===(e==null?void 0:e.volumeId));return(r==null?void 0:r.referencedId)||(r==null?void 0:r.uid)}getViewReferenceId(e={}){var c;let{volumeId:n,sliceIndex:r}=e;if(!n){const l=this.getActors();if(!l)return;n=(c=l.find(u=>u.actor.getClassName()==="vtkVolume"))==null?void 0:c.referencedId}const i=this.getSliceIndex();r??(r=i);const{viewPlaneNormal:a,focalPoint:s}=this.getCamera(),o=n.includes("?")?"&":"?";return`volumeId:${n}${o}sliceIndex=${r}&viewPlaneNormal=${a.join(",")}`}_addVolumeId(e){this.volumeIds.add(e)}getAllVolumeIds(){return Array.from(this.volumeIds)}}function Zt(t,e){const{imageData:n}=t.getImageData(),r=t.canvasToWorld(e);return Va(n,r)}function ca(t,e){return t.indexToWorld(e)}function Wm(t,e){const{imageData:n}=t.getImageData(),r=ca(n,e);return t.worldToCanvas(r)}class Wr extends Na{constructor(e){super(e),this._useAcquisitionPlaneForViewPlane=!1,this.getNumberOfSlices=()=>{const{numberOfSlices:r}=oa(this)||{};return r},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetRotation:!1,suppressEvents:!0}),this.getCurrentImageIdIndex=(r,i=!0)=>{const{currentStepIndex:a}=Xn(this,r||this.getVolumeId(),i);return a},this.getSliceIndex=()=>{const{imageIndex:r}=oa(this)||{};return r},this.getCurrentImageId=()=>{const r=this.getDefaultActor();if(!r||!Xe(r,"vtkVolume"))return;const i=q.getVolume(this.getVolumeId());if(!i)return;const{viewPlaneNormal:a,focalPoint:s}=this.getCamera();return ra(i,s,a)},this.getSlicePlaneCoordinates=()=>{const r=this.getDefaultActor();if(!(r!=null&&r.actor))return console.warn("No image data found for calculating vtkPlanes."),[];const i=this.getVolumeId(),a=q.getVolume(i),s=this.getCamera(),{focalPoint:o,position:c,viewPlaneNormal:l}=s,u=Zr(a,l),f=Da(r.actor,l,o),g=Math.round((f.current-f.min)/u),h=Math.round((f.max-f.current)/u),p=this.getSliceIndex(),d=[];for(let m=-g;m<=h;m++){const{newFocalPoint:y}=qn(o,c,f,l,u,m);d.push({sliceIndex:p+m,point:y})}return d};const{orientation:n}=this.options;if(n&&n!==br.ACQUISITION){this.applyViewOrientation(n);return}this._useAcquisitionPlaneForViewPlane=!0}async setVolumes(e,n=!1,r=!1){const i=q.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1),super.setVolumes(e,n,r)}async addVolumes(e,n=!1,r=!1){const i=q.getVolume(e[0].volumeId);if(!i)throw new Error(`imageVolume with id: ${i.volumeId} does not exist`);return this._useAcquisitionPlaneForViewPlane&&(this._setViewPlaneToAcquisitionPlane(i),this._useAcquisitionPlaneForViewPlane=!1),super.addVolumes(e,n,r)}jumpToWorld(e){const{focalPoint:n}=this.getCamera(),r=[0,0,0];$e(r,e,n);const i=this.getCamera(),a=i.viewPlaneNormal,s=fe(r,a),o=xe(a[0],a[1],a[2]);if(tn(o,o,s),Math.abs(o[0])>.001||Math.abs(o[1])>.001||Math.abs(o[2])>.001){const c=[0,0,0],l=[0,0,0];rn(c,i.focalPoint,o),rn(l,i.position,o),this.setCamera({focalPoint:c,position:l}),this.render()}return!0}setOrientation(e,n=!0){let r,i;if(typeof e=="string"){if(dn[e])({viewPlaneNormal:r,viewUp:i}=dn[e]);else if(e==="acquisition")({viewPlaneNormal:r,viewUp:i}=this._getAcquisitionPlaneOrientation());else throw new Error(`Invalid orientation: ${e}. Use Enums.OrientationAxis instead.`);this.setCamera({viewPlaneNormal:r,viewUp:i}),this.viewportProperties.orientation=e,this.resetCamera()}else({viewPlaneNormal:r,viewUp:i}=e),this.applyViewOrientation(e);n&&this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();if(!e){console.warn("No active camera found");return}e.getParallelProjection()?e.setClippingRange(-Te.MAXIMUM_RAY_DISTANCE,Te.MAXIMUM_RAY_DISTANCE):e.setClippingRange(Te.MINIMUM_SLAB_THICKNESS,Te.MAXIMUM_RAY_DISTANCE)}_getAcquisitionPlaneOrientation(){if(!this.getDefaultActor())return;const n=this.getVolumeId(),r=q.getVolume(n);if(!r)throw new Error(`imageVolume with id: ${n} does not exist in cache`);const{direction:i}=r,a=i.slice(6,9).map(o=>-o),s=i.slice(3,6).map(o=>-o);return{viewPlaneNormal:a,viewUp:s}}_setViewPlaneToAcquisitionPlane(e){let n,r;if(e){const{direction:i}=e;n=i.slice(6,9).map(a=>-a),r=i.slice(3,6).map(a=>-a)}else({viewPlaneNormal:n,viewUp:r}=this._getAcquisitionPlaneOrientation());this.setCamera({viewPlaneNormal:n,viewUp:r}),this.initialViewUp=r,this.resetCamera()}getBlendMode(e){const n=this.getActors(),r=(e==null?void 0:e.length)>0?n.find(i=>e.includes(i.uid)):n[0];return(r==null?void 0:r.blendMode)||(r==null?void 0:r.actor.getMapper().getBlendMode())}setBlendMode(e,n=[],r=!1){let i=this.getActors();(n==null?void 0:n.length)>0&&(i=i.filter(a=>n.includes(a.uid))),i.forEach(a=>{var c;const{actor:s}=a,o=s.getMapper();(c=o.setBlendMode)==null||c.call(o,e),a.blendMode=e}),r&&this.render()}resetCamera(e){const{resetPan:n=!0,resetZoom:r=!0,resetRotation:i=!0,resetToCenter:a=!0,suppressEvents:s=!1,resetOrientation:o=!0}=e||{},{orientation:c}=this.viewportProperties;c&&o&&this.applyViewOrientation(c,!1),super.resetCamera({resetPan:n,resetZoom:r,resetToCenter:a});const l=this.getVtkActiveCamera(),u=l.getViewPlaneNormal(),f=l.getFocalPoint();if(this.getActors().forEach(h=>{if(!h.actor)return;const p=h.actor.getMapper();if(p.getClippingPlanes().length===0&&!(h!=null&&h.clippingFilter)){const m=Ge.newInstance(),y=Ge.newInstance(),T=[m,y];let v=Te.MINIMUM_SLAB_THICKNESS;h.slabThickness&&(v=h.slabThickness),this.setOrientationOfClippingPlanes(T,v,u,f),p.addClippingPlane(m),p.addClippingPlane(y)}}),i&&dn[this.viewportProperties.orientation]!==void 0){const h=dn[this.viewportProperties.orientation];this.setCameraNoEvent({viewUp:h.viewUp,viewPlaneNormal:h.viewPlaneNormal})}if(!s){const h={viewportId:this.id,camera:this.getCamera(),renderingEngineId:this.renderingEngineId,element:this.element};H(this.element,A.CAMERA_RESET,h)}return!0}setSlabThickness(e,n=[]){e<.1&&(e=.1);let r=this.getActors();(n==null?void 0:n.length)>0&&(r=r.filter(a=>n.includes(a.uid))),r.forEach(a=>{Xe(a,"vtkVolume")&&(a.slabThickness=e)});const i=this.getCamera();this.updateClippingPlanesForActors(i),this.triggerCameraModifiedEventIfNecessary(i,i),this.viewportProperties.slabThickness=e}resetSlabThickness(){this.getActors().forEach(r=>{Xe(r,"vtkVolume")&&(r.slabThickness=Te.MINIMUM_SLAB_THICKNESS)});const n=this.getCamera();this.updateClippingPlanesForActors(n),this.triggerCameraModifiedEventIfNecessary(n,n),this.viewportProperties.slabThickness=void 0}getSliceViewInfo(){const{width:e,height:n}=this.getCanvas(),r=Zt(this,[0,0]),i=Zt(this,[e-1,0]),a=Zt(this,[0,n-1]),s=$e($(),i,r),o=$e($(),a,r),c=ve($(),s,o);_e(s,s),_e(o,o),_e(c,c);const{dimensions:l}=this.getImageData(),[u,f,g]=l,d=[[0,0,0],[u-1,0,0],[0,f-1,0],[u-1,f-1,0],[0,0,g-1],[u-1,0,g-1],[0,f-1,g-1],[u-1,f-1,g-1]].map(S=>Wm(this,S)).reduce((S,M)=>(S.minX=Math.min(S.minX,M[0]),S.minY=Math.min(S.minY,M[1]),S.maxX=Math.max(S.maxX,M[0]),S.maxY=Math.max(S.maxY,M[1]),S),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),m=Zt(this,[d.minX,d.minY]),y=X1(s[0],s[1],s[2],0,o[0],o[1],o[2],0,c[0],c[1],c[2],0,m[0],m[1],m[2],1),T=Zt(this,[d.maxX,d.maxY]),v=$e($(),T,m),C=ke(Dn(),y),{viewPlaneNormal:x}=this.getCamera();if(x.filter(S=>Math.abs(S)>Pt).length>1)throw new Error("getSliceInfo is not supported for oblique views");const E=x.findIndex(S=>Math.abs(S)>1-Pt);if(E===-1)throw new Error("Unable to determine slice axis");const O=fe(s,v)+1,D=fe(o,v)+1;return{sliceIndex:this.getSliceIndex(),width:O,height:D,slicePlane:E,sliceToIndexMatrix:y,indexToSliceMatrix:C}}getCurrentSlicePixelData(){const{voxelManager:e}=this.getImageData();return e.getSliceData(this.getSliceViewInfo())}getViewReference(e={}){const n=super.getViewReference(e);if(!(n!=null&&n.volumeId))return;const r=q.getVolume(n.volumeId);return n.referencedImageId=ra(r,n.cameraFocalPoint,n.viewPlaneNormal),n}resetProperties(e){this._resetProperties(e)}_resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=Te.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||(e=this.getVolumeId());const r=q.getVolume(e);if(!r)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(bs(n.actor,r),xt(n)){const l=n.actor.getProperty().getRGBTransferFunction(0);Ia(l,this.initialTransferFunctionNodes)}const i={...super.getVOIModifiedEventDetail(e)};this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,resetCameraRotation:!0}),H(this.element,A.VOI_MODIFIED,i)}getSlicesClippingPlanes(){const e=this.getSlicePlaneCoordinates(),{viewPlaneNormal:n}=this.getCamera(),r=Te.MINIMUM_SLAB_THICKNESS;return e.map(({point:i,sliceIndex:a})=>{const s=[Ge.newInstance(),Ge.newInstance()];return this.setOrientationOfClippingPlanes(s,r,n,i),{sliceIndex:a,planes:s.map(o=>({normal:o.getNormal(),origin:o.getOrigin()}))}})}}function zm(t,e){e.classHierarchy.push("vtkAbstractImageMapper"),t.getIsOpaque=()=>!0,t.getCurrentImage=()=>null,t.getBoundsForSlice=()=>(R.vtkErrorMacro("vtkAbstractImageMapper.getBoundsForSlice - NOT IMPLEMENTED"),Jn())}const $m={slice:0,customDisplayExtent:[0,0,0,0,0,0],useCustomExtents:!1,backgroundColor:[0,0,0,1]};function jm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$m,n),el.extend(t,e,n),R.setGet(t,e,["slice","useCustomExtents"]),R.setGetArray(t,e,["customDisplayExtent"],6),R.setGetArray(t,e,["backgroundColor"],4),zm(t,e)}var Hm={extend:jm};function ku(t,e,n){const r=n.getCurrentImage(),i=r.getExtent(),a=[i[0],i[2],i[4]],{ijkMode:s}=n.getClosestIJKAxis();let o=n.isA("vtkImageArrayMapper")?n.getSubSlice():n.getSlice();s!==n.getSlicingMode()&&(o=n.getSliceAtPosition(o)),a[s]+=o;const c=[0,0,0];r.indexToWorld(a,c),a[s]+=1;const l=[0,0,0];r.indexToWorld(a,l),l[0]-=c[0],l[1]-=c[1],l[2]-=c[2],_e(l,l);const u=Ge.intersectWithLine(t,e,c,l);if(u.intersection){const f=u.x,g=[0,0,0];return r.worldToIndex(f,g),{t:u.t,absoluteIJK:g}}return null}function Km(t,e,n){const r=ku(t,e,n);if(r){const a=n.getCurrentImage().getExtent(),s=[Math.round(r.absoluteIJK[0]),Math.round(r.absoluteIJK[1]),Math.round(r.absoluteIJK[2])];return s[0]<a[0]||s[0]>a[1]||s[1]<a[2]||s[1]>a[3]||s[2]<a[4]||s[2]>a[5]?null:{t:r.t,ijk:s}}return null}function qm(t,e,n){const r=ku(t,e,n);if(r){const a=n.getCurrentImage().getExtent(),s=r.absoluteIJK,o=[Math.floor(s[0]),Math.floor(s[1]),Math.floor(s[2])];if(o[0]<a[0]||o[0]>a[1]-1||o[1]<a[2]||o[1]>a[3]-1||o[2]<a[4]||o[2]>(a[5]?a[5]-1:a[5]))return null;const c=[s[0]-o[0],s[1]-o[1],s[2]-o[2]];return{t:r.t,ijk:o,pCoords:c}}return null}const{staticOffsetAPI:Xm,otherStaticMethods:Ym}=cl,{SlicingMode:ne}=Ra;function Zm(t,e){e.classHierarchy.push("vtkImageMapper"),t.getSliceAtPosition=r=>{const i=t.getCurrentImage();let a;if(r.length===3)a=r;else if(Number.isFinite(r)){const u=i.getBounds();switch(e.slicingMode){case ne.X:a=[r,(u[3]+u[2])/2,(u[5]+u[4])/2];break;case ne.Y:a=[(u[1]+u[0])/2,r,(u[5]+u[4])/2];break;case ne.Z:a=[(u[1]+u[0])/2,(u[3]+u[2])/2,r];break}}const s=[0,0,0];i.worldToIndex(a,s);const o=i.getExtent(),{ijkMode:c}=t.getClosestIJKAxis();let l=0;switch(c){case ne.I:l=pt(s[0],o[0],o[1]);break;case ne.J:l=pt(s[1],o[2],o[3]);break;case ne.K:l=pt(s[2],o[4],o[5]);break;default:return 0}return l},t.setSliceFromCamera=r=>{const i=r.getFocalPoint();switch(e.slicingMode){case ne.I:case ne.J:case ne.K:{const a=t.getSliceAtPosition(i);t.setSlice(a)}break;case ne.X:t.setSlice(i[0]);break;case ne.Y:t.setSlice(i[1]);break;case ne.Z:t.setSlice(i[2]);break}},t.setXSlice=r=>{t.setSlicingMode(ne.X),t.setSlice(r)},t.setYSlice=r=>{t.setSlicingMode(ne.Y),t.setSlice(r)},t.setZSlice=r=>{t.setSlicingMode(ne.Z),t.setSlice(r)},t.setISlice=r=>{t.setSlicingMode(ne.I),t.setSlice(r)},t.setJSlice=r=>{t.setSlicingMode(ne.J),t.setSlice(r)},t.setKSlice=r=>{t.setSlicingMode(ne.K),t.setSlice(r)},t.getSlicingModeNormal=()=>{const r=[0,0,0],i=t.getCurrentImage().getDirection();switch(e.slicingMode){case ne.X:r[0]=1;break;case ne.Y:r[1]=1;break;case ne.Z:r[2]=1;break;case ne.I:Si(i,[1,0,0],r);break;case ne.J:Si(i,[0,1,0],r);break;case ne.K:Si(i,[0,0,1],r);break}return r};function n(){let r;switch(e.slicingMode){case ne.X:r=0;break;case ne.Y:r=1;break;case ne.Z:r=2;break;default:e.closestIJKAxis={ijkMode:e.slicingMode,flip:!1};return}const i=t.getCurrentImage().getDirection(),a=_1(i);let s=0;for(;s<3&&a[r+3*s]===0;++s);const o=a[r+3*s]<0;e.closestIJKAxis={ijkMode:s,flip:o}}t.setSlicingMode=r=>{e.slicingMode!==r&&(e.slicingMode=r,t.getCurrentImage()&&n(),t.modified())},t.getClosestIJKAxis=()=>((e.closestIJKAxis===void 0||e.closestIJKAxis.ijkMode===ne.NONE)&&t.getCurrentImage()&&n(),e.closestIJKAxis),t.getBounds=()=>{const r=t.getCurrentImage();if(!r)return Jn();if(!e.useCustomExtents)return r.getBounds();const i=e.customDisplayExtent.slice(),{ijkMode:a}=t.getClosestIJKAxis();let s=e.slice;switch(a!==e.slicingMode&&(s=t.getSliceAtPosition(e.slice)),a){case ne.I:i[0]=s,i[1]=s;break;case ne.J:i[2]=s,i[3]=s;break;case ne.K:i[4]=s,i[5]=s;break}return r.extentToBounds(i)},t.getBoundsForSlice=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.slice,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=t.getCurrentImage();if(!a)return Jn();const s=a.getSpatialExtent(),{ijkMode:o}=t.getClosestIJKAxis();let c=r;switch(o!==e.slicingMode&&(c=t.getSliceAtPosition(r)),o){case ne.I:s[0]=c-i,s[1]=c+i;break;case ne.J:s[2]=c-i,s[3]=c+i;break;case ne.K:s[4]=c-i,s[5]=c+i;break}return a.extentToBounds(s)},t.intersectWithLineForPointPicking=(r,i)=>Km(r,i,t),t.intersectWithLineForCellPicking=(r,i)=>qm(r,i,t),t.getCurrentImage=()=>t.getInputData()}const Jm={slicingMode:ne.NONE,closestIJKAxis:{ijkMode:ne.NONE,flip:!1},renderToRectangle:!1,sliceAtFocalPoint:!1,preferSizeOverAccuracy:!1};function Pu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Jm,n),Hm.extend(t,e,n),R.get(t,e,["slicingMode"]),R.setGet(t,e,["closestIJKAxis","renderToRectangle","sliceAtFocalPoint","preferSizeOverAccuracy"]),cl.implementCoincidentTopologyMethods(t,e),Zm(t,e)}const Qm=R.newInstance(Pu,"vtkImageMapper");var ey={newInstance:Qm,extend:Pu,...Xm,...Ym,...Ra};const{InterpolationType:Fi}=P9,{vtkErrorMacro:lc}=R,_i=4;function ty(t,e){e.classHierarchy.push("vtkImageProperty"),t.getMTime=()=>{let n=e.mtime,r;for(let i=0;i<_i;i++)e.componentData[i].rGBTransferFunction&&(r=e.componentData[i].rGBTransferFunction.getMTime(),n=n>r?n:r),e.componentData[i].piecewiseFunction&&(r=e.componentData[i].piecewiseFunction.getMTime(),n=n>r?n:r);return n},t.setRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),e.componentData[i].rGBTransferFunction!==a?(e.componentData[i].rGBTransferFunction=a,t.modified(),!0):!1},t.getRGBTransferFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].rGBTransferFunction},t.setPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),e.componentData[i].piecewiseFunction!==a?(e.componentData[i].piecewiseFunction=a,t.modified(),!0):!1},t.getPiecewiseFunction=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.componentData[n].piecewiseFunction},t.setScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=n,a=r;return Number.isInteger(n)||(a=n,i=0),t.setPiecewiseFunction(i,a)},t.getScalarOpacity=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return t.getPiecewiseFunction(n)},t.setComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(n<0||n>=_i)return lc("Invalid index"),!1;const i=Math.min(1,Math.max(0,r));return e.componentData[n].componentWeight!==i?(e.componentData[n].componentWeight=i,t.modified(),!0):!1},t.getComponentWeight=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return n<0||n>=_i?(lc("Invalid index"),0):e.componentData[n].componentWeight},t.setInterpolationTypeToNearest=()=>t.setInterpolationType(Fi.NEAREST),t.setInterpolationTypeToLinear=()=>t.setInterpolationType(Fi.LINEAR),t.getInterpolationTypeAsString=()=>R.enumToString(Fi,e.interpolationType)}const ny={independentComponents:!1,interpolationType:Fi.LINEAR,colorWindow:255,colorLevel:127.5,ambient:1,diffuse:0,opacity:1,useLookupTableScalarRange:!1,useLabelOutline:!1,labelOutlineThickness:[1],labelOutlineOpacity:1};function Gu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,ny,n),R.obj(t,e),!e.componentData){e.componentData=[];for(let r=0;r<_i;r++)e.componentData.push({rGBTransferFunction:null,piecewiseFunction:null,componentWeight:1})}R.setGet(t,e,["independentComponents","interpolationType","colorWindow","colorLevel","ambient","diffuse","opacity","useLookupTableScalarRange","useLabelOutline","labelOutlineOpacity"]),R.setGetArray(t,e,["labelOutlineThickness"]),ty(t,e)}const ry=R.newInstance(Gu,"vtkImageProperty");var iy={newInstance:ry,extend:Gu};const{vtkDebugMacro:ay}=R;function sy(t,e){e.classHierarchy.push("vtkImageSlice"),t.getActors=()=>t,t.getImages=()=>t,t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let n=e.property.getOpacity()>=1;return n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>!1,t.makeProperty=iy.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;const r=i=>i[0].map((a,s)=>i.map(o=>o[s]));if(!e.mapperBounds||!r([n,e.mapperBounds]).reduce((i,a)=>i&&a[0]===a[1],!0)||t.getMTime()>e.boundsMTime.getMTime()){ay("Recomputing bounds..."),e.mapperBounds=n.map(a=>a),t.computeMatrix();const i=new Float64Array(16);ue(i,e.matrix),De.transformBounds(n,i,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBoundsForSlice=(n,r)=>{const i=e.mapper.getBoundsForSlice(n,r);if(!De.isValid(i))return i;t.computeMatrix();const a=new Float64Array(16);return ue(a,e.matrix),De.transformBounds(i,a)},t.getMinXBound=()=>t.getBounds()[0],t.getMaxXBound=()=>t.getBounds()[1],t.getMinYBound=()=>t.getBounds()[2],t.getMaxYBound=()=>t.getBounds()[3],t.getMinZBound=()=>t.getBounds()[4],t.getMaxZBound=()=>t.getBounds()[5],t.getMTime=()=>{let n=e.mtime;if(e.property!==null){const r=e.property.getMTime();n=r>n?r:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let r=e.mapper.getMTime();n=r>n?r:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),r=e.mapper.getInput().getMTime(),n=r>n?r:n)}if(e.property!==null){let r=e.property.getMTime();n=r>n?r:n,e.property.getRGBTransferFunction()!==null&&(r=e.property.getRGBTransferFunction().getMTime(),n=r>n?r:n)}return n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1}const oy={mapper:null,property:null,forceOpaque:!1,forceTranslucent:!1,bounds:[...De.INIT_BOUNDS]};function Au(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oy,n),bl.extend(t,e,n),e.boundsMTime={},R.obj(e.boundsMTime),R.set(t,e,["property"]),R.setGet(t,e,["mapper","forceOpaque","forceTranslucent"]),R.getArray(t,e,["bounds"],6),sy(t,e)}const cy=R.newInstance(Au,"vtkImageSlice");var ly={newInstance:cy,extend:Au};function Bu(t){const e=Mn.newInstance();let n=0,r=1024;return t.lower!==void 0&&t.upper!==void 0&&(n=t.lower,r=t.upper),e.addRGBPoint(n,0,0,0),e.addRGBPoint(r,1,1,1),e}function Wu(t,e){const n=e.voxelManager.getScalarData();if(!t.getPointData)return;const r=t.getPointData().getScalars().getData();if(e.color&&e.rgba){const i=new Uint8Array(e.columns*e.rows*3);for(let a=0;a<e.columns*e.rows;a++)i[a*3]=n[a*4],i[a*3+1]=n[a*4+1],i[a*3+2]=n[a*4+2];e.rgba=!1,e.getPixelData=()=>i,r.set(i)}else r.set(n);t.modified()}function Z(){return window.performance?performance.now():Date.now()}function uy(t,e){return function(n){const r=((n-(e-.5))/(t-1)+.5)*255;return Math.min(Math.max(r,0),255)}}function fy(t){const n=Math.max(...t.lut).toString(2).length-8,r=t.lut[0]>>n,i=t.lut[t.lut.length-1]>>n,a=t.firstValueMapped+t.lut.length-1;return function(s){return s<t.firstValueMapped?r:s>=a?i:t.lut[s-t.firstValueMapped]>>n}}function zu(t,e,n){return n?fy(n):uy(t,e)}function gy(t,e,n,r,i){const a=t.maxPixelValue,s=t.minPixelValue,o=Math.min(s,0);if(t.cachedLut===void 0){const u=a-o+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(u)}const c=t.cachedLut.lutArray,l=zu(Array.isArray(e)?e[0]:e,Array.isArray(n)?n[0]:n,i);if(r)for(let u=s;u<=a;u++)c[u+-o]=255-l(u);else for(let u=s;u<=a;u++)c[u+-o]=l(u);return c}function hy(t,e,n){let r=Z();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Z()-r;const a=t.minPixelValue;let s=0,o=0;const c=i.length;if(r=Z(),a<0)for(;o<c;)n[s++]=e[i[o++]+-a],n[s++]=e[i[o++]+-a],n[s]=e[i[o]+-a],o+=2,s+=2;else for(;o<c;)n[s++]=e[i[o++]],n[s++]=e[i[o++]],n[s]=e[i[o]],o+=2,s+=2;t.stats.lastStoredPixelDataToCanvasImageDataTime=Z()-r}function py(t,e,n){let r=Z();const i=t.getPixelData();t.stats.lastGetPixelDataTime=Z()-r;const a=t.minPixelValue;let s=0,o=0;const c=i.length;if(r=Z(),a<0)for(;o<c;)n[s++]=e[i[o++]+-a],n[s++]=e[i[o++]+-a],n[s++]=e[i[o++]+-a],n[s++]=i[o++];else for(;o<c;)n[s++]=e[i[o++]],n[s++]=e[i[o++]],n[s++]=e[i[o++]],n[s++]=i[o++];t.stats.lastStoredPixelDataToCanvasImageDataTime=Z()-r}class cr{constructor(){this.reset()}getMatrix(){return this.m}reset(){this.m=[1,0,0,1,0,0]}clone(){const e=new cr;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}multiply(e){const n=this.m[0]*e[0]+this.m[2]*e[1],r=this.m[1]*e[0]+this.m[3]*e[1],i=this.m[0]*e[2]+this.m[2]*e[3],a=this.m[1]*e[2]+this.m[3]*e[3],s=this.m[0]*e[4]+this.m[2]*e[5]+this.m[4],o=this.m[1]*e[4]+this.m[3]*e[5]+this.m[5];this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this.m[4]=s,this.m[5]=o}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),n=this.m[3]*e,r=-this.m[1]*e,i=-this.m[2]*e,a=this.m[0]*e,s=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=n,this.m[1]=r,this.m[2]=i,this.m[3]=a,this.m[4]=s,this.m[5]=o}rotate(e){const n=Math.cos(e),r=Math.sin(e),i=this.m[0]*n+this.m[2]*r,a=this.m[1]*n+this.m[3]*r,s=this.m[0]*-r+this.m[2]*n,o=this.m[1]*-r+this.m[3]*n;this.m[0]=i,this.m[1]=a,this.m[2]=s,this.m[3]=o}translate(e,n){this.m[4]+=this.m[0]*e+this.m[2]*n,this.m[5]+=this.m[1]*e+this.m[3]*n}scale(e,n){this.m[0]*=e,this.m[1]*=e,this.m[2]*=n,this.m[3]*=n}transformPoint(e){const n=e[0],r=e[1];return[n*this.m[0]+r*this.m[2]+this.m[4],n*this.m[1]+r*this.m[3]+this.m[5]]}}function zr(t,e){const n=new cr;if(!t.viewport.displayedArea)return n;n.translate(t.canvas.width/2,t.canvas.height/2);const r=t.viewport.rotation;r!==0&&n.rotate(r*Math.PI/180);let i=t.viewport.scale,a=t.viewport.scale;const s=t.viewport.displayedArea.brhc.x-(t.viewport.displayedArea.tlhc.x-1),o=t.viewport.displayedArea.brhc.y-(t.viewport.displayedArea.tlhc.y-1);if(t.viewport.displayedArea.presentationSizeMode==="NONE")t.image.rowPixelSpacing<t.image.columnPixelSpacing?i*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(a*=t.image.rowPixelSpacing/t.image.columnPixelSpacing);else if(i=t.viewport.displayedArea.columnPixelSpacing,a=t.viewport.displayedArea.rowPixelSpacing,t.viewport.displayedArea.presentationSizeMode==="SCALE TO FIT"){const c=t.canvas.height/(o*a),l=t.canvas.width/(s*i);i=a=Math.min(l,c),t.viewport.displayedArea.rowPixelSpacing<t.viewport.displayedArea.columnPixelSpacing?i*=t.viewport.displayedArea.columnPixelSpacing/t.viewport.displayedArea.rowPixelSpacing:t.viewport.displayedArea.columnPixelSpacing<t.viewport.displayedArea.rowPixelSpacing&&(a*=t.viewport.displayedArea.rowPixelSpacing/t.viewport.displayedArea.columnPixelSpacing)}return n.scale(i,a),r!==0&&n.rotate(-r*Math.PI/180),n.translate(t.viewport.translation.x,t.viewport.translation.y),r!==0&&n.rotate(r*Math.PI/180),t.viewport.hflip&&n.scale(-1,1),t.viewport.vflip&&n.scale(1,-1),n.translate(-s/2,-o/2),n}function _s(t,e,n){if(t===void 0)throw new Error("setToPixelCoordinateSystem: parameter enabledElement must not be undefined");if(e===void 0)throw new Error("setToPixelCoordinateSystem: parameter context must not be undefined");const i=zr(t).getMatrix();e.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])}function Us(t,e){const n=t.renderingTools.lastRenderedImageId,r=t.renderingTools.lastRenderedViewport;return e.imageId!==n||!r||r.windowCenter!==t.viewport.voi.windowCenter||r.windowWidth!==t.viewport.voi.windowWidth||r.invert!==t.viewport.invert||r.rotation!==t.viewport.rotation||r.hflip!==t.viewport.hflip||r.vflip!==t.viewport.vflip||r.modalityLUT!==t.viewport.modalityLUT||r.voiLUT!==t.viewport.voiLUT||r.colormap!==t.viewport.colormap}function la(t,e){const n=t.renderingTools.renderCanvas;n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,n.width,n.height);const i=r.getImageData(0,0,e.width,e.height);t.renderingTools.renderCanvasContext=r,t.renderingTools.renderCanvasData=i}function ks(t){const e=t.image.imageId,n=t.viewport,r=t.image.color;return t.renderingTools.lastRenderedImageId=e,t.renderingTools.lastRenderedIsColor=r,t.renderingTools.lastRenderedViewport={windowCenter:n.voi.windowCenter,windowWidth:n.voi.windowWidth,invert:n.invert,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip,modalityLUT:n.modalityLUT,voiLUT:n.voiLUT,colormap:n.colormap},t.renderingTools}function dy(t,e){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&t.cachedLut.invert===e.invert||(gy(t,e.voi.windowWidth,e.voi.windowCenter,e.invert),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert),t.cachedLut.lutArray}function my(t,e,n){const r=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||!r)&&(t.renderingTools.renderCanvas=document.createElement("canvas"));const i=t.renderingTools.renderCanvas,{windowWidth:a,windowCenter:s}=t.viewport.voi;if((a===256||a===255)&&(s===128||s===127)&&!t.viewport.invert&&e.getCanvas&&e.getCanvas())return e.getCanvas();if(!Us(t,e)&&!n)return i;(i.width!==e.width||i.height!==e.height)&&la(t,e);let o=Z();const c=dy(e,t.viewport);e.stats=e.stats||{},e.stats.lastLutGenerateTime=Z()-o;const l=t.renderingTools.renderCanvasData,u=t.renderingTools.renderCanvasContext;return e.rgba?py(e,c,l.data):hy(e,c,l.data),o=Z(),u.putImageData(l,0,0),e.stats.lastPutImageDataTime=Z()-o,i}function yy(t,e){if(t===void 0)throw new Error("renderColorImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("renderColorImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,_s(t,r);const i=my(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,s=t.viewport.displayedArea.tlhc.y-1,o=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-s;r.drawImage(i,a,s,o,c,0,0,o,c),t.renderingTools=ks(t)}function vy(t,e,n){let r=Z();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Z()-r;const a=i.length,s=t.minPixelValue;let o=3,c=0;if(r=Z(),i instanceof Int16Array)if(s<0)for(;c<a;)n[o]=e[i[c++]+-s],o+=4;else for(;c<a;)n[o]=e[i[c++]],o+=4;else if(i instanceof Uint16Array)for(;c<a;)n[o]=e[i[c++]],o+=4;else if(s<0)for(;c<a;)n[o]=e[i[c++]+-s],o+=4;else for(;c<a;)n[o]=e[i[c++]],o+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=Z()-r}function Ty(t,e,n){let r=Z();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Z()-r;const a=i.length;let s=3,o=0;for(r=Z();o<a;)n[s]=e(i[o++]),s+=4;t.stats.lastStoredPixelDataToCanvasImageDataTime=Z()-r}function Cy(t,e,n){let r=Z();const i=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Z()-r;const a=i.length,s=t.minPixelValue;let o=0,c=0,l;if(r=Z(),i instanceof Int16Array)if(s<0)for(;c<a;)l=e[i[c++]+-s],n[o++]=l,n[o++]=l,n[o++]=l,n[o++]=255;else for(;c<a;)l=e[i[c++]],n[o++]=l,n[o++]=l,n[o++]=l,n[o++]=255;else if(i instanceof Uint16Array)for(;c<a;)l=e[i[c++]],n[o++]=l,n[o++]=l,n[o++]=l,n[o++]=255;else if(s<0)for(;c<a;)l=e[i[c++]+-s],n[o++]=l,n[o++]=l,n[o++]=l,n[o++]=255;else for(;c<a;)l=e[i[c++]],n[o++]=l,n[o++]=l,n[o++]=l,n[o++]=255;t.stats.lastStoredPixelDataToCanvasImageDataTime=Z()-r}function xy(t,e){if(wy(t))return;const n=e.maxPixelValue*e.slope+e.intercept,r=e.minPixelValue*e.slope+e.intercept,i=n-r,a=(n+r)/2;t.voi===void 0?t.voi={windowWidth:i,windowCenter:a,voiLUTFunction:e.voiLUTFunction}:(t.voi.windowWidth=i,t.voi.windowCenter=a)}function wy(t){return t.voiLUT&&t.voiLUT.lut&&t.voiLUT.lut.length>0||t.voi.windowWidth!==void 0&&t.voi.windowCenter!==void 0}function uc(t,e){return!t&&!e?!0:!t||!e?!1:t.id===e.id}function Sy(t,e){return n=>n*t+e}function Ry(t){const e=t.lut[0],n=t.lut[t.lut.length-1],r=t.firstValueMapped+t.lut.length;return i=>i<t.firstValueMapped?e:i>=r?n:t.lut[i]}function Ey(t,e,n){return n?Ry(n):Sy(t,e)}function My(t,e,n,r,i,a){const s=t.maxPixelValue,o=t.minPixelValue,c=Math.min(o,0);if(t.cachedLut===void 0){const g=s-c+1;t.cachedLut={},t.cachedLut.lutArray=new Uint8ClampedArray(g)}const l=t.cachedLut.lutArray,u=Ey(t.slope,t.intercept,i),f=zu(e,n,a);if(t.isPreScaled)if(r)for(let g=o;g<=s;g++)l[g+-c]=255-f(g);else for(let g=o;g<=s;g++)l[g+-c]=f(g);else if(r)for(let g=o;g<=s;g++)l[g+-c]=255-f(u(g));else for(let g=o;g<=s;g++)l[g+-c]=f(u(g));return l}function $u(t,e,n){return t.cachedLut!==void 0&&t.cachedLut.windowCenter===e.voi.windowCenter&&t.cachedLut.windowWidth===e.voi.windowWidth&&uc(t.cachedLut.modalityLUT,e.modalityLUT)&&uc(t.cachedLut.voiLUT,e.voiLUT)&&t.cachedLut.invert===e.invert&&!n||(xy(e,t),My(t,e.voi.windowWidth,e.voi.windowCenter,e.invert,e.modalityLUT,e.voiLUT),t.cachedLut.windowWidth=e.voi.windowWidth,t.cachedLut.windowCenter=e.voi.windowCenter,t.cachedLut.invert=e.invert,t.cachedLut.voiLUT=e.voiLUT,t.cachedLut.modalityLUT=e.modalityLUT),t.cachedLut.lutArray}function Oy(t,e,n,r=!0){const i=t.renderingTools.lastRenderedIsColor;(!t.renderingTools.renderCanvas||i)&&(t.renderingTools.renderCanvas=document.createElement("canvas"),la(t,e));const a=t.renderingTools.renderCanvas;if(!Us(t,e)&&!n)return a;(a.width!==e.width||a.height!==e.height)&&la(t,e),e.stats=e.stats||{};const s=t.renderingTools.renderCanvasData,o=t.renderingTools.renderCanvasContext;let c=Z();e.stats.lastLutGenerateTime=Z()-c;const{viewport:l}=t;if(l.modality==="PT"&&e.isPreScaled){const{windowWidth:u,windowCenter:f}=l.voi,g=f-u/2,d=255/(f+u/2-g);let m;l.invert?m=y=>255-(y-g)*d:m=y=>(y-g)*d,Ty(e,m,s.data)}else{const u=$u(e,l,n);r?vy(e,u,s.data):Cy(e,u,s.data)}return c=Z(),o.putImageData(s,0,0),e.stats.lastPutImageDataTime=Z()-c,a}function Dy(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,_s(t,r);const i=Oy(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,s=t.viewport.displayedArea.tlhc.y-1,o=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-s;r.drawImage(i,a,s,o,c,0,0,o,c),t.renderingTools=ks(t)}const D0=0,V0=1,Vy=2;function Iy(t,e,n){if(t>1)throw new Error("HSVToRGB expects hue < 1");const r=[];if(e===0)return r[0]=n,r[1]=n,r[2]=n,r;const i=Math.floor(t*6),a=6*t-i,s=n*(1-e),o=n*(1-e*a),c=n*(1-e*(1-a));switch(i){case 0:case 6:r[0]=n,r[1]=c,r[2]=s;break;case 1:r[0]=o,r[1]=n,r[2]=s;break;case 2:r[0]=s,r[1]=n,r[2]=c;break;case 3:r[0]=s,r[1]=o,r[2]=n;break;case 4:r[0]=c,r[1]=s,r[2]=n;break;case 5:r[0]=n,r[1]=s,r[2]=o;break}return r}function Ly(t,e){let n;return t<e.Range[0]?n=e.MaxIndex+D0+1.5:t>e.Range[1]?n=e.MaxIndex+V0+1.5:n=(t+e.Shift)*e.Scale,Math.floor(n)}class Ps{constructor(){this.NumberOfColors=256,this.Ramp="linear",this.TableRange=[0,255],this.HueRange=[0,.66667],this.SaturationRange=[1,1],this.ValueRange=[1,1],this.AlphaRange=[1,1],this.NaNColor=[128,0,0,255],this.BelowRangeColor=[0,0,0,255],this.UseBelowRangeColor=!0,this.AboveRangeColor=[255,255,255,255],this.UseAboveRangeColor=!0,this.InputRange=[0,255],this.Table=[]}setNumberOfTableValues(e){this.NumberOfColors=e}setRamp(e){this.Ramp=e}setTableRange(e,n){this.TableRange[0]=e,this.TableRange[1]=n}setHueRange(e,n){this.HueRange[0]=e,this.HueRange[1]=n}setSaturationRange(e,n){this.SaturationRange[0]=e,this.SaturationRange[1]=n}setValueRange(e,n){this.ValueRange[0]=e,this.ValueRange[1]=n}setRange(e,n){this.InputRange[0]=e,this.InputRange[1]=n}setAlphaRange(e,n){this.AlphaRange[0]=e,this.AlphaRange[1]=n}getColor(e){return this.mapValue(e)}build(e){if(this.Table.length>1&&!e)return;this.Table=[];const n=this.NumberOfColors-1;let r,i,a,s;n?(r=(this.HueRange[1]-this.HueRange[0])/n,i=(this.SaturationRange[1]-this.SaturationRange[0])/n,a=(this.ValueRange[1]-this.ValueRange[0])/n,s=(this.AlphaRange[1]-this.AlphaRange[0])/n):r=i=a=s=0;for(let o=0;o<=n;o++){const c=this.HueRange[0]+o*r,l=this.SaturationRange[0]+o*i,u=this.ValueRange[0]+o*a,f=this.AlphaRange[0]+o*s,g=Iy(c,l,u),h=[0,0,0,0];switch(this.Ramp){case"scurve":h[0]=Math.floor(127.5*(1+Math.cos((1-g[0])*Math.PI))),h[1]=Math.floor(127.5*(1+Math.cos((1-g[1])*Math.PI))),h[2]=Math.floor(127.5*(1+Math.cos((1-g[2])*Math.PI))),h[3]=Math.floor(f*255);break;case"linear":h[0]=Math.floor(g[0]*255+.5),h[1]=Math.floor(g[1]*255+.5),h[2]=Math.floor(g[2]*255+.5),h[3]=Math.floor(f*255+.5);break;case"sqrt":h[0]=Math.floor(Math.sqrt(g[0])*255+.5),h[1]=Math.floor(Math.sqrt(g[1])*255+.5),h[2]=Math.floor(Math.sqrt(g[2])*255+.5),h[3]=Math.floor(Math.sqrt(f)*255+.5);break;default:throw new Error(`Invalid Ramp value (${this.Ramp})`)}this.Table.push(h)}this.buildSpecialColors()}buildSpecialColors(){const e=this.NumberOfColors,n=e+D0,r=e+V0,i=e+Vy;this.UseBelowRangeColor||e===0?this.Table[n]=this.BelowRangeColor:this.Table[n]=this.Table[0],this.UseAboveRangeColor||e===0?this.Table[r]=this.AboveRangeColor:this.Table[r]=this.Table[e-1],this.Table[i]=this.NaNColor}mapValue(e){const n=this.getIndex(e);if(n<0)return this.NaNColor;if(n===0){if(this.UseBelowRangeColor&&e<this.TableRange[0])return this.BelowRangeColor}else if(n===this.NumberOfColors-1&&this.UseAboveRangeColor&&e>this.TableRange[1])return this.AboveRangeColor;return this.Table[n]}getIndex(e){const n={Range:[],MaxIndex:this.NumberOfColors-1,Shift:-this.TableRange[0],Scale:1};if(this.TableRange[1]<=this.TableRange[0]?n.Scale=Number.MAX_VALUE:n.Scale=n.MaxIndex/(this.TableRange[1]-this.TableRange[0]),n.Range[0]=this.TableRange[0],n.Range[1]=this.TableRange[1],isNaN(e))return-1;let r=Ly(e,n);return r===this.NumberOfColors+D0?r=0:r===this.NumberOfColors+V0&&(r=this.NumberOfColors-1),r}setTableValue(e,n,r,i,a){let s;if(typeof n=="number"&&r!==void 0&&i!==void 0&&a!==void 0)s=[n,r,i,a];else if(Array.isArray(n))s=n;else throw new Error("Invalid arguments for setTableValue");if(e<0)throw new Error(`Can't set the table value for negative index (${e})`);if(e>=this.NumberOfColors)throw new Error(`Index ${e} is greater than the number of colors ${this.NumberOfColors}`);this.Table[e]=s,(e===0||e===this.NumberOfColors-1)&&this.buildSpecialColors()}}const fc=[0,0,0,0];function Ny(t,e,n){n=n===null?100:n;const r=(e-t)/(n-1),i=[];for(;n-- >0;)i.push(t),t+=r;return i[i.length-1]=e,i}function by(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=n+Math.floor((r-n)/2),a=t[i];if(a===e)return i;e<a?r=i-1:n=i+1}return n}function Fy(t,e){let n;const r=[],i=e.length;for(t.sort(function(a,s){return a-s}),n=0;n<i;n++)r[n]=by(t,e[n]);return r}function Qa(t,e,n){let r;const i=[],a=[],s=[],o=[];for(n=n===null?1:n,r=0;r<e.length;r++){const u=e[r];i.push((t-1)*u[0]),a.push(u[1]),s.push(u[1])}const c=Ny(0,1,t);for(r=0;r<t;r++)c[r]=(t-1)*Math.pow(c[r],n);const l=Fy(i,c);for(r=1;r<t-1;r++){const u=l[r],f=(c[r]-i[u-1])/(i[u]-i[u-1]),g=a[u]-s[u-1];o[r]=f*g+s[u-1]}return o[0]=s[0],o[t-1]=a[e.length-1],o}function _y(t,e,n){let r;const i=[];e=e===null?256:e,n=n===null?1:n;const a=Qa(e,t.red,n),s=Qa(e,t.green,n),o=Qa(e,t.blue,n);for(r=0;r<e;r++){const c=Math.round(a[r]*255),l=Math.round(s[r]*255),u=Math.round(o[r]*255),f=[c,l,u,255];i.push(f)}return i}function Uy(t,e){let n=Hs[t];return n||(n=Hs[t]={name:"",colors:[]}),!n.colors&&n.segmentedData&&(n.colors=_y(n.segmentedData,n.numColors,n.gamma)),{getId(){return t},getColorSchemeName(){return n.name},setColorSchemeName(i){n.name=i},getNumberOfColors(){return n.colors.length},setNumberOfColors(i){for(;n.colors.length<i;)n.colors.push(fc);n.colors.length=i},getColor(i){return this.isValidIndex(i)?n.colors[i]:fc},getColorRepeating(i){const a=n.colors.length;return i=a?i%a:0,this.getColor(i)},setColor(i,a){this.isValidIndex(i)&&(n.colors[i]=a)},addColor(i){n.colors.push(i)},insertColor(i,a){this.isValidIndex(i)&&n.colors.splice(i,1,a)},removeColor(i){this.isValidIndex(i)&&n.colors.splice(i,1)},clearColors(){n.colors=[]},buildLookupTable(i){if(!i)return;const a=n.colors.length;i.setNumberOfTableValues(a);for(let s=0;s<a;s++)i.setTableValue(s,n.colors[s])},createLookupTable(){const i=new Ps;return this.buildLookupTable(i),i},isValidIndex(i){return i>=0&&i<n.colors.length}}}function ky(t,e,n,r){let i=Z();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Z()-i;const s=a.length,o=t.minPixelValue;let c=0,l=0,u,f,g;if(i=Z(),n instanceof Ps?g=n.Table:g=n,o<0)for(;l<s;)u=e[a[l++]+-o],f=g[u],r[c++]=f[0],r[c++]=f[1],r[c++]=f[2],r[c++]=f[3];else for(;l<s;)u=e[a[l++]],f=g[u],r[c++]=f[0],r[c++]=f[1],r[c++]=f[2],r[c++]=f[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=Z()-i}function Py(t,e,n,r){let i=Z();const a=t.voxelManager.getScalarData();t.stats.lastGetPixelDataTime=Z()-i;const s=a.length,o=t.minPixelValue;let c=0,l=0,u,f,g;if(i=Z(),n instanceof Ps?g=n.Table:g=n,o<0)for(;l<s;)u=e(a[l++]+-o),f=g[u],r[c++]=f[0],r[c++]=f[1],r[c++]=f[2],r[c++]=f[3];else for(;l<s;)u=e(a[l++]),f=g[u],r[c++]=f[0],r[c++]=f[1],r[c++]=f[2],r[c++]=f[3];t.stats.lastStoredPixelDataToCanvasImageDataTime=Z()-i}function I0(t,e,n){return Math.max(e,Math.min(n,t))}function Gy(t,e,n){t.renderingTools.renderCanvas||(t.renderingTools.renderCanvas=document.createElement("canvas"));const r=t.renderingTools.renderCanvas;let i=t.viewport.colormap||t.options.colormap;if(t.options&&t.options.colormap&&console.warn("enabledElement.options.colormap is deprecated. Use enabledElement.viewport.colormap instead"),i&&typeof i=="string"&&(i=Uy(i)),!i)throw new Error("renderPseudoColorImage: colormap not found.");const a=i.getId();if(!Us(t,e)&&!n&&t.renderingTools.colormapId===a)return r;(r.width!==e.width||r.height!==e.height)&&la(t,e);let s=Z();(!t.renderingTools.colorLUT||n||t.renderingTools.colormapId!==a)&&(i.setNumberOfColors(256),t.renderingTools.colorLUT=i.createLookupTable(),t.renderingTools.colormapId=a);const o=t.renderingTools.renderCanvasData,c=t.renderingTools.renderCanvasContext,{viewport:l}=t,u=t.renderingTools.colorLUT;if(l.modality==="PT"){const{windowWidth:f,windowCenter:g}=l.voi,h=g-f/2,m=255/(g+f/2-h);let y;l.invert?y=T=>I0(Math.floor(255-(T-h)*m),0,255):y=T=>I0(Math.floor((T-h)*m),0,255),Py(e,y,u,o.data)}else{const f=$u(e,t.viewport,n);e.stats=e.stats||{},e.stats.lastLutGenerateTime=Z()-s,ky(e,f,u,o.data)}return s=Z(),c.putImageData(o,0,0),e.stats.lastPutImageDataTime=Z()-s,r}function Ay(t,e){if(t===void 0)throw new Error("drawImage: enabledElement parameter must not be undefined");const n=t.image;if(n===void 0)throw new Error("drawImage: image must be loaded before it can be drawn");const r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),r.imageSmoothingEnabled=!t.viewport.pixelReplication,_s(t,r);const i=Gy(t,n,e),a=t.viewport.displayedArea.tlhc.x-1,s=t.viewport.displayedArea.tlhc.y-1,o=t.viewport.displayedArea.brhc.x-a,c=t.viewport.displayedArea.brhc.y-s;r.drawImage(i,a,s,o,c,0,0,o,c),t.renderingTools=ks(t)}function ju(t,e){const n=t.image;if(!t.canvas||!t.image)return;const r=Z();if(n.stats={lastGetPixelDataTime:-1,lastStoredPixelDataToCanvasImageDataTime:-1,lastPutImageDataTime:-1,lastRenderTime:-1,lastLutGenerateTime:-1},n){let a=n.render;a||(t.viewport.colormap?a=Ay:n.color?a=yy:a=Dy),a(t,e)}const i=Z()-r;n.stats.lastRenderTime=i,t.invalid=!1,t.needsRedraw=!1}function Hu(t){return zr(t)}function hi(t,e){const n=Hu(t);return n.invert(),n.transformPoint(e)}const By={viewport:{}};function Wy(){return{tlhc:{x:1,y:1},brhc:{x:1,y:1},rowPixelSpacing:1,columnPixelSpacing:1,presentationSizeMode:"NONE"}}function zy(){const t=Wy(),e={scale:1,translation:{x:0,y:0},voi:{windowWidth:void 0,windowCenter:void 0,voiLUTFunction:qe.LINEAR},invert:!1,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:void 0,voiLUT:void 0,colormap:void 0,labelmap:!1,displayedArea:t};return Object.assign({},e,By.viewport)}function Vr(t,e){if(t==null)throw new Error(e)}function $y(t){return!(t==null||t===0||t===180)}function Ku(t,e=null){return Vr(t,"getImageSize: parameter image must not be undefined"),Vr(t.width,"getImageSize: parameter image must have width"),Vr(t.height,"getImageSize: parameter image must have height"),$y(e)?{height:t.width,width:t.height}:{width:t.width,height:t.height}}function Gs(t,e,n=null){Vr(t,"getImageScale: parameter canvas must not be undefined"),Vr(e,"getImageScale: parameter image must not be undefined");const r=Ku(e,n),i=e.rowPixelSpacing||1,a=e.columnPixelSpacing||1;let s=1,o=1;i<a?o=a/i:s=i/a;const c=t.height/r.height/s,l=t.width/r.width/o;return{verticalScale:c,horizontalScale:l,scaleFactor:Math.min(l,c)}}function qu(t,e,n,r){if(t===void 0)throw new Error("getDefaultViewport: parameter canvas must not be undefined");if(e===void 0)return zy();const i=Gs(t,e,0).scaleFactor;let a;return n==="PT"&&e.isPreScaled?a={windowWidth:5,windowCenter:2.5}:e.windowWidth!==void 0&&e.windowCenter!==void 0&&(a={windowWidth:Array.isArray(e.windowWidth)?e.windowWidth[0]:e.windowWidth,windowCenter:Array.isArray(e.windowCenter)?e.windowCenter[0]:e.windowCenter}),{scale:i,translation:{x:0,y:0},voi:a,invert:e.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1,modalityLUT:e.modalityLUT,modality:n,voiLUT:e.voiLUT,colormap:r!==void 0?r:e.colormap,displayedArea:{tlhc:{x:1,y:1},brhc:{x:e.columns,y:e.rows},rowPixelSpacing:e.rowPixelSpacing===void 0?1:e.rowPixelSpacing,columnPixelSpacing:e.columnPixelSpacing===void 0?1:e.columnPixelSpacing,presentationSizeMode:"NONE"}}}function gc(t,e){return Hu(t).transformPoint(e)}function jy(t){const{image:e}=t;t.viewport.scale=Gs(t.canvas,e,t.viewport.rotation).scaleFactor,t.viewport.translation.x=0,t.viewport.translation.y=0}function Hy(t){const{canvas:e}=t,{clientWidth:n,clientHeight:r}=e;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r)}function Ky(t,e,n){const r=t.viewport.scale,i=Ku(t.image,t.viewport.rotation),a=Math.round(i.width*r),s=Math.round(i.height*r),o=t.viewport.translation.x,c=t.viewport.translation.y;return a===e&&s<=n||a<=e&&s===n&&o===0&&c===0}function qy(t,e,n){const r=t.viewport.scale,i=t.canvas.width,a=t.canvas.height,s=i/e,o=a/n,c=Math.sqrt(s*o);t.viewport.scale=c*r}function Xy(t,e=!1){const n=t.canvas.width,r=t.canvas.height;Hy(t),t.image!==void 0&&(e||Ky(t,n,r)?jy(t):qy(t,n,r))}function Yy(t,e){const{hflip:n,vflip:r,rotation:i}=e;if(t.x*=n?-1:1,t.y*=r?-1:1,i!==0){const a=i*Math.PI/180,s=Math.cos(a),o=Math.sin(a),c=t.x*s-t.y*o,l=t.x*o+t.y*s;t.x=c,t.y=l}return t}function Zy(t,e=!0,n=!0){const{canvas:r,image:i,viewport:a}=t,s=Gs(r,i,0).scaleFactor;a.vflip=!1,a.hflip=!1,e&&(a.translation.x=0,a.translation.y=0),n&&(a.displayedArea.tlhc.x=1,a.displayedArea.tlhc.y=1,a.displayedArea.brhc.x=i.columns,a.displayedArea.brhc.y=i.rows,a.scale=s)}const Jy=1;class Sn extends ar{constructor(e){super(e),this.imageIds=[],this.imageKeyToIndexMap=new Map,this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.imagesLoader=this,this.globalDefaultProperties={},this.perImageIdDefaultProperties=new Map,this.voiUpdatedWithSetProperties=!1,this.invert=!1,this.initialInvert=!1,this.initialTransferFunctionNodes=null,this.stackInvalidated=!1,this._publishCalibratedEvent=!1,this.updateRenderingPipeline=()=>{this._configureRenderingPipeline()},this.resize=()=>{this.useCPURendering&&this._resizeCPU()},this._resizeCPU=()=>{this._cpuFallbackEnabledElement.viewport&&Xy(this._cpuFallbackEnabledElement)},this.getFrameOfReferenceUID=n=>{var r;return(r=this.getImagePlaneReferenceData(n))==null?void 0:r.FrameOfReferenceUID},this.getCornerstoneImage=()=>this.csImage,this.createActorMapper=n=>{const r=ey.newInstance();r.setInputData(n);const i=ly.newInstance();i.setMapper(r);const{preferSizeOverAccuracy:a}=xs().rendering;return a&&r.setPreferSizeOverAccuracy(!0),n.getPointData().getScalars().getNumberOfComponents()>1&&i.getProperty().setIndependentComponents(!1),i},this.getNumberOfSlices=()=>this.imageIds.length,this.getDefaultProperties=n=>{let r;return n!==void 0&&(r=this.perImageIdDefaultProperties.get(n)),r!==void 0?r:{...this.globalDefaultProperties}},this.getProperties=()=>{const{colormap:n,voiRange:r,VOILUTFunction:i,interpolationType:a,invert:s,voiUpdatedWithSetProperties:o}=this;return{colormap:n,voiRange:r,VOILUTFunction:i,interpolationType:a,invert:s,isComputedVOI:!o}},this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0,suppressEvents:!0}),this.getRotationCPU=()=>{const{viewport:n}=this._cpuFallbackEnabledElement;return n.rotation},this.getRotationGPU=()=>{const{viewUp:n,viewPlaneNormal:r,flipVertical:i}=this.getCameraNoRotation(),a=i?kt($(),this.initialViewUp):this.initialViewUp,s=a2(a,n)*180/Math.PI,o=ve($(),a,n);return fe(o,r)>=0?s:(360-s)%360},this.setRotation=n=>{const r=this.getCamera();if(this.useCPURendering?this.setRotationCPU(n):this.setRotationGPU(n),this._suppressCameraModifiedEvents)return;const i=this.getCamera(),a={previousCamera:r,camera:i,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};H(this.element,A.CAMERA_MODIFIED,a)},this.renderImageObject=n=>{this._setCSImage(n),(this.useCPURendering?this._updateToDisplayImageCPU:this._updateActorToDisplayImageId).call(this,n)},this._setCSImage=n=>{var r;n.isPreScaled=(r=n.preScale)==null?void 0:r.scaled,this.csImage=n},this.canvasToWorldCPU=(n,r=[0,0,0])=>{if(!this._cpuFallbackEnabledElement.image)return;const[i,a]=hi(this._cpuFallbackEnabledElement,n),{origin:s,spacing:o,direction:c}=this.getImageData(),l=c.slice(0,3),u=c.slice(3,6);return ze(r,s,l,i*o[0]),ze(r,r,u,a*o[1]),r},this.worldToCanvasCPU=n=>{const{spacing:r,direction:i,origin:a}=this.getImageData(),s=i.slice(0,3),o=i.slice(3,6),c=Pe($(),n,a),l=[fe(c,s)/r[0],fe(c,o)/r[1]];return gc(this._cpuFallbackEnabledElement,l)},this.canvasToWorldGPU=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),s=i.getDistance();i.setClippingRange(s,s+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),u=window.devicePixelRatio||1,f=[n[0]*u,n[1]*u],g=[f[0]+this.sx,f[1]+this.sy];g[1]=l[1]-g[1];const h=c.displayToWorld(g[0],g[1],0,r);return i.setClippingRange(a[0],a[1]),[h[0],h[1],h[2]]},this.worldToCanvasGPU=n=>{const r=this.getRenderer(),i=this.getVtkActiveCamera(),a=i.getClippingRange(),s=i.getDistance();i.setClippingRange(s,s+.1);const c=this.getRenderingEngine().offscreenMultiRenderWindow.getOpenGLRenderWindow(),l=c.getSize(),u=c.worldToDisplay(...n,r);u[1]=l[1]-u[1];const f=[u[0]-this.sx,u[1]-this.sy];i.setClippingRange(a[0],a[1]);const g=window.devicePixelRatio||1;return[f[0]/g,f[1]/g]},this.getCurrentImageIdIndex=()=>this.currentImageIdIndex,this.getSliceIndex=()=>this.currentImageIdIndex,this.getTargetImageIdIndex=()=>this.targetImageIdIndex,this.getImageIds=()=>this.imageIds,this.getCurrentImageId=(n=this.getCurrentImageIdIndex())=>this.imageIds[n],this.hasImageId=n=>this.imageKeyToIndexMap.has(n),this.hasImageURI=n=>this.imageKeyToIndexMap.has(n),this.customRenderViewportToCanvas=()=>{if(!this.useCPURendering)throw new Error("Custom cpu rendering pipeline should only be hit in CPU rendering mode");return this._cpuFallbackEnabledElement.image?(ju(this._cpuFallbackEnabledElement,this.cpuRenderingInvalidated),this.cpuRenderingInvalidated=!1):this.fillWithBackgroundColor(),{canvas:this.canvas,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,viewportStatus:this.viewportStatus}},this.renderingPipelineFunctions={getImageData:{cpu:this.getImageDataCPU,gpu:this.getImageDataGPU},setColormap:{cpu:this.setColormapCPU,gpu:this.setColormapGPU},getCamera:{cpu:this.getCameraCPU,gpu:super.getCamera},setCamera:{cpu:this.setCameraCPU,gpu:super.setCamera},getPan:{cpu:this.getPanCPU,gpu:super.getPan},setPan:{cpu:this.setPanCPU,gpu:super.setPan},getZoom:{cpu:this.getZoomCPU,gpu:super.getZoom},setZoom:{cpu:this.setZoomCPU,gpu:super.setZoom},setVOI:{cpu:this.setVOICPU,gpu:this.setVOIGPU},getRotation:{cpu:this.getRotationCPU,gpu:this.getRotationGPU},setInterpolationType:{cpu:this.setInterpolationTypeCPU,gpu:this.setInterpolationTypeGPU},setInvertColor:{cpu:this.setInvertColorCPU,gpu:this.setInvertColorGPU},resetCamera:{cpu:(n={})=>{const{resetPan:r=!0,resetZoom:i=!0}=n;return this.resetCameraCPU({resetPan:r,resetZoom:i}),!0},gpu:(n={})=>{const{resetPan:r=!0,resetZoom:i=!0}=n;return this.resetCameraGPU({resetPan:r,resetZoom:i}),!0}},canvasToWorld:{cpu:this.canvasToWorldCPU,gpu:this.canvasToWorldGPU},worldToCanvas:{cpu:this.worldToCanvasCPU,gpu:this.worldToCanvasGPU},getRenderer:{cpu:()=>this.getCPUFallbackError("getRenderer"),gpu:super.getRenderer},getDefaultActor:{cpu:()=>this.getCPUFallbackError("getDefaultActor"),gpu:super.getDefaultActor},getActors:{cpu:()=>this.getCPUFallbackError("getActors"),gpu:super.getActors},getActor:{cpu:()=>this.getCPUFallbackError("getActor"),gpu:super.getActor},setActors:{cpu:()=>this.getCPUFallbackError("setActors"),gpu:super.setActors},addActors:{cpu:()=>this.getCPUFallbackError("addActors"),gpu:super.addActors},addActor:{cpu:()=>this.getCPUFallbackError("addActor"),gpu:super.addActor},removeAllActors:{cpu:()=>this.getCPUFallbackError("removeAllActors"),gpu:super.removeAllActors},unsetColormap:{cpu:this.unsetColormapCPU,gpu:this.unsetColormapGPU}},this.scaling={},this.modality=null,this.useCPURendering=Rr(),this._configureRenderingPipeline(),this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport(),this.currentImageIdIndex=0,this.targetImageIdIndex=0,this.resetCamera(),this.initializeElementDisabledHandler()}setUseCPURendering(e){this.useCPURendering=e,this._configureRenderingPipeline(e)}static get useCustomRenderingPipeline(){return Rr()}_configureRenderingPipeline(e){this.useCPURendering=e??Rr();for(const n in this.renderingPipelineFunctions)if(Object.prototype.hasOwnProperty.call(this.renderingPipelineFunctions,n)){const r=this.renderingPipelineFunctions[n];this[n]=this.useCPURendering?r.cpu:r.gpu}this.useCPURendering?this._resetCPUFallbackElement():this._resetGPUViewport()}_resetCPUFallbackElement(){this._cpuFallbackEnabledElement={canvas:this.canvas,renderingTools:{},transform:new cr,viewport:{rotation:0}}}_resetGPUViewport(){const e=this.getRenderer(),n=vl.newInstance();e.setActiveCamera(n);const r=[0,0,-1];this.initialViewUp=[0,-1,0],n.setDirectionOfProjection(-r[0],-r[1],-r[2]),n.setViewUp(...this.initialViewUp),n.setParallelProjection(!0),n.setThicknessFromFocalPoint(.1),n.setFreezeFocalPoint(!0)}initializeElementDisabledHandler(){ae.addEventListener(A.ELEMENT_DISABLED,function e(){clearTimeout(this.debouncedTimeout),ae.removeEventListener(A.ELEMENT_DISABLED,e)})}getImageDataGPU(){const e=this.getDefaultActor();if(!e||!xt(e))return;const{actor:n}=e,r=n.getMapper().getInputData(),i=this.csImage;return{dimensions:r.getDimensions(),spacing:r.getSpacing(),origin:r.getOrigin(),direction:r.getDirection(),get scalarData(){return i==null?void 0:i.voxelManager.getScalarData()},imageData:n.getMapper().getInputData(),metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,hasPixelSpacing:this.hasPixelSpacing,calibration:{...i==null?void 0:i.calibration,...this.calibration},preScale:{...i==null?void 0:i.preScale},voxelManager:i==null?void 0:i.voxelManager}}getImageDataCPU(){const{metadata:e}=this._cpuFallbackEnabledElement;if(!e)return;const n=e.spacing,r=this.csImage;return{dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.getFrameOfReferenceUID()},scaling:this.scaling,imageData:{getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getScalarData:()=>this.cpuImagePixelData,getSpacing:()=>n,worldToIndex:i=>{const a=this.worldToCanvasCPU(i),s=hi(this._cpuFallbackEnabledElement,a);return[s[0],s[1],0]},indexToWorld:(i,a)=>{const s=gc(this._cpuFallbackEnabledElement,[i[0],i[1]]);return this.canvasToWorldCPU(s,a)}},scalarData:this.cpuImagePixelData,hasPixelSpacing:this.hasPixelSpacing,calibration:{...r==null?void 0:r.calibration,...this.calibration},preScale:{...r==null?void 0:r.preScale},voxelManager:r==null?void 0:r.voxelManager}}buildMetadata(e){const n=e.imageId,{pixelRepresentation:r,bitsAllocated:i,bitsStored:a,highBit:s,photometricInterpretation:o,samplesPerPixel:c}=j("imagePixelModule",n),{windowWidth:l,windowCenter:u,voiLUTFunction:f}=e,{modality:g}=j("generalSeriesModule",n),h=j("scalingModule",n),p=j(Je.CALIBRATION,n);g==="PT"&&h&&this._addScalingToViewport(h),this.modality=g;const d=this._getValidVOILUTFunction(f);this.VOILUTFunction=d,this.calibration=p;let m=this._getImagePlaneModule(n);return this.useCPURendering||(m=this.calibrateIfNecessary(n,m)),{imagePlaneModule:m,imagePixelModule:{bitsAllocated:i,bitsStored:a,samplesPerPixel:c,highBit:s,photometricInterpretation:o,pixelRepresentation:r,windowWidth:l,windowCenter:u,modality:g,voiLUTFunction:d}}}calibrateIfNecessary(e,n){const r=j("calibratedPixelSpacing",e),i=this.calibration!==r,{scale:a}=r||{};return this.hasPixelSpacing=a>0||n.rowPixelSpacing>0,n.calibration=r,i&&(this.calibration=r,this._publishCalibratedEvent=!0,this._calibrationEvent={scale:a,calibration:r}),n}setDefaultProperties(e,n){n==null?this.globalDefaultProperties=e:(this.perImageIdDefaultProperties.set(n,e),this.getCurrentImageId()===n&&this.setProperties(e))}clearDefaultProperties(e){e==null?(this.globalDefaultProperties={},this.resetProperties()):(this.perImageIdDefaultProperties.delete(e),this.resetToDefaultProperties())}setProperties({colormap:e,voiRange:n,VOILUTFunction:r,invert:i,interpolationType:a}={},s=!1){this.viewportStatus=this.csImage?Ke.PRE_RENDER:Ke.LOADING,this.globalDefaultProperties={colormap:this.globalDefaultProperties.colormap??e,voiRange:this.globalDefaultProperties.voiRange??n,VOILUTFunction:this.globalDefaultProperties.VOILUTFunction??r,invert:this.globalDefaultProperties.invert??i,interpolationType:this.globalDefaultProperties.interpolationType??a},typeof e<"u"&&this.setColormap(e),typeof n<"u"&&this.setVOI(n,{suppressEvents:s,voiUpdatedWithSetProperties:!0}),typeof r<"u"&&this.setVOILUTFunction(r,s),typeof i<"u"&&this.setInvertColor(i),typeof a<"u"&&this.setInterpolationType(a)}resetProperties(){this.cpuRenderingInvalidated=!0,this.voiUpdatedWithSetProperties=!1,this.viewportStatus=Ke.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={}),this._resetProperties(),this.render()}_resetProperties(){let e;if(this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage(),this.setVOI(e),this.setInvertColor(this.initialInvert),this.setInterpolationType(Jt.LINEAR),!this.useCPURendering){const n=this.getTransferFunction();Ia(n,this.initialTransferFunctionNodes);const i=aa(n).reduce((o,c)=>(o.push(c[0],c[1],c[2],c[3]),o),[]),a=this.getDefaultActor(),s=Ms(i,a.actor);this.setColormap(s)}}resetToDefaultProperties(){var i;this.cpuRenderingInvalidated=!0,this.viewportStatus=Ke.PRE_RENDER,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={});const e=this.getCurrentImageId(),n=this.perImageIdDefaultProperties.get(e)||this.globalDefaultProperties;(i=n.colormap)!=null&&i.name&&this.setColormap(n.colormap);let r;n.voiRange==null?r=this._getVOIRangeForCurrentImage():r=n.voiRange,this.setVOI(r),this.setInterpolationType(Jt.LINEAR),this.setInvertColor(!1),this.render()}_getVOIFromCache(){let e;return this.voiUpdatedWithSetProperties?e=this.voiRange:this._isCurrentImagePTPrescaled()?e=this._getDefaultPTPrescaledVOIRange():e=this._getVOIRangeForCurrentImage()??this.voiRange,e}_setPropertiesFromCache(){const e=this._getVOIFromCache(),{interpolationType:n,invert:r}=this;this.setVOI(e),this.setInterpolationType(n),this.setInvertColor(r)}getCameraCPU(){const{metadata:e,viewport:n}=this._cpuFallbackEnabledElement;if(!e)return{};const{direction:r}=e,i=r.slice(6,9).map(f=>-f);let a=r.slice(3,6).map(f=>-f);if(n.rotation){const f=as(Dn(),n.rotation*Math.PI/180,i);a=pe($(),a,f)}const s=[this.element.clientWidth/2,this.element.clientHeight/2],o=this.canvasToWorld(s),c=this.canvasToWorld([0,0]),l=this.canvasToWorld([0,this.element.clientHeight]),u=r2(c,l)/2;return{parallelProjection:!0,focalPoint:o,position:[0,0,0],parallelScale:u,scale:n.scale,viewPlaneNormal:[i[0],i[1],i[2]],viewUp:[a[0],a[1],a[2]],flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical}}setCameraCPU(e){const{viewport:n,image:r}=this._cpuFallbackEnabledElement,i=this.getCameraCPU(),{focalPoint:a,parallelScale:s,scale:o,flipHorizontal:c,flipVertical:l}=e,{clientHeight:u}=this.element;if(a){const g=this.worldToCanvasCPU(a),h=hi(this._cpuFallbackEnabledElement,g),p=this.worldToCanvasCPU(i.focalPoint),d=hi(this._cpuFallbackEnabledElement,p),m=c2();qi(m,wo(h[0],h[1]),wo(d[0],d[1]));const y=Yy({x:m[0],y:m[1]},n);n.translation.x-=y.x,n.translation.y-=y.y}if(s){const{rowPixelSpacing:g}=r,h=u*g*.5/s;n.scale=h,n.parallelScale=s}if(o){const{rowPixelSpacing:g}=r;n.scale=o,n.parallelScale=u*g*.5/o}(c!==void 0||l!==void 0)&&this.setFlipCPU({flipHorizontal:c,flipVertical:l}),this._cpuFallbackEnabledElement.transform=zr(this._cpuFallbackEnabledElement);const f={previousCamera:i,camera:this.getCamera(),element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};H(this.element,A.CAMERA_MODIFIED,f)}getPanCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return[e.translation.x,e.translation.y]}setPanCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,focalPoint:[...e.map(r=>-r),0]})}getZoomCPU(){const{viewport:e}=this._cpuFallbackEnabledElement;return e.scale}setZoomCPU(e){const n=this.getCameraCPU();this.setCameraCPU({...n,scale:e})}setFlipCPU({flipHorizontal:e,flipVertical:n}){const{viewport:r}=this._cpuFallbackEnabledElement;e!==void 0&&(r.hflip=e,this.flipHorizontal=r.hflip),n!==void 0&&(r.vflip=n,this.flipVertical=r.vflip)}setVOILUTFunction(e,n){if(this.useCPURendering)throw new Error("VOI LUT function is not supported in CPU rendering");const r=this._getValidVOILUTFunction(e);let i=!1;this.VOILUTFunction!==r&&(i=!0),this.VOILUTFunction=r;const{voiRange:a}=this.getProperties();this.setVOI(a,{suppressEvents:n,forceRecreateLUTFunction:i})}setRotationCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.rotation=e}setRotationGPU(e){const n=this.getPan(this.fitToCanvasCamera),r=this.getPan(),i=Xi([0,0],n,r);this.setPan(i,!1);const{flipVertical:a}=this.getCamera(),s=a?kt($(),this.initialViewUp):this.initialViewUp;this.setCameraNoEvent({viewUp:s}),this.getVtkActiveCamera().roll(-e);const o=this.getPan(),c=this.getPan(this.fitToCanvasCamera),l=Xi([0,0],o,c),u=cs([0,0],n,l);this.setPan(u,!1)}setInterpolationTypeGPU(e){const n=this.getDefaultActor();if(!n||!xt(n))return;const{actor:r}=n;r.getProperty().setInterpolationType(e),this.interpolationType=e}setInterpolationTypeCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n.pixelReplication=e!==Jt.LINEAR,this.interpolationType=e}setInvertColorCPU(e){const{viewport:n}=this._cpuFallbackEnabledElement;n&&(n.invert=e,this.invert=e)}setInvertColorGPU(e){const n=this.getDefaultActor();if(n&&xt(n)){if(Xe(n,"vtkVolume")){const i=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Mr(i),this.invert=e}else if(Xe(n,"vtkImageSlice")){const i=n.actor.getProperty().getRGBTransferFunction(0);(!this.invert&&e||this.invert&&!e)&&Mr(i),this.invert=e}}}setVOICPU(e,n={}){const{suppressEvents:r=!1}=n,{viewport:i,image:a}=this._cpuFallbackEnabledElement;if(!i||!a)return;if(typeof e>"u"){const{windowWidth:o,windowCenter:c}=a,l=Array.isArray(o)?o[0]:o,u=Array.isArray(c)?c[0]:c;i.voi={windowWidth:l,windowCenter:u,voiLUTFunction:a.voiLUTFunction};const{lower:f,upper:g}=Or(l,u,a.voiLUTFunction);e={lower:f,upper:g}}else{const{lower:o,upper:c}=e,{windowCenter:l,windowWidth:u}=Os(o,c);i.voi||(i.voi={windowWidth:0,windowCenter:0,voiLUTFunction:a.voiLUTFunction}),i.voi.windowWidth=u,i.voi.windowCenter=l}this.voiRange=e;const s={viewportId:this.id,range:e};r||H(this.element,A.VOI_MODIFIED,s)}getTransferFunction(){const e=this.getDefaultActor();return!e||!xt(e)?void 0:e.actor.getProperty().getRGBTransferFunction(0)}setVOIGPU(e,n={}){const{suppressEvents:r=!1,forceRecreateLUTFunction:i=!1,voiUpdatedWithSetProperties:a=!1}=n;if(e&&this.voiRange&&this.voiRange.lower===e.lower&&this.voiRange.upper===e.upper&&!i&&!this.stackInvalidated)return;const s=this.getDefaultActor();if(!s||!xt(s))return;const o=s.actor;let c=e;if(typeof c>"u"){const h=o.getMapper().getInputData().getPointData().getScalars().getRange();c={lower:h[0],upper:h[1]}}o.getProperty().setUseLookupTableScalarRange(!0);let l=o.getProperty().getRGBTransferFunction(0);const u=this.VOILUTFunction===qe.SAMPLED_SIGMOID;if((u||!l||i)&&(l=(u?Ds:Bu)(c),this.invert&&Mr(l),o.getProperty().setRGBTransferFunction(0,l),this.initialTransferFunctionNodes=aa(l)),u||l.setRange(c.lower,c.upper),this.voiRange=c,this.voiUpdatedWithSetProperties||(this.voiUpdatedWithSetProperties=a),r)return;const f={viewportId:this.id,range:c,VOILUTFunction:this.VOILUTFunction};H(this.element,A.VOI_MODIFIED,f)}_addScalingToViewport(e){if(this.scaling.PT)return;const{suvbw:n,suvlbm:r,suvbsa:i}=e,a={};r&&(a.suvbwToSuvlbm=r/n),i&&(a.suvbwToSuvbsa=i/n),this.scaling.PT=a}_getNumCompsFromPhotometricInterpretation(e){let n=1;return(e==="RGB"||e.includes("YBR")||e==="PALETTE COLOR")&&(n=3),n}getImageDataMetadata(e){const{imagePlaneModule:n,imagePixelModule:r}=this.buildMetadata(e);let{rowCosines:i,columnCosines:a}=n;(i==null||a==null)&&(i=[1,0,0],a=[0,1,0]);const s=xe(i[0],i[1],i[2]),o=xe(a[0],a[1],a[2]),c=$();ve(c,s,o);let l=n.imagePositionPatient;l==null&&(l=[0,0,0]);const u=n.columnPixelSpacing||e.columnPixelSpacing,f=n.rowPixelSpacing||e.rowPixelSpacing,g=e.columns,h=e.rows,p=Jy,d=1,m=e.numberOfComponents||this._getNumCompsFromPhotometricInterpretation(r.photometricInterpretation);return{bitsAllocated:r.bitsAllocated,numberOfComponents:m,origin:l,direction:[...s,...o,...c],dimensions:[g,h,d],spacing:[u,f,p],numVoxels:g*h*d,imagePlaneModule:n,imagePixelModule:r}}matchImagesForOverlay(e,n){return(i=>{const a=j(Je.IMAGE_PLANE,n),s=j(Je.IMAGE_PLANE,i),o=a.imageOrientationPatient,c=s.imageOrientationPatient;if(o&&c){if(Ne(a.imageOrientationPatient,s.imageOrientationPatient)){const u=a.imagePositionPatient,f=s.imagePositionPatient;if(u&&f&&Ne(u,f)){const h=a.rows,p=a.columns,d=s.rows,m=s.columns;if(h===d&&p===m)return i}}}else{const l=a.rows,u=a.columns,f=s.rows,g=s.columns;if(l===f&&u===g)return i}})(e)}getImagePlaneReferenceData(e=this.getCurrentImageIdIndex()){const n=this.imageIds[e];if(!n)return;const r=j(Je.IMAGE_PLANE,n);if(!r)return;const{imagePositionPatient:i,frameOfReferenceUID:a}=r;let{rowCosines:s,columnCosines:o}=r;s||(s=[1,0,0]),o||(o=[0,1,0]);const c=ve([0,0,0],o,s);return{FrameOfReferenceUID:a,viewPlaneNormal:c,cameraFocalPoint:i,referencedImageId:n,sliceIndex:e}}_getCameraOrientation(e){const n=e.slice(6,9).map(i=>-i),r=e.slice(3,6).map(i=>-i);return{viewPlaneNormal:[n[0],n[1],n[2]],viewUp:[r[0],r[1],r[2]]}}createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:s}){const o=new s.constructor(s.length),c=oe.newInstance({name:"Pixels",numberOfComponents:a,values:o}),l=rl.newInstance();return l.setDimensions(r),l.setSpacing(i),l.setDirection(n),l.setOrigin(e),l.getPointData().setScalars(c),l}_createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:s}){try{this._imageData=this.createVTKImageData({origin:e,direction:n,dimensions:r,spacing:i,numberOfComponents:a,pixelArray:s})}catch(o){console.error(o)}}async setStack(e,n=0){this._throwIfDestroyed(),this.imageIds=e,this.imageKeyToIndexMap.clear(),e.forEach((s,o)=>{this.imageKeyToIndexMap.set(s,o),this.imageKeyToIndexMap.set(ot(s),o)}),this.currentImageIdIndex=n,this.targetImageIdIndex=n;const r=j(Ar.IMAGE_RETRIEVE_CONFIGURATION,e[n],"stack");this.imagesLoader=r?(r.create||Ou)(r):this,this.stackInvalidated=!0,this.flipVertical=!1,this.flipHorizontal=!1,this.voiRange=null,this.interpolationType=Jt.LINEAR,this.invert=!1,this.viewportStatus=Ke.LOADING,this.fillWithBackgroundColor(),this.useCPURendering&&(this._cpuFallbackEnabledElement.renderingTools={},delete this._cpuFallbackEnabledElement.viewport.colormap);const i=await this._setImageIdIndex(n),a={imageIds:e,viewportId:this.id,element:this.element,currentImageIdIndex:n};return H(this.element,A.VIEWPORT_NEW_IMAGE_SET,a),i}_throwIfDestroyed(){if(this.isDisabled)throw new Error("The stack viewport has been destroyed and is no longer usable. Renderings will not be performed. If you are using the same viewportId and have re-enabled the viewport, you need to grab the new viewport instance using renderingEngine.getViewport(viewportId), instead of using your lexical scoped reference to the viewport instance.")}_checkVTKImageDataMatchesCornerstoneImage(e,n){if(!n)return!1;const[r,i]=n.getSpacing(),[a,s]=n.getDimensions(),o=this._getImagePlaneModule(e.imageId),c=n.getDirection(),l=c.slice(0,3),u=c.slice(3,6),f=n.getPointData().getScalars().getDataType(),g=Ne(r,e.columnPixelSpacing),h=Ne(i,e.rowPixelSpacing),p=g||e.columnPixelSpacing===null&&r===1,d=h||e.rowPixelSpacing===null&&i===1,m=a===e.columns,y=s===e.rows,T=Ne(o.rowCosines,l),v=Ne(o.columnCosines,u),C=f===e.voxelManager.getScalarData().constructor.name;return p&&d&&m&&y&&T&&v&&C}_updateVTKImageDataFromCornerstoneImage(e){let r=this._getImagePlaneModule(e.imageId).imagePositionPatient;r==null&&(r=[0,0,0]),this._imageData.setOrigin(r),Wu(this._imageData,e)}_loadAndDisplayImage(e,n){return this.useCPURendering?this._loadAndDisplayImageCPU(e,n):this._loadAndDisplayImageGPU(e,n)}_loadAndDisplayImageCPU(e,n){return new Promise((r,i)=>{function a(h,p,d){if(this.currentImageIdIndex!==p)return;const m=h.voxelManager.getScalarData(),y=h.preScale,T=y==null?void 0:y.scalingParameters,v=(y==null?void 0:y.scaled)&&(T==null?void 0:T.rescaleIntercept)%1!==0||(T==null?void 0:T.rescaleSlope)%1!==0;if(m instanceof Float32Array&&v){const x={min:h.maxPixelValue,max:h.minPixelValue},O=Math.abs(x.max-x.min)/65535,D=x.min,S=m.length,M=new Uint16Array(S);let V=65535,L=0;for(let F=0;F<S;F++){const k=Math.floor((m[F]-D)/O);M[F]=k,V=Math.min(V,k),L=Math.max(L,k)}h.minPixelValue=V,h.maxPixelValue=L,h.slope=O,h.intercept=D,h.getPixelData=()=>M,h.preScale={...h.preScale,scaled:!1}}this._setCSImage(h),this.viewportStatus=Ke.PRE_RENDER;const C={image:h,imageId:d,imageIdIndex:p,viewportId:this.id,renderingEngineId:this.renderingEngineId};H(this.element,A.STACK_NEW_IMAGE,C),this._updateToDisplayImageCPU(h),this.render(),this.currentImageIdIndex=p,r(d)}function s(h,p,d){const m={error:h,imageIdIndex:p,imageId:d};this.suppressEvents||H(ae,A.IMAGE_LOAD_ERROR,m),i(h)}function o(h,p,d){return rr(h,d).then(m=>{a.call(this,m,p,h)},m=>{s.call(this,m,p,h)})}const c=-5,l=Q.Interaction,u={imageId:e,imageIdIndex:n},f={useRGBA:!0,requestType:l},g={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};H(this.element,A.PRE_STACK_NEW_IMAGE,g),Mt.addRequest(o.bind(this,e,n,f),l,u,c)})}successCallback(e,n){var l,u;const r=this.imageIds.indexOf(e);if(this.currentImageIdIndex!==r)return;const i=(l=this.csImage)==null?void 0:l.imageFrame,a=n==null?void 0:n.imageFrame,s=(i==null?void 0:i.photometricInterpretation)||((u=this.csImage)==null?void 0:u.photometricInterpretation),o=(a==null?void 0:a.photometricInterpretation)||(n==null?void 0:n.photometricInterpretation);s!==o&&(this.stackInvalidated=!0),this._setCSImage(n);const c={image:n,imageId:e,imageIdIndex:r,viewportId:this.id,renderingEngineId:this.renderingEngineId};this._updateActorToDisplayImageId(n),H(this.element,A.STACK_NEW_IMAGE,c),this.render(),this.currentImageIdIndex=r}errorCallback(e,n,r){if(!n)return;const i=this.imageIds.indexOf(e),a={error:r,imageIdIndex:i,imageId:e};H(ae,A.IMAGE_LOAD_ERROR,a)}getLoaderImageOptions(e){const n=this.imageIds.indexOf(e),{transferSyntaxUID:r}=j("transferSyntax",e)||{};return{useRGBA:!1,transferSyntaxUID:r,priority:5,requestType:Q.Interaction,additionalDetails:{imageId:e,imageIdIndex:n}}}async loadImages(e,n){const r=await Promise.allSettled(e.map(a=>{const s=this.getLoaderImageOptions(a);return rr(a,s).then(o=>(n.successCallback(a,o),a),o=>(n.errorCallback(a,!0,o),a))})),i=r.filter(a=>a.status==="rejected");if(i&&i.length){const a=new CustomEvent(A.IMAGE_LOAD_ERROR,{detail:i,cancelable:!0});ae.dispatchEvent(a)}return r}_loadAndDisplayImageGPU(e,n){const r={imageId:e,imageIdIndex:n,viewportId:this.id,renderingEngineId:this.renderingEngineId};return H(this.element,A.PRE_STACK_NEW_IMAGE,r),this.imagesLoader.loadImages([e],this).then(i=>e)}_updateToDisplayImageCPU(e){const n=this.getImageDataMetadata(e),r=qu(this.canvas,e,this.modality,this._cpuFallbackEnabledElement.viewport.colormap),{windowCenter:i,windowWidth:a,voiLUTFunction:s}=r.voi;this.voiRange=Or(a,i,s),this._cpuFallbackEnabledElement.image=e,this._cpuFallbackEnabledElement.metadata={...n},this.cpuImagePixelData=e.voxelManager.getScalarData();const o=Object.assign({},r,this._cpuFallbackEnabledElement.viewport);this._cpuFallbackEnabledElement.viewport=this.stackInvalidated?r:o,this.stackInvalidated=!1,this.cpuRenderingInvalidated=!0,this._cpuFallbackEnabledElement.transform=zr(this._cpuFallbackEnabledElement)}getSliceViewInfo(){throw new Error("Method not implemented.")}addImages(e){const n=[];e.forEach(r=>{const{imageId:i,...a}=r,s=q.getImage(i),{origin:o,dimensions:c,direction:l,spacing:u,numberOfComponents:f}=this.getImageDataMetadata(s),g=this.createVTKImageData({origin:o,dimensions:c,direction:l,spacing:u,numberOfComponents:f,pixelArray:s.voxelManager.getScalarData()}),h=this.createActorMapper(g);h&&(n.push({uid:r.actorUID??Rt(),actor:h,referencedId:i,...a}),r.callback&&r.callback({imageActor:h,imageId:r.imageId}))}),this.addActors(n)}_updateActorToDisplayImageId(e){const n=this._checkVTKImageDataMatchesCornerstoneImage(e,this._imageData),r=this.getViewPresentation();if(n&&!this.stackInvalidated){this._updateVTKImageDataFromCornerstoneImage(e),this.resetCameraNoEvent(),this.setViewPresentation(r),this._setPropertiesFromCache(),this.stackActorReInitialized=!1;return}const{origin:i,direction:a,dimensions:s,spacing:o,numberOfComponents:c,imagePixelModule:l}=this.getImageDataMetadata(e),u=e.voxelManager.getScalarData();this._createVTKImageData({origin:i,direction:a,dimensions:s,spacing:o,numberOfComponents:c,pixelArray:u}),this._updateVTKImageDataFromCornerstoneImage(e);const f=this.createActorMapper(this._imageData),g=this.getActors();g.length&&g[0].uid===this.id?g[0].actor=f:g.unshift({uid:this.id,actor:f}),this.setActors(g);const{viewPlaneNormal:h,viewUp:p}=this._getCameraOrientation(a),d=this.getCamera();this.setCameraNoEvent({viewUp:p,viewPlaneNormal:h}),this.initialViewUp=p,this.resetCameraNoEvent(),this.setViewPresentation(r),this.triggerCameraEvent(this.getCamera(),d);const m=l.photometricInterpretation==="MONOCHROME1";this.stackInvalidated=!0;const y=this._getInitialVOIRange(e);this.setVOI(y,{forceRecreateLUTFunction:!!m}),this.initialInvert=!!m,this.setInvertColor(this.invert||this.initialInvert),this.stackInvalidated=!1,this.stackActorReInitialized=!0,this._publishCalibratedEvent&&this.triggerCalibrationEvent()}_getInitialVOIRange(e){if(this.voiRange&&this.voiUpdatedWithSetProperties)return this.voiRange;const{windowCenter:n,windowWidth:r,voiLUTFunction:i}=e;let a=this._getVOIRangeFromWindowLevel(r,n,i);return a=this._getPTPreScaledRange()||a,a}_getPTPreScaledRange(){if(this._isCurrentImagePTPrescaled())return this._getDefaultPTPrescaledVOIRange()}_isCurrentImagePTPrescaled(){var e;return!(this.modality!=="PT"||!this.csImage.isPreScaled||!((e=this.csImage.preScale)!=null&&e.scalingParameters.suvbw))}_getDefaultPTPrescaledVOIRange(){return{lower:0,upper:5}}_getVOIRangeFromWindowLevel(e,n,r=qe.LINEAR){let i,a;if(typeof n=="number"&&typeof e=="number"?(i=n,a=e):Array.isArray(n)&&Array.isArray(e)&&(i=n[0],a=e[0]),i!==void 0&&a!==void 0)return Or(a,i,r)}async _setImageIdIndex(e){if(e>=this.imageIds.length)throw new Error(`ImageIdIndex provided ${e} is invalid, the stack only has ${this.imageIds.length} elements`);this.currentImageIdIndex=e,this.hasPixelSpacing=!0,this.viewportStatus=Ke.PRE_RENDER;const n=await this._loadAndDisplayImage(this.imageIds[e],e);if(this.perImageIdDefaultProperties.size>=1){const r=this.perImageIdDefaultProperties.get(n);r!==void 0?this.setProperties(r):this.globalDefaultProperties!==void 0&&this.setProperties(this.globalDefaultProperties)}return n}resetCameraCPU({resetPan:e=!0,resetZoom:n=!0}){const{image:r}=this._cpuFallbackEnabledElement;if(!r)return;Zy(this._cpuFallbackEnabledElement,e,n);const{scale:i}=this._cpuFallbackEnabledElement.viewport,{clientWidth:a,clientHeight:s}=this.element,o=[a/2,s/2],c=this.canvasToWorldCPU(o);this.setCameraCPU({focalPoint:c,scale:i})}resetCameraGPU({resetPan:e,resetZoom:n}){return this.setCamera({flipHorizontal:!1,flipVertical:!1,viewUp:this.initialViewUp}),super.resetCamera({resetPan:e,resetZoom:n,resetToCenter:!0})}scroll(e,n=!0,r=!1){const i=this.imageIds,a=this.targetImageIdIndex,s=i.length;let o=a+e;o=Math.max(0,o),r?o=o%s:o=Math.min(s-1,o),this.targetImageIdIndex=o;const c=i[o];q.isLoaded(c)||!n?this.setImageIdIndex(o):(clearTimeout(this.debouncedTimeout),this.debouncedTimeout=window.setTimeout(()=>{this.setImageIdIndex(o)},40));const u={newImageIdIndex:o,imageId:c,direction:e};o!==a&&H(this.element,A.STACK_VIEWPORT_SCROLL,u)}setImageIdIndex(e){return this._throwIfDestroyed(),this.currentImageIdIndex===e?Promise.resolve(this.getCurrentImageId()):this._setImageIdIndex(e)}calibrateSpacing(e){const n=this.getImageIds().indexOf(e);this.stackInvalidated=!0,this._loadAndDisplayImage(e,n)}triggerCameraEvent(e,n){const r={previousCamera:n,camera:e,element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId};this.suppressEvents||H(this.element,A.CAMERA_MODIFIED,r)}triggerCalibrationEvent(){const{imageData:e}=this.getImageData(),n={element:this.element,viewportId:this.id,renderingEngineId:this.renderingEngineId,imageId:this.getCurrentImageId(),imageData:e,worldToIndex:e.getWorldToIndex(),...this._calibrationEvent};this.suppressEvents||H(this.element,A.IMAGE_SPACING_CALIBRATED,n),this._publishCalibratedEvent=!1}jumpToWorld(e){const n=this.getImageIds(),r=this.getImageData(),{direction:i,spacing:a}=r,s=ra({direction:i,spacing:a,imageIds:n},e,this.getCamera().viewPlaneNormal),o=n.indexOf(s);return o===-1?!1:(this.setImageIdIndex(o),this.render(),!0)}_getVOIRangeForCurrentImage(){const{windowCenter:e,windowWidth:n,voiLUTFunction:r}=this.csImage;return this._getVOIRangeFromWindowLevel(n,e,r)}_getValidVOILUTFunction(e){return Object.values(qe).includes(e)?e:qe.LINEAR}getSliceInfo(){const e=this.getSliceIndex(),{dimensions:n}=this.getImageData();return{width:n[0],height:n[1],sliceIndex:e,slicePlane:2}}isReferenceViewable(e,n={}){const r=this.getCurrentImageIdIndex(),i=this.imageIds[r];if(!i||!e)return!1;const{referencedImageId:a,multiSliceReference:s}=e;if(a){if(a===i)return!0;e.referencedImageURI||(e.referencedImageURI=ot(a));const{referencedImageURI:c}=e,l=this.imageKeyToIndexMap.get(c);if(n.asOverlay&&this.matchImagesForOverlay(i,a))return!0;if(l===void 0)return!1;if(n.withNavigation)return!0;const u=s&&this.imageKeyToIndexMap.get(s.referencedImageId);return r<=u&&r>=l}if(!super.isReferenceViewable(e,n))return!1;if(e.volumeId)return n.asVolume;const{cameraFocalPoint:o}=e;if(n.asNearbyProjection&&o){const{spacing:c,direction:l,origin:u}=this.getImageData(),f=l.slice(6,9),g=Zr({direction:l,spacing:c},f),h=Pe($(),o,u),p=fe(h,f),d=g/2;if(Math.abs(p)<=d)return!0}return!1}getViewReference(e={}){const{sliceIndex:n=this.getCurrentImageIdIndex()}=e,r=super.getViewReference(e),i=this.getCurrentImageId(n);if(i){if(r.referencedImageId=i,this.getCurrentImageIdIndex()!==n){const a=this.getImagePlaneReferenceData(n);if(!a)return;Object.assign(r,a)}return r}}setViewReference(e){if(!(e!=null&&e.referencedImageId)){(e==null?void 0:e.sliceIndex)!==void 0&&this.scroll(e.sliceIndex-this.targetImageIdIndex);return}const{referencedImageId:n}=e;e.referencedImageURI||(e.referencedImageURI=ot(n));const{referencedImageURI:r}=e,i=this.imageKeyToIndexMap.get(r);if(i===void 0){console.error(`No image URI found for ${r}`);return}this.scroll(i-this.targetImageIdIndex)}getViewReferenceId(e={}){const{sliceIndex:n=this.currentImageIdIndex}=e;return`imageId:${this.imageIds[n]}`}getSliceIndexForImage(e){if(e){if(typeof e=="string")return this.imageKeyToIndexMap.get(e);if(e.referencedImageId)return this.imageKeyToIndexMap.get(e.referencedImageId)}}getCPUFallbackError(e){return new Error(`method ${e} cannot be used during CPU Fallback mode`)}fillWithBackgroundColor(){const e=this.getRenderingEngine();e&&e.fillCanvasWithBackgroundColor(this.canvas,this.options.background)}unsetColormapCPU(){delete this._cpuFallbackEnabledElement.viewport.colormap,this._cpuFallbackEnabledElement.renderingTools={},this.cpuRenderingInvalidated=!0,this.fillWithBackgroundColor(),this.render()}setColormapCPU(e){this.colormap=e;const n=Gr(e.name);this._cpuFallbackEnabledElement.viewport.colormap=n,this._cpuFallbackEnabledElement.renderingTools={},this.fillWithBackgroundColor(),this.cpuRenderingInvalidated=!0,this.render();const r={viewportId:this.id,colormap:e};H(this.element,A.COLORMAP_MODIFIED,r)}setColormapGPU(e){const i=this.getDefaultActor().actor.getProperty(),a=i.getRGBTransferFunction(),s=Gr(e.name)||ia.getPresetByName(e.name);if(a)a.applyColorMap(s),a.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,a);else{const c=Mn.newInstance();c.applyColorMap(s),c.setMappingRange(this.voiRange.lower,this.voiRange.upper),i.setRGBTransferFunction(0,c)}this.colormap=e,this.render();const o={viewportId:this.id,colormap:e};H(this.element,A.COLORMAP_MODIFIED,o)}unsetColormapGPU(){throw new Error("unsetColormapGPU not implemented.")}_getImagePlaneModule(e){var i;const n=j(Je.IMAGE_PLANE,e);this.hasPixelSpacing=!n.usingDefaultValues||((i=this.calibration)==null?void 0:i.scale)>0,this.calibration||(this.calibration=n.calibration);const r={...n};return r.columnPixelSpacing||(r.columnPixelSpacing=1),r.rowPixelSpacing||(r.rowPixelSpacing=1),r.columnCosines||(r.columnCosines=[0,1,0]),r.rowCosines||(r.rowCosines=[1,0,0]),r.imagePositionPatient||(r.imagePositionPatient=[0,0,0]),r.imageOrientationPatient||(r.imageOrientationPatient=new Float32Array([1,0,0,0,1,0])),r}}class Xu extends Na{constructor(e){super(e),this.getNumberOfSlices=()=>1,this.getRotation=()=>0,this.getCurrentImageIdIndex=()=>0,this.getCurrentImageId=()=>null,this.resetCameraForResize=()=>this.resetCamera({resetPan:!0,resetZoom:!0,resetToCenter:!0});const{parallelProjection:n,orientation:r}=this.options,i=this.getVtkActiveCamera();n!=null&&i.setParallelProjection(n),r&&r!==br.ACQUISITION&&this.applyViewOrientation(r)}resetCamera({resetPan:e=!0,resetZoom:n=!0,resetToCenter:r=!0}={}){super.resetCamera({resetPan:e,resetZoom:n,resetToCenter:r});const i=this.getVtkActiveCamera();return i.getParallelProjection()?i.setClippingRange(-Te.MAXIMUM_RAY_DISTANCE,Te.MAXIMUM_RAY_DISTANCE):i.setClippingRange(Te.MINIMUM_SLAB_THICKNESS,Te.MAXIMUM_RAY_DISTANCE),this.getRenderer().resetCameraClippingRange(),!0}setSlabThickness(e,n){return null}setBlendMode(e,n,r){return null}resetProperties(e){const n=e?this.getActor(e):this.getDefaultActor();if(!n)throw new Error(`No actor found for the given volumeId: ${e}`);n.slabThickness&&(n.slabThickness=Te.MINIMUM_SLAB_THICKNESS,this.viewportProperties.slabThickness=void 0,this.updateClippingPlanesForActors(this.getCamera())),e||(e=this.getVolumeId());const r=q.getVolume(e);if(!r)throw new Error(`imageVolume with id: ${e} does not exist in cache`);if(bs(n.actor,r),xt(n)){const i=n.actor.getProperty().getRGBTransferFunction(0);Ia(i,this.initialTransferFunctionNodes)}this.setCamera(this.initialCamera),H(this.element,A.VOI_MODIFIED,super.getVOIModifiedEventDetail(e))}getSliceIndex(){return null}setCamera(e){super.setCamera(e),this.getRenderer().resetCameraClippingRange(),this.render()}setCameraClippingRange(){const e=this.getVtkActiveCamera();e.getParallelProjection()?e.setClippingRange(-Te.MAXIMUM_RAY_DISTANCE,Te.MAXIMUM_RAY_DISTANCE):e.setClippingRange(Te.MINIMUM_SLAB_THICKNESS,Te.MAXIMUM_RAY_DISTANCE)}resetSlabThickness(){return null}}const Yu="viewport-element",Zu="cornerstone-canvas",hc=1e-4;function Qy(t){const e=document.createElement("canvas");return e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.imageRendering="pixelated",e.classList.add(Zu),t.appendChild(e),e}function ev(t){const e=document.createElement("div");return e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.overflow="hidden",e.classList.add(Yu),t.appendChild(e),e}function _t(t){const e=`canvas.${Zu}`,n=`div.${Yu}`,r=t.querySelector(n)||ev(t),i=r.querySelector(e);if(i)return i;const a=Qy(r),s=r.getBoundingClientRect(),o=window.devicePixelRatio||1,c=Math.ceil(s.width*o),l=Math.ceil(s.height*o);return a.width=c,a.height=l,a}async function tv(t,e,n,r=!1,i=!1){n.forEach(s=>{const o=t.getViewport(s);if(!o)throw new Error(`Viewport with Id ${s} does not exist`);if(!(o instanceof Na))throw new Error("setVolumesForViewports only supports VolumeViewport and VolumeViewport3D")});const a=n.map(async s=>{await t.getViewport(s).setVolumes(e,r,i)});await Promise.all(a)}class nv{constructor(e){this.opacity=.4,this.outlineOpacity=.4,this.transferFunction=[],this.actor=e}setRGBTransferFunction(e,n){this.transferFunction[e]=n}setScalarOpacity(e){}setInterpolationTypeToNearest(){}setUseLabelOutline(){}setLabelOutlineOpacity(e){this.outlineOpacity=e}setLabelOutlineThickness(){}getColor(e){const n=this.transferFunction[0],r=n.getRedValue(e),i=n.getGreenValue(e),a=n.getBlueValue(e);return[r,i,a,this.opacity]}}class rv{constructor(e){this.actor=e}getInputData(){return this.actor.getImage()}}class iv{constructor(e,n){this.canvasProperties=new nv(this),this.visibility=!1,this.mapper=new rv(this),this.className="CanvasActor",this.derivedImage=n,this.viewport=e}renderRLE(e,n,r){const{width:i,height:a}=this.image;let{canvas:s}=this;(!s||s.width!==i||s.height!==a)&&(this.canvas=s=new window.OffscreenCanvas(i,a));const o=s.getContext("2d"),c=o.createImageData(i,a),{data:l}=c;l.fill(0);const{map:u}=r;let f=1/0,g=1/0,h=-1/0,p=-1/0;for(let y=0;y<a;y++){const T=u.getRun(y,0);if(!T)continue;g=Math.min(g,y),p=Math.max(p,y);const v=y*i<<2;let C;for(const x of T){const{start:w,end:E,value:O}=x;if(O===0){C||(C=[]),C.push(T.indexOf(x));continue}f=Math.min(f,w),h=Math.max(h,E);const D=this.canvasProperties.getColor(O).map(M=>M*255);let S=v+(w<<2);for(let M=w;M<E;M++)l[S++]=D[0],l[S++]=D[1],l[S++]=D[2],l[S++]=D[3]}}if(f>i)return;const d=h-f,m=p-g;o.putImageData(c,0,0,f-1,g-1,d+2,m+2),n.drawImage(s,f,g,d,m,f,g,d,m)}setMapper(e){this.mapper=e}render(e,n){if(!this.visibility)return;const r=this.image||this.getImage(),{width:i,height:a}=r,s=r.getScalarData();if(!s)return;const{voxelManager:o}=r;if(o&&o.map.getRun){this.renderRLE(e,n,o);return}let{canvas:c}=this;(!c||c.width!==i||c.height!==a)&&(this.canvas=c=new window.OffscreenCanvas(i,a));const l=c.getContext("2d"),u=l.createImageData(i,a),{data:f}=u;let g=0,h=0,p=1/0,d=1/0,m=-1/0,y=-1/0;for(let C=0;C<a;C++)for(let x=0;x<i;x++){const w=s[g++];if(w){p=Math.min(x,p),d=Math.min(C,d),m=Math.max(x,m),y=Math.max(C,y);const E=this.canvasProperties.getColor(w);f[h]=E[0]*255,f[h+1]=E[1]*255,f[h+2]=E[2]*255,f[h+3]=127}h+=4}if(p>i)return;const T=m-p+1,v=y-d+1;l.putImageData(u,0,0,p,d,T,v),n.drawImage(c,p,d,T,v,p,d,T,v)}getClassName(){return this.className}getProperty(){return this.canvasProperties}setVisibility(e){this.visibility=e}getMapper(){return this.mapper}isA(e){return e===this.className}getImage(){if(this.image)return this.image;this.image={...this.derivedImage};const e=this.viewport.getImageData();return Object.assign(this.image,{worldToIndex:n=>e.imageData.worldToIndex(n),indexToWorld:(n,r)=>e.imageData.indexToWorld(n,r),getDimensions:()=>e.dimensions,getScalarData:()=>{var n;return(n=this.derivedImage)==null?void 0:n.getPixelData()},getDirection:()=>e.direction,getSpacing:()=>e.spacing,setOrigin:()=>null,setDerivedImage:n=>{this.derivedImage=n,this.image=null},modified:()=>null}),this.image}}const Ws=class Ws{static imageIdToFrames(e){const n=e.match(this.frameRangeExtractor);if(!n||!n[2])return null;const r=n[2].split("-").map(i=>Number(i));return r.length===1?r[0]:r}static imageIdToFrameEnd(e){const n=this.imageIdToFrames(e);return Array.isArray(n)?n[1]:n}static imageIdToFrameStart(e){const n=this.imageIdToFrames(e);return Array.isArray(n)?n[0]:n}static framesToString(e){return Array.isArray(e)?`${e[0]}-${e[1]}`:String(e)}static framesToImageId(e,n){const r=e.match(this.frameRangeExtractor);if(!r||!r[2])return null;const i=this.framesToString(n);return e.replace(this.frameRangeExtractor,`${r[1]}${i}`)}};Ws.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let Yn=Ws;const Nr=class Nr extends ar{constructor(e){super({...e,canvas:e.canvas||_t(e.element)}),this.videoWidth=0,this.videoHeight=0,this.loop=!0,this.mute=!0,this.isPlaying=!1,this.scrollSpeed=1,this.playbackRate=1,this.frameRange=[0,0],this.fps=30,this.videoCamera={panWorld:[0,0],parallelScale:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({loop:this.videoElement.loop,muted:this.videoElement.muted,playbackRate:this.playbackRate,scrollSpeed:this.scrollSpeed,voiRange:{...this.voiRange}}),this.getMiddleSliceData=()=>{throw new Error("Method not implemented.")},this.useCustomRenderingPipeline=!0,this.resetCamera=()=>(this.refreshRenderValues(),this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame(),!0),this.getNumberOfSlices=()=>{const n=Math.round(this.videoElement.duration*this.fps/this.scrollSpeed);return isNaN(n)?this.numberOfFrames:n},this.getFrameOfReferenceUID=()=>this.videoElement.src,this.resize=()=>{const n=this.canvas,{clientWidth:r,clientHeight:i}=n;(n.width!==r||n.height!==i)&&(n.width=r,n.height=i),this.refreshRenderValues(),this.isPlaying||this.renderFrame()},this.canvasToWorld=(n,r=[0,0,0])=>{const i=this.videoCamera.panWorld,a=this.getWorldToCanvasRatio(),s=[i[0]*a,i[1]*a],o=[n[0]-s[0],n[1]-s[1]];return r.splice(0,2,o[0]/a,o[1]/a),r},this.worldToCanvas=n=>{const r=this.videoCamera.panWorld,i=this.getWorldToCanvasRatio();return[(n[0]+r[0])*i,(n[1]+r[1])*i]},this.getRotation=()=>0,this.canvasToIndex=n=>{const r=this.getTransform();return r.invert(),r.transformPoint(n.map(i=>i*devicePixelRatio))},this.indexToCanvas=n=>this.getTransform().transformPoint(n).map(i=>i/devicePixelRatio),this.customRenderViewportToCanvas=()=>{this.renderFrame()},this.renderFrame=()=>{var o;const n=window.devicePixelRatio||1,i=this.getTransform().getMatrix(),a=this.canvasContext;a.resetTransform(),a.clearRect(0,0,this.canvas.width,this.canvas.height),a.transform(i[0]/n,i[1]/n,i[2]/n,i[3]/n,i[4]/n,i[5]/n),a.drawImage(this.videoElement,0,0,this.videoWidth,this.videoHeight);for(const c of this.getActors())c.actor.render(this,this.canvasContext);this.canvasContext.resetTransform(),H(this.element,A.STACK_NEW_IMAGE,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),H(this.element,A.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,imageIndex:this.getCurrentImageIdIndex(),numberOfSlices:this.numberOfFrames,renderingEngineId:this.renderingEngineId,time:this.videoElement.currentTime,duration:this.videoElement.duration}),(o=this.initialRender)==null||o.call(this);const s=this.getFrameNumber();this.isPlaying&&(s<this.frameRange[0]?this.setFrameNumber(this.frameRange[0]):s>this.frameRange[1]&&(this.loop?this.setFrameNumber(this.frameRange[0]):this.pause()))},this.renderWhilstPlaying=()=>{this.renderFrame(),this.isPlaying&&requestAnimationFrame(this.renderWhilstPlaying)},this.canvasContext=this.canvas.getContext("2d"),this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.videoElement=document.createElement("video"),this.videoElement.muted=this.mute,this.videoElement.loop=this.loop,this.videoElement.autoplay=!0,this.videoElement.crossOrigin="anonymous",this.addEventListeners(),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(A.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(A.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){this.removeEventListeners(),this.videoElement.remove()}getImageDataMetadata(e){const n=typeof e=="string"?e:e.imageId,r=j(Je.IMAGE_PLANE,n);let i=r.rowCosines,a=r.columnCosines;(r.usingDefaultValues||i==null||a==null)&&(i=[1,0,0],a=[0,1,0]);const o=xe(i[0],i[1],i[2]),c=xe(a[0],a[1],a[2]),{rows:l,columns:u}=r,f=$();ve(f,o,c);let g=r.imagePositionPatient;g==null&&(g=[0,0,0]);const h=r.columnPixelSpacing||1,p=r.rowPixelSpacing||1,d=r.columns,m=r.rows,y=1,T=1;return this.hasPixelSpacing=!!r.columnPixelSpacing,{bitsAllocated:8,numberOfComponents:3,origin:g,rows:l,columns:u,direction:[...o,...c,...f],dimensions:[d,m,T],spacing:[h,p,y],hasPixelSpacing:this.hasPixelSpacing,numVoxels:d*m*T,imagePlaneModule:r}}setDataIds(e,n){var r;this.setVideo(e[0],(((r=n.viewReference)==null?void 0:r.sliceIndex)||0)+1)}setVideo(e,n){this.imageId=Array.isArray(e)?e[0]:e;const r=j(Je.IMAGE_URL,e);if(!(r!=null&&r.rendered))throw new Error(`Video Image ID ${e} does not have a rendered video view`);const{rendered:i}=r,a=j(Je.GENERAL_SERIES,e);this.modality=a==null?void 0:a.Modality,this.metadata=this.getImageDataMetadata(e);let{cineRate:s,numberOfFrames:o}=j(Je.CINE,e);return this.numberOfFrames=o,this.setVideoURL(i).then(()=>((!o||o===1)&&(o=Math.round(this.videoElement.duration*(s||30))),s||(s=Math.round(o/this.videoElement.duration)),this.fps=s,this.numberOfFrames=o,this.setFrameRange([1,o]),this.initialRender=()=>{this.initialRender=null,this.pause(),this.setFrameNumber(n||1)},new Promise(c=>{window.setTimeout(()=>{this.setFrameNumber(n||1),c(this)},25)})))}async setVideoURL(e){return new Promise(n=>{this.videoElement.src=e,this.videoElement.preload="auto";const r=()=>{this.videoWidth=this.videoElement.videoWidth,this.videoHeight=this.videoElement.videoHeight,this.videoElement.removeEventListener("loadedmetadata",r),this.refreshRenderValues(),n(!0)};this.videoElement.addEventListener("loadedmetadata",r)})}getImageIds(){const e=new Array(this.numberOfFrames),n=this.imageId.replace(/[0-9]+$/,"");for(let r=0;r<this.numberOfFrames;r++)e[r]=`${n}${r+1}`;return e}togglePlayPause(){return this.isPlaying?(this.pause(),!1):(this.play(),!0)}async play(){try{this.isPlaying||(this.isPlaying=!0,await this.videoElement.play(),this.renderWhilstPlaying())}catch{}}pause(){try{this.isPlaying=!1,this.videoElement.pause()}catch{}}async scroll(e=1){await this.pause();const n=this.videoElement,r=this.renderFrame,a=n.currentTime+e*this.scrollSpeed/this.fps;n.currentTime=a;const s=o=>{r(),n.removeEventListener("seeked",s)};n.addEventListener("seeked",s)}async start(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=0,e.paused){const r=i=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async end(){const e=this.videoElement,n=this.renderFrame;if(e.currentTime=e.duration,e.paused){const r=i=>{n(),e.removeEventListener("seeked",r)};e.addEventListener("seeked",r)}}async setTime(e){const n=this.videoElement,r=this.renderFrame;if(n.currentTime=e,n.paused){const i=a=>{r(),n.removeEventListener("seeked",i)};n.addEventListener("seeked",i)}}getSliceViewInfo(){throw new Error("Method not implemented.")}async setFrameNumber(e){this.setTime((e-1)/this.fps)}setFrameRange(e){if(!e){this.frameRange=[1,this.numberOfFrames];return}e.length!==2||e[0]===e[1]||(this.frameRange=[e[0],e[1]])}getSliceIndexForImage(e){if(e){if(typeof e=="string")return Yn.imageIdToFrameStart(e);if(e.referencedImageId)return Yn.imageIdToFrameStart(e.referencedImageId)}}getFrameRange(){return this.frameRange}setProperties(e){e.loop!==void 0&&(this.videoElement.loop=e.loop),e.muted!==void 0&&(this.videoElement.muted=e.muted),e.playbackRate!==void 0&&this.setPlaybackRate(e.playbackRate),e.scrollSpeed!==void 0&&this.setScrollSpeed(e.scrollSpeed),e.voiRange&&this.setVOI(e.voiRange)}setPlaybackRate(e=1){if(this.playbackRate=e,e<.0625){this.pause();return}this.videoElement&&(this.videoElement.playbackRate=e,this.play())}setScrollSpeed(e=1,n=Gi.FRAME){this.scrollSpeed=n===Gi.SECOND?e*this.fps:e}resetProperties(){this.setProperties({loop:!1,muted:!0})}getScalarData(){var a;if(((a=this.scalarData)==null?void 0:a.frameNumber)===this.getFrameNumber())return this.scalarData;if(!this.videoElement||!this.videoElement.videoWidth||!this.videoElement.videoHeight){console.debug("Video not ready yet, returning empty scalar data");const s=new Uint8ClampedArray;return s.getRange=()=>[0,255],s.frameNumber=-1,s}const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");n.drawImage(this.videoElement,0,0);const i=n.getImageData(0,0,e.width,e.height).data;return i.getRange=()=>[0,255],i.frameNumber=this.getFrameNumber(),this.scalarData=i,i}getImageData(){const{metadata:e}=this,n=e.spacing,r={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:a=>{const s=this.worldToCanvas(a),o=this.canvasToIndex(s);return[o[0],o[1],0]},indexToWorld:(a,s)=>{const o=this.indexToCanvas([a[0],a[1]]);return this.canvasToWorld(o,s)}},i={dimensions:e.dimensions,spacing:n,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:e.FrameOfReferenceUID},getScalarData:()=>this.getScalarData(),scalarData:this.getScalarData(),imageData:r,voxelManager:{forEach:(a,s)=>Is(s.imageData,{pointInShapeFn:s.isInObject??(()=>!0),callback:a,boundsIJK:s.boundsIJK,returnPoints:s.returnPoints??!1})},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1}};return Object.defineProperty(r,"scalarData",{get:()=>this.getScalarData(),enumerable:!0}),i}hasImageURI(e){const n=e.match(Nr.frameRangeExtractor),r=n?e.substring(0,n.index):e;return this.imageId.includes(r)}setVOI(e){this.voiRange=e,this.setColorTransform()}setWindowLevel(e=256,n=128){const r=n-e/2,i=n+e/2-1;this.setVOI({lower:r,upper:i}),this.setColorTransform()}setAverageWhite(e){this.averageWhite=e,this.setColorTransform()}setColorTransform(){if(!this.voiRange&&!this.averageWhite){this.feFilter=null;return}const e=this.averageWhite||[255,255,255],n=Math.max(...e),r=e.map(c=>n/c),{lower:i=0,upper:a=255}=this.voiRange||{},s=(a-i+1)/255,o=i/255;this.feFilter=`url('data:image/svg+xml,      <svg xmlns="http://www.w3.org/2000/svg">        <filter id="colour" color-interpolation-filters="linearRGB">        <feColorMatrix type="matrix"         values="          ${r[0]*s} 0 0 0 ${o}           0 ${r[1]*s} 0 0 ${o}           0 0 ${r[2]*s} 0 ${o}           0 0 0 1 0" />        </filter>      </svg>#colour')`,this.canvas.style.filter=this.feFilter}setCamera(e){const{parallelScale:n,focalPoint:r}=e;if(n&&(this.videoCamera.parallelScale=this.element.clientHeight/2/n),r!==void 0){const i=this.worldToCanvas(r),a=[this.element.clientWidth/2,this.element.clientHeight/2],s=[(i[0]-a[0])/this.videoCamera.parallelScale,(i[1]-a[1])/this.videoCamera.parallelScale];this.videoCamera.panWorld=[this.videoCamera.panWorld[0]-s[0],this.videoCamera.panWorld[1]-s[1]]}this.canvasContext.fillStyle="rgba(0,0,0,1)",this.canvasContext.fillRect(0,0,this.canvas.width,this.canvas.height),this.isPlaying||this.renderFrame()}getCurrentImageId(e=this.getCurrentImageIdIndex()){return this.imageId.replace("/frames/1",`/frames/${e+1}`)}getViewReferenceId(e={}){const{sliceIndex:n}=e;return n===void 0?`videoId:${this.getCurrentImageId()}`:Array.isArray(n)?`videoId:${this.imageId.substring(0,this.imageId.length-1)}${n[0]+1}-${n[1]+1}`:`videoId:${this.imageId.replace("/frames/1",`/frames/${1+n}`)}`}isReferenceViewable(e,n={}){let{imageURI:r}=n;const{referencedImageId:i,sliceIndex:a,multiSliceReference:s}=e;if(!super.isReferenceViewable(e))return!1;const o=this.getCurrentImageId();if(!r){const g=o.indexOf(":");r=o.substring(g+1,o.length-1)}if(n.withNavigation)return!0;const c=this.getSliceIndex();if(s){const g=Yn.imageIdToFrameEnd(s.referencedImageId);return c>=a&&c<=g}if(a!==void 0)return c===a;if(!i)return!1;const l=i.match(Nr.frameRangeExtractor);if(!l||!l[2])return!0;const u=l[2].split("-").map(g=>Number(g)),f=c+1;return u[0]<=f&&f<=(u[1]??u[0])}setViewReference(e){typeof e.sliceIndex=="number"?this.setFrameNumber(e.sliceIndex+1):Array.isArray(e.sliceIndex)&&this.setFrameRange(e.sliceIndex)}getViewReference(e){const n=(e==null?void 0:e.sliceIndex)??(this.isPlaying?this.frameRange[0]:this.getCurrentImageIdIndex()),r=(e==null?void 0:e.rangeEndSliceIndex)??(this.isPlaying?this.frameRange[1]-1:void 0),i=r>n?{sliceIndex:r,referencedImageId:this.getCurrentImageId(r)}:void 0;return{...super.getViewReference(e),referencedImageId:this.getViewReferenceId(e),sliceIndex:n,multiSliceReference:i}}getFrameNumber(){return 1+this.getCurrentImageIdIndex()}getCurrentImageIdIndex(){return Math.round(this.videoElement.currentTime*this.fps)}getSliceIndex(){return this.getCurrentImageIdIndex()/this.scrollSpeed}getCamera(){const{parallelScale:e}=this.videoCamera,n=[this.element.clientWidth/2,this.element.clientHeight/2];return{parallelProjection:!0,focalPoint:this.canvasToWorld(n),position:[0,0,0],viewUp:[0,-1,0],parallelScale:this.element.clientHeight/2/e,viewPlaneNormal:[0,0,1]}}getFrameRate(){return this.fps}getPan(){const e=this.videoCamera.panWorld;return[e[0],e[1]]}refreshRenderValues(){let e=this.canvas.offsetWidth/this.videoWidth;this.videoHeight*e>this.canvas.height&&(e=this.canvas.offsetHeight/this.videoHeight);const n=Math.floor(this.videoWidth*e),r=Math.floor(this.videoHeight*e),i=(this.canvas.offsetWidth-n)/2,a=(this.canvas.offsetHeight-r)/2,s=i/e,o=a/e;this.videoCamera.panWorld=[s,o],this.videoCamera.parallelScale=e}getWorldToCanvasRatio(){return this.videoCamera.parallelScale}getCanvasToWorldRatio(){return 1/this.videoCamera.parallelScale}getTransform(){const e=this.videoCamera.panWorld,n=window.devicePixelRatio||1,r=this.getWorldToCanvasRatio(),i=this.getCanvasToWorldRatio(),a=[this.canvas.offsetWidth/2,this.canvas.offsetHeight/2],s=[a[0]*i,a[1]*i],o=new cr;return o.scale(n,n),o.translate(a[0],a[1]),o.scale(r,r),o.translate(e[0],e[1]),o.translate(-s[0],-s[1]),o}updateCameraClippingPlanesAndRange(){}addImages(e){const n=this.getActors();e.forEach(r=>{const{imageId:i,...a}=r,s=q.getImage(i),o=this.createActorMapper(s),c=r.actorUID??Rt();o&&(n.push({uid:c,actor:o,referencedId:i,...a}),r.callback&&r.callback({imageActor:o,imageId:i}))}),this.setActors(n)}createActorMapper(e){return new iv(this,e)}};Nr.frameRangeExtractor=/(\/frames\/|[&?]frameNumber=)([^/&?]*)/i;let L0=Nr;const av=`
.DicomMicroscopyViewer {
  --ol-partial-background-color: rgba(127, 127, 127, 0.7);
  --ol-foreground-color: #000000;
  --ol-subtle-foreground-color: #000;
  --ol-subtle-background-color: rgba(78, 78, 78, 0.5);
}

.DicomMicroscopyViewer .ol-box {
  box-sizing: border-box;
  border-radius: 2px;
  border: 1.5px solid var(--ol-background-color);
  background-color: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-mouse-position {
  top: 8px;
  right: 8px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line {
  background: var(--ol-partial-background-color);
  border-radius: 4px;
  bottom: 8px;
  left: 8px;
  padding: 2px;
  position: absolute;
}

.DicomMicroscopyViewer .ol-scale-line-inner {
  border: 1px solid var(--ol-subtle-foreground-color);
  border-top: none;
  color: var(--ol-foreground-color);
  font-size: 10px;
  text-align: center;
  margin: 1px;
  will-change: contents, width;
  transition: all 0.25s;
}

.DicomMicroscopyViewer .ol-scale-bar {
  position: absolute;
  bottom: 8px;
  left: 8px;
}

.DicomMicroscopyViewer .ol-scale-bar-inner {
  display: flex;
}

.DicomMicroscopyViewer .ol-scale-step-marker {
  width: 1px;
  height: 15px;
  background-color: var(--ol-foreground-color);
  float: right;
  z-index: 10;
}

.DicomMicroscopyViewer .ol-scale-step-text {
  position: absolute;
  bottom: -5px;
  font-size: 10px;
  z-index: 11;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-text {
  position: absolute;
  font-size: 12px;
  text-align: center;
  bottom: 25px;
  color: var(--ol-foreground-color);
  text-shadow:
    -1.5px 0 var(--ol-partial-background-color),
    0 1.5px var(--ol-partial-background-color),
    1.5px 0 var(--ol-partial-background-color),
    0 -1.5px var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar {
  position: relative;
  height: 10px;
  z-index: 9;
  box-sizing: border-box;
  border: 1px solid var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-even {
  background-color: var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-scale-singlebar-odd {
  background-color: var(--ol-background-color);
}

.DicomMicroscopyViewer .ol-unsupported {
  display: none;
}

.DicomMicroscopyViewer .ol-viewport,
.DicomMicroscopyViewer .ol-unselectable {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.DicomMicroscopyViewer .ol-viewport canvas {
  all: unset;
}

.DicomMicroscopyViewer .ol-selectable {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  -moz-user-select: text;
  user-select: text;
}

.DicomMicroscopyViewer .ol-grabbing {
  cursor: -webkit-grabbing;
  cursor: -moz-grabbing;
  cursor: grabbing;
}

.DicomMicroscopyViewer .ol-grab {
  cursor: move;
  cursor: -webkit-grab;
  cursor: -moz-grab;
  cursor: grab;
}

.DicomMicroscopyViewer .ol-control {
  position: absolute;
  background-color: var(--ol-subtle-background-color);
  border-radius: 4px;
}

.DicomMicroscopyViewer .ol-zoom {
  top: 0.5em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-rotate {
  top: 0.5em;
  right: 0.5em;
  transition:
    opacity 0.25s linear,
    visibility 0s linear;
}

.DicomMicroscopyViewer .ol-rotate.ol-hidden {
  opacity: 0;
  visibility: hidden;
  transition:
    opacity 0.25s linear,
    visibility 0s linear 0.25s;
}

.DicomMicroscopyViewer .ol-zoom-extent {
  top: 4.643em;
  left: 0.5em;
}

.DicomMicroscopyViewer .ol-full-screen {
  right: 0.5em;
  top: 0.5em;
}

.DicomMicroscopyViewer .ol-control button {
  display: block;
  margin: 1px;
  padding: 0;
  color: var(--ol-subtle-foreground-color);
  font-weight: bold;
  text-decoration: none;
  font-size: inherit;
  text-align: center;
  height: 1.375em;
  width: 1.375em;
  line-height: 0.4em;
  background-color: var(--ol-background-color);
  border: none;
  border-radius: 2px;
}

.DicomMicroscopyViewer .ol-control button::-moz-focus-inner {
  border: none;
  padding: 0;
}

.DicomMicroscopyViewer .ol-zoom-extent button {
  line-height: 1.4em;
}

.DicomMicroscopyViewer .ol-compass {
  display: block;
  font-weight: normal;
  will-change: transform;
}

.DicomMicroscopyViewer .ol-touch .ol-control button {
  font-size: 1.5em;
}

.DicomMicroscopyViewer .ol-touch .ol-zoom-extent {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-control button:hover,
.DicomMicroscopyViewer .ol-control button:focus {
  text-decoration: none;
  outline: 1px solid var(--ol-subtle-foreground-color);
  color: var(--ol-foreground-color);
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-in {
  border-radius: 2px 2px 0 0;
}

.DicomMicroscopyViewer .ol-zoom .ol-zoom-out {
  border-radius: 0 0 2px 2px;
}

.DicomMicroscopyViewer .ol-attribution {
  text-align: right;
  bottom: 0.5em;
  right: 0.5em;
  max-width: calc(100% - 1.3em);
  display: flex;
  flex-flow: row-reverse;
  align-items: center;
}

.DicomMicroscopyViewer .ol-attribution a {
  color: var(--ol-subtle-foreground-color);
  text-decoration: none;
}

.DicomMicroscopyViewer .ol-attribution ul {
  margin: 0;
  padding: 1px 0.5em;
  color: var(--ol-foreground-color);
  text-shadow: 0 0 2px var(--ol-background-color);
  font-size: 12px;
}

.DicomMicroscopyViewer .ol-attribution li {
  display: inline;
  list-style: none;
}

.DicomMicroscopyViewer .ol-attribution li:not(:last-child):after {
  content: ' ';
}

.DicomMicroscopyViewer .ol-attribution img {
  max-height: 2em;
  max-width: inherit;
  vertical-align: middle;
}

.DicomMicroscopyViewer .ol-attribution button {
  flex-shrink: 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-collapsed ul {
  display: none;
}

.DicomMicroscopyViewer .ol-attribution:not(.ol-collapsed) {
  background: var(--ol-partial-background-color);
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible {
  bottom: 0;
  right: 0;
  border-radius: 4px 0 0;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible img {
  margin-top: -0.2em;
  max-height: 1.6em;
}

.DicomMicroscopyViewer .ol-attribution.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-zoomslider {
  top: 4.5em;
  left: 0.5em;
  height: 200px;
}

.DicomMicroscopyViewer .ol-zoomslider button {
  position: relative;
  height: 10px;
}

.DicomMicroscopyViewer .ol-touch .ol-zoomslider {
  top: 5.5em;
}

.DicomMicroscopyViewer .ol-overviewmap {
  left: 0.5em;
  bottom: 0.5em;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible {
  bottom: 0;
  left: 0;
  border-radius: 0 4px 0 0;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap button {
  display: block;
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-map {
  border: 1px solid var(--ol-subtle-foreground-color);
  height: 150px;
  width: 150px;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) button {
  bottom: 0;
  left: 0;
  position: absolute;
}

.DicomMicroscopyViewer .ol-overviewmap.ol-collapsed .ol-overviewmap-map,
.DicomMicroscopyViewer .ol-overviewmap.ol-uncollapsible button {
  display: none;
}

.DicomMicroscopyViewer .ol-overviewmap:not(.ol-collapsed) {
  background: var(--ol-subtle-background-color);
}

.DicomMicroscopyViewer .ol-overviewmap-box {
  border: 0.5px dotted var(--ol-subtle-foreground-color);
}

.DicomMicroscopyViewer .ol-overviewmap .ol-overviewmap-box:hover {
  cursor: move;
}

@layout-header-background: #007ea3;
@primary-color: #007ea3;
@processing-color: #8cb8c6;
@success-color: #3f9c35;
@warning-color: #eeaf30;
@error-color: #96172e;
@font-size-base: 14px;

.DicomMicroscopyViewer .ol-tooltip {
  font-size: 16px !important;
}
`,pc=Symbol.for("map"),sv="postrender",jn=class jn extends ar{constructor(e){super({...e,canvas:e.canvas||_t(e.element)}),this.internalCamera={rotation:0,centerIndex:[0,0],extent:[0,-2,1,-1],xSpacing:1,ySpacing:1,resolution:1,zoom:1},this.voiRange={lower:0,upper:255},this.getProperties=()=>({}),this.resetCamera=()=>!0,this.getNumberOfSlices=()=>1,this.getFrameOfReferenceUID=()=>this.frameOfReferenceUID,this.resize=()=>{const r=this.canvas,{clientWidth:i,clientHeight:a}=r;(r.width!==i||r.height!==a)&&(r.width=i,r.height=a),this.refreshRenderValues()},this.canvasToWorld=r=>{if(!this.metadata)return;const[i,a]=this.canvasToIndex(r),{origin:s,spacing:o,direction:c}=this.getImageData(),l=xe(0,0,0),u=c.slice(0,3),f=c.slice(3,6);return ze(l,s,u,i*o[0]),ze(l,l,f,a*o[1]),[l[0],l[1],l[2]]},this.worldToCanvas=r=>{if(!this.metadata)return;const{spacing:i,direction:a,origin:s}=this.metadata,o=a.slice(0,3),c=a.slice(3,6),l=Pe([0,0,0],r,s),u=[fe(l,o)/i[0],fe(l,c)/i[1]];return this.indexToCanvas(u)},this.postrender=()=>{this.refreshRenderValues(),H(this.element,A.IMAGE_RENDERED,{element:this.element,viewportId:this.id,viewport:this,renderingEngineId:this.renderingEngineId})},this.getRotation=()=>0,this.canvasToIndex=r=>{const i=this.getTransform();return i.invert(),i.transformPoint(r)},this.indexToCanvas=r=>this.getTransform().transformPoint(r),this.customRenderViewportToCanvas=()=>{},this.getImageIds=()=>[this.imageIds[0]],this.renderingEngineId=e.renderingEngineId,this.element.setAttribute("data-viewport-uid",this.id),this.element.setAttribute("data-rendering-engine-uid",this.renderingEngineId),this.element.style.position="relative",this.microscopyElement=document.createElement("div"),this.microscopyElement.setAttribute("class","DicomMicroscopyViewer"),this.microscopyElement.id=Rt(),this.microscopyElement.innerText="Initial",this.microscopyElement.style.background="grey",this.microscopyElement.style.width="100%",this.microscopyElement.style.height="100%",this.microscopyElement.style.position="absolute",this.microscopyElement.style.left="0",this.microscopyElement.style.top="0";const n=this.element.firstElementChild;n.insertBefore(this.microscopyElement,n.childNodes[1]),this.addEventListeners(),this.addWidget("DicomMicroscopyViewer",{getEnabled:()=>!!this.viewer,setEnabled:()=>{this.elementDisabledHandler()}}),this.resize()}static get useCustomRenderingPipeline(){return!0}addEventListeners(){this.canvas.addEventListener(A.ELEMENT_DISABLED,this.elementDisabledHandler)}removeEventListeners(){this.canvas.removeEventListener(A.ELEMENT_DISABLED,this.elementDisabledHandler)}elementDisabledHandler(){var n;this.removeEventListeners(),(n=this.viewer)==null||n.cleanup(),this.viewer=null,this.element.firstElementChild.removeChild(this.microscopyElement),this.microscopyElement=null}getImageDataMetadata(e=0){var D;const n=this.metadataDicomweb.reduce((S,M)=>(S==null?void 0:S.NumberOfFrames)<M.NumberOfFrames?M:S),{TotalPixelMatrixColumns:r,TotalPixelMatrixRows:i,ImageOrientationSlide:a,ImagedVolumeWidth:s,ImagedVolumeHeight:o,ImagedVolumeDepth:c}=n,l=j(Je.IMAGE_PLANE,this.imageIds[e]);let u=a.slice(0,3),f=a.slice(3,6);(u==null||f==null)&&(u=[1,0,0],f=[0,1,0]);const g=xe(u[0],u[1],u[2]),h=xe(f[0],f[1],f[2]),p=$();ve(p,g,h);const{XOffsetInSlideCoordinateSystem:d=0,YOffsetInSlideCoordinateSystem:m=0,ZOffsetInSlideCoordinateSystem:y=0}=((D=n.TotalPixelMatrixOriginSequence)==null?void 0:D[0])||{},T=[d,m,y],v=s/r,C=o/i,x=r,w=i,E=c,O=1;return this.hasPixelSpacing=!!(s&&o),{bitsAllocated:8,numberOfComponents:3,origin:T,direction:[...g,...h,...p],dimensions:[x,w,O],spacing:[v,C,E],hasPixelSpacing:this.hasPixelSpacing,numVoxels:x*w*O,imagePlaneModule:l}}async setFrameNumber(e){}setProperties(e){}resetProperties(){this.setProperties({})}getScalarData(){return null}getImageData(){const{metadata:e}=this;if(!e)return null;const{spacing:n}=e,r={getDirection:()=>e.direction,getDimensions:()=>e.dimensions,getRange:()=>[0,255],getScalarData:()=>this.getScalarData(),getSpacing:()=>e.spacing,worldToIndex:a=>{const s=this.worldToCanvas(a),o=this.canvasToIndex(s);return[o[0],o[1],0]},indexToWorld:a=>{const s=this.indexToCanvas([a[0],a[1]]);return this.canvasToWorld(s)}};return{dimensions:e.dimensions,spacing:n,numberOfComponents:3,origin:e.origin,direction:e.direction,metadata:{Modality:this.modality,FrameOfReferenceUID:this.frameOfReferenceUID},hasPixelSpacing:this.hasPixelSpacing,calibration:this.calibration,preScale:{scaled:!1},scalarData:this.getScalarData(),imageData:r,voxelManager:{forEach:(a,s)=>Is(s.imageData,{pointInShapeFn:s.isInObject??(()=>!0),callback:a,boundsIJK:s.boundsIJK,returnPoints:s.returnPoints??!1})}}}hasImageURI(e){return!0}setCamera(e){const n=this.getCamera(),{parallelScale:r,focalPoint:i}=e,a=this.getView(),{xSpacing:s}=this.internalCamera;if(r){const c=this.element.clientHeight/r,l=1/s/c;a.setResolution(l)}if(i){const c=this.worldToCanvas(i),l=this.canvasToIndex(c);a.setCenter(l)}const o=this.getCamera();this.triggerCameraModifiedEventIfNecessary(n,o)}getCurrentImageId(){return this.imageIds[0]}getFrameNumber(){return 1}getCamera(){this.refreshRenderValues();const{resolution:e,xSpacing:n}=this.internalCamera,r=e*n,i=[this.element.clientWidth/2,this.element.clientHeight/2],a=this.canvasToWorld(i);return{parallelProjection:!0,focalPoint:a,position:a,viewUp:[0,-1,0],parallelScale:this.element.clientHeight*r,viewPlaneNormal:[0,0,1]}}setDataIds(e,n){(n==null?void 0:n.miniNavigationOverlay)!==!1&&jn.addMiniNavigationOverlayCss();const r=(n==null?void 0:n.webClient)||j(Je.WADO_WEB_CLIENT,e[0]);if(!r)throw new Error(`To use setDataIds on WSI data, you must provide metaData.webClient for ${e[0]}`);return this.setWSI(e,r)}async setWSI(e,n){this.microscopyElement.style.background="black",this.microscopyElement.innerText="Loading",this.imageIds=e;const r=await jn.getDicomMicroscopyViewer();this.frameOfReferenceUID=null;const i=this.imageIds.map(o=>{var f,g,h;const c=n.getDICOMwebMetadata(o);Object.defineProperty(c,"isMultiframe",{value:c.isMultiframe,enumerable:!1}),Object.defineProperty(c,"frameNumber",{value:void 0,enumerable:!1});const l=(f=c["00080008"])==null?void 0:f.Value;(l==null?void 0:l.length)===1&&(c["00080008"].Value=l[0].split("\\"));const u=(h=(g=c["00200052"])==null?void 0:g.Value)==null?void 0:h[0];return this.frameOfReferenceUID?u!==this.frameOfReferenceUID&&(c["00200052"].Value=[this.frameOfReferenceUID]):this.frameOfReferenceUID=u,c}),a=[];i.forEach(o=>{const c=new r.metadata.VLWholeSlideMicroscopyImage({metadata:o}),l=c.ImageType[2];l==="VOLUME"||l==="THUMBNAIL"?a.push(c):console.log("Unknown image type",c.ImageType)}),this.metadataDicomweb=a;const s=new r.viewer.VolumeImageViewer({client:n,metadata:a,controls:["overview","position"],retrieveRendered:!1,bindings:{}});s.render({container:this.microscopyElement}),this.metadata=this.getImageDataMetadata(),s.deactivateDragPanInteraction(),this.viewer=s,this.map=s[pc],this.map.on(sv,this.postrender),this.resize(),this.microscopyElement.innerText="",Object.assign(this.microscopyElement.style,{"--ol-partial-background-color":"rgba(127, 127, 127, 0.7)","--ol-foreground-color":"#000000","--ol-subtle-foreground-color":"#000","--ol-subtle-background-color":"rgba(78, 78, 78, 0.5)",background:"none"})}scroll(e){const n=this.getCamera();this.setCamera({parallelScale:n.parallelScale*(1+.1*e)})}getSliceIndex(){return 0}getView(){if(!this.viewer)return;const e=this.viewer[pc],n=window;return n.map=e,n.viewer=this.viewer,n.view=e==null?void 0:e.getView(),n.wsi=this,e==null?void 0:e.getView()}refreshRenderValues(){const e=this.getView();if(!e)return;const n=e.getResolution();if(!n||n<Pt)return;const r=e.getCenter(),i=e.getProjection().getExtent(),a=e.getRotation(),s=e.getZoom(),{metadata:{spacing:[o,c]}}=this,l=1/n/o;Object.assign(this.internalCamera,{extent:i,centerIndex:r,worldToCanvasRatio:l,xSpacing:o,ySpacing:c,resolution:n,rotation:a,zoom:s})}getZoom(){var e;return(e=this.getView())==null?void 0:e.getZoom()}setZoom(e){var n;(n=this.getView())==null||n.setZoom(e)}getTransform(){this.refreshRenderValues();const{centerIndex:e,resolution:n,rotation:r}=this.internalCamera,i=[this.canvas.width/2,this.canvas.height/2],a=new cr;return a.translate(i[0],i[1]),a.rotate(r),a.scale(1/n,-1/n),a.translate(-e[0],-e[1]),a}getViewReferenceId(){return`imageId:${this.getCurrentImageId()}`}getCurrentImageIdIndex(){return 0}static addMiniNavigationOverlayCss(){if(document.getElementById(this.overlayCssId))return;const e=document.createElement("style");e.innerText=av,e.setAttribute("id",this.overlayCssId),document.getElementsByTagName("head")[0].append(e)}};jn.getDicomMicroscopyViewer=async()=>R8("dicom-microscopy-viewer"),jn.overlayCssId="overlayCss";let N0=jn;const Ju={[Ce.ORTHOGRAPHIC]:Wr,[Ce.PERSPECTIVE]:Wr,[Ce.STACK]:Sn,[Ce.VOLUME_3D]:Xu,[Ce.VIDEO]:L0,[Ce.WHOLE_SLIDE]:N0};function Un(t){return Ju[t].useCustomRenderingPipeline}const dc=2;class ov{constructor(e){throw this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this.renderFrameOfReference=n=>{const i=this._getViewportsAsArray().map(a=>{if(a.getFrameOfReferenceUID()===n)return a.id});this.renderViewports(i)},this._renderFlaggedViewports=()=>{this._throwIfDestroyed(),this.useCPURendering||this.performVtkDrawCall();const n=this._getViewportsAsArray(),r=[];for(let i=0;i<n.length;i++){const a=n[i];if(this._needsRender.has(a.id)){const s=this.renderViewportUsingCustomOrVtkPipeline(a);if(r.push(s),a.setRendered(),this._needsRender.delete(a.id),this._needsRender.size===0)break}}this._animationFrameSet=!1,this._animationFrameHandle=null,r.forEach(i=>{i!=null&&i.element&&H(i.element,A.IMAGE_RENDERED,i)})},this.id=e||Rt(),this.useCPURendering=Rr(),Fr.set(this),new Error("@cornerstonejs/core is not initialized, run init() first")}enableElement(e){const n=this._normalizeViewportInputEntry(e);this._throwIfDestroyed();const{element:r,viewportId:i}=n;if(!r)throw new Error("No element provided");this.getViewport(i)&&this.disableElement(i);const{type:s}=n,o=Un(s);!this.useCPURendering&&!o?this.enableVTKjsDrivenViewport(n):this.addCustomViewport(n);const c=_t(r),{background:l}=n.defaultOptions;this.fillCanvasWithBackgroundColor(c,l)}disableElement(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n){console.warn(`viewport ${e} does not exist`);return}this._resetViewport(n),!Un(n.type)&&!this.useCPURendering&&this.offscreenMultiRenderWindow.removeRenderer(e),this._removeViewport(e),n.isDisabled=!0,this._needsRender.delete(e),this.getViewports().length||this._clearAnimationFrame()}setViewports(e){const n=this._normalizeViewportInputEntries(e);this._throwIfDestroyed(),this._reset();const r=[],i=[];n.forEach(a=>{!this.useCPURendering&&!Un(a.type)?r.push(a):i.push(a)}),this.setVtkjsDrivenViewports(r),this.setCustomViewports(i),n.forEach(a=>{const s=_t(a.element),{background:o}=a.defaultOptions;this.fillCanvasWithBackgroundColor(s,o)})}resize(e=!0,n=!0){this._throwIfDestroyed();const r=this._getViewportsAsArray(),i=[],a=[];r.forEach(s=>{Un(s.type)?a.push(s):i.push(s)}),i.length&&this._resizeVTKViewports(i,n,e),a.length&&this._resizeUsingCustomResizeHandler(a,n,e)}getViewport(e){return this._viewports.get(e)}getViewports(){return this._throwIfDestroyed(),this._getViewportsAsArray()}getStackViewport(e){this._throwIfDestroyed();const n=this.getViewport(e);if(!n)throw new Error(`Viewport with Id ${e} does not exist`);if(!(n instanceof Sn))throw new Error(`Viewport with Id ${e} is not a StackViewport.`);return n}getStackViewports(){return this._throwIfDestroyed(),this.getViewports().filter(n=>n instanceof Sn)}getVolumeViewports(){this._throwIfDestroyed();const e=this.getViewports(),n=r=>r instanceof Na;return e.filter(n)}render(){const n=this.getViewports().map(r=>r.id);this._setViewportsToBeRenderedNextFrame(n)}renderViewports(e){this._setViewportsToBeRenderedNextFrame(e)}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}destroy(){this.hasBeenDestroyed||(this.useCPURendering||(this._getViewportsAsArray().forEach(n=>{this.offscreenMultiRenderWindow.removeRenderer(n.id)}),this.offscreenMultiRenderWindow.delete(),delete this.offscreenMultiRenderWindow),this._reset(),Fr.delete(this.id),this.hasBeenDestroyed=!0)}fillCanvasWithBackgroundColor(e,n){const r=e.getContext("2d");let i;if(n){const a=n.map(s=>Math.floor(255*s));i=`rgb(${a[0]}, ${a[1]}, ${a[2]})`}else i="black";r.fillStyle=i,r.fillRect(0,0,e.width,e.height)}_normalizeViewportInputEntry(e){const{type:n,defaultOptions:r}=e;let i=r;return(!i||Object.keys(i).length===0)&&(i={background:[0,0,0],orientation:null,displayArea:null},n===Ce.ORTHOGRAPHIC&&(i={...i,orientation:br.AXIAL})),{...e,defaultOptions:i}}_normalizeViewportInputEntries(e){const n=[];return e.forEach(r=>{n.push(this._normalizeViewportInputEntry(r))}),n}_resizeUsingCustomResizeHandler(e,n=!0,r=!0){e.forEach(i=>{typeof i.resize=="function"&&i.resize()}),e.forEach(i=>{const a=i.getCamera();i.resetCamera(),n&&i.setCamera(a)}),r&&this.render()}_resizeVTKViewports(e,n=!0,r=!0){const i=e.map(a=>_t(a.element));if(i.forEach(a=>{const s=window.devicePixelRatio||1;a.width=a.clientWidth*s,a.height=a.clientHeight*s}),i.length){const{offScreenCanvasWidth:a,offScreenCanvasHeight:s}=this._resizeOffScreenCanvas(i);this._resize(e,a,s)}e.forEach(a=>{const s=a.getCamera(),o=a.getRotation(),{flipHorizontal:c}=s;a.resetCameraForResize();const l=a.getDisplayArea();n&&(l?(c&&a.setCamera({flipHorizontal:c}),o&&a.setViewPresentation({rotation:o})):a.setCamera(s))}),r&&this.render()}enableVTKjsDrivenViewport(e){const r=this._getViewportsAsArray().filter(u=>Un(u.type)===!1),i=r.map(u=>u.canvas),a=_t(e.element);i.push(a);const{offScreenCanvasWidth:s,offScreenCanvasHeight:o}=this._resizeOffScreenCanvas(i),c=this._resize(r,s,o),l={...e,canvas:a};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:s,offScreenCanvasHeight:o,xOffset:c})}_removeViewport(e){if(!this.getViewport(e)){console.warn(`viewport ${e} does not exist`);return}this._viewports.delete(e)}addVtkjsDrivenViewport(e,n){const{element:r,canvas:i,viewportId:a,type:s,defaultOptions:o}=e;r.tabIndex=-1;const{offScreenCanvasWidth:c,offScreenCanvasHeight:l,xOffset:u}=n,{sxStartDisplayCoords:f,syStartDisplayCoords:g,sxEndDisplayCoords:h,syEndDisplayCoords:p,sx:d,sy:m,sWidth:y,sHeight:T}=this._getViewportCoordsOnOffScreenCanvas(e,c,l,u);this.offscreenMultiRenderWindow.addRenderer({viewport:[f,g,h,p],id:a,background:o.background?o.background:[0,0,0]});const v={id:a,element:r,renderingEngineId:this.id,type:s,canvas:i,sx:d,sy:m,sWidth:y,sHeight:T,defaultOptions:o||{}};let C;if(s===Ce.STACK)C=new Sn(v);else if(s===Ce.ORTHOGRAPHIC||s===Ce.PERSPECTIVE)C=new Wr(v);else if(s===Ce.VOLUME_3D)C=new Xu(v);else throw new Error(`Viewport Type ${s} is not supported`);this._viewports.set(a,C);const x={element:r,viewportId:a,renderingEngineId:this.id};C.suppressEvents||H(ae,A.ELEMENT_ENABLED,x)}addCustomViewport(e){const{element:n,viewportId:r,type:i,defaultOptions:a}=e;n.tabIndex=-1;const s=_t(n),{clientWidth:o,clientHeight:c}=s;(s.width!==o||s.height!==c)&&(s.width=o,s.height=c);const l={id:r,renderingEngineId:this.id,element:n,type:i,canvas:s,sx:0,sy:0,sWidth:o,sHeight:c,defaultOptions:a||{}},u=Ju[i],f=new u(l);this._viewports.set(r,f);const g={element:n,viewportId:r,renderingEngineId:this.id};H(ae,A.ELEMENT_ENABLED,g)}setCustomViewports(e){e.forEach(n=>{this.addCustomViewport(n)})}setVtkjsDrivenViewports(e){if(e.length){const n=e.map(s=>_t(s.element));n.forEach(s=>{const o=window.devicePixelRatio||1,c=s.getBoundingClientRect();s.width=c.width*o,s.height=c.height*o});const{offScreenCanvasWidth:r,offScreenCanvasHeight:i}=this._resizeOffScreenCanvas(n);let a=0;for(let s=0;s<e.length;s++){const o=e[s],c=n[s],l={...o,canvas:c};this.addVtkjsDrivenViewport(l,{offScreenCanvasWidth:r,offScreenCanvasHeight:i,xOffset:a}),a+=c.width}}}_resizeOffScreenCanvas(e){const{offScreenCanvasContainer:n,offscreenMultiRenderWindow:r}=this,i=Math.max(...e.map(s=>s.height));let a=0;return e.forEach(s=>{a+=s.width}),n.width=a,n.height=i,r.resize(),{offScreenCanvasWidth:a,offScreenCanvasHeight:i}}_resize(e,n,r){let i=0;for(let a=0;a<e.length;a++){const s=e[a],{sxStartDisplayCoords:o,syStartDisplayCoords:c,sxEndDisplayCoords:l,syEndDisplayCoords:u,sx:f,sy:g,sWidth:h,sHeight:p}=this._getViewportCoordsOnOffScreenCanvas(s,n,r,i);i+=s.canvas.width,s.sx=f,s.sy=g,s.sWidth=h,s.sHeight=p,this.offscreenMultiRenderWindow.getRenderer(s.id).setViewport([o,c,l,u])}return i}_getViewportCoordsOnOffScreenCanvas(e,n,r,i){const{canvas:a}=e,{width:s,height:o}=a,c=i,l=0,u=c/n,f=l+(r-o)/r,g=s/n,h=o/r;return{sxStartDisplayCoords:u,syStartDisplayCoords:f,sxEndDisplayCoords:u+g,syEndDisplayCoords:f+h,sx:c,sy:l,sWidth:s,sHeight:o}}_getViewportsAsArray(){return Array.from(this._viewports.values())}_setViewportsToBeRenderedNextFrame(e){e.forEach(n=>{this._needsRender.add(n)}),this._render()}_render(){this._needsRender.size>0&&!this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}performVtkDrawCall(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();if(r.length){for(let i=0;i<r.length;i++){const{renderer:a,id:s}=r[i];this._needsRender.has(s)?a.setDraw(!0):a.setDraw(!1)}n.render();for(let i=0;i<r.length;i++)r[i].renderer.setDraw(!1)}}renderViewportUsingCustomOrVtkPipeline(e){let n;if(e.sWidth<dc||e.sHeight<dc){console.warn("Viewport is too small",e.sWidth,e.sHeight);return}if(Un(e.type)===!0)n=e.customRenderViewportToCanvas();else{if(this.useCPURendering)throw new Error("GPU not available, and using a viewport with no custom render pipeline.");const{offscreenMultiRenderWindow:r}=this,s=r.getOpenGLRenderWindow().get3DContext().canvas;n=this._renderViewportFromVtkCanvasToOnscreenCanvas(e,s)}return n}_renderViewportFromVtkCanvasToOnscreenCanvas(e,n){const{element:r,canvas:i,sx:a,sy:s,sWidth:o,sHeight:c,id:l,renderingEngineId:u,suppressEvents:f}=e,{width:g,height:h}=i;return i.getContext("2d").drawImage(n,a,s,o,c,0,0,g,h),{element:r,suppressEvents:f,viewportId:l,renderingEngineId:u,viewportStatus:e.viewportStatus}}_resetViewport(e){const n=this.id,{element:r,canvas:i,id:a}=e,s={element:r,viewportId:a,renderingEngineId:n};e.removeWidgets(),H(ae,A.ELEMENT_DISABLED,s),r.removeAttribute("data-viewport-uid"),r.removeAttribute("data-rendering-engine-uid"),i.getContext("2d").clearRect(0,0,i.width,i.height)}_clearAnimationFrame(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}_reset(){this._getViewportsAsArray().forEach(n=>{this._resetViewport(n)}),this._clearAnimationFrame(),this._viewports=new Map}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_downloadOffScreenCanvas(){const e=this._debugRender();cv(e)}_debugRender(){const{offscreenMultiRenderWindow:e}=this,n=e.getRenderWindow(),r=e.getRenderers();for(let c=0;c<r.length;c++)r[c].renderer.setDraw(!0);n.render();const s=e.getOpenGLRenderWindow().get3DContext().canvas,o=s.toDataURL();return this._getViewportsAsArray().forEach(c=>{const{sx:l,sy:u,sWidth:f,sHeight:g}=c,h=c.canvas,{width:p,height:d}=h;h.getContext("2d").drawImage(s,l,u,f,g,0,0,p,d)}),o}}function cv(t){const e=document.createElement("a");e.download="viewport.png",e.href=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}var ut;(function(t){t[t.None=0]="None",t[t.Capture=1]="Capture",t[t.Bubble=2]="Bubble"})(ut||(ut={}));class ba{constructor(e){this._eventListeners=new Map,this._children=new Map,this._target=e}get isEmpty(){return this._eventListeners.size===0&&this._children.size===0}addEventListener(e,n,r){const i=e.indexOf(".");if(i!==-1){const s=e.substring(0,i);let o=this._children.get(s);o||(o=new ba(this._target),this._children.set(s,o)),e=e.substring(i+1),o.addEventListener(e,n,r)}else this._addEventListener(e,n,r)}removeEventListener(e,n,r){const i=e.indexOf(".");if(i!==-1){const s=e.substring(0,i),o=this._children.get(s);if(!o)return;e=e.substring(i+1),o.removeEventListener(e,n,r),o.isEmpty&&this._children.delete(s)}else this._removeEventListener(e,n,r)}reset(){Array.from(this._children.entries()).forEach(([e,n])=>{if(n.reset(),n.isEmpty)this._children.delete(e);else throw new Error("Child is not empty and cannot be removed")}),this._unregisterAllEvents()}_addEventListener(e,n,r){let i=this._eventListeners.get(e);i||(i=new Map,this._eventListeners.set(e,i));const s=(r==null?void 0:r.capture)??!1?ut.Capture:ut.Bubble,o=i.get(n)??ut.None;if(o&s){console.warn("A listener is already registered for this phase");return}i.set(n,o|s),this._target.addEventListener(e,n,r)}_removeEventListener(e,n,r){const a=(r==null?void 0:r.capture)??!1?ut.Capture:ut.Bubble,s=this._eventListeners.get(e);if(!s)return;(n?[n]:Array.from(s.keys())).forEach(c=>{const l=s.get(c)??ut.None;if(!!!(l&a))return;this._target.removeEventListener(e,c,r);const f=l^a;f===ut.None?s.delete(c):s.set(c,f)}),s.size||this._eventListeners.delete(e)}_unregisterAllListeners(e,n){Array.from(n.entries()).forEach(([r,i])=>{const a=ut.Capture;for(let s=a;i;s<<=1){if(!(i&s))continue;const o=s===ut.Capture;this.removeEventListener(e,r,{capture:o}),i^=s}})}_unregisterAllEvents(){Array.from(this._eventListeners.entries()).forEach(([e,n])=>{this._unregisterAllListeners(e,n)})}}class lv{constructor(){this._targetsEventListeners=new Map}addEventListener(e,n,r,i){let a=this._targetsEventListeners.get(e);a||(a=new ba(e),this._targetsEventListeners.set(e,a)),a.addEventListener(n,r,i)}removeEventListener(e,n,r,i){const a=this._targetsEventListeners.get(e);a&&(a.removeEventListener(n,r,i),a.isEmpty&&this._targetsEventListeners.delete(e))}reset(){Array.from(this._targetsEventListeners.entries()).forEach(([e,n])=>{n.reset(),this._targetsEventListeners.delete(e)})}}var uv=Object.freeze({__proto__:null,MultiTargetEventListenerManager:lv,TargetEventListeners:ba});function fv(t,e){const n=t.getSize();for(let r=0;r<n;r++){const i=[];t.getNodeValue(r,i),i[1]=i[1]*e,i[2]=i[2]*e,i[3]=i[3]*e,t.setNodeValue(r,i)}}function gv(t){let e=t[0],n=t[0],r;const i=t.length;for(let a=1;a<i;a++)r=t[a],e=Math.min(e,r),n=Math.max(n,r);return{min:e,max:n}}const hv=Symbol("LastRuntimeId"),pv={},dv=4294967295,mv="-";function yv(t,e,n){return vv(t!==null&&typeof t=="object"?t:pv,hv,(typeof n=="number"&&n>0?n:dv)>>>0).join(typeof e=="string"?e:mv)}function vv(t,e,n){let r=t[e];r instanceof Array||(r=[0],Object.defineProperty(t,e,{value:r}));for(let i=!0,a=0;i&&a<r.length;++a){let s=r[a]|0;s<n?(i=!1,s=s+1):(s=0,a+1===r.length&&r.push(0)),r[a]=s}return r}const mc={},Tv={add:(t,e)=>{const n=ot(t);mc[n]=e},get:(t,e)=>{if(t==="calibratedPixelSpacing"){const n=ot(e);return mc[n]}}};function Cv(t,e,n=1e-5){return Math.abs(t[0]+e[0])<n&&Math.abs(t[1]+e[1])<n&&Math.abs(t[2]+e[2])<n}function xv(t,e){return!(t[0]<0||t[0]>=e[0]||t[1]<0||t[1]>=e[1]||t[2]<0||t[2]>=e[2])}function wv(t,e){let n;e?n=[Ea(e)]:n=Ma();const r=[];return n.forEach(i=>{const a=t.getActors(),s=i.getVolumeViewports();for(const o of s){const c=o.getActors();if(c.length!==a.length)continue;a.every(({uid:u})=>c.find(f=>u===f.uid))&&r.push(o)}}),r}const Qu=t=>t.preScale.scaled&&t.preScale.scalingParameters.suvbw;function ef(t,e,n=void 0,r="_thumbnails",i={displayArea:{imageArea:[1,1]}}){if(!t||!(t instanceof HTMLCanvasElement))throw new Error("canvas element is required");const a=!e.imageId,s=!a&&e,o=a&&e,l=`renderGPUViewport-${s.imageId||o.volumeId}`,u=document.createElement("div"),f=window.devicePixelRatio||1;i.displayArea||(i.displayArea={imageArea:[1,1]});const g=t.width,h=t.height;u.style.width=`${g/f+hc}px`,u.style.height=`${h/f+hc}px`,u.style.visibility="hidden",u.style.position="absolute",document.body.appendChild(u);const p=l.split(":").join("-");u.setAttribute("viewport-id-for-remove",p);const d=_t(u),m=Ea(r)||new ov(r);let y=m.getViewport(l);if(!y){const T={viewportId:l,type:a?Ce.ORTHOGRAPHIC:Ce.STACK,element:u,defaultOptions:{...i,suppressEvents:!0}};m.enableElement(T),y=m.getViewport(l)}return new Promise(T=>{let v=!1,{viewReference:C}=i;const x=w=>{if(v)return;if(C){const V=C;C=null,y.setViewReference(V),y.render();return}t.getContext("2d").drawImage(d,0,0,d.width,d.height,0,0,t.width,t.height);const O=y.canvasToWorld([0,0]),D=y.canvasToWorld([d.width/f,0]),S=y.canvasToWorld([0,d.height/f]),M=1;v=!0,u.removeEventListener(A.IMAGE_RENDERED,x),setTimeout(()=>{m.disableElement(l),document.querySelectorAll(`[viewport-id-for-remove="${p}"]`).forEach(L=>{L.remove()})},0),T({origin:O,bottomLeft:S,topRight:D,thicknessMm:M})};u.addEventListener(A.IMAGE_RENDERED,x),a?y.setVolumes([o],!1,!0):y.renderImageObject(e),y.resetCamera(),n==="PT"&&!Qu(s)&&y.setProperties({voiRange:{lower:s.minPixelValue,upper:s.maxPixelValue}}),y.render()})}function tf(t,e,n,r,i){if(e.volumeId)throw new Error("Unsupported volume rendering for CPU");const s=e,o=qu(t,s,n),c={canvas:t,viewport:o,image:s,renderingTools:{}};c.transform=zr(c);const l=!0;return new Promise((u,f)=>{ju(c,l),u(null)})}function Sv(t){const{canvas:e,imageId:n,viewReference:r,requestType:i=Q.Thumbnail,priority:a=-5,renderingEngineId:s="_thumbnails",useCPURendering:o=!1,thumbnail:c=!1,imageAspect:l=!1,viewportOptions:u}=t,f=r==null?void 0:r.volumeId,g=f&&!n,h=r&&u?{...u,viewReference:r}:u,p=o?tf:ef;return new Promise((d,m)=>{function y(x,w){var S;const{modality:E}=j("generalSeriesModule",w)||{},O=!g&&x,D=g&&x;O&&(O.isPreScaled=O.isPreScaled||((S=O.preScale)==null?void 0:S.scaled)),c&&(e.height=256,e.width=256),l&&O&&(e.width=O&&e.height*O.width/O.height),e.style.width=`${e.width/devicePixelRatio}px`,e.style.height=`${e.height/devicePixelRatio}px`,D&&o&&m(new Error("CPU rendering of volume not supported")),p(e,x,E,s,h).then(d)}function T(x,w){console.error(x,w),m(x)}function v(x,w,E){return rr(x,E).then(O=>{y.call(this,O,x)},O=>{T.call(this,O,x)})}const C={useRGBA:!!o,requestType:i};if(f){const x=q.getVolume(f);x||m(new Error(`Volume id ${f} not found in cache`));const w=x.imageIds[0];y(x,w)}else Mt.addRequest(v.bind(null,n,null,C),i,{imageId:n},a)})}class nf{constructor(e="Tools",n=50){this.position=-1,this.redoAvailable=0,this.undoAvailable=0,this.ring=new Array,this.label=e,this._size=n}get size(){return this._size}set size(e){this.ring=new Array(e),this._size=e,this.position=-1,this.redoAvailable=0,this.undoAvailable=0}undo(e=1){for(;e>0&&this.undoAvailable>0;)this.ring[this.position].restoreMemo(!0),e--,this.redoAvailable++,this.undoAvailable--,this.position=(this.position-1+this.size)%this.size}redo(e=1){for(;e>0&&this.redoAvailable>0;){const n=(this.position+1)%this.size;this.ring[n].restoreMemo(!1),e--,this.position=n,this.undoAvailable++,this.redoAvailable--}}push(e){var r;if(!e)return;const n=e.restoreMemo?e:(r=e.createMemo)==null?void 0:r.call(e);if(n)return this.redoAvailable=0,this.undoAvailable<this._size&&this.undoAvailable++,this.position=(this.position+1)%this._size,this.ring[this.position]=n,n}}const Rv=new nf;var Ev=Object.freeze({__proto__:null,DefaultHistoryMemo:Rv,HistoryMemo:nf});function Mv(t,e){const n=j("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:s,rowPixelSpacing:o}=n;s||(s=1),o||(o=1);const c=$();ze(c,a,r,-s/2),ze(c,c,i,-o/2);const l=$();$e(l,e,c);const u=fe(l,i),f=fe(l,r);return[u/o,f/s]}function Ov(t,e){const n=j("imagePlaneModule",t);if(!n)throw new Error(`No imagePlaneModule found for imageId: ${t}`);const{columnCosines:r,rowCosines:i,imagePositionPatient:a}=n;let{columnPixelSpacing:s,rowPixelSpacing:o}=n;s||(s=1),o||(o=1);const c=$();return ze(c,a,i,o*(e[0]-.5)),ze(c,c,r,s*(e[1]-.5)),Array.from(c)}function Dv(t){const e=Ma(),n=[];return e.forEach(r=>{r.getViewports().forEach(a=>{a.hasImageURI(t)&&n.push(a)})}),n}function Vv(t,e){const n=Iv(t,e);return n?n.index:null}function Iv(t,e){const n=e.getImageIds(),r=e.getCurrentImageIdIndex();if(n.length===0)return null;const i=c=>{const l=Lv(c);if(!l)return null;const u=Nu(l.planeNormal,l.imagePositionPatient);return bu(u,t)},a={distance:i(n[r])??1/0,index:r},s=n.slice(r+1);for(let c=0;c<s.length;c++){const l=s[c],u=i(l);if(u!==null)if(u<=a.distance)a.distance=u,a.index=c+r+1;else break}const o=n.slice(0,r);for(let c=o.length-1;c>=0;c--){const l=o[c],u=i(l);if(!(u===null||u===a.distance))if(u<a.distance)a.distance=u,a.index=c;else break}return a.distance===1/0?null:a}function Lv(t){const e=j("imagePlaneModule",t);if(!e||!(e.rowCosines instanceof Array&&e.rowCosines.length===3)||!(e.columnCosines instanceof Array&&e.columnCosines.length===3)||!(e.imagePositionPatient instanceof Array&&e.imagePositionPatient.length===3))return null;const{rowCosines:n,columnCosines:r,imagePositionPatient:i}=e,a=ce($(),...n),s=ce($(),...r),o=ve($(),a,s);return{rowCosines:n,columnCosines:r,imagePositionPatient:i,planeNormal:o}}function Nv(t){const{width:e,height:n}=t.getCanvas(),{sliceToIndexMatrix:r,indexToSliceMatrix:i}=t.getSliceViewInfo(),a=Zt(t,[0,0]),s=Zt(t,[e-1,0]),o=Zt(t,[0,n-1]),c=$e($(),s,a),l=$e($(),o,a),u=ve($(),c,l);_e(c,c),_e(l,l),_e(u,u);const f=Math.max(Math.abs(c[0]),Math.abs(c[1]),Math.abs(c[2])),g=Math.max(Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2]));if(!ho(1,f)||!ho(1,g))throw new Error("Livewire is not available for rotate/oblique viewports");const{voxelManager:h}=t.getImageData(),p=t.getSliceViewInfo(),d=h.getSliceData(p);return{width:p.width,height:p.height,scalarData:d,sliceToIndexMatrix:r,indexToSliceMatrix:i}}const fn={},ua={add:(t,e)=>{const[n,r]=t,i=`${n}_${r}`;fn[i]||(fn[i]={}),fn[i]=e},get:(t,e,n)=>{if(t!=="spatialRegistrationModule")return;const r=`${e}_${n}`;if(fn[r])return fn[r];const i=`${n}_${e}`;if(fn[i])return ke(Dn(),fn[i])}};Ss(ua.get.bind(ua));const bv=.05;function Fv(t,e){const n=t.getSliceIndex(),r=e.getSliceIndex(),i=j("imagePlaneModule",n.toString()),a=j("imagePlaneModule",r.toString());if(!i||!a){console.log("Viewport spatial registration requires image plane module");return}const{imageOrientationPatient:s}=a;if(!i.imageOrientationPatient.every((g,h)=>Math.abs(g-s[h])<bv)){console.log("Viewport spatial registration only supported for same orientation (hence translation only) for now",i==null?void 0:i.imageOrientationPatient,a==null?void 0:a.imageOrientationPatient);return}const c=i.imagePositionPatient,l=a.imagePositionPatient,u=Pe($(),c,l),f=Ta(Dn(),u);ua.add([t.id,e.id],f)}function _v(t){const{imageData:e,dimensions:n}=t.getImageData()||{};if(!e||!n)return[];const{canvas:r}=t,i=window.devicePixelRatio,a=[0,0],s=[r.width/i,0],o=[r.width/i,r.height/i],c=[0,r.height/i],l=t.canvasToWorld(a),u=t.canvasToWorld(s),f=t.canvasToWorld(o),g=t.canvasToWorld(c),h=e.worldToIndex(l),p=e.worldToIndex(u),d=e.worldToIndex(f),m=e.worldToIndex(g);return Uv({dimensions:n,imageData:e,topLeftImage:h,topRightImage:p,bottomRightImage:d,bottomLeftImage:m,topLeftWorld:l,topRightWorld:u,bottomRightWorld:f,bottomLeftWorld:g})}function Uv({dimensions:t,imageData:e,topLeftImage:n,topRightImage:r,bottomRightImage:i,bottomLeftImage:a,topLeftWorld:s,topRightWorld:o,bottomRightWorld:c,bottomLeftWorld:l}){const u=pi(n,t)?s:e.indexToWorld([0,0,0]),f=pi(r,t)?o:e.indexToWorld([t[0]-1,0,0]),g=pi(i,t)?c:e.indexToWorld([t[0]-1,t[1]-1,0]),h=pi(a,t)?l:e.indexToWorld([0,t[1]-1,0]);return[u,f,h,g]}function pi(t,e){return t[0]>0||t[0]<e[0]-1||t[1]>0||t[1]<e[1]-1||t[2]>0||t[2]<e[2]-1}function As(t){if(!t)return;const{viewportUid:e,renderingEngineUid:n}=t.dataset;return kv(e,n)}function kv(t,e){if(!e||!t)return;const n=Ea(e);if(!n||n.hasBeenDestroyed)return;const r=n.getViewport(t);if(!r)return;const i=r.getFrameOfReferenceUID();return{viewport:r,renderingEngine:n,viewportId:t,renderingEngineId:e,FrameOfReferenceUID:i}}function Pv(t){const e=As(t);if(!e)return;const{viewport:n}=e;if(!(n instanceof Sn))throw new Error(`An image can only be fetched for a stack viewport and not for a viewport of type: ${n.type}`);return n.getCornerstoneImage()}function Gv(t){const e=t[0],{modality:n,seriesInstanceUID:r}=j("generalSeriesModule",e),{imageOrientationPatient:i,pixelSpacing:a,frameOfReferenceUID:s,columns:o,rows:c}=j("imagePlaneModule",e),l={modality:n,imageOrientationPatient:i,pixelSpacing:a,frameOfReferenceUID:s,columns:o,rows:c,seriesInstanceUID:r};return t.every(f=>{const{modality:g,seriesInstanceUID:h}=j("generalSeriesModule",f),{imageOrientationPatient:p,pixelSpacing:d,columns:m,rows:y}=j("imagePlaneModule",f);return h===l.seriesInstanceUID&&g===l.modality&&m===l.columns&&y===l.rows&&Ne(p,l.imageOrientationPatient)&&Ne(d,l.pixelSpacing)})}const Av=new Set(["1.2.840.10008.1.2.4.100","1.2.840.10008.1.2.4.100.1","1.2.840.10008.1.2.4.101","1.2.840.10008.1.2.4.101.1","1.2.840.10008.1.2.4.102","1.2.840.10008.1.2.4.102.1","1.2.840.10008.1.2.4.103","1.2.840.10008.1.2.4.103.1","1.2.840.10008.1.2.4.104","1.2.840.10008.1.2.4.104.1","1.2.840.10008.1.2.4.105","1.2.840.10008.1.2.4.105.1","1.2.840.10008.1.2.4.106","1.2.840.10008.1.2.4.106.1","1.2.840.10008.1.2.4.107","1.2.840.10008.1.2.4.108"]);function Bv(t){return t?(Array.isArray(t)?t:[t]).find(n=>Av.has(n)):!1}async function Wv({viewport:t,options:e={}}){const n=t.getRenderingEngine();let r=e.volumeId||`${Rt()}`;r.split(":").length===0&&(r=`${Rm()}:${r}`);const{id:i,element:a}=t,s=e.viewportId||i,o=t.getImageIds(),c=t.getViewPresentation(),l=t.getViewReference();n.enableElement({viewportId:s,type:Ce.ORTHOGRAPHIC,element:a,defaultOptions:{background:e.background,orientation:e.orientation}}),(await xm(r,{imageIds:o})).load();const f=n.getViewport(s);await tv(n,[{volumeId:r}],[s]);const g=()=>{f.render(),a.removeEventListener(A.VOLUME_VIEWPORT_NEW_VOLUME,g)};return(()=>{a.addEventListener(A.VOLUME_VIEWPORT_NEW_VOLUME,g)})(),f.setViewPresentation(c),f.setViewReference(l),f.render(),f}async function zv({viewport:t,options:e}){const n=t,{id:r,element:i}=n,a=t.getRenderingEngine(),{background:s}=e,o=e.viewportId||r,c=q.getVolume(n.getVolumeId());if(!(c instanceof Ls))throw new Error("Currently, you cannot decache a volume that is not an ImageVolume. So, unfortunately, volumes such as nifti  (which are basic Volume, without imageIds) cannot be decached.");const l={viewportId:o,type:Ce.STACK,element:i,defaultOptions:{background:s}},u=n.getViewReference();a.enableElement(l);const f=a.getViewport(o);return await f.setStack(c.imageIds),f.setViewReference(u),f.render(),f}function rf(t,e=2){if(Array.isArray(t))return t.map(i=>rf(i,e)).join(", ");if(t==null||t==="")return"NaN";t=Number(t);const n=Math.abs(t);if(n<1e-4)return`${t}`;const r=n>=100?e-2:n>=10?e-1:n>=1?e:n>=.1?e+1:n>=.01?e+2:n>=.001?e+3:e+4;return t.toFixed(r)}function $v(t){return Math.round(t/Pt)*Pt}function jv(t,e,n){const r=t.length===e*n*4,i=t.length===e*n*3;if(r||i){const a=new Float32Array(e*n);let s=0,o=0;const c=r?4:3;for(let l=0;l<e;l++)for(let u=0;u<n;u++){const f=t[s],g=t[s+1],h=t[s+2];a[o]=(f+g+h)/3,s+=c,o++}return a}else return t}function Hv(t){if(t instanceof Wr)return q.getVolume(t.getVolumeId()).imageIds;if(t.getImageIds)return t.getImageIds()}function Kv(t,e){const n=[...t];return e>=n.length?(yc(n),n):(yc(n),n.slice(0,e))}function yc(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}}function e0(t){const e=t.toString(16);return e.length==1?"0"+e:e}function qv(t,e,n){return"#"+e0(t)+e0(e)+e0(n)}function Xv(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}var Yv=Object.freeze({__proto__:null,hexToRgb:Xv,rgbToHex:qv});function Zv(t,e){if(t===e)return!0;if(t==null||e==null)return!1;try{return JSON.stringify(t)===JSON.stringify(e)}catch(n){return console.debug("Error in JSON.stringify during deep comparison:",n),t===e}}function Jv(t,e,n){if(!n)throw new Error("getVolume is required, use the utilities export instead ");if(t.modality)return t.modality;if(t.setVolumes)return e=e??t.getVolumeId(),!e||!n?void 0:n(e).metadata.Modality;throw new Error("Invalid viewport type")}const Qv=(t,e)=>t.reduce((n,r)=>((n[r[e]]=n[r[e]]||[]).push(r),n),{});function eT(t){const e=t.map(s=>{const{imagePositionPatient:o}=j("imagePlaneModule",s)||{};return{imageId:s,imagePositionPatient:o}});if(!e.every(s=>s.imagePositionPatient))return null;const n=Qv(e,"imagePositionPatient"),r=Object.keys(n),i=n[r[0]].length;return i===1||!r.every(s=>n[s].length===i)?null:n}function tT(t,e){const n={};let r=[];const i=Object.keys(t);for(let a=0;a<i.length;a++){const s=new Set,o=t[i[a]];for(let c=0;c<o.length;c++){const l=e(o[c].imageId)||0;if(n[l]=n[l]||[],n[l].push({imageId:o[c].imageId}),s.add(l),s.size-1<c)return}if(a==0)r=Array.from(s);else if(!aT(r,s))return}return n}function gr(t,e){const n=j(e,t);try{return parseFloat(n)}catch{return}}function nT(t){const e=j("20011003",t);try{const{InlineBinary:n}=e;if(n){const r=atob(n),i=new ArrayBuffer(r.length),a=new DataView(i);for(let s=0;s<r.length;s++)a.setUint8(s,r.charCodeAt(s));return new Float32Array(i)[0]}return parseFloat(e)}catch{return}}function rT(t){let e=j("0019100c",t)||j("0019100C",t);try{const{InlineBinary:n}=e;return n&&(e=atob(n)),parseFloat(e)}catch{return}}function iT(t){let e=j("00431039",t);try{const{InlineBinary:n}=e;return n&&(e=atob(n).split("//")),parseFloat(e[0])%1e5}catch{return}}function aT(t,e){if(t.length!=e.size)return!1;for(let n=0;n<t.length;n++)if(!e.has(t[n]))return!1;return!0}function sT(t){const e=j("petImageModule",t);return e?e.frameReferenceTime:0}function af(t){const e=eT(t);if(!e)return{imageIdGroups:[t],splittingTag:null};const n=["TemporalPositionIdentifier","DiffusionBValue","TriggerTime","EchoTime","EchoNumber","PhilipsPrivateBValue","SiemensPrivateBValue","GEPrivateBValue","PetFrameReferenceTime"],r=[i=>gr(i,n[0]),i=>gr(i,n[1]),i=>gr(i,n[2]),i=>gr(i,n[3]),i=>gr(i,n[4]),nT,rT,iT,sT];for(let i=0;i<r.length;i++){const a=tT(e,r[i]);if(a)return{imageIdGroups:Object.keys(a).map(Number.parseFloat).sort((c,l)=>c-l).map(c=>a[c].map(l=>l.imageId)),splittingTag:n[i]}}return{imageIdGroups:[t],splittingTag:null}}function oT(t){const{imageIdGroups:e,splittingTag:n}=af(t);return{isDynamicVolume:e.length>1,timePoints:e,splittingTag:n}}function cT(t,e){const n=t.length,{rescaleSlope:r,rescaleIntercept:i,suvbw:a}=e;if(e.modality==="PT"&&typeof a=="number")for(let s=0;s<n;s++)t[s]=a*(t[s]*r+i);else for(let s=0;s<n;s++)t[s]=t[s]*r+i;return t}function sf(t,e,n){return Math.min(Math.max(e,t),n)}function of(t,e){if(!As(t.element))throw new Error("Scroll::Viewport is not enabled (it might be disabled)");if(t instanceof Sn&&t.getImageIds().length===0)throw new Error("Scroll::Stack Viewport has no images");const{volumeId:r,delta:i,scrollSlabs:a}=e;if(t instanceof Wr)lT(t,r,i,a);else{const s=t.getCurrentImageIdIndex();if(s+i>t.getImageIds().length-1||s+i<0){const o={imageIdIndex:s,direction:i};H(ae,A.STACK_SCROLL_OUT_OF_BOUNDS,o)}t.scroll(i,e.debounceLoading,e.loop)}}function lT(t,e,n,r=!1){const i=r,{numScrollSteps:a,currentStepIndex:s,sliceRangeInfo:o}=Xn(t,e,i);if(!o)return;const{sliceRange:c,spacingInNormalDirection:l,camera:u}=o,{focalPoint:f,viewPlaneNormal:g,position:h}=u,{newFocalPoint:p,newPosition:d}=qn(f,h,c,g,l,n);t.setCamera({focalPoint:p,position:d}),t.render();const m=s+n,y={volumeId:e,viewport:t,delta:n,desiredStepIndex:m,currentStepIndex:s,numScrollSteps:a,currentImageId:t.getCurrentImageId()};(m>a||m<0)&&t.getCurrentImageId()?H(ae,A.VOLUME_VIEWPORT_SCROLL_OUT_OF_BOUNDS,y):H(ae,A.VOLUME_VIEWPORT_SCROLL,y)}async function uT(t,e={}){const{imageIndex:n,debounceLoading:r,volumeId:i}=e,a=As(t);if(!a)throw new Error("Element has been disabled");const{viewport:s}=a,{imageIndex:o,numberOfSlices:c}=fT(s,r),u=gT(c,n)-o;of(s,{delta:u,debounceLoading:r,volumeId:i})}function fT(t,e){return t instanceof Sn?{numberOfSlices:t.getImageIds().length,imageIndex:e?t.getTargetImageIdIndex():t.getCurrentImageIdIndex()}:{numberOfSlices:t.getNumberOfSlices(),imageIndex:t.getSliceIndex()}}function gT(t,e){const n=t-1;return sf(e,0,n)}function hT(t,e,n={}){const r=q.getVolume(t);if(!r)throw new Error(`Referenced volume with id ${t} does not exist.`);const{metadata:i,spacing:a,direction:s,dimensions:o}=r,{minX:c,maxX:l,minY:u,maxY:f,minZ:g,maxZ:h}=e,p=[Math.min(c,l),Math.min(u,f),Math.min(g,h)],d=ca(r.imageData,p),m=[Math.abs(l-c)+1,Math.abs(f-u)+1,Math.abs(h-g)+1],{targetBuffer:y}=n,T={metadata:i,dimensions:m,spacing:a,origin:d,direction:s,targetBuffer:y,scalarData:(y==null?void 0:y.type)==="Float32Array"?new Float32Array(m[0]*m[1]*m[2]):void 0},v=wm(Rt(),T),C=v.voxelManager.getCompleteScalarDataArray(),x=m[0]*m[1],w=o[0]*o[1],E=r.voxelManager.getCompleteScalarDataArray();for(let O=0;O<m[2];O++)for(let D=0;D<m[1];D++){const S=ca(v.imageData,[0,D,O]),M=Va(r.imageData,S),V=M[2]*w+M[1]*o[0]+M[0],L=E.slice(V,V+m[0]),F=O*x+D*m[0];C.set(L,F)}return v.voxelManager.setCompleteScalarDataArray(C),v}function pT(t,e){const{viewUp:n,viewPlaneNormal:r}=e,i=Ii(t,[0,0,0]),a=kt($(),n),s=kt($(),r),o=ve($(),a,s),c=$e($(),Ii(t,a),i),l=$e($(),Ii(t,s),i);_e(c,c),_e(l,l);const u=ve($(),c,l);return{worldVecRowDir:o,worldVecColDir:a,worldVecSliceDir:s,ijkVecRowDir:u,ijkVecColDir:c,ijkVecSliceDir:l}}const dT=(t,e)=>Jv(t,e,q.getVolume);var cf=Object.freeze({__proto__:null,FrameRange:Yn,HistoryMemo:Ev,PointsManager:Ni,ProgressiveIterator:ir,RLEVoxelMap:Yt,VoxelManager:nr,actorIsA:Xe,applyPreset:Uu,autoLoad:M0,calculateSpacingBetweenImageIds:xu,calculateViewportsSpatialRegistration:Fv,calibratedPixelSpacingMetadataProvider:Tv,clamp:I0,clip:sf,color:Yv,colormap:h6,convertStackToVolumeViewport:Wv,convertToGrayscale:jv,convertVolumeToStackViewport:zv,createLinearRGBTransferFunction:Bu,createSigmoidRGBTransferFunction:Ds,createSubVolume:hT,decimate:Mu,deepClone:Br,deepEqual:Zv,deepMerge:Oa,eventListener:uv,fnv1aHash:kl,generateVolumePropsFromImageIds:Ru,genericMetadataProvider:La,getBufferConfiguration:dl,getClosestImageId:ra,getClosestStackImageIndexForPoint:Vv,getCurrentVolumeViewportSlice:Nv,getDynamicVolumeInfo:oT,getImageLegacy:Pv,getImageSliceDataForVolumeViewport:oa,getMinMax:gv,getRandomSampleFromArray:Kv,getRuntimeId:yv,getScalingParameters:Su,getSliceRange:Da,getSpacingInNormalDirection:Zr,getTargetVolumeAndSpacingInNormalDir:Fs,getViewportImageCornersInWorld:_v,getViewportImageIds:Hv,getViewportModality:dT,getViewportsWithImageURI:Dv,getViewportsWithVolumeId:Eu,getVoiFromSigmoidRGBTransferFunction:_u,getVolumeActorCorners:Bl,getVolumeDirectionVectors:pT,getVolumeId:Iu,getVolumeSliceRangeInfo:Fu,getVolumeViewportScrollInfo:Xn,getVolumeViewportsContainingSameVolumes:wv,hasFloatScalingParameters:Ns,hasNaNValues:O0,imageIdToURI:ot,imageRetrieveMetadataProvider:Ar,imageToWorldCoords:Ov,indexWithinDimensions:xv,invertRgbTransferFunction:Mr,isEqual:Ne,isEqualAbs:f6,isEqualNegative:Hl,isImageActor:xt,isOpposite:Cv,isPTPrescaledWithSUV:Qu,isValidVolume:Gv,isVideoTransferSyntax:Bv,jumpToSlice:uT,loadImageToCanvas:Sv,makeVolumeMetadata:Cu,planar:Pm,pointInShapeCallback:Is,renderToCanvasCPU:tf,renderToCanvasGPU:ef,roundNumber:rf,roundToPrecision:$v,scaleArray:cT,scaleRgbTransferFunction:fv,scroll:of,snapFocalPointToSlice:qn,sortImageIdsAndGetSpacing:wu,spatialRegistrationMetadataProvider:ua,splitImageIdsBy4DTags:af,transferFunctionUtils:d6,transformIndexToWorld:ca,transformWorldToIndex:Va,transformWorldToIndexContinuous:Ii,triggerEvent:H,updateVTKImageDataWithCornerstoneImage:Wu,uuidv4:Rt,windowLevel:p6,worldToImageCoords:Mv});class mT{}const{PointsManager:vc}=cf,z=class z extends mT{static statsInit(e){e.storePointData||(z.pointsInShape=null)}};z.max=[-1/0],z.min=[1/0],z.sum=[0],z.count=0,z.maxIJK=null,z.maxLPS=null,z.minIJK=null,z.minLPS=null,z.runMean=[0],z.m2=[0],z.pointsInShape=vc.create3(1024),z.statsCallback=({value:e,pointLPS:n=null,pointIJK:r=null})=>{var a;Array.isArray(e)&&e.length>1&&z.max.length===1&&(z.max.push(z.max[0],z.max[0]),z.min.push(z.min[0],z.min[0]),z.sum.push(z.sum[0],z.sum[0]),z.runMean.push(0,0),z.m2.push(z.m2[0],z.m2[0])),z.pointsInShape&&n&&((a=z.pointsInShape)==null||a.push(n));const i=Array.isArray(e)?e:[e];z.count+=1,z.max.map((s,o)=>{const c=i[o],l=c-z.runMean[o];z.sum[o]+=c,z.runMean[o]+=l/z.count;const u=c-z.runMean[o];z.m2[o]+=l*u,z.min[o]=Math.min(z.min[o],c),c<z.min[o]&&(z.min[o]=c,o===0&&(z.minIJK=r,z.minLPS=n)),c>z.max[o]&&(z.max[o]=c,o===0&&(z.maxIJK=r,z.maxLPS=n))})},z.getStatistics=e=>{const n=z.sum.map(s=>s/z.count),r=z.m2.map(s=>Math.sqrt(s/z.count)),i=(e==null?void 0:e.unit)||null,a={max:{name:"max",label:"Max Pixel",value:di(z.max),unit:i,pointIJK:z.maxIJK,pointLPS:z.maxLPS},min:{name:"min",label:"Min Pixel",value:di(z.min),unit:i,pointIJK:z.minIJK,pointLPS:z.minLPS},mean:{name:"mean",label:"Mean Pixel",value:di(n),unit:i},stdDev:{name:"stdDev",label:"Standard Deviation",value:di(r),unit:i},count:{name:"count",label:"Pixel Count",value:z.count,unit:null},pointsInShape:z.pointsInShape,array:[]};return a.array.push(a.max,a.mean,a.stdDev,a.stdDev,a.count),z.max=[-1/0],z.min=[1/0],z.sum=[0],z.m2=[0],z.runMean=[0],z.count=0,z.maxIJK=null,z.maxLPS=null,z.minIJK=null,z.minLPS=null,z.pointsInShape=vc.create3(1024),a};let Ir=z;function di(t){return t.length===1?t[0]:t}const Tc=10,zs=class zs extends Ir{static getStatistics(e){const{spacing:n}=e,r=Ir.getStatistics(),i=n?"mm":"voxels",a=n?n[0]*n[1]*n[2]*1e3:1;return r.volume={value:Array.isArray(r.count.value)?r.count.value.map(s=>s*a):r.count.value*a,unit:i,name:"volume"},r.maxIJKs=this.maxIJKs,r.array.push(r.volume),this.maxIJKs=[],r}static statsCallback(e){Ir.statsCallback(e);const{value:n}=e,{maxIJKs:r}=this,{length:i}=r;if(!(typeof n!="number"||i>=Tc&&n<r[0].value)){if(!i||n>=r[i-1].value)r.push(e);else for(let a=0;a<i;a++)if(n<=r[a].value){r.splice(a,0,e);break}i>=Tc&&r.splice(0,1)}}};zs.maxIJKs=[];let zn=zs;const{VoxelManager:mi}=cf,yT={calculateSegmentsStatisticsVolume:t=>{const{segmentationInfo:e,imageInfo:n,indices:r}=t,{scalarData:i,dimensions:a,spacing:s}=e,{scalarData:o,dimensions:c}=n;if(a[0]!==c[0]||a[1]!==c[1]||a[2]!==c[2])throw new Error("Dimensions do not match to calculate statistics, different dimensions not supported yet");const l=mi.createScalarVolumeVoxelManager({dimensions:a,scalarData:i}),u=mi.createScalarVolumeVoxelManager({dimensions:c,scalarData:o});return l.forEach(({value:g,pointIJK:h,index:p})=>{if(r.indexOf(g)===-1)return;const d=u.getAtIndex(p);zn.statsCallback({value:d,pointIJK:h})},{boundsIJK:u.getDefaultBounds()}),zn.getStatistics({spacing:s,unit:"mm"})},calculateSegmentsStatisticsStack:t=>{const{segmentationInfo:e,imageInfo:n,indices:r}=t;for(let s=0;s<e.length;s++){const o=e[s],c=n[s],l=[o.dimensions[0],o.dimensions[1],1],u=mi.createScalarVolumeVoxelManager({dimensions:l,scalarData:o.scalarData}),f=mi.createScalarVolumeVoxelManager({dimensions:l,scalarData:c.scalarData});u.forEach(({value:g,pointIJK:h,index:p})=>{if(r.indexOf(g)===-1)return;const d=f.getAtIndex(p);zn.statsCallback({value:d})},{boundsIJK:f.getDefaultBounds()})}const i=e[0].spacing;return zn.getStatistics({spacing:i})}};b0(yT);

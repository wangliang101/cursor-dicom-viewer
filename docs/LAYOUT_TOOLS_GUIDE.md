# 多窗格布局工具使用指南

## 概述

DICOM查看器工具栏中有两个与布局相关的工具，它们服务于不同的目的，解决不同的需求。本指南将详细说明它们的区别和使用场景。

## 两个布局工具的详细说明

### 1. 窗格布局选择器 (LayoutSelector)

**图标**: 📱 网格图标 (AppstoreOutlined)  
**提示**: "切换窗格布局 (窗格数量和排列方式)"

#### 功能

- 控制显示器上**有多少个窗格**
- 控制窗格的**排列方式**（几行几列）
- 决定**整体布局结构**

#### 可选项

- **1x1**: 单窗格 - 一个大窗格显示
- **1x2**: 1行2列 - 左右两个窗格
- **2x1**: 2行1列 - 上下两个窗格
- **2x2**: 2行2列 - 四个窗格网格排列
- **3x1**: 3行1列 - 三个窗格垂直排列
- **1x3**: 1行3列 - 三个窗格水平排列
- **2x3**: 2行3列 - 六个窗格网格排列

#### 使用场景

- 需要同时查看多张不同的图像
- 对比分析（如治疗前后对比）
- 多病例并排查看
- 需要更多显示空间进行详细分析

### 2. 视图类型选择器 (MultiViewLayoutSelector)

**图标**: 🌿 分支图标 (BranchesOutlined)  
**提示**: "切换视图类型模式 (轴位、矢状位、冠状位等)"

#### 功能

- 控制每个窗格显示**什么类型的视图**
- 设置**医学影像的观察角度**
- 配置**专业的影像重建模式**

#### 可选项

- **单一视图**: 所有窗格都显示轴位视图（默认）
- **三平面视图**: 分别显示轴位、矢状位、冠状位
- **四视图+VR**: 三平面视图 + 体绘制视图
- **MPR四视图**: 多平面重建四视图
- **VR对比视图**: 轴位视图与体绘制对比

#### 使用场景

- 需要从多个角度观察病灶
- 进行复杂的三维结构分析
- 使用高级影像重建技术
- 专业的放射科阅片工作流程

## 工具的关系和协作

### 先后顺序

1. **第一步**: 使用窗格布局选择器确定需要几个窗格
2. **第二步**: 使用视图类型选择器设置每个窗格显示的视图类型

### 智能显示逻辑

- 当选择"1x1"单窗格布局时，视图类型选择器会自动隐藏（因为只有一个窗格）
- 只有在多窗格布局时，视图类型选择器才会显示

### 实际应用示例

#### 示例1: 常规CT阅片

1. 选择"2x2"四窗格布局
2. 选择"三平面视图"，自动在四个窗格中显示不同视角

#### 示例2: 对比分析

1. 选择"1x2"左右两窗格布局
2. 保持"单一视图"，手动在两个窗格中加载不同时期的图像

#### 示例3: 详细分析

1. 选择"2x3"六窗格布局
2. 选择"MPR四视图"进行多平面重建分析

## 用户界面优化

### 当前改进

- 更明确的工具提示说明
- 清晰的功能区分
- 智能的显示/隐藏逻辑

### 建议的进一步优化

1. **视觉分组**: 将两个工具放在同一个工具组中，用边框或背景色区分
2. **分步指导**: 在首次使用时提供简单的操作指导
3. **预设组合**: 提供常用的布局+视图类型组合预设

## 故障排除

### 常见问题

1. **Q**: 为什么有时候视图类型选择器不见了？
   **A**: 在单窗格(1x1)布局下，视图类型选择器会自动隐藏，因为只有一个窗格。

2. **Q**: 两个工具有什么区别？
   **A**: 窗格布局控制"有几个窗格"，视图类型控制"每个窗格显示什么"。

3. **Q**: 应该先设置哪个？
   **A**: 建议先设置窗格布局（确定窗格数量），再设置视图类型。

4. **Q**: 为什么选择某些多视图选项时没有反应？
   **A**: 系统会自动检查布局兼容性。例如，"MPR四视图"需要4个窗格，但1x2布局只有2个窗格，因此该选项会被过滤掉。

5. **Q**: 切换多视图时为什么会出现黑屏？
   **A**: 已修复。现在视图切换时会正确重新初始化并显示对应的视图类型。

### 最新修复 (v1.1)

#### 问题1：布局与视图类型不匹配

- **现象**: 在1x2布局下选择MPR四视图会导致逻辑错误
- **解决方案**:
  - 添加了智能兼容性检查
  - 多视图选择器只显示与当前布局兼容的选项
  - 选项描述中显示所需窗格数量
  - 不兼容的布局会自动过滤

#### 问题2：视图切换时黑屏

- **现象**: 从单视图切换到多视图时窗格变黑
- **解决方案**:
  - 重新设计ViewportPane组件的初始化逻辑
  - 添加了视图类型变化时的重新初始化机制
  - 改进了加载状态显示
  - 添加了视图类型指示器

#### 改进功能

- **布局兼容性验证**: 系统会自动检查并阻止不兼容的操作
- **智能选项过滤**: 只显示当前布局支持的多视图选项
- **视觉反馈增强**: 每个窗格都会显示当前的视图类型
- **错误恢复机制**: 不兼容时自动回退到默认单一视图

## 总结

这两个工具虽然都与"布局"相关，但服务于不同的需求层次：

- **窗格布局选择器**: 解决"显示结构"问题
- **视图类型选择器**: 解决"内容类型"问题

通过合理使用这两个工具，可以创建出适合不同诊断需求的个性化查看界面。最新版本已经解决了布局兼容性和视图切换的问题，提供了更加稳定和用户友好的体验。

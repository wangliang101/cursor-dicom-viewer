# 多窗格DICOM查看器功能演示

## 快速开始

### 1. 启动项目

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 2. 访问演示页面

- **主页面**: http://localhost:5173/
- **多窗格演示**: http://localhost:5173/multi-pane

## 功能演示

### 1. 布局切换演示

在多窗格演示页面中，您可以体验以下功能：

#### 步骤1: 加载演示数据

1. 点击页面顶部的"加载演示数据"按钮
2. 系统会加载4张模拟DICOM图像

#### 步骤2: 切换布局

1. 在工具栏中找到布局选择器（网格图标）
2. 点击下拉菜单查看所有可用布局：
   - 1x1 (单窗格)
   - 1x2 (1行2列)
   - 2x1 (2行1列)
   - 2x2 (2行2列)
   - 3x1 (3行1列)
   - 1x3 (1行3列)
   - 2x3 (2行3列)

#### 步骤3: 窗格交互

1. 点击任意窗格使其成为活动窗格
2. 活动窗格会显示蓝色边框高亮
3. 每个窗格显示编号和状态信息

### 2. 工具栏功能

多窗格查看器集成了完整的DICOM工具栏：

#### 基础工具

- **窗宽窗位**: 调整图像对比度
- **平移**: 移动图像位置
- **缩放**: 放大缩小图像
- **十字线**: 精确定位

#### 缩放控制

- **放大**: 增加缩放倍数
- **缩小**: 减少缩放倍数
- **适应窗口**: 重置到最佳显示尺寸
- **缩放显示**: 实时显示当前缩放百分比

#### 图像变换

- **重置**: 恢复图像初始状态
- **旋转**: 顺时针/逆时针旋转90度
- **翻转**: 水平/垂直翻转
- **反色**: 图像颜色反转

#### 测量工具

- **长度测量**: 测量距离
- **角度测量**: 测量角度
- **矩形ROI**: 矩形感兴趣区域
- **圆形ROI**: 圆形感兴趣区域
- **双向测量**: 双向距离测量
- **像素探针**: 像素值探测

#### 序列播放

- **播放/暂停**: 自动播放图像序列
- **上一帧/下一帧**: 手动切换图像
- **帧信息**: 显示当前帧位置

### 3. 响应式设计

#### 桌面端体验

- 完整的三栏布局（序列面板 + 查看器 + 控制面板）
- 所有工具栏功能完全可用
- 支持多种窗格布局

#### 移动端适配

- 自动折叠侧边面板
- 工具栏自适应布局
- 触摸友好的交互设计

### 4. 布局配置详解

每种布局都有其特定的使用场景：

#### 1x1 - 单窗格

- 适用于单张图像的详细查看
- 最大化显示区域
- 适合精细操作

#### 1x2 - 1行2列

- 适用于左右对比查看
- 常用于治疗前后对比
- 双侧器官对比

#### 2x1 - 2行1列

- 适用于上下对比查看
- 时间序列对比
- 不同切面对比

#### 2x2 - 2行2列

- 经典的四象限布局
- 多切面同时显示
- 全面的图像分析

#### 3x1 - 3行1列

- 适用于时间序列
- 多期相对比
- 纵向排列便于滚动查看

#### 1x3 - 1行3列

- 适用于横向对比
- 多个病例对比
- 宽屏显示器优化

#### 2x3 - 2行3列

- 适用于大量图像显示
- 批量阅片
- 全景式查看

## 技术亮点

### 1. CSS Grid布局

- 使用现代CSS Grid技术
- 灵活的网格系统
- 自适应容器尺寸

### 2. React Hooks

- 现代React开发模式
- 状态管理优化
- 组件复用性强

### 3. 模块化设计

- 组件高度解耦
- 易于扩展和维护
- 清晰的代码结构

### 4. 性能优化

- 按需渲染
- 状态缓存
- 事件优化

## 自定义扩展

### 添加新布局

```javascript
// 在 LAYOUT_CONFIGS 中添加新配置
'custom_layout': {
  name: '自定义布局',
  rows: 2,
  cols: 3,
  panes: [
    { row: 0, col: 0, rowSpan: 1, colSpan: 2 }, // 跨列窗格
    { row: 0, col: 2, rowSpan: 2, colSpan: 1 }, // 跨行窗格
    { row: 1, col: 0, rowSpan: 1, colSpan: 1 }, // 标准窗格
    { row: 1, col: 1, rowSpan: 1, colSpan: 1 }, // 标准窗格
  ]
}
```

### 窗格事件处理

```javascript
// 监听窗格切换事件
const handlePaneChange = (paneIndex) => {
  console.log(`切换到窗格 ${paneIndex + 1}`);
  // 自定义处理逻辑
};

// 监听布局变化事件
const handleLayoutChange = (newLayout) => {
  console.log(`布局切换到 ${newLayout}`);
  // 保存用户偏好设置
};
```

## 故障排除

### 常见问题

1. **布局显示异常**

   - 检查CSS Grid支持
   - 确认容器尺寸设置
   - 验证布局配置正确性

2. **窗格交互无响应**

   - 检查事件绑定
   - 确认组件状态更新
   - 验证props传递

3. **工具栏功能异常**
   - 检查Cornerstone.js初始化
   - 确认工具组配置
   - 验证viewport引用

### 调试技巧

1. **开启控制台日志**

   ```javascript
   // 在组件中添加调试信息
   console.log('当前布局:', currentLayout);
   console.log('活动窗格:', activePane);
   ```

2. **检查组件状态**

   ```javascript
   // 使用React DevTools查看组件状态
   // 监控props和state变化
   ```

3. **性能分析**
   ```javascript
   // 使用Performance API
   performance.mark('layout-start');
   // ... 布局切换代码
   performance.mark('layout-end');
   performance.measure('layout-time', 'layout-start', 'layout-end');
   ```

## 下一步计划

1. **集成真实DICOM数据**
2. **添加更多布局选项**
3. **实现窗格拖拽功能**
4. **优化移动端体验**
5. **添加键盘快捷键**

## 反馈与贡献

如果您在使用过程中遇到问题或有改进建议，欢迎：

1. 提交Issue报告问题
2. 提交Pull Request贡献代码
3. 参与讨论和功能规划

---

**注意**: 当前版本使用模拟数据进行演示，实际使用时需要集成真实的DICOM图像加载功能。

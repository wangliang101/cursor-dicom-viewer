# 多视图布局切换测试指南

## 快速测试步骤

### 1. 启动应用

```bash
npm start
```

### 2. 打开浏览器开发者工具

- 按 `F12` 或右键选择"检查元素"
- 切换到 `Console` (控制台) 标签页

### 3. 测试布局切换功能

#### 找到布局选择器

- 在顶部工具栏中找到网格图标 📱 (AppstoreOutlined)
- 提示文字为："切换窗格布局 (窗格数量和排列方式)"

#### 执行测试步骤

1. **查看初始状态**

   - 控制台应该显示："Cornerstone 初始化完成"
   - 初始布局应该是 "1x1"

2. **测试布局切换**

   - 点击布局选择器
   - 选择不同的布局选项：
     - `1x2` (1行2列)
     - `2x1` (2行1列)
     - `2x2` (2行2列)
     - `1x3` (1行3列)
     - 等等

3. **观察控制台输出**
   每次切换布局时，应该看到类似以下的日志：

   ```
   布局切换: 1x1 -> 1x2
   MainLayout 布局变化: 1x2
   ViewerContainer 渲染 - 当前布局: 1x2
   重新配置视口以适应布局: 1x2
   多窗格布局将由MultiPaneViewer组件处理
   布局切换已完成，当前布局: 1x2
   视口配置完成，当前布局: 1x2
   ```

4. **切换回单窗格**
   - 选择 `1x1` 布局
   - 控制台应该显示视口被重新创建
   - 如果之前加载了DICOM图像，应该能正常显示

### 4. 测试多视图类型选择器

#### 找到多视图选择器

- 在多窗格布局下（非1x1），会显示分支图标 🌿 (BranchesOutlined)
- 提示文字为："切换视图类型模式 (轴位、矢状位、冠状位等)"

#### 测试步骤

1. **先切换到多窗格布局** (如2x2)
2. **点击多视图选择器**
3. **尝试选择不同选项**：
   - 单一视图
   - 三平面视图
   - 四视图+VR
   - 等等

### 5. 验证预期行为

#### ✅ 正常行为

- [ ] 布局切换被正确检测和记录
- [ ] 控制台显示详细的切换过程
- [ ] 在1x1布局下，多视图选择器隐藏
- [ ] 在多窗格布局下，显示MultiPaneViewer组件
- [ ] 布局指示器正确显示当前布局
- [ ] 没有JavaScript错误

#### ❌ 异常行为

如果发现以下问题，请报告：

- 布局切换没有响应
- 控制台出现错误信息
- 多视图选择器显示异常
- 视口创建失败

## 高级测试

### 测试DICOM图像加载

1. 上传一些DICOM文件
2. 在单窗格模式下确认图像正常显示
3. 切换到多窗格布局
4. 观察图像在不同窗格中的显示

### 测试工具功能

1. 在单窗格模式下测试各种工具：
   - 窗宽窗位调整
   - 缩放和平移
   - 旋转和翻转
2. 切换布局后确认工具状态

### 性能测试

1. 快速连续切换多个布局
2. 观察内存使用情况
3. 检查是否有内存泄漏

## 已知限制

### 当前版本的限制

1. **多窗格Cornerstone集成未完成**：多窗格布局目前显示占位内容
2. **视图类型功能模拟**：三平面视图等功能还在开发中
3. **工具同步**：多个视口之间的工具状态同步还需完善

### 预期的后续改进

1. 为MultiPaneViewer添加真实的Cornerstone支持
2. 实现真正的多平面重建(MPR)
3. 添加体绘制(VR)支持
4. 优化布局切换的动画效果

## 报告问题

如果发现问题，请提供：

1. **浏览器信息** (Chrome, Firefox, Safari等)
2. **控制台错误信息** (完整的错误堆栈)
3. **重现步骤** (详细的操作步骤)
4. **预期行为** vs **实际行为**
5. **截图或录屏** (如果可能)

## 开发者信息

### 调试技巧

- 使用 `console.log` 追踪布局状态变化
- 在 React DevTools 中观察组件状态
- 检查 Cornerstone 渲染引擎的状态

### 相关文件

- `src/pages/Layout/index.jsx` - 主要的布局逻辑
- `src/components/MainLayout/index.jsx` - 布局参数传递
- `src/components/ViewerContainer/index.jsx` - 视图容器
- `src/components/DicomToolbar/index.jsx` - 布局选择器
- `src/components/MultiPaneViewer/` - 多窗格查看器
